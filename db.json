{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"source/images/logo-header.png","path":"images/logo-header.png","modified":0,"renderable":0},{"_id":"themes/ayer/source/404.html","path":"404.html","modified":0,"renderable":1},{"_id":"themes/ayer/source/favicon.ico","path":"favicon.ico","modified":0,"renderable":1},{"_id":"themes/ayer/source/css/clipboard.styl","path":"css/clipboard.styl","modified":0,"renderable":1},{"_id":"themes/ayer/source/css/custom.styl","path":"css/custom.styl","modified":0,"renderable":1},{"_id":"themes/ayer/source/dist/main.js","path":"dist/main.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/dist/main.css","path":"dist/main.css","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/404.jpg","path":"images/404.jpg","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/alipay.jpg","path":"images/alipay.jpg","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/ayer-side.svg","path":"images/ayer-side.svg","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/ayer.png","path":"images/ayer.png","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/ayer.svg","path":"images/ayer.svg","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/beian.png","path":"images/beian.png","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/cover3.jpg","path":"images/cover3.jpg","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/cover6.jpeg","path":"images/cover6.jpeg","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/forkme.png","path":"images/forkme.png","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/gitee.png","path":"images/gitee.png","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/github.png","path":"images/github.png","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/hexo-tag-chart.png","path":"images/hexo-tag-chart.png","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/hexo.png","path":"images/hexo.png","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/logo-header.png","path":"images/logo-header.png","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/mouse.cur","path":"images/mouse.cur","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/sponsor.jpg","path":"images/sponsor.jpg","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/cover7.jpeg","path":"images/cover7.jpeg","modified":0,"renderable":1},{"_id":"themes/ayer/source/images/wechat.jpg","path":"images/wechat.jpg","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/busuanzi-2.3.pure.min.js","path":"js/busuanzi-2.3.pure.min.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/clickBoom1.js","path":"js/clickBoom1.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/clickBoom2.js","path":"js/clickBoom2.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/clickLove.js","path":"js/clickLove.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/dz.js","path":"js/dz.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/jquery-3.6.0.min.js","path":"js/jquery-3.6.0.min.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/lazyload.min.js","path":"js/lazyload.min.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/search.js","path":"js/search.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/js/tocbot.min.js","path":"js/tocbot.min.js","modified":0,"renderable":1},{"_id":"themes/ayer/source/css/fonts/JetBrainsMono-Regular-2.ttf","path":"css/fonts/JetBrainsMono-Regular-2.ttf","modified":0,"renderable":1},{"_id":"themes/ayer/source/css/fonts/ZhuZiAWan-2.ttc","path":"css/fonts/ZhuZiAWan-2.ttc","modified":0,"renderable":1},{"_id":"themes/ayer/source/css/fonts/remixicon.eot","path":"css/fonts/remixicon.eot","modified":0,"renderable":1},{"_id":"themes/ayer/source/css/fonts/remixicon.ttf","path":"css/fonts/remixicon.ttf","modified":0,"renderable":1},{"_id":"themes/ayer/source/css/fonts/remixicon.svg","path":"css/fonts/remixicon.svg","modified":0,"renderable":1},{"_id":"themes/ayer/source/css/fonts/remixicon.woff","path":"css/fonts/remixicon.woff","modified":0,"renderable":1},{"_id":"themes/ayer/source/css/fonts/remixicon.css","path":"css/fonts/remixicon.css","modified":0,"renderable":1},{"_id":"themes/ayer/source/css/fonts/remixicon.woff2","path":"css/fonts/remixicon.woff2","modified":0,"renderable":1}],"Cache":[{"_id":"source/CNAME","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1661478179879},{"_id":"source/.DS_Store","hash":"aae39e28a15d542b7d4cf19a1fb6baab58aa74a5","modified":1661478179879},{"_id":"source/_posts/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1661478179880},{"_id":"source/_posts/JS常用工具类汇总(持续完善...).md","hash":"7f29f8dab27e32ce84b4159be491593d2f00f4b6","modified":1661478179880},{"_id":"source/_posts/hello-world.md","hash":"667f9a8070fd6f1612c307155ecf4934bbbb870e","modified":1661478179881},{"_id":"source/_posts/filter、map、reduce的使用.md","hash":"e0dbc13b4c2c2fdd9c2c3dabe1d95d784f635c52","modified":1661478179881},{"_id":"source/_posts/关于跨域，我想说.md","hash":"fd70e051386b05376d6a6569310c6359e8b12beb","modified":1661478179882},{"_id":"source/_posts/前端常见面试题积累.md","hash":"750d2f544221b5cf782abd224148ae9316f34fc9","modified":1661478179882},{"_id":"source/_posts/国密4加密算法备份.md","hash":"36a558da46d259d3418978cf942f82b9700dbd7a","modified":1661478179882},{"_id":"source/_posts/安装Docker和Jenkins.md","hash":"5a14602da587344488e42ed116a453c1f55d30b8","modified":1661478179883},{"_id":"source/_posts/如何搭建个人博客.md","hash":"e952c9149f5307c237e6fd69b18580a3cec62d11","modified":1661478179883},{"_id":"source/_posts/持久化vuex.md","hash":"dd7713ccc3aaab47aa9ec340931dd15d4d424289","modified":1661478179884},{"_id":"source/_posts/实用的Vue自定义指令.md","hash":"edfa2d79bf75e81ce3759cabf5f3d1b2b71b7ce8","modified":1661478179884},{"_id":"source/about/index.md","hash":"31097de0a5f33b663531f0c0dd81626c7d7064c9","modified":1661478179885},{"_id":"source/images/logo-header.png","hash":"b1ab4f3bb13e27b82093402de2078a6e5ecefbfb","modified":1661478179885},{"_id":"source/_posts/我的prettier-config.md","hash":"d17783997f5c7cc344b05bc2c2fe6b47600d98c9","modified":1661478474848},{"_id":"source/categories/index.md","hash":"f4ad2754c162406f5784571301e79de183c394ea","modified":1661478179885},{"_id":"source/_posts/那些开发中的css技巧.md","hash":"2da8360da3381b2b3f81b93dc24813731cdb779b","modified":1661478179884},{"_id":"source/photos/index.md","hash":"0d3909776cc77075868744a8be801b59ce228d8e","modified":1661478179886},{"_id":"source/tags/index.md","hash":"de28cee4b554851c9cb8554bf1374baa0de8d428","modified":1661478179886},{"_id":"themes/ayer/.gitignore","hash":"b18b650c857471724778c1450c446b93192d8b0e","modified":1660642986570},{"_id":"themes/ayer/.gitattributes","hash":"0a06233e35936dfb7efe1472917805056a159fa2","modified":1660642986570},{"_id":"themes/ayer/.npmignore","hash":"1744752b89ad4271612ff0a03232ed56484e592c","modified":1660642986570},{"_id":"themes/ayer/.stylintrc","hash":"557d72b4dcd86e66fc5c688595288cf06b12ce6c","modified":1660642986571},{"_id":"themes/ayer/.travis.yml","hash":"e8e8c5607528fd55ac11dde00b6186d3ea52fdef","modified":1660642986571},{"_id":"themes/ayer/LICENSE","hash":"e39066a824465f4d6ad5ce7903b4d683d38d2b6c","modified":1660642986571},{"_id":"themes/ayer/index.js","hash":"19292aa9df268dbab8ac51a2a3aa7a20ac1eb00a","modified":1660642986571},{"_id":"themes/ayer/README.md","hash":"4e515889ec444939e9a06947fae120503a3fa7b2","modified":1660642986571},{"_id":"themes/ayer/_config.yml","hash":"c38923f87865147d1d1fb393aca8ae6bfe15cb01","modified":1660814126806},{"_id":"themes/ayer/move_config.js","hash":"e310bdb9a8738e506e53a40bd3cd895008d4cd61","modified":1660642986576},{"_id":"themes/ayer/package.json","hash":"5424c8abe79bf3dde54dfbf64f6814b31379f97b","modified":1660723676113},{"_id":"themes/ayer/rollup.config.js","hash":"13b61821acd9fc27131a34853037184b94ae8577","modified":1660642986576},{"_id":"themes/ayer/.github/FUNDING.yml","hash":"186f05c1b9509a4ad957490004ff37462aedd984","modified":1660642986570},{"_id":"themes/ayer/.github/config.yml","hash":"0300d3458011582f8158a3588912dac4cb3ec21a","modified":1660642986570},{"_id":"themes/ayer/languages/default.yml","hash":"7e16c460c2c3d953c3bdebdef471ea747812b7a1","modified":1660642986571},{"_id":"themes/ayer/languages/en.yml","hash":"7e16c460c2c3d953c3bdebdef471ea747812b7a1","modified":1660642986571},{"_id":"themes/ayer/languages/de.yml","hash":"cdeed93d1eb4e65195aaf97d8c517e97106ddfd5","modified":1660642986571},{"_id":"themes/ayer/languages/fr.yml","hash":"4a3cb84884988624943c6b0f8c1754da34943092","modified":1660642986571},{"_id":"themes/ayer/languages/ja.yml","hash":"d2ccb7ac8c9ff2ee721843741bb30b019d0a8083","modified":1660642986572},{"_id":"themes/ayer/languages/ko.yml","hash":"7dc54c2db864e5b725b55e201030e92acc1c422e","modified":1660642986572},{"_id":"themes/ayer/languages/nl.yml","hash":"2c289e97000c0c67636d96895aaa801c8abec0d4","modified":1660642986572},{"_id":"themes/ayer/languages/no.yml","hash":"f8d7294f0d73ec35c37c050462cb725ea25a0fcc","modified":1660642986572},{"_id":"themes/ayer/languages/pt.yml","hash":"b137b9aead0dc4e2c2d9217ceb270460e41f5cb3","modified":1660642986572},{"_id":"themes/ayer/languages/es.yml","hash":"a3e8d81b99f62f86b3f34708253070b8806b31c8","modified":1660642986571},{"_id":"themes/ayer/languages/ru.yml","hash":"cdce73598db1aefb17b1c91658cfa4c906b98e24","modified":1660642986572},{"_id":"themes/ayer/languages/vi.yml","hash":"7d019ee795816a6a030a039d8238b71be04098fd","modified":1660642986572},{"_id":"themes/ayer/languages/zh-TW.yml","hash":"edb2654bdb684fe0f21e8d6c841496c3506006ed","modified":1660642986572},{"_id":"themes/ayer/layout/archive.ejs","hash":"2703b07cc8ac64ae46d1d263f4653013c7e1666b","modified":1660642986575},{"_id":"themes/ayer/layout/categories.ejs","hash":"c40f84aacdf7d33cfcb4eb9f78f331dad699abff","modified":1660642986576},{"_id":"themes/ayer/layout/friends.ejs","hash":"18382cd4429588e58bf046beacaed06704832fe3","modified":1660642986576},{"_id":"themes/ayer/languages/zh-CN.yml","hash":"68400b1859e58cba03b05020ac8f47b807933027","modified":1660642986572},{"_id":"themes/ayer/layout/index.ejs","hash":"77347cbb8635611d8b1fb84bde75f9dedaf8632d","modified":1660642986576},{"_id":"themes/ayer/layout/layout.ejs","hash":"84864bd6b4fc92bdd0a8ccba491fe490a8ecbf9b","modified":1660642986576},{"_id":"themes/ayer/layout/page.ejs","hash":"a9a48ae63f5d68a36382951166fdd6e482b901f1","modified":1660642986576},{"_id":"themes/ayer/layout/plain-page.ejs","hash":"39cce1936f5f0e2feb924a7af2f52a631d81b84f","modified":1660642986576},{"_id":"themes/ayer/layout/post.ejs","hash":"a9a48ae63f5d68a36382951166fdd6e482b901f1","modified":1660642986576},{"_id":"themes/ayer/layout/tags.ejs","hash":"88b34dd8d7b1e64fa27aa6ed72af996cf6700809","modified":1660642986576},{"_id":"themes/ayer/scripts/default_config.js","hash":"70d6ee032d75410d540b6789b5949739a47f0125","modified":1660642986578},{"_id":"themes/ayer/source/404.html","hash":"155c674062d18ab392fa47ac837dd7afe77f8a56","modified":1660642986581},{"_id":"themes/ayer/source/favicon.ico","hash":"473ba682e828a7e34f24fae320e77b6bed4260c7","modified":1660642986588},{"_id":"themes/ayer/source-src/main.js","hash":"13c57a2cec878217a5a3ee9afb6705d4c3cc0d3c","modified":1660642986581},{"_id":"themes/ayer/.github/ISSUE_TEMPLATE/bug-report.md","hash":"4be6c40d386582293bcabf96321277238db57a51","modified":1660642986570},{"_id":"themes/ayer/.github/ISSUE_TEMPLATE/feature-request.md","hash":"d8d4951f5f3f08660dc4ba6d1a44eb56d3b094b4","modified":1660642986570},{"_id":"themes/ayer/.github/ISSUE_TEMPLATE/question.md","hash":"6cb78a96b83ed228fb3c956f2dbc654220335ec0","modified":1660642986570},{"_id":"themes/ayer/.github/ISSUE_TEMPLATE/other.md","hash":"94ee4baf54bfa786228aafc0f2f8c17076a99a0b","modified":1660642986570},{"_id":"themes/ayer/.github/workflows/npmpublish.yml","hash":"3ff1b124e532465ba14475f3ea8f4ec5d8856028","modified":1660642986570},{"_id":"themes/ayer/layout/_partial/ads.ejs","hash":"d36962c66e3653aa94cc428731dd43a7ea4f979d","modified":1660642986572},{"_id":"themes/ayer/layout/_partial/after-footer.ejs","hash":"17ccda6fb61f1b6df94d23db936665c00a29a85b","modified":1660642986572},{"_id":"themes/ayer/layout/_partial/archive-post.ejs","hash":"9be7173badcca6582c1136204adb3aa432aada21","modified":1660642986572},{"_id":"themes/ayer/layout/_partial/archive.ejs","hash":"a56c8905987fa86657a9f081a89c12e5a5a5df54","modified":1660642986572},{"_id":"themes/ayer/layout/_partial/article.ejs","hash":"41a2f132410c77891cc8117062a0700d8ed64bb9","modified":1660642986572},{"_id":"themes/ayer/layout/_partial/ayer.ejs","hash":"01ca257dde90dcadf1288a641401f6cf21a0ad43","modified":1660642986573},{"_id":"themes/ayer/layout/_partial/baidu-analytics.ejs","hash":"f0e6e88f9f7eb08b8fe51449a8a3016273507924","modified":1660642986573},{"_id":"themes/ayer/layout/_partial/broadcast.ejs","hash":"c228fa93bcf2f8403729342854211ea976df9a9f","modified":1660642986573},{"_id":"themes/ayer/layout/_partial/float-btns.ejs","hash":"43ba0cd1f9e898bcbd873b1e9a2d47249d6aaf77","modified":1660642986573},{"_id":"themes/ayer/layout/_partial/footer.ejs","hash":"1407c1043fdb628642de9d2990921d92a3c2f078","modified":1660642986573},{"_id":"themes/ayer/layout/_partial/google-analytics.ejs","hash":"ca81abe75c80ab32d6b6c4fe65de8e74df07bef3","modified":1660642986573},{"_id":"themes/ayer/layout/_partial/head.ejs","hash":"61100fe248a744fab5dc71fb610992cbeff27e54","modified":1660642986573},{"_id":"themes/ayer/layout/_partial/lock.ejs","hash":"bbb00715c204197e7790d08be9a29afe5976146e","modified":1660642986573},{"_id":"themes/ayer/layout/_partial/katex.ejs","hash":"752666b28d5caed5e7d82d697d7546461e451d6f","modified":1660642986573},{"_id":"themes/ayer/layout/_partial/mathjax.ejs","hash":"d38a59e2316b8a9c233c2f41edc2a03eab2c0a2e","modified":1660642986573},{"_id":"themes/ayer/layout/_partial/music.ejs","hash":"678db9d41f2c5bd9ebdeaa9e6e5392836c47255a","modified":1660808876258},{"_id":"themes/ayer/layout/_partial/modal.ejs","hash":"cf441365eff1f8143e3c9ae54954d0ebe0a358e5","modified":1660642986573},{"_id":"themes/ayer/layout/_partial/sidebar.ejs","hash":"e3b411aef6e5f25f6c5c66b93d653ef70da8d4af","modified":1660642986575},{"_id":"themes/ayer/layout/_partial/viewer.ejs","hash":"7bcde0d6384819fd4c975a6e6e24e0919fbb1593","modified":1660642986575},{"_id":"themes/ayer/scripts/events/index.js","hash":"2c84d99e881f5cd1ee8a406b595a4365f3aea41e","modified":1660642986578},{"_id":"themes/ayer/scripts/helpers/ayer-plus-vendors.js","hash":"7b3df58faaa875d17afbf74ddef5601116f2ce3d","modified":1660642986578},{"_id":"themes/ayer/scripts/helpers/wordcount.js","hash":"f9c8fceb2130929b8f11e22b1c3476c99d1574a8","modified":1660642986578},{"_id":"themes/ayer/scripts/filters/index.js","hash":"e435b782178da75656f9616c7af564fb9ff0de50","modified":1660642986578},{"_id":"themes/ayer/scripts/filters/meta_generator.js","hash":"58f4c93d22e4eb9743915223444335fb6fe06d21","modified":1660642986578},{"_id":"themes/ayer/scripts/utils/join-path.js","hash":"629e7deb3955f750c1cfa6fc773f412e020fcef4","modified":1660642986578},{"_id":"themes/ayer/scripts/lib/core.js","hash":"7908a82a86d63f35c6f785cacb1cfaf99ae7e0f9","modified":1660642986578},{"_id":"themes/ayer/scripts/utils/object.js","hash":"649457796374c79e49a19bd541e4ad8e78fe8995","modified":1660642986578},{"_id":"themes/ayer/source/css/.DS_Store","hash":"7ecd6d8d9dfef41a22084fec1635d04e4d751696","modified":1660727257688},{"_id":"themes/ayer/source/css/clipboard.styl","hash":"017f9b628806eeb199da2e77485cd9ac8e2117b3","modified":1660642986582},{"_id":"themes/ayer/source/css/custom.styl","hash":"56276abe6cd7cbf49fbf4fd4c986733188374160","modified":1660806050825},{"_id":"themes/ayer/source/dist/main.js","hash":"436093b4310b4656fb1e60ae946d04b85d6b1fa5","modified":1661148251375},{"_id":"themes/ayer/source/dist/main.css","hash":"731eb90f7bab976fa2b2590ee6fb3dc215c99b38","modified":1661148251375},{"_id":"themes/ayer/source/images/ayer-side.svg","hash":"ad004ce7a873de0f91774f3d5923e010396a07bd","modified":1660642986588},{"_id":"themes/ayer/source/images/ayer.png","hash":"0466c05244273f645d239cd27513bfa3c50308aa","modified":1660642986589},{"_id":"themes/ayer/source/images/ayer.svg","hash":"379c3307f97c364718a1dbc1e52fb14de12eb11a","modified":1660642986589},{"_id":"themes/ayer/source/images/beian.png","hash":"29c400bc3b89f6085766dac4e0330ded5cb73d52","modified":1660642986589},{"_id":"themes/ayer/source/.DS_Store","hash":"3c5c8276e521bd59a851969a1ac652b543adb750","modified":1660721421730},{"_id":"themes/ayer/source/images/404.jpg","hash":"4f36a8d378712427cded03f5166949f5e0ba754c","modified":1660642986588},{"_id":"themes/ayer/source/images/forkme.png","hash":"99c3e21a169421e4f249befb428396c729863a75","modified":1660642986597},{"_id":"themes/ayer/source/images/gitee.png","hash":"250da578e0bd1393f22737f58d0fbae95119e527","modified":1660642986597},{"_id":"themes/ayer/source/images/github.png","hash":"4853ff37f9d859e7faa77675632a73f8ef089a15","modified":1660642986597},{"_id":"themes/ayer/source/images/hexo-tag-chart.png","hash":"6db432aae30556d151c2fd2c1d11015d9309ba81","modified":1660642986597},{"_id":"themes/ayer/source/images/hexo.png","hash":"6b0315fba8a8f496491079b361e2fb5253e19a04","modified":1660642986598},{"_id":"themes/ayer/source/images/logo-header.png","hash":"b1ab4f3bb13e27b82093402de2078a6e5ecefbfb","modified":1660722155162},{"_id":"themes/ayer/source/images/mouse.cur","hash":"86f902fa3e8e570c7f003d579c22734b13ae73ec","modified":1660723390770},{"_id":"themes/ayer/source/images/sponsor.jpg","hash":"5b5e4498177b369a7eca7ab2b1d0710b8690e21d","modified":1660642986598},{"_id":"themes/ayer/source/js/clickBoom1.js","hash":"afd4a981d3a56c40898248152009d478a3cd0d1e","modified":1660642986598},{"_id":"themes/ayer/source/js/clickBoom2.js","hash":"d3fe9e8c7046bec9745628f61d61e4102171ac2b","modified":1660642986598},{"_id":"themes/ayer/source/js/clickLove.js","hash":"a35dfb7ff19796c005ee30b55fd95e39d6d59a89","modified":1660642986599},{"_id":"themes/ayer/source/js/busuanzi-2.3.pure.min.js","hash":"6e41f31100ae7eb3a6f23f2c168f6dd56e7f7a9a","modified":1660642986598},{"_id":"themes/ayer/source/js/dz.js","hash":"079ae73e2e396c2e00919a50a6fe0d064f99303a","modified":1660722872266},{"_id":"themes/ayer/source/js/lazyload.min.js","hash":"b801b3946fb9b72e03512c0663458e140e1fa77b","modified":1660642986599},{"_id":"themes/ayer/source/js/tocbot.min.js","hash":"bae97e8a24a05a99335f8e725641c8ca9c50502a","modified":1660642986599},{"_id":"themes/ayer/source/js/search.js","hash":"118be0e0918532ac1225f62e1a0a6f0673e0b173","modified":1660642986599},{"_id":"themes/ayer/source-src/css/_darkmode.styl","hash":"219753a5cf40cfbd557fbde01a71f589e6de4327","modified":1660642986579},{"_id":"themes/ayer/source-src/css/_extend.styl","hash":"8dedef428b6ac7d629e1d1f6039b0f60dacc4c5e","modified":1660642986579},{"_id":"themes/ayer/source-src/css/_normalize.styl","hash":"630e719b9e805a26182a37152435d4787c0f1734","modified":1660642986579},{"_id":"themes/ayer/source-src/css/_mixins.styl","hash":"6959409df2dd0a1ca05be0c0e9b2a884efdfb82d","modified":1660642986579},{"_id":"themes/ayer/source-src/css/_remixicon.styl","hash":"ce395318edf69766fe11161c4587a97f84521d85","modified":1660642986581},{"_id":"themes/ayer/source-src/css/_variables.styl","hash":"29a84486cced34944f66582d638108685e9746a8","modified":1660727587965},{"_id":"themes/ayer/source-src/css/style.styl","hash":"fed7a2a0a05f42974097eade3231ba72b5bd0cf9","modified":1661148058532},{"_id":"themes/ayer/source-src/js/ayer.js","hash":"538d48e89c9908155f16ff82aaf4c2b1122b11f4","modified":1660642986581},{"_id":"themes/ayer/source-src/js/share.js","hash":"7edce2efe23e75e29765201dc8b00fd2a5b5c9d2","modified":1660642986581},{"_id":"themes/ayer/layout/_partial/post/albums.ejs","hash":"cfb16c9dda7a609776a28702e0c3854a52e422a7","modified":1660642986573},{"_id":"themes/ayer/layout/_partial/post/author.ejs","hash":"57738b222e00bbd110be65d300d8bed34d73b3ea","modified":1660642986573},{"_id":"themes/ayer/layout/_partial/post/busuanzi.ejs","hash":"4647234e5c4529d754c9d0fc53ca9e9205f21443","modified":1660642986574},{"_id":"themes/ayer/layout/_partial/post/category.ejs","hash":"85f0ebeceee1c32623bfa1e4170dbe1e34442fea","modified":1660642986574},{"_id":"themes/ayer/layout/_partial/post/clipboard.ejs","hash":"9f86e3d222555181a3e631a09bcdabdd44507cb8","modified":1660642986574},{"_id":"themes/ayer/layout/_partial/post/gallery.ejs","hash":"5f8487fe7bed9a09001c6655244ff35f583cf1eb","modified":1660642986574},{"_id":"themes/ayer/layout/_partial/post/gitalk.ejs","hash":"bc540478d35780e142b069ba2adafd5d5ce8a7b0","modified":1660642986574},{"_id":"themes/ayer/layout/_partial/post/date.ejs","hash":"6197802873157656e3077c5099a7dda3d3b01c29","modified":1660642986574},{"_id":"themes/ayer/layout/_partial/post/minivaline.ejs","hash":"41de9084eedcbba1403897c4aa01ced0cb6b9ba5","modified":1660642986574},{"_id":"themes/ayer/layout/_partial/post/nav.ejs","hash":"e59198918e92ef92156aeefbf6023584ac1cae64","modified":1660642986574},{"_id":"themes/ayer/layout/_partial/post/justifiedGallery.ejs","hash":"4a21fd3d7335ffcd0661036fee81a927c125e2e2","modified":1660642986574},{"_id":"themes/ayer/layout/_partial/post/search.ejs","hash":"2c9d19d1685e834aa2020998da2a2d259ce9b9ff","modified":1660642986574},{"_id":"themes/ayer/layout/_partial/post/share.ejs","hash":"0a364766931f48df60b7c92fec8fde1067a93e00","modified":1660642986575},{"_id":"themes/ayer/layout/_partial/post/tag.ejs","hash":"2fcb0bf9c8847a644167a27824c9bb19ac74dd14","modified":1660642986575},{"_id":"themes/ayer/layout/_partial/post/tocbot.ejs","hash":"9898b0dd9237e21908ba40292a8a9f947bed44d2","modified":1660642986575},{"_id":"themes/ayer/layout/_partial/post/topping.ejs","hash":"fea793e132f627a8148059a9aee8bc33550506d1","modified":1660642986575},{"_id":"themes/ayer/layout/_partial/post/twikoo.ejs","hash":"63bc5c056b2db2aca479705fc94eaa7fd26a7976","modified":1660642986575},{"_id":"themes/ayer/layout/_partial/post/valine.ejs","hash":"369396d0c5b669df7a26df95f7a1b8a52f4eea65","modified":1660642986575},{"_id":"themes/ayer/layout/_partial/post/word.ejs","hash":"4b8e8455709debd73fba6bf3aad63378c4156dc1","modified":1660642986575},{"_id":"themes/ayer/scripts/events/lib/hello.js","hash":"2ed130e5e1c2bc021be8d755f34c4fcf61a60121","modified":1660642986578},{"_id":"themes/ayer/layout/_partial/post/title.ejs","hash":"3b076a65b9847cd6e0d424f5c2874046ef51d4d9","modified":1660642986575},{"_id":"themes/ayer/scripts/events/lib/merge-configs.js","hash":"54836a1b41ebb32acc41839f53e1892779f66bb2","modified":1660642986578},{"_id":"themes/ayer/source-src/css/_partial/ads.styl","hash":"d4be39f60a81dd0e5bdd49671e7308deddc572de","modified":1660642986579},{"_id":"themes/ayer/source-src/css/_partial/albums.styl","hash":"0659d5f7469f24a415354ff767d949926465d515","modified":1660642986579},{"_id":"themes/ayer/source-src/css/_partial/apple.styl","hash":"e06dce604cc58ec39d677e4e59910c2725684901","modified":1660642986579},{"_id":"themes/ayer/source-src/css/_partial/archive.styl","hash":"3044bf059522e79a726265c9a2f603ec8dc4222d","modified":1660642986579},{"_id":"themes/ayer/source-src/css/_partial/article.styl","hash":"5584a2caf6ce3138e7af8e8fea69539a936b9298","modified":1660722396864},{"_id":"themes/ayer/source-src/css/_partial/articles.styl","hash":"c293d484b6b9aa701cd8d435e2f82c243135723c","modified":1660806079422},{"_id":"themes/ayer/source-src/css/_partial/categories.styl","hash":"3b11d0c6c4439b0856ba81c50bd8867d5bb081da","modified":1660642986579},{"_id":"themes/ayer/source-src/css/_partial/footer.styl","hash":"1a4576c38ef19834a4d0a8ac887e7b55d21f2f13","modified":1660642986580},{"_id":"themes/ayer/source-src/css/_partial/friends.styl","hash":"9dd116846c92daee1c8f80b79cab231613b164b2","modified":1660642986580},{"_id":"themes/ayer/source-src/css/_partial/gallery.styl","hash":"7bdc2c9fb4971dbd7511c5cbb69bd611f20db591","modified":1660642986580},{"_id":"themes/ayer/source-src/css/_partial/gitalk.styl","hash":"3706eef2e0541493f1679a30241d279e29dfdc17","modified":1660642986580},{"_id":"themes/ayer/source-src/css/_partial/highlight.styl","hash":"e9149be88e1ebc135cf0c786418020eb2429b021","modified":1660727394021},{"_id":"themes/ayer/source-src/css/_partial/justifiedGallery.styl","hash":"f2f43ae9831c3df017b35c68caa94f5eb911f697","modified":1660642986580},{"_id":"themes/ayer/source-src/css/_partial/layout.styl","hash":"9cbc5d7c647d3628a22a24512eee2fbf29c5201f","modified":1661148243756},{"_id":"themes/ayer/source-src/css/_partial/lists.styl","hash":"da8a82a48852411c10e279dfee43038d46f4f273","modified":1660642986580},{"_id":"themes/ayer/source-src/css/_partial/mobile.styl","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1660642986580},{"_id":"themes/ayer/source-src/css/_partial/ayer.styl","hash":"ffe15ecce0c4c1a2f3e18d919584aa2941bd72f1","modified":1660808949047},{"_id":"themes/ayer/source-src/css/_partial/float.styl","hash":"d888df89a172e4c8119cb8740fc1eae1a9539157","modified":1660642986580},{"_id":"themes/ayer/source-src/css/_partial/navbar.styl","hash":"da34b6125de01938d11de6ad3c0fed2c75faf40a","modified":1660720655772},{"_id":"themes/ayer/source-src/css/_partial/pace.styl","hash":"bde7bf3577c66a3ac829410d52fa2144212282ef","modified":1660642986580},{"_id":"themes/ayer/source-src/css/_partial/reward.styl","hash":"a8a069ea34a0fd043832890db5341405e9f462cd","modified":1660642986581},{"_id":"themes/ayer/source-src/css/_partial/search.styl","hash":"f81076fc6d4a83be3371bcb79ab54d88e2605714","modified":1660642986581},{"_id":"themes/ayer/source-src/css/_partial/sidebar.styl","hash":"600c70f1de82da5223af290d47a583f9c379d188","modified":1660642986581},{"_id":"themes/ayer/source-src/css/_partial/tag.styl","hash":"87df748185edfba222c3f9a4b9ef8eee0e8e5ad3","modified":1660642986581},{"_id":"themes/ayer/source-src/css/_partial/share.styl","hash":"9ce2dd3ffdc4e170dfcb975a7158f913bc40b8d8","modified":1660642986581},{"_id":"themes/ayer/source-src/css/_partial/tocbot.styl","hash":"007bca390ec685349add74e033ff2cb90a1701bc","modified":1660642986581},{"_id":"themes/ayer/source-src/css/_partial/totop.styl","hash":"9e9d8dc167ed2c332e4520cbf41244c34c1ebf64","modified":1660642986581},{"_id":"themes/ayer/source/images/alipay.jpg","hash":"27cfc2c7fb908c64b31df36edb46e593a0fdb9f2","modified":1660722760136},{"_id":"themes/ayer/source/images/wechat.jpg","hash":"0231d0a7ab24e6efecc4e62122578a3bf0020f06","modified":1660722755657},{"_id":"themes/ayer/source/js/jquery-3.6.0.min.js","hash":"b82d238d4e31fdf618bae8ac11a6c812c03dd0d4","modified":1660642986599},{"_id":"themes/ayer/source/css/fonts/remixicon.woff","hash":"8d6a423fd373c0a1f45b927d37f8f932aaea21ec","modified":1660642986587},{"_id":"themes/ayer/source/css/fonts/remixicon.css","hash":"26932750dfd0376106869771bc875eac9c87d0d4","modified":1660727544421},{"_id":"themes/ayer/source/css/fonts/remixicon.woff2","hash":"d83e667e2d8583bcd2d97b4ebe13ff1f147b947c","modified":1660642986587},{"_id":"themes/ayer/source/css/fonts/JetBrainsMono-Regular-2.ttf","hash":"107329e2c9a229038ccec64a7ef57448b1943df8","modified":1592143130000},{"_id":"themes/ayer/screenshots/hexo-theme-ayer.png","hash":"4111670e622ce09837b6b9cc641782af75805079","modified":1660642986577},{"_id":"themes/ayer/source/images/cover3.jpg","hash":"7b4e7c9ce19ce5d5c1588b2567e88ecbb04370af","modified":1660642986591},{"_id":"themes/ayer/package-lock.json","hash":"d71d5cf19c1a9d4788ffd42f155c30a9883a2e2d","modified":1660720568575},{"_id":"themes/ayer/source/css/fonts/remixicon.ttf","hash":"7eba83fb4482a63f3b338ccb6dca312e8e95db7f","modified":1660642986587},{"_id":"themes/ayer/source/css/fonts/remixicon.eot","hash":"7e929b884b2201250fc49e8e79c3aba6cd9e4482","modified":1660642986583},{"_id":"themes/ayer/source/images/cover6.jpeg","hash":"d09be7294b8b31abde500bf884cc5483f58de0ab","modified":1661148504712},{"_id":"themes/ayer/source/css/fonts/remixicon.svg","hash":"94144debfb5761d37d79336a10ef674f82baec1b","modified":1660642986585},{"_id":"themes/ayer/source/images/cover7.jpeg","hash":"af7131608e7f3f9ef6b980c21fd30c113c65e110","modified":1660721672453},{"_id":"themes/ayer/source/css/fonts/ZhuZiAWan-2.ttc","hash":"c3d5b862a7f2b44705fe94df5ecd1fac390b42e8","modified":1536874564000},{"_id":"public/search.xml","hash":"c9153b5872ed50f94f02eb23a2a50495354db0a4","modified":1661478474474},{"_id":"public/content.json","hash":"6f998970902db5309cd3821f3e1091e92eefc058","modified":1661478474474},{"_id":"public/about/index.html","hash":"c2c193677abfc9d144a0d74f4bce78f011409e97","modified":1661478474474},{"_id":"public/categories/index.html","hash":"cd73dee6363d528c907d448bd3ccc3be1ee8398b","modified":1661478474474},{"_id":"public/tags/index.html","hash":"ef38e79c2d9f19122acbe2265454694c0b8c1818","modified":1661478474474},{"_id":"public/archives/page/2/index.html","hash":"4fa984b05aa308413c8b82f711e6e2e09a8a8d90","modified":1661478474474},{"_id":"public/archives/2021/06/index.html","hash":"2326e24105a16b7819f97eb20cf1889ec0ea83e9","modified":1661478474474},{"_id":"public/archives/2021/index.html","hash":"743488ccf7ca47895e403416c4290ac01616e3a0","modified":1661478474474},{"_id":"public/archives/2021/07/index.html","hash":"bcef8726bf0902035762e71b518c2010b731511b","modified":1661478474474},{"_id":"public/archives/2021/10/index.html","hash":"be26a80a86b4627a30fb0780add98b685cdb795a","modified":1661478474474},{"_id":"public/archives/2022/index.html","hash":"4c4df1f76a0a49e85615459f5da3bb76c3b5905f","modified":1661478474474},{"_id":"public/archives/2022/08/index.html","hash":"7448df14b61fa160203e55e3f271e9f52867b907","modified":1661478474474},{"_id":"public/categories/前端知识积累/Javascript/index.html","hash":"3de2e0942492a9a766a685e29add61da82238af6","modified":1661478474474},{"_id":"public/categories/前端面试题/index.html","hash":"ebe159b878b7354bbdbc4e949c262f3d1fe3562b","modified":1661478474474},{"_id":"public/categories/个人备份/index.html","hash":"f7498f568430c2520db9cffaad08249cf67b725f","modified":1661478474474},{"_id":"public/categories/服务端知识积累/index.html","hash":"e972508e8ea0d2993d98c703f6e86e0536eec346","modified":1661478474474},{"_id":"public/categories/前端知识积累/Vue/index.html","hash":"ff8a330a00027769c694f8524113bbc9ad6cae35","modified":1661478474474},{"_id":"public/categories/前端知识积累/网络相关/index.html","hash":"0f4ce2623b3f421aa272713f882713d6d9446e38","modified":1661478474474},{"_id":"public/categories/服务端知识积累/Docker-Jenkins/index.html","hash":"8adee3fd74a3121613312013f5821c857019c98a","modified":1661478474474},{"_id":"public/categories/前端知识积累/CSS/index.html","hash":"1545fc201cf113d8571e351728ed6293e04d1930","modified":1661478474474},{"_id":"public/categories/搭建个人博客/index.html","hash":"d89915ee40cb3c98ffe5aa619977c9b1b930a0de","modified":1661478474474},{"_id":"public/tags/懒人福音/index.html","hash":"dd638bf5a9da700b4da5697e0ce2a273fdbcadf7","modified":1661478474474},{"_id":"public/tags/面试题/index.html","hash":"f154a050f5c3ce2a6933b75db955fbcbb811c183","modified":1661478474474},{"_id":"public/tags/Vue积累/index.html","hash":"b5b9628dd91e9abdcbc2ff48fa44bb1db3ef587f","modified":1661478474474},{"_id":"public/tags/备份/index.html","hash":"c547ebab6e53d7edf35a2480343d9734675f43fb","modified":1661478474474},{"_id":"public/photos/index.html","hash":"94fa6176c225b1ed8837f23dfb89d1b05faa6dce","modified":1661478474474},{"_id":"public/post/48d3.html","hash":"b1a1e392f94a61629bd1f57c63b80916ad5d6e94","modified":1661478474474},{"_id":"public/post/0.html","hash":"bfdc44beff39e241bcc6bd94f222b1d940422a7f","modified":1661478474474},{"_id":"public/post/21d0.html","hash":"73238aaa88582307f6beaae6fcd65502cc6e9c65","modified":1661478474474},{"_id":"public/post/83d9.html","hash":"e4156135619205be65eca570c2d764eda63407f8","modified":1661478474474},{"_id":"public/post/a18d.html","hash":"e8fae04d6406dd3f5ef531e229abf1df57ec6d9c","modified":1661478474474},{"_id":"public/post/9ff3.html","hash":"bc8dcff6b8a67b90c5cb3dd18cd8a98b9155136a","modified":1661478474474},{"_id":"public/post/f36c.html","hash":"345405c0e264c5b28003e9f9fc8139b9de425026","modified":1661478474474},{"_id":"public/post/4109.html","hash":"86b17bb15a3b0d97967120f7891b34fd77047f9b","modified":1661478474474},{"_id":"public/post/cc46.html","hash":"e63d7a4261dd72f29bdd470a4bbf3ec02d1309e1","modified":1661478474474},{"_id":"public/post/535a.html","hash":"83521a69e2c39f04f6ddc7b34e0851260fcfe83e","modified":1661478474474},{"_id":"public/post/9487.html","hash":"b30a5009c174096dc81fc57c80f01b8bc340bd54","modified":1661478474474},{"_id":"public/post/3eeb.html","hash":"c4548507f4039fda20a29a72e460c94aad8006b3","modified":1661478474474},{"_id":"public/archives/index.html","hash":"cd8ffa69322a502b6cc3e9eccf05600b0883e601","modified":1661478474474},{"_id":"public/categories/前端知识积累/index.html","hash":"8668e215c7de5d503a1c21a7fb013d39ac805d18","modified":1661478474474},{"_id":"public/index.html","hash":"fd2b1a2bf80c8ca16b487f3db9bf7d16367bb1ac","modified":1661478474474},{"_id":"public/page/2/index.html","hash":"e5064b0b6805b7474ae32cb04fe20da5eb38ae56","modified":1661478474474},{"_id":"public/tags/前端开发/index.html","hash":"2fa325d22e8e7d037d72622006ed7d91e9534ffc","modified":1661478474474},{"_id":"public/tags/知识积累/index.html","hash":"a20aae987fde7dee71f46816760caa1950a40f10","modified":1661478474474},{"_id":"public/CNAME","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1661478474474},{"_id":"public/images/404.jpg","hash":"4f36a8d378712427cded03f5166949f5e0ba754c","modified":1661478474474},{"_id":"public/images/ayer-side.svg","hash":"ad004ce7a873de0f91774f3d5923e010396a07bd","modified":1661478474474},{"_id":"public/images/ayer.png","hash":"0466c05244273f645d239cd27513bfa3c50308aa","modified":1661478474474},{"_id":"public/images/logo-header.png","hash":"b1ab4f3bb13e27b82093402de2078a6e5ecefbfb","modified":1661478474474},{"_id":"public/images/ayer.svg","hash":"379c3307f97c364718a1dbc1e52fb14de12eb11a","modified":1661478474474},{"_id":"public/images/beian.png","hash":"29c400bc3b89f6085766dac4e0330ded5cb73d52","modified":1661478474474},{"_id":"public/images/github.png","hash":"4853ff37f9d859e7faa77675632a73f8ef089a15","modified":1661478474474},{"_id":"public/images/gitee.png","hash":"250da578e0bd1393f22737f58d0fbae95119e527","modified":1661478474474},{"_id":"public/images/hexo-tag-chart.png","hash":"6db432aae30556d151c2fd2c1d11015d9309ba81","modified":1661478474474},{"_id":"public/images/forkme.png","hash":"99c3e21a169421e4f249befb428396c729863a75","modified":1661478474474},{"_id":"public/images/mouse.cur","hash":"86f902fa3e8e570c7f003d579c22734b13ae73ec","modified":1661478474474},{"_id":"public/images/hexo.png","hash":"6b0315fba8a8f496491079b361e2fb5253e19a04","modified":1661478474474},{"_id":"public/images/sponsor.jpg","hash":"5b5e4498177b369a7eca7ab2b1d0710b8690e21d","modified":1661478474474},{"_id":"public/favicon.ico","hash":"473ba682e828a7e34f24fae320e77b6bed4260c7","modified":1661478474474},{"_id":"public/live2dw/assets/haruto.model.json","hash":"76f915f7edbd9c47df0ca041dddb151c0c93a2bf","modified":1661478474474},{"_id":"public/live2dw/assets/haruto.physics.json","hash":"2fbf886979212357ba293bd35884f2cb5b26b6a6","modified":1661478474474},{"_id":"public/live2dw/assets/mtn/01.mtn","hash":"61d7d590d9feb71b32fd6bd142b59410d75bc1fa","modified":1661478474474},{"_id":"public/live2dw/assets/mtn/02.mtn","hash":"efc99efdff39c93372cff0f6d62c4e748e1a5593","modified":1661478474474},{"_id":"public/live2dw/assets/mtn/04.mtn","hash":"32c888667455a3ff6f1b04f910c1a5cc4de30af0","modified":1661478474474},{"_id":"public/live2dw/assets/mtn/03.mtn","hash":"a72b697a92a7cff40d15774b143b465b34cee5e6","modified":1661478474474},{"_id":"public/live2dw/assets/mtn/06.mtn","hash":"df10cc1d333c96da1296a4853c1ddbd44d8a11f3","modified":1661478474474},{"_id":"public/live2dw/assets/mtn/07.mtn","hash":"d8c9410135c81604eba665b59808089808e0851a","modified":1661478474474},{"_id":"public/live2dw/assets/mtn/08.mtn","hash":"9b95ef8548b979d1fca557c74f8d66fb15b34578","modified":1661478474474},{"_id":"public/live2dw/assets/mtn/05.mtn","hash":"637e00442da4042cd4b0ed2cc62ffb1559881814","modified":1661478474474},{"_id":"public/live2dw/assets/mtn/09.mtn","hash":"ecf1283b72e1c4b7e3a97343cd97726813f18790","modified":1661478474474},{"_id":"public/live2dw/lib/L2Dwidget.min.js","hash":"5f1a807437cc723bcadc3791d37add5ceed566a2","modified":1661478474474},{"_id":"public/live2dw/assets/mtn/idle_02.mtn","hash":"d130dd1d194f05b3eb5391289b0339999e37c3a6","modified":1661478474474},{"_id":"public/images/alipay.jpg","hash":"27cfc2c7fb908c64b31df36edb46e593a0fdb9f2","modified":1661478474474},{"_id":"public/images/wechat.jpg","hash":"0231d0a7ab24e6efecc4e62122578a3bf0020f06","modified":1661478474474},{"_id":"public/css/fonts/remixicon.woff","hash":"8d6a423fd373c0a1f45b927d37f8f932aaea21ec","modified":1661478474474},{"_id":"public/css/fonts/remixicon.woff2","hash":"d83e667e2d8583bcd2d97b4ebe13ff1f147b947c","modified":1661478474474},{"_id":"public/live2dw/lib/L2Dwidget.min.js.map","hash":"3290fe2df45f065b51a1cd7b24ec325cbf9bb5ce","modified":1661478474474},{"_id":"public/css/clipboard.css","hash":"7990b92ffeda1b06b94b50140d9c95dac21bd418","modified":1661478474474},{"_id":"public/404.html","hash":"155c674062d18ab392fa47ac837dd7afe77f8a56","modified":1661478474474},{"_id":"public/dist/main.js","hash":"436093b4310b4656fb1e60ae946d04b85d6b1fa5","modified":1661478474474},{"_id":"public/css/custom.css","hash":"69be82edbe87be5a92980c9bc8317c5703346b66","modified":1661478474474},{"_id":"public/js/busuanzi-2.3.pure.min.js","hash":"6e41f31100ae7eb3a6f23f2c168f6dd56e7f7a9a","modified":1661478474474},{"_id":"public/js/clickBoom1.js","hash":"afd4a981d3a56c40898248152009d478a3cd0d1e","modified":1661478474474},{"_id":"public/js/clickBoom2.js","hash":"d3fe9e8c7046bec9745628f61d61e4102171ac2b","modified":1661478474474},{"_id":"public/js/dz.js","hash":"079ae73e2e396c2e00919a50a6fe0d064f99303a","modified":1661478474474},{"_id":"public/js/clickLove.js","hash":"9e8e79d69ad8338761272f86fe5cad0ad5e503cc","modified":1661478474474},{"_id":"public/js/tocbot.min.js","hash":"bae97e8a24a05a99335f8e725641c8ca9c50502a","modified":1661478474474},{"_id":"public/js/search.js","hash":"118be0e0918532ac1225f62e1a0a6f0673e0b173","modified":1661478474474},{"_id":"public/js/lazyload.min.js","hash":"b801b3946fb9b72e03512c0663458e140e1fa77b","modified":1661478474474},{"_id":"public/dist/main.css","hash":"731eb90f7bab976fa2b2590ee6fb3dc215c99b38","modified":1661478474474},{"_id":"public/js/jquery-3.6.0.min.js","hash":"b82d238d4e31fdf618bae8ac11a6c812c03dd0d4","modified":1661478474474},{"_id":"public/css/fonts/remixicon.css","hash":"26932750dfd0376106869771bc875eac9c87d0d4","modified":1661478474474},{"_id":"public/css/fonts/JetBrainsMono-Regular-2.ttf","hash":"107329e2c9a229038ccec64a7ef57448b1943df8","modified":1661478474474},{"_id":"public/live2dw/lib/L2Dwidget.0.min.js","hash":"35bb5b588b6de25c9be2dd51d3fd331feafac02d","modified":1661478474474},{"_id":"public/images/cover3.jpg","hash":"7b4e7c9ce19ce5d5c1588b2567e88ecbb04370af","modified":1661478474474},{"_id":"public/live2dw/assets/moc/haruto.2048/texture_00.png","hash":"62b970aa1480a1c18bdc4e74e297f2a1b34ca9fa","modified":1661478474474},{"_id":"public/live2dw/assets/moc/haruto.moc","hash":"57bec0b245b49ea941d61ba3dee671f20441afae","modified":1661478474474},{"_id":"public/css/fonts/remixicon.ttf","hash":"7eba83fb4482a63f3b338ccb6dca312e8e95db7f","modified":1661478474474},{"_id":"public/css/fonts/remixicon.eot","hash":"7e929b884b2201250fc49e8e79c3aba6cd9e4482","modified":1661478474474},{"_id":"public/live2dw/lib/L2Dwidget.0.min.js.map","hash":"35e71cc2a130199efb167b9a06939576602f0d75","modified":1661478474474},{"_id":"public/images/cover6.jpeg","hash":"d09be7294b8b31abde500bf884cc5483f58de0ab","modified":1661478474474},{"_id":"public/css/fonts/remixicon.svg","hash":"94144debfb5761d37d79336a10ef674f82baec1b","modified":1661478474474},{"_id":"public/images/cover7.jpeg","hash":"af7131608e7f3f9ef6b980c21fd30c113c65e110","modified":1661478474474},{"_id":"public/css/fonts/ZhuZiAWan-2.ttc","hash":"c3d5b862a7f2b44705fe94df5ecd1fac390b42e8","modified":1661478474474}],"Category":[{"name":"前端知识积累","_id":"cl79tdvvb00045d9kbbhj1ao3"},{"name":"Javascript","parent":"cl79tdvvb00045d9kbbhj1ao3","_id":"cl79tdvvg000j5d9k80qa8jje"},{"name":"前端面试题","_id":"cl79tdvvh000m5d9kc6vnh3dh"},{"name":"个人备份","_id":"cl79tdvvh000r5d9kc1urh5jx"},{"name":"服务端知识积累","_id":"cl79tdvvh000z5d9k8qzbhqjm"},{"name":"Vue","parent":"cl79tdvvb00045d9kbbhj1ao3","_id":"cl79tdvvi00165d9k9s9y11bz"},{"name":"网络相关","parent":"cl79tdvvb00045d9kbbhj1ao3","_id":"cl79tdvvi001b5d9khizz3rol"},{"name":"Docker & Jenkins","parent":"cl79tdvvh000z5d9k8qzbhqjm","_id":"cl79tdvvj001j5d9k1sfi8lw7"},{"name":"CSS","parent":"cl79tdvvb00045d9kbbhj1ao3","_id":"cl79tdvvo001y5d9k7spr5av4"},{"name":"搭建个人博客","_id":"cl79tdvvo00225d9k8ipvarff"}],"Data":[],"Page":[{"title":"about","date":"2021-09-30T10:00:23.000Z","layout":"about","_content":"","source":"about/index.md","raw":"---\ntitle: about\ndate: 2021-09-30 18:00:23\nlayout: about\n---\n","updated":"2022-08-26T01:42:59.885Z","path":"about/index.html","comments":1,"_id":"cl79tdvv800005d9k2vdbcswl","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"所有分类","type":"categories","layout":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: 所有分类\ntype: \"categories\"\nlayout: \"categories\"\n---\n","date":"2022-08-26T01:42:59.885Z","updated":"2022-08-26T01:42:59.885Z","path":"categories/index.html","comments":1,"_id":"cl79tdvva00025d9k3czcfhbm","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"所有分类","type":"tags","layout":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: 所有分类\ntype: \"tags\"\nlayout: \"tags\"\n---\n","date":"2022-08-26T01:42:59.886Z","updated":"2022-08-26T01:42:59.886Z","path":"tags/index.html","comments":1,"_id":"cl79tdvvc00065d9k1y88c0cx","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"相册","date":"2022-08-18T09:12:46.000Z","albums":[["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fj2a2q07j21400u045b.jpg","路上拍的星星"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fj5n9fw8j21400u0jy6.jpg","老君山-登顶啦"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fj6w4rcrj21400u0q4f.jpg","老君山-天微亮"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fjampwo4j21hc0u0q4y.jpg","老君山-山形"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fjb4m2b8j20u0140juj.jpg","老君山-日出就要来啦"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fjbs4jmgj21400u0q4o.jpg","老君山-日出1"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fjbrh16wj21400u0761.jpg","老君山-日出2"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fjbqpz1kj21400u00v7.jpg","老君山-日出3"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk8cgppyj21400u010p.jpg","大一宿舍照"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk8e3jxqj21hc0u0gv8.jpg","我自己焊的板子"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk8dlrzij21hc0u0466.jpg","竟然把水滴都拍出来了"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk8d3uyvj21400u0tdw.jpg","18年全家福"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk8c2qo6j21hc0u0dkx.jpg","老家后院"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk8bjkxzj21400u0qbt.jpg","海"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk8aqj9qj20u0140ads.jpg","我们俩的影子照"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk89ylcjj21400u0jv5.jpg","日全食"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk89cbwuj20u0140434.jpg","宝贝的手工，厉害"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk887ftqj21400u0tcc.jpg","很美的天空"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk87h9v7j20u01j041i.jpg","我的个人照"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk877vwwj20nq0m9js5.jpg","我的个人照2"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk86z90pj21400u0dq0.jpg","19年全家福"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk86ei6tj21400u0gs2.jpg","机箱照"],["https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk85n99gj20u0140qgy.jpg","宿舍三人照"]],"_content":"","source":"photos/index.md","raw":"---\ntitle: 相册\ndate: 2022-08-18 17:12:46\nalbums: [\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fj2a2q07j21400u045b.jpg', '路上拍的星星'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fj5n9fw8j21400u0jy6.jpg', '老君山-登顶啦'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fj6w4rcrj21400u0q4f.jpg', '老君山-天微亮'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fjampwo4j21hc0u0q4y.jpg', '老君山-山形'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fjb4m2b8j20u0140juj.jpg', '老君山-日出就要来啦'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fjbs4jmgj21400u0q4o.jpg', '老君山-日出1'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fjbrh16wj21400u0761.jpg', '老君山-日出2'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fjbqpz1kj21400u00v7.jpg', '老君山-日出3'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk8cgppyj21400u010p.jpg', '大一宿舍照'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk8e3jxqj21hc0u0gv8.jpg', '我自己焊的板子'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk8dlrzij21hc0u0466.jpg', '竟然把水滴都拍出来了'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk8d3uyvj21400u0tdw.jpg', '18年全家福'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk8c2qo6j21hc0u0dkx.jpg', '老家后院'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk8bjkxzj21400u0qbt.jpg', '海'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk8aqj9qj20u0140ads.jpg', '我们俩的影子照'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk89ylcjj21400u0jv5.jpg', '日全食'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk89cbwuj20u0140434.jpg', '宝贝的手工，厉害'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk887ftqj21400u0tcc.jpg', '很美的天空'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk87h9v7j20u01j041i.jpg', '我的个人照'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk877vwwj20nq0m9js5.jpg', '我的个人照2'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk86z90pj21400u0dq0.jpg', '19年全家福'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk86ei6tj21400u0gs2.jpg', '机箱照'],\n  ['https://tva1.sinaimg.cn/large/e6c9d24egy1h5fk85n99gj20u0140qgy.jpg', '宿舍三人照'],\n  ]\n---\n","updated":"2022-08-26T01:42:59.886Z","path":"photos/index.html","comments":1,"layout":"page","_id":"cl79tdvvc00085d9k2hp205gp","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"JS常用工具类汇总（持续完善....）","abbrlink":"535a","date":"2021-06-29T11:41:45.000Z","layout":"post","seo_title":"JS常用知识点总结","keywords":"JS javascript","copyright":true,"photos":["https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/JS%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB%E6%B1%87%E6%80%BB(%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0....)/no-code.png"],"top":1,"_content":"\n整理项目开发中经常使用的Javascript片段, 以便Ctrl + C\n\n<!-- more -->\n\n\n### 1. 创建a标签,打开新页面\n\n```js\n/**\n * 创建a标签,打开新页面 openURL()\n * @param {String} url 目标地址\n * @returns null\n */\nfunction openURL(url) {\n  let aLabel = document.createElement('a');\n  //设置链接\n  aLabel.setAttribute('href', url);\n  //新窗口打开链接\n  aLabel.setAttribute('target', '_blank');\n  //设置标签ID\n  aLabel.setAttribute('id', 'reportpoint');\n  // 防止反复添加\n  if (document.getElementById('reportpoint')) {\n    document.body.removeChild(document.getElementById('reportpoint'));\n  }\n  document.body.appendChild(aLabel);\n  aLabel.click();\n}\n```\n\n***\n\n### 2. 防抖函数\n\n防抖函数的原理就是通过延时器控制用户在短时间内进行重复操作的时候取消上一次操作\n\n```js 防抖函数\n/**\n * 防抖函数 debounce()\n * @param {function} fn 事件触发的操作\n * @param {number} delay 多少毫秒内连续触发事件，不会执行\n * @returns {Function}\n */\nfunction debounce(fn, delay) {\n  let timer = null ;\n  return function() {\n    let self = this ; // 注意this指向\n    args = arguments; // 拿到函数的入参\n\n    timer && clearTimeout(timer);\n    timer = setTimeout(() => {\n      fn.apply(self, args);\n    }, delay)\n  }\n}\n// 假设现有以下点击事件，clickEvent()\nlet input1 = document.getElementById('input1');\ninput1.addEventListener('keyup',debounce(action1,1000))\n\nfunction action1() {\n  console.log(input1.value)\n}\n```\n\n***\n\n### 3. 节流函数\n\n节流函数的原理就是通过控制延时器,当高频事件触发，n秒内只会执行一次\n\n```js 节流函数\n/**\n * 节流函数 throttle()\n * @param {function} fn 事件触发的操作\n * @param {number} delay 多少毫秒内连续触发事件，只会执行一次\n * @returns {Function}\n */\nfunction throttle(fn, delay) {\n  let timer = null ;\n  let flag = true ; // 当前是否正在执行...\n  return function() {\n    if (!flag) return\n    flag = false; \n    let self = this ; // 注意this指向\n    args = arguments; // 拿到函数的入参\n\n    timer && clearTimeout(timer);\n    timer = setTimeout(() => {\n      flag = true; // 时间到了，可以继续执行下一次事件\n      fn.apply(self, args);\n    }, delay)\n  }\n}\n```\n\n使用的规则同 <a href='#防抖函数'> 防抖函数 </a>\n\n***\n\n### 4. 将字符串运行成js脚本的几种方式\n\n```js\n    1. eval('字符串')\n    2. new Function('字符串')\n\n    3. setTimeout('字符串', 1000)\n    4. setInterval('字符串', 1000)\n```\n\n***\n\n### 5. 浏览器复制内容到剪切板\n\n```js\n/**\n * 浏览器复制内容到剪切板 copyText()\n * @param {string} text 需要复制的内容\n * @returns null\n */\nconst copyText = (text)=>{\n  var range = document.createRange();\n  var copyDOM = document.createElement('a');\n  copyDOM.innerHTML = text;\n  window.getSelection().removeAllRanges();\n  document.body.appendChild(copyDOM)\n  range.selectNode(copyDOM);\n  window.getSelection().addRange(range);\n  var successful = document.execCommand('copy');\n  if(successful){\n    // 复制成功到剪切板\n  }else{\n    // 复制失败，一般是因为浏览器不支持复制\n  }\n  document.body.removeChild(copyDOM)\n}\n```\n\n***\n\n### 6. 取随机字符串\n\n取随机字符串根据业务的不同会有不一样的取值方式，用作签名的一部分、用做随机密码....\n这里我采用的是获取长度不定、去除容易混淆的字符oOLl,9gq,Vv,Uu,I1的随机位数的随机字符\n\n```js\n/**\n * 取随机字符串 randomString()\n * @param {number} len 随机字符串的长度\n * @returns null\n */\nfunction randomString(len) {\n  len = len || 32; // 默认随机生成32位长度字符串\n  var $chars = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678';    /****默认去掉了容易混淆的字符oOLl,9gq,Vv,Uu,I1****/\n  var maxPos = $chars.length;\n  var randomStr = '';\n  for (var i = 0; i < len; i++) {\n    randomStr += $chars.charAt(Math.floor(Math.random() * maxPos));\n  }\n  return randomStr;\n}\n```\n\n***\n\n### 7. 异步加载一段js脚本\n\n如： 异步引入网页悬浮脚本、异步引入高德地图、腾讯地图等。\n\n```ts\n/**\n * @description 异步加载  一段js放在 header\n * @param {object} url - js 的 url\n * @param {function} callback - 成功回调\n * @returns { promise<any>}} promise\n */\nconst loadScript = (url: string) => {\n  return new Promise(() => {\n    try {\n      const script: any = document.createElement('script')\n      script.type = 'text/javascript'\n      if (script.readyState) {\n        //IE\n        script.onreadystatechange = function () {\n          if (\n            script.readyState == 'loaded' ||\n            script.readyState == 'complete'\n          ) {\n            script.onreadystatechange = null\n            Promise.resolve(0)\n          }\n        }\n      } else {\n        //Others: Firefox, Safari, Chrome, and Opera\n        script.onload = function () {\n          Promise.resolve(0)\n        }\n      }\n      script.src = url\n      document.body.appendChild(script)\n    } catch (e) {\n      Promise.reject(e)\n    }\n  })\n}\n```\n\n***\n\n### 8. 获取页面高度\n\n```js\n// get page height\nconst getPageHeight = () => {\n  const g = document\n  const a = g.body\n  const f = g.documentElement\n  const d = g.compatMode === 'BackCompat' ? a : g.documentElement\n  return Math.max(f.scrollHeight, a.scrollHeight, d.clientHeight)\n}\n```\n\n***\n\n### 9. 获取页面可视高度\n\n```js\n// get page view height\nconst getPageViewHeight = () => {\n  const d = document\n  const a = d.compatMode === 'BackCompat' ? d.body : d.documentElement\n  return a.clientHeight\n}\n```\n\n***\n\n### 10. 获取页面可视宽度\n\n```js\n// get page view width\nconst getPageViewWidth = () => {\n  const d = document\n  const a = d.compatMode === 'BackCompat' ? d.body : d.documentElement\n  return a.clientWidth\n}\n```\n\n***\n\n### 11. 获取页面宽度\n\n```js\n// get page width\nconst getPageWidth = () => {\n  const g = document\n  const a = g.body\n  const f = g.documentElement\n  const d = g.compatMode === 'BackCompat' ? a : g.documentElement\n  return Math.max(f.scrollWidth, a.scrollWidth, d.clientWidth)\n}\n```\n\n***\n\n### 12. 判断当前设备\n\n#### 是否为安卓设备\n\n```js\nconst isAndroidMobileDevice = () => {\n  return /android/i.test(navigator.userAgent.toLowerCase())\n}\n```\n\n#### 是否为苹果设备\n\n```js\nconst isAppleMobileDevice = () => {\n  return /iphone|ipod|ipad|Macintosh/i.test(navigator.userAgent.toLowerCase())\n}\n```\n\n#### 是否为iPhoneX\n\n```js\nconst isIphonex = () => {\n  // X XS, XS Max, XR\n  const xSeriesConfig = [\n    {\n      devicePixelRatio: 3,\n      width: 375,\n      height: 812\n    },\n    {\n      devicePixelRatio: 3,\n      width: 414,\n      height: 896\n    },\n    {\n      devicePixelRatio: 2,\n      width: 414,\n      height: 896\n    }\n  ]\n  if (typeof window !== 'undefined' && window) {\n    const isIOS = /iphone/gi.test(window.navigator.userAgent)\n    if (!isIOS) return false\n    const { devicePixelRatio, screen } = window\n    const { width, height } = screen\n    return xSeriesConfig.some(\n      (item) =>\n        item.devicePixelRatio === devicePixelRatio &&\n        item.width === width &&\n        item.height === height\n    )\n  }\n  return false\n}\n```\n\n#### 是否为手机设备\n\n```js\nconst isMobileUserAgent = () => {\n  return /iphone|ipod|android.*mobile|windows.*phone|blackberry.*mobile/i.test(\n    window.navigator.userAgent.toLowerCase()\n  )\n}\n```\n\n***\n\n### 13. 设置cookie\n\n```ts\n/**\n * @description 设置 cookie\n * @params {string} cookie -键名\n * @params {any} value -存入的值\n * @params {Hours} number -有效期限\n */\nconst setCookie = (name: string, value: any, Hours: number) => {\n  const d = new Date()\n  const offset = 8\n  const utc = d.getTime() + d.getTimezoneOffset() * 60000\n  const nd = utc + 3600000 * offset\n  const exp = new Date(nd)\n  exp.setTime(exp.getTime() + Hours * 60 * 60 * 1000)\n  document.cookie =\n    name +\n    '=' +\n    escape(value) +\n    ';path=/;expires=' +\n    exp.toUTCString() +\n    ';domain=360doc.com;'\n}\n```\n\n***\n\n### 14. 获取字符串对应的字节数\n\n```js\n/**\n * @description 获取字节数\n * @param s 字符串\n */\nconst getBytesLength = (s: string) => {\n  return s.replace(/[^\\x00-\\xff]/gi, '--').length\n}\n```\n\n***\n\n### 15. 获取本地的时间\n\n```ts\n/**\n * 获取本地的时间\n */\nconst getServerTime = () => {\n  var xmlHttp: XMLHttpRequest\n  function srvTime() {\n    try {\n      // FF, Opera, Safari, Chrome\n      xmlHttp = new XMLHttpRequest()\n    } catch (err1) {\n      // IE\n      try {\n        xmlHttp = new ActiveXObject('Msxml2.XMLHTTP')\n      } catch (err2) {\n        try {\n          xmlHttp = new ActiveXObject('Microsoft.XMLHTTP')\n        } catch (eerr3) {\n          // AJAX not supported, use CPU time.\n          alert('AJAX not supported')\n        }\n      }\n    }\n    xmlHttp.open('HEAD', window.location.href.toString(), false)\n    xmlHttp.setRequestHeader('Content-Type', 'text/html')\n    xmlHttp.send('')\n    return xmlHttp.getResponseHeader('Date')\n  }\n\n  var st = srvTime()\n  var date = new Date(st as string)\n  var timestamp = date.getTime()\n  return timestamp\n}\n```\n\n***\n\n### 16. 获取浏览器的Cookie的值\n\n```js\n/**\n * 获取浏览器的Cookie的值\n */\nconst cookie = name => `; ${document.cookie}`.split(`; ${name}=`).pop().split(';').shift();\n\n// 获取token \ncookie('TOKEN')\n```\n\n***\n\n### 17. 颜色RGB转十六进制\n\n```js\n/**\n * 颜色RGB转十六进制\n */\nconst rgbToHex = (r, g, b) => \"#\" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);\n\nrgbToHex(0, 51, 255); \n// Result: #0033ff\n```\n\n***\n\n### 18. 复制到剪贴板(新的API)\n\n```js\n/**\n * 复制到剪贴板\n */\nconst copyToClipboard = (text) => navigator.clipboard.writeText(text);\n    \ncopyToClipboard(\"Hello World\");\n```\n\n***\n\n### 19. 清除所有Cookie\n\n```js\n/**\n * 清除所有Cookie\n */\nconst clearCookies = document.cookie.split(';').forEach(cookie => document.cookie = cookie.replace(/^ +/, '').replace(/=.*/, `=;expires=${new Date(0).toUTCString()};path=/`));\n```\n\n***\n\n### 20. 生成随机十六进制颜色\n\n```js\n/**\n * 生成随机十六进制颜色\n */\nconst randomHex = () => `#${Math.floor(Math.random() * 0xffffff).toString(16).padEnd(6, \"0\")}`;\n    \n console.log(randomHex());\n// Result: #92b008\n```\n\n***\n\n### 21. 从URL获取查询参数 -- JS\n\n```js\n/**\n * 从URL获取查询参数\n */\nconst getParameters = (URL) => {\n  URL = JSON.parse(\n    '{\"' +\n      decodeURI(URL.split(\"?\")[1])\n        .replace(/\"/g, '\\\\\"')\n        .replace(/&/g, '\",\"')\n        .replace(/=/g, '\":\"') +\n      '\"}'\n  );\n  return JSON.stringify(URL);\n};\n\n// 调用\ngetParameters(window.location);\n// Result: { search : \"easy\", page : 3 }\n```\n\n或者： \n\n```js\n/**\n * 从URL获取查询参数\n */\nObject.fromEntries(new URLSearchParams(window.location.search))\n```\n\n***\n\n### 22. 检查用户的设备是否在暗黑模式\n\n```js\n/**\n * 检查用户的设备是否在暗黑模式\n * @return Boolean\n */\nconst isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches\n```\n\n***\n\n### 23. 下载一个Excel文档\n\n```js\n/**\n * 下载一个链接\n */ \nfunction download(link, name) {\n\tif(!name){\n\t\tname = link.slice(link.lastIndexOf('/') + 1)\n\t}\n\tlet eleLink = document.createElement('a')\n\teleLink.download = name\n\teleLink.style.display = 'none'\n\teleLink.href = link\n\tdocument.body.appendChild(eleLink)\n\teleLink.click()\n\tdocument.body.removeChild(eleLink)\n}\n\n//下载excel\ndownload('http://111.229.14.189/file/1.xlsx')\n```\n\n***\n\n### 24. 浏览器中下载一些DOM内容/JSON文件\n\n```js\n/**\n * 浏览器下载静态文件\n * @param {String} name 文件名\n * @param {String} content 文件内容\n */\nfunction downloadFile(name, content) {\n\tif (typeof name == 'undefined') {\n\t\tthrow new Error('The first parameter name is a must')\n\t}\n\tif (typeof content == 'undefined') {\n\t\tthrow new Error('The second parameter content is a must')\n\t}\n\tif (!(content instanceof Blob)) {\n\t\tcontent = new Blob([content])\n\t}\n\tconst link = URL.createObjectURL(content)\n\tdownload(link, name)\n}\n\n// 调用下载\ndownloadFile('1.txt','lalalallalalla')\ndownloadFile('1.json',JSON.stringify({name:'hahahha'}))\n```\n\n***\n\n### 25. 浏览器下载MP4/PDF/图片等\n\n```js\n/**\n * 浏览器下载MP4/PDF/图片等\n */\nimport axios from 'axios'\n//提供一个link，完成文件下载，link可以是  http://xxx.com/xxx.xls\nfunction downloadByLink(link,fileName){\n\taxios.request({\n\t\turl: link,\n\t\tresponseType: 'blob' // 关键代码，让axios把响应改成blob\n\t}).then(res => {\n    const link = URL.createObjectURL(res.data)\n\t\tdownload(link, fileName)\n  })\n}\n```\n\n注意：会有同源策略的限制，需要配置转发\n\n***\n\n### 26. 去除对象中的空元素\n\n给后端发送数据的时候，要判断某个属性是不是空字符串，然后给后端拼参数，这块逻辑抽离出来就是`cleanObject`，代码实现如下：\n\n```js\n/**\n * cleanObject 去除对象中的空元素\n */\nexport const cleanObject = (object) => {\n  // Object.assign({}, object)\n  if (!object) {\n    return {};\n  }\n  const result = { ...object };\n  Object.keys(result).forEach((key) => {\n    const value = result[key];\n    if (isVoid(value)) {\n      delete result[key];\n    }\n  });\n  return result;\n};\n\n// 判断是否为空\nexport const isVoid = (value) =>\n  value === undefined || value === null || value === \"\";\n```\n\n使用：\n\n```js\nlet res = cleanObject({\n    name:'',\n    pageSize:10,\n    page:1\n})\nconsole.log(\"res\", res) // 输出 { page:1,pageSize:10 }\n```\n\n***\n\n### 27. 常用的正则验证\n\n```js\n/**\n * 常用的正则验证\n */\nconst checkStr = function(str, type) { // 常用正则验证，注意type大小写\n  switch (type) {\n    case 'phone': // 手机号码\n      return /^1[3|4|5|6|7|8|9][0-9]{9}$/.test(str)\n    case 'tel': // 座机\n      return /^(0\\d{2,3}-\\d{7,8})(-\\d{1,4})?$/.test(str)\n    case 'card': // 身份证\n      return /(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)/.test(str)\n    case 'pwd': // 密码以字母开头，长度在6~18之间，只能包含字母、数字和下划线\n      return /^[a-zA-Z]\\w{5,17}$/.test(str)\n    case 'postal': // 邮政编码\n      return /[1-9]\\d{5}(?!\\d)/.test(str)\n    case 'QQ': // QQ号\n      return /^[1-9][0-9]{4,9}$/.test(str)\n    case 'email': // 邮箱\n      return /^[\\w-]+(.[\\w-]+)*@[\\w-]+(.[\\w-]+)+$/.test(str)\n    case 'money': // 金额(小数点2位)\n      return /^\\d*(?:.\\d{0,2})?$/.test(str)\n    case 'URL': // 网址\n      return /(http|ftp|https)://[\\w-_]+(.[\\w-_]+)+([\\w-.,@?^=%&:/~+#]*[\\w-@?^=%&/~+#])?/.test(str)\n    case 'IP': // IP\n      return /((?:(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d))/.test(str)\n    case 'date': // 日期时间\n      return /^(\\d{4})-(\\d{2})-(\\d{2}) (\\d{2})(?::\\d{2}|:(\\d{2}):(\\d{2}))$/.test(str) ||\n        /^(\\d{4})-(\\d{2})-(\\d{2})$/.test(str)\n    case 'number': // 数字\n      return /^[0-9]$/.test(str)\n    case 'english': // 英文\n      return /^[a-zA-Z]+$/.test(str)\n    case 'chinese': // 中文\n      return /^[\\u4E00-\\u9FA5]+$/.test(str)\n    case 'lower': // 小写\n      return /^[a-z]+$/.test(str)\n    case 'upper': // 大写\n      return /^[A-Z]+$/.test(str)\n    case 'HTML': // HTML标记\n      return /<(\"[^\"]*\"|'[^']*'|[^'\">])*>/.test(str)\n    default:\n      return true\n  }\n}\n```\n\n***\n\n### 28. 阿拉伯数字转中文大写数字\n\n```js\n/**\n * 阿拉伯数字转中文大写数字\n */\nconst numberToChinese = function(num) { // 将阿拉伯数字翻译成中文的大写数字\n  let AA = new Array('零', '一', '二', '三', '四', '五', '六', '七', '八', '九', '十')\n  let BB = new Array('', '十', '百', '仟', '萬', '億', '点', '')\n  let a = ('' + num).replace(/(^0*)/g, '').split('.')\n  let k = 0\n  let re = ''\n  for (let i = a[0].length - 1; i >= 0; i--) {\n    switch (k) {\n      case 0:\n        re = BB[7] + re\n        break\n      case 4:\n        if (!new RegExp('0{4}//d{' + (a[0].length - i - 1) + '}$').test(a[0])) {\n          re = BB[4] + re\n        }\n        break\n      case 8:\n        re = BB[5] + re\n        BB[7] = BB[5]\n        k = 0\n        break\n    }\n    if (k % 4 === 2 && a[0].charAt(i + 2) !== 0 && a[0].charAt(i + 1) === 0) {\n      re = AA[0] + re\n    }\n    if (a[0].charAt(i) !== 0) {\n      re = AA[a[0].charAt(i)] + BB[k % 4] + re\n    }\n    k++\n  }\n  if (a.length > 1) { // 加上小数部分(如果有小数部分)\n    re += BB[6]\n    for (let i = 0; i < a[1].length; i++) {\n      re += AA[a[1].charAt(i)]\n    }\n  }\n  if (re === '一十') {\n    re = '十'\n  }\n  if (re.match(/^一/) && re.length === 3) {\n    re = re.replace('一', '')\n  }\n  return re\n}\n```\n\n***\n\n### 29. base64图片下载功能\n\n```js\n/**\n * base64图片下载功能\n */\nconst downloadFile = function(base64, fileName) { //base64图片下载功能\n  let base64ToBlob = function(code) {\n    let parts = code.split(';base64,');\n    let contentType = parts[0].split(':')[1];\n    let raw = window.atob(parts[1]);\n    let rawLength = raw.length;\n    let uInt8Array = new Uint8Array(rawLength);\n    for (let i = 0; i < rawLength; ++i) {\n      uInt8Array[i] = raw.charCodeAt(i);\n    }\n    return new Blob([uInt8Array], {\n      type: contentType\n    });\n  };\n  let aLink = document.createElement('a');\n  let blob = base64ToBlob(base64); //new Blob([content]);\n  let evt = document.createEvent(\"HTMLEvents\");\n  evt.initEvent(\"click\", true, true); //initEvent不加后两个参数在FF下会报错  事件类型，是否冒泡，是否阻止浏览器的默认行为\n  aLink.download = fileName;\n  aLink.href = URL.createObjectURL(blob);\n  aLink.click();\n}\n```\n\n***\n\n### 30. 获取div高度\n\n```js\n/**\n * 获取div高度\n */\nconst div = document.querySelector('');\nwindow.getComputedStyle(div).getPropertyValue('height');\n```\n\n\n***\n\n### 31. 将base64转化成可用formData提交的文件\n\n```ts\n/**\n * convertBase64UrlToBlob 将base64转化成可用formdata提交的文件\n * @param {string} urlData base64位的url\n * @returns\n */\nconst convertBase64UrlToBlob = (urlData) => {\n  //去掉url的头，并转换为byte\n  const split = urlData.split(',');\n  const bytes = window.atob(split[1]);\n  //处理异常,将ascii码小于0的转换为大于0\n  const ab = new ArrayBuffer(bytes.length);\n  const ia = new Uint8Array(ab);\n  for (let i = 0; i < bytes.length; i++) {\n    ia[i] = bytes.charCodeAt(i);\n  }\n  return new Blob([ab], { type: split[0].match(/:(.*?);/)[1] });\n};\n```\n\n***\n\n### 32. 找到对象中所有可能存在的字符串，并替换掉其中的<, >, (, )分别为全角的＜＞（）\n\n```ts\n/**\n * 找到对象中所有可能存在的字符串，并替换掉其中的<, >, (, )分别为全角的＜＞（）\n * 可以自定义拓展更多的规则\n * @param {object} obj 需要处理的对象\n * @return {object} aim obj\n */\nexport const formatString = (obj) => {\n  for (const key in obj) {\n    if (!obj.hasOwnProperty(key)) return; // 排除掉原型继承而来的属性\n    if (typeof obj[key] == 'string') {\n      obj[key] = obj[key]\n        .replace(/</g, '＜')\n        .replace(/>/g, '＞')\n        .replace(/\\(/g, '（')\n        .replace(/\\)/g, '）');\n    }\n    if (typeof obj[key] == 'object' || typeof obj[key] == 'function') {\n      formatString(obj[key]);\n    }\n  }\n  return obj;\n};\n```\n\n***\n\n### 33. 将对象格式转化为get请求所需要的参数\n\n```ts\n/**\n * getParams 将对象格式转化为get请求所需要的参数\n * @param {object} params 需要处理的对象\n * @return {object} aim obj\n */\nexport function getParams(params) {\n  let paramStr = '';\n  Object.keys(params).forEach((item) => {\n    if (paramStr === '') {\n      paramStr = `${item}=${params[item]}`;\n    } else {\n      paramStr = `${paramStr}&${item}=${params[item]}`;\n    }\n  });\n  return paramStr;\n}\n```\n\n***\n\n### 34. 获取图片真实的宽高（非真实渲染）\n\n```ts\n/**\n * getImageSize 获取图片的宽高\n * @param {string} url 需要处理的图片路径\n * @return {object} { width: number, height: number }\n */\nexport function getImageSize(url: string): Promise<any> {\n  return new Promise(function (resolve, reject) {\n    const image = new Image();\n    image.onload = function () {\n      resolve({\n        width: image.width, // 或naturalWidth\n        height: image.height, // 或naturalHeight\n      });\n      // 注释中这两个属性在Firefox/Chrome/Safari/Opera及IE9+里已经实现\n    };\n    image.onerror = function () {\n      reject(new Error('error'));\n    };\n    image.src = url;\n  });\n}\n```\n\n***\n\n### 35. 递归拿出对象数组中所有指定的字段项，并返回新数组\n\n```ts\n/**\n * 递归拿出所有指定的字段项\n * @param {Array} list\n * @param {string} key\n * @param {string} child\n * @returns {Array} 返回所有key的集合\n */\nexport function getKeyList(list: Array<any>, key: string, child = 'children') {\n  const result: any[] = [];\n  list.forEach((listItem) => {\n    listItem[key] && result.push(listItem[key]);\n    if (listItem[child] && listItem[child].length) {\n      result.push(...getKeyList(listItem[child], key, child));\n    }\n  });\n  return result;\n}\n```","source":"_posts/JS常用工具类汇总(持续完善...).md","raw":"---\ntitle: JS常用工具类汇总（持续完善....）\nabbrlink: 535a\ndate: 2021-06-29 19:41:45\nlayout: post\nseo_title: JS常用知识点总结\nkeywords: JS javascript\ncategories: \n  - 前端知识积累\n  - Javascript\ncopyright: true\ntags:\n  - 前端开发\n  - 懒人福音\n  - 知识积累\nphotos: ['https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/JS%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB%E6%B1%87%E6%80%BB(%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0....)/no-code.png']\ntop: 1\n---\n\n整理项目开发中经常使用的Javascript片段, 以便Ctrl + C\n\n<!-- more -->\n\n\n### 1. 创建a标签,打开新页面\n\n```js\n/**\n * 创建a标签,打开新页面 openURL()\n * @param {String} url 目标地址\n * @returns null\n */\nfunction openURL(url) {\n  let aLabel = document.createElement('a');\n  //设置链接\n  aLabel.setAttribute('href', url);\n  //新窗口打开链接\n  aLabel.setAttribute('target', '_blank');\n  //设置标签ID\n  aLabel.setAttribute('id', 'reportpoint');\n  // 防止反复添加\n  if (document.getElementById('reportpoint')) {\n    document.body.removeChild(document.getElementById('reportpoint'));\n  }\n  document.body.appendChild(aLabel);\n  aLabel.click();\n}\n```\n\n***\n\n### 2. 防抖函数\n\n防抖函数的原理就是通过延时器控制用户在短时间内进行重复操作的时候取消上一次操作\n\n```js 防抖函数\n/**\n * 防抖函数 debounce()\n * @param {function} fn 事件触发的操作\n * @param {number} delay 多少毫秒内连续触发事件，不会执行\n * @returns {Function}\n */\nfunction debounce(fn, delay) {\n  let timer = null ;\n  return function() {\n    let self = this ; // 注意this指向\n    args = arguments; // 拿到函数的入参\n\n    timer && clearTimeout(timer);\n    timer = setTimeout(() => {\n      fn.apply(self, args);\n    }, delay)\n  }\n}\n// 假设现有以下点击事件，clickEvent()\nlet input1 = document.getElementById('input1');\ninput1.addEventListener('keyup',debounce(action1,1000))\n\nfunction action1() {\n  console.log(input1.value)\n}\n```\n\n***\n\n### 3. 节流函数\n\n节流函数的原理就是通过控制延时器,当高频事件触发，n秒内只会执行一次\n\n```js 节流函数\n/**\n * 节流函数 throttle()\n * @param {function} fn 事件触发的操作\n * @param {number} delay 多少毫秒内连续触发事件，只会执行一次\n * @returns {Function}\n */\nfunction throttle(fn, delay) {\n  let timer = null ;\n  let flag = true ; // 当前是否正在执行...\n  return function() {\n    if (!flag) return\n    flag = false; \n    let self = this ; // 注意this指向\n    args = arguments; // 拿到函数的入参\n\n    timer && clearTimeout(timer);\n    timer = setTimeout(() => {\n      flag = true; // 时间到了，可以继续执行下一次事件\n      fn.apply(self, args);\n    }, delay)\n  }\n}\n```\n\n使用的规则同 <a href='#防抖函数'> 防抖函数 </a>\n\n***\n\n### 4. 将字符串运行成js脚本的几种方式\n\n```js\n    1. eval('字符串')\n    2. new Function('字符串')\n\n    3. setTimeout('字符串', 1000)\n    4. setInterval('字符串', 1000)\n```\n\n***\n\n### 5. 浏览器复制内容到剪切板\n\n```js\n/**\n * 浏览器复制内容到剪切板 copyText()\n * @param {string} text 需要复制的内容\n * @returns null\n */\nconst copyText = (text)=>{\n  var range = document.createRange();\n  var copyDOM = document.createElement('a');\n  copyDOM.innerHTML = text;\n  window.getSelection().removeAllRanges();\n  document.body.appendChild(copyDOM)\n  range.selectNode(copyDOM);\n  window.getSelection().addRange(range);\n  var successful = document.execCommand('copy');\n  if(successful){\n    // 复制成功到剪切板\n  }else{\n    // 复制失败，一般是因为浏览器不支持复制\n  }\n  document.body.removeChild(copyDOM)\n}\n```\n\n***\n\n### 6. 取随机字符串\n\n取随机字符串根据业务的不同会有不一样的取值方式，用作签名的一部分、用做随机密码....\n这里我采用的是获取长度不定、去除容易混淆的字符oOLl,9gq,Vv,Uu,I1的随机位数的随机字符\n\n```js\n/**\n * 取随机字符串 randomString()\n * @param {number} len 随机字符串的长度\n * @returns null\n */\nfunction randomString(len) {\n  len = len || 32; // 默认随机生成32位长度字符串\n  var $chars = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678';    /****默认去掉了容易混淆的字符oOLl,9gq,Vv,Uu,I1****/\n  var maxPos = $chars.length;\n  var randomStr = '';\n  for (var i = 0; i < len; i++) {\n    randomStr += $chars.charAt(Math.floor(Math.random() * maxPos));\n  }\n  return randomStr;\n}\n```\n\n***\n\n### 7. 异步加载一段js脚本\n\n如： 异步引入网页悬浮脚本、异步引入高德地图、腾讯地图等。\n\n```ts\n/**\n * @description 异步加载  一段js放在 header\n * @param {object} url - js 的 url\n * @param {function} callback - 成功回调\n * @returns { promise<any>}} promise\n */\nconst loadScript = (url: string) => {\n  return new Promise(() => {\n    try {\n      const script: any = document.createElement('script')\n      script.type = 'text/javascript'\n      if (script.readyState) {\n        //IE\n        script.onreadystatechange = function () {\n          if (\n            script.readyState == 'loaded' ||\n            script.readyState == 'complete'\n          ) {\n            script.onreadystatechange = null\n            Promise.resolve(0)\n          }\n        }\n      } else {\n        //Others: Firefox, Safari, Chrome, and Opera\n        script.onload = function () {\n          Promise.resolve(0)\n        }\n      }\n      script.src = url\n      document.body.appendChild(script)\n    } catch (e) {\n      Promise.reject(e)\n    }\n  })\n}\n```\n\n***\n\n### 8. 获取页面高度\n\n```js\n// get page height\nconst getPageHeight = () => {\n  const g = document\n  const a = g.body\n  const f = g.documentElement\n  const d = g.compatMode === 'BackCompat' ? a : g.documentElement\n  return Math.max(f.scrollHeight, a.scrollHeight, d.clientHeight)\n}\n```\n\n***\n\n### 9. 获取页面可视高度\n\n```js\n// get page view height\nconst getPageViewHeight = () => {\n  const d = document\n  const a = d.compatMode === 'BackCompat' ? d.body : d.documentElement\n  return a.clientHeight\n}\n```\n\n***\n\n### 10. 获取页面可视宽度\n\n```js\n// get page view width\nconst getPageViewWidth = () => {\n  const d = document\n  const a = d.compatMode === 'BackCompat' ? d.body : d.documentElement\n  return a.clientWidth\n}\n```\n\n***\n\n### 11. 获取页面宽度\n\n```js\n// get page width\nconst getPageWidth = () => {\n  const g = document\n  const a = g.body\n  const f = g.documentElement\n  const d = g.compatMode === 'BackCompat' ? a : g.documentElement\n  return Math.max(f.scrollWidth, a.scrollWidth, d.clientWidth)\n}\n```\n\n***\n\n### 12. 判断当前设备\n\n#### 是否为安卓设备\n\n```js\nconst isAndroidMobileDevice = () => {\n  return /android/i.test(navigator.userAgent.toLowerCase())\n}\n```\n\n#### 是否为苹果设备\n\n```js\nconst isAppleMobileDevice = () => {\n  return /iphone|ipod|ipad|Macintosh/i.test(navigator.userAgent.toLowerCase())\n}\n```\n\n#### 是否为iPhoneX\n\n```js\nconst isIphonex = () => {\n  // X XS, XS Max, XR\n  const xSeriesConfig = [\n    {\n      devicePixelRatio: 3,\n      width: 375,\n      height: 812\n    },\n    {\n      devicePixelRatio: 3,\n      width: 414,\n      height: 896\n    },\n    {\n      devicePixelRatio: 2,\n      width: 414,\n      height: 896\n    }\n  ]\n  if (typeof window !== 'undefined' && window) {\n    const isIOS = /iphone/gi.test(window.navigator.userAgent)\n    if (!isIOS) return false\n    const { devicePixelRatio, screen } = window\n    const { width, height } = screen\n    return xSeriesConfig.some(\n      (item) =>\n        item.devicePixelRatio === devicePixelRatio &&\n        item.width === width &&\n        item.height === height\n    )\n  }\n  return false\n}\n```\n\n#### 是否为手机设备\n\n```js\nconst isMobileUserAgent = () => {\n  return /iphone|ipod|android.*mobile|windows.*phone|blackberry.*mobile/i.test(\n    window.navigator.userAgent.toLowerCase()\n  )\n}\n```\n\n***\n\n### 13. 设置cookie\n\n```ts\n/**\n * @description 设置 cookie\n * @params {string} cookie -键名\n * @params {any} value -存入的值\n * @params {Hours} number -有效期限\n */\nconst setCookie = (name: string, value: any, Hours: number) => {\n  const d = new Date()\n  const offset = 8\n  const utc = d.getTime() + d.getTimezoneOffset() * 60000\n  const nd = utc + 3600000 * offset\n  const exp = new Date(nd)\n  exp.setTime(exp.getTime() + Hours * 60 * 60 * 1000)\n  document.cookie =\n    name +\n    '=' +\n    escape(value) +\n    ';path=/;expires=' +\n    exp.toUTCString() +\n    ';domain=360doc.com;'\n}\n```\n\n***\n\n### 14. 获取字符串对应的字节数\n\n```js\n/**\n * @description 获取字节数\n * @param s 字符串\n */\nconst getBytesLength = (s: string) => {\n  return s.replace(/[^\\x00-\\xff]/gi, '--').length\n}\n```\n\n***\n\n### 15. 获取本地的时间\n\n```ts\n/**\n * 获取本地的时间\n */\nconst getServerTime = () => {\n  var xmlHttp: XMLHttpRequest\n  function srvTime() {\n    try {\n      // FF, Opera, Safari, Chrome\n      xmlHttp = new XMLHttpRequest()\n    } catch (err1) {\n      // IE\n      try {\n        xmlHttp = new ActiveXObject('Msxml2.XMLHTTP')\n      } catch (err2) {\n        try {\n          xmlHttp = new ActiveXObject('Microsoft.XMLHTTP')\n        } catch (eerr3) {\n          // AJAX not supported, use CPU time.\n          alert('AJAX not supported')\n        }\n      }\n    }\n    xmlHttp.open('HEAD', window.location.href.toString(), false)\n    xmlHttp.setRequestHeader('Content-Type', 'text/html')\n    xmlHttp.send('')\n    return xmlHttp.getResponseHeader('Date')\n  }\n\n  var st = srvTime()\n  var date = new Date(st as string)\n  var timestamp = date.getTime()\n  return timestamp\n}\n```\n\n***\n\n### 16. 获取浏览器的Cookie的值\n\n```js\n/**\n * 获取浏览器的Cookie的值\n */\nconst cookie = name => `; ${document.cookie}`.split(`; ${name}=`).pop().split(';').shift();\n\n// 获取token \ncookie('TOKEN')\n```\n\n***\n\n### 17. 颜色RGB转十六进制\n\n```js\n/**\n * 颜色RGB转十六进制\n */\nconst rgbToHex = (r, g, b) => \"#\" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);\n\nrgbToHex(0, 51, 255); \n// Result: #0033ff\n```\n\n***\n\n### 18. 复制到剪贴板(新的API)\n\n```js\n/**\n * 复制到剪贴板\n */\nconst copyToClipboard = (text) => navigator.clipboard.writeText(text);\n    \ncopyToClipboard(\"Hello World\");\n```\n\n***\n\n### 19. 清除所有Cookie\n\n```js\n/**\n * 清除所有Cookie\n */\nconst clearCookies = document.cookie.split(';').forEach(cookie => document.cookie = cookie.replace(/^ +/, '').replace(/=.*/, `=;expires=${new Date(0).toUTCString()};path=/`));\n```\n\n***\n\n### 20. 生成随机十六进制颜色\n\n```js\n/**\n * 生成随机十六进制颜色\n */\nconst randomHex = () => `#${Math.floor(Math.random() * 0xffffff).toString(16).padEnd(6, \"0\")}`;\n    \n console.log(randomHex());\n// Result: #92b008\n```\n\n***\n\n### 21. 从URL获取查询参数 -- JS\n\n```js\n/**\n * 从URL获取查询参数\n */\nconst getParameters = (URL) => {\n  URL = JSON.parse(\n    '{\"' +\n      decodeURI(URL.split(\"?\")[1])\n        .replace(/\"/g, '\\\\\"')\n        .replace(/&/g, '\",\"')\n        .replace(/=/g, '\":\"') +\n      '\"}'\n  );\n  return JSON.stringify(URL);\n};\n\n// 调用\ngetParameters(window.location);\n// Result: { search : \"easy\", page : 3 }\n```\n\n或者： \n\n```js\n/**\n * 从URL获取查询参数\n */\nObject.fromEntries(new URLSearchParams(window.location.search))\n```\n\n***\n\n### 22. 检查用户的设备是否在暗黑模式\n\n```js\n/**\n * 检查用户的设备是否在暗黑模式\n * @return Boolean\n */\nconst isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches\n```\n\n***\n\n### 23. 下载一个Excel文档\n\n```js\n/**\n * 下载一个链接\n */ \nfunction download(link, name) {\n\tif(!name){\n\t\tname = link.slice(link.lastIndexOf('/') + 1)\n\t}\n\tlet eleLink = document.createElement('a')\n\teleLink.download = name\n\teleLink.style.display = 'none'\n\teleLink.href = link\n\tdocument.body.appendChild(eleLink)\n\teleLink.click()\n\tdocument.body.removeChild(eleLink)\n}\n\n//下载excel\ndownload('http://111.229.14.189/file/1.xlsx')\n```\n\n***\n\n### 24. 浏览器中下载一些DOM内容/JSON文件\n\n```js\n/**\n * 浏览器下载静态文件\n * @param {String} name 文件名\n * @param {String} content 文件内容\n */\nfunction downloadFile(name, content) {\n\tif (typeof name == 'undefined') {\n\t\tthrow new Error('The first parameter name is a must')\n\t}\n\tif (typeof content == 'undefined') {\n\t\tthrow new Error('The second parameter content is a must')\n\t}\n\tif (!(content instanceof Blob)) {\n\t\tcontent = new Blob([content])\n\t}\n\tconst link = URL.createObjectURL(content)\n\tdownload(link, name)\n}\n\n// 调用下载\ndownloadFile('1.txt','lalalallalalla')\ndownloadFile('1.json',JSON.stringify({name:'hahahha'}))\n```\n\n***\n\n### 25. 浏览器下载MP4/PDF/图片等\n\n```js\n/**\n * 浏览器下载MP4/PDF/图片等\n */\nimport axios from 'axios'\n//提供一个link，完成文件下载，link可以是  http://xxx.com/xxx.xls\nfunction downloadByLink(link,fileName){\n\taxios.request({\n\t\turl: link,\n\t\tresponseType: 'blob' // 关键代码，让axios把响应改成blob\n\t}).then(res => {\n    const link = URL.createObjectURL(res.data)\n\t\tdownload(link, fileName)\n  })\n}\n```\n\n注意：会有同源策略的限制，需要配置转发\n\n***\n\n### 26. 去除对象中的空元素\n\n给后端发送数据的时候，要判断某个属性是不是空字符串，然后给后端拼参数，这块逻辑抽离出来就是`cleanObject`，代码实现如下：\n\n```js\n/**\n * cleanObject 去除对象中的空元素\n */\nexport const cleanObject = (object) => {\n  // Object.assign({}, object)\n  if (!object) {\n    return {};\n  }\n  const result = { ...object };\n  Object.keys(result).forEach((key) => {\n    const value = result[key];\n    if (isVoid(value)) {\n      delete result[key];\n    }\n  });\n  return result;\n};\n\n// 判断是否为空\nexport const isVoid = (value) =>\n  value === undefined || value === null || value === \"\";\n```\n\n使用：\n\n```js\nlet res = cleanObject({\n    name:'',\n    pageSize:10,\n    page:1\n})\nconsole.log(\"res\", res) // 输出 { page:1,pageSize:10 }\n```\n\n***\n\n### 27. 常用的正则验证\n\n```js\n/**\n * 常用的正则验证\n */\nconst checkStr = function(str, type) { // 常用正则验证，注意type大小写\n  switch (type) {\n    case 'phone': // 手机号码\n      return /^1[3|4|5|6|7|8|9][0-9]{9}$/.test(str)\n    case 'tel': // 座机\n      return /^(0\\d{2,3}-\\d{7,8})(-\\d{1,4})?$/.test(str)\n    case 'card': // 身份证\n      return /(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)/.test(str)\n    case 'pwd': // 密码以字母开头，长度在6~18之间，只能包含字母、数字和下划线\n      return /^[a-zA-Z]\\w{5,17}$/.test(str)\n    case 'postal': // 邮政编码\n      return /[1-9]\\d{5}(?!\\d)/.test(str)\n    case 'QQ': // QQ号\n      return /^[1-9][0-9]{4,9}$/.test(str)\n    case 'email': // 邮箱\n      return /^[\\w-]+(.[\\w-]+)*@[\\w-]+(.[\\w-]+)+$/.test(str)\n    case 'money': // 金额(小数点2位)\n      return /^\\d*(?:.\\d{0,2})?$/.test(str)\n    case 'URL': // 网址\n      return /(http|ftp|https)://[\\w-_]+(.[\\w-_]+)+([\\w-.,@?^=%&:/~+#]*[\\w-@?^=%&/~+#])?/.test(str)\n    case 'IP': // IP\n      return /((?:(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d))/.test(str)\n    case 'date': // 日期时间\n      return /^(\\d{4})-(\\d{2})-(\\d{2}) (\\d{2})(?::\\d{2}|:(\\d{2}):(\\d{2}))$/.test(str) ||\n        /^(\\d{4})-(\\d{2})-(\\d{2})$/.test(str)\n    case 'number': // 数字\n      return /^[0-9]$/.test(str)\n    case 'english': // 英文\n      return /^[a-zA-Z]+$/.test(str)\n    case 'chinese': // 中文\n      return /^[\\u4E00-\\u9FA5]+$/.test(str)\n    case 'lower': // 小写\n      return /^[a-z]+$/.test(str)\n    case 'upper': // 大写\n      return /^[A-Z]+$/.test(str)\n    case 'HTML': // HTML标记\n      return /<(\"[^\"]*\"|'[^']*'|[^'\">])*>/.test(str)\n    default:\n      return true\n  }\n}\n```\n\n***\n\n### 28. 阿拉伯数字转中文大写数字\n\n```js\n/**\n * 阿拉伯数字转中文大写数字\n */\nconst numberToChinese = function(num) { // 将阿拉伯数字翻译成中文的大写数字\n  let AA = new Array('零', '一', '二', '三', '四', '五', '六', '七', '八', '九', '十')\n  let BB = new Array('', '十', '百', '仟', '萬', '億', '点', '')\n  let a = ('' + num).replace(/(^0*)/g, '').split('.')\n  let k = 0\n  let re = ''\n  for (let i = a[0].length - 1; i >= 0; i--) {\n    switch (k) {\n      case 0:\n        re = BB[7] + re\n        break\n      case 4:\n        if (!new RegExp('0{4}//d{' + (a[0].length - i - 1) + '}$').test(a[0])) {\n          re = BB[4] + re\n        }\n        break\n      case 8:\n        re = BB[5] + re\n        BB[7] = BB[5]\n        k = 0\n        break\n    }\n    if (k % 4 === 2 && a[0].charAt(i + 2) !== 0 && a[0].charAt(i + 1) === 0) {\n      re = AA[0] + re\n    }\n    if (a[0].charAt(i) !== 0) {\n      re = AA[a[0].charAt(i)] + BB[k % 4] + re\n    }\n    k++\n  }\n  if (a.length > 1) { // 加上小数部分(如果有小数部分)\n    re += BB[6]\n    for (let i = 0; i < a[1].length; i++) {\n      re += AA[a[1].charAt(i)]\n    }\n  }\n  if (re === '一十') {\n    re = '十'\n  }\n  if (re.match(/^一/) && re.length === 3) {\n    re = re.replace('一', '')\n  }\n  return re\n}\n```\n\n***\n\n### 29. base64图片下载功能\n\n```js\n/**\n * base64图片下载功能\n */\nconst downloadFile = function(base64, fileName) { //base64图片下载功能\n  let base64ToBlob = function(code) {\n    let parts = code.split(';base64,');\n    let contentType = parts[0].split(':')[1];\n    let raw = window.atob(parts[1]);\n    let rawLength = raw.length;\n    let uInt8Array = new Uint8Array(rawLength);\n    for (let i = 0; i < rawLength; ++i) {\n      uInt8Array[i] = raw.charCodeAt(i);\n    }\n    return new Blob([uInt8Array], {\n      type: contentType\n    });\n  };\n  let aLink = document.createElement('a');\n  let blob = base64ToBlob(base64); //new Blob([content]);\n  let evt = document.createEvent(\"HTMLEvents\");\n  evt.initEvent(\"click\", true, true); //initEvent不加后两个参数在FF下会报错  事件类型，是否冒泡，是否阻止浏览器的默认行为\n  aLink.download = fileName;\n  aLink.href = URL.createObjectURL(blob);\n  aLink.click();\n}\n```\n\n***\n\n### 30. 获取div高度\n\n```js\n/**\n * 获取div高度\n */\nconst div = document.querySelector('');\nwindow.getComputedStyle(div).getPropertyValue('height');\n```\n\n\n***\n\n### 31. 将base64转化成可用formData提交的文件\n\n```ts\n/**\n * convertBase64UrlToBlob 将base64转化成可用formdata提交的文件\n * @param {string} urlData base64位的url\n * @returns\n */\nconst convertBase64UrlToBlob = (urlData) => {\n  //去掉url的头，并转换为byte\n  const split = urlData.split(',');\n  const bytes = window.atob(split[1]);\n  //处理异常,将ascii码小于0的转换为大于0\n  const ab = new ArrayBuffer(bytes.length);\n  const ia = new Uint8Array(ab);\n  for (let i = 0; i < bytes.length; i++) {\n    ia[i] = bytes.charCodeAt(i);\n  }\n  return new Blob([ab], { type: split[0].match(/:(.*?);/)[1] });\n};\n```\n\n***\n\n### 32. 找到对象中所有可能存在的字符串，并替换掉其中的<, >, (, )分别为全角的＜＞（）\n\n```ts\n/**\n * 找到对象中所有可能存在的字符串，并替换掉其中的<, >, (, )分别为全角的＜＞（）\n * 可以自定义拓展更多的规则\n * @param {object} obj 需要处理的对象\n * @return {object} aim obj\n */\nexport const formatString = (obj) => {\n  for (const key in obj) {\n    if (!obj.hasOwnProperty(key)) return; // 排除掉原型继承而来的属性\n    if (typeof obj[key] == 'string') {\n      obj[key] = obj[key]\n        .replace(/</g, '＜')\n        .replace(/>/g, '＞')\n        .replace(/\\(/g, '（')\n        .replace(/\\)/g, '）');\n    }\n    if (typeof obj[key] == 'object' || typeof obj[key] == 'function') {\n      formatString(obj[key]);\n    }\n  }\n  return obj;\n};\n```\n\n***\n\n### 33. 将对象格式转化为get请求所需要的参数\n\n```ts\n/**\n * getParams 将对象格式转化为get请求所需要的参数\n * @param {object} params 需要处理的对象\n * @return {object} aim obj\n */\nexport function getParams(params) {\n  let paramStr = '';\n  Object.keys(params).forEach((item) => {\n    if (paramStr === '') {\n      paramStr = `${item}=${params[item]}`;\n    } else {\n      paramStr = `${paramStr}&${item}=${params[item]}`;\n    }\n  });\n  return paramStr;\n}\n```\n\n***\n\n### 34. 获取图片真实的宽高（非真实渲染）\n\n```ts\n/**\n * getImageSize 获取图片的宽高\n * @param {string} url 需要处理的图片路径\n * @return {object} { width: number, height: number }\n */\nexport function getImageSize(url: string): Promise<any> {\n  return new Promise(function (resolve, reject) {\n    const image = new Image();\n    image.onload = function () {\n      resolve({\n        width: image.width, // 或naturalWidth\n        height: image.height, // 或naturalHeight\n      });\n      // 注释中这两个属性在Firefox/Chrome/Safari/Opera及IE9+里已经实现\n    };\n    image.onerror = function () {\n      reject(new Error('error'));\n    };\n    image.src = url;\n  });\n}\n```\n\n***\n\n### 35. 递归拿出对象数组中所有指定的字段项，并返回新数组\n\n```ts\n/**\n * 递归拿出所有指定的字段项\n * @param {Array} list\n * @param {string} key\n * @param {string} child\n * @returns {Array} 返回所有key的集合\n */\nexport function getKeyList(list: Array<any>, key: string, child = 'children') {\n  const result: any[] = [];\n  list.forEach((listItem) => {\n    listItem[key] && result.push(listItem[key]);\n    if (listItem[child] && listItem[child].length) {\n      result.push(...getKeyList(listItem[child], key, child));\n    }\n  });\n  return result;\n}\n```","slug":"JS常用工具类汇总(持续完善...)","published":1,"updated":"2022-08-26T01:42:59.880Z","comments":1,"link":"","_id":"cl79tdvv900015d9kcng650yc","content":"<p>整理项目开发中经常使用的Javascript片段, 以便Ctrl + C</p>\n<span id=\"more\"></span>\n\n\n<h3 id=\"1-创建a标签-打开新页面\"><a href=\"#1-创建a标签-打开新页面\" class=\"headerlink\" title=\"1. 创建a标签,打开新页面\"></a>1. 创建a标签,打开新页面</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 创建a标签,打开新页面 openURL()</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">String</span>&#125; url 目标地址</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@returns</span> <span class=\"variable\">null</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">openURL</span>(<span class=\"params\">url</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> aLabel = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;a&#x27;</span>);</span><br><span class=\"line\">  <span class=\"comment\">//设置链接</span></span><br><span class=\"line\">  aLabel.<span class=\"title function_\">setAttribute</span>(<span class=\"string\">&#x27;href&#x27;</span>, url);</span><br><span class=\"line\">  <span class=\"comment\">//新窗口打开链接</span></span><br><span class=\"line\">  aLabel.<span class=\"title function_\">setAttribute</span>(<span class=\"string\">&#x27;target&#x27;</span>, <span class=\"string\">&#x27;_blank&#x27;</span>);</span><br><span class=\"line\">  <span class=\"comment\">//设置标签ID</span></span><br><span class=\"line\">  aLabel.<span class=\"title function_\">setAttribute</span>(<span class=\"string\">&#x27;id&#x27;</span>, <span class=\"string\">&#x27;reportpoint&#x27;</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 防止反复添加</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;reportpoint&#x27;</span>)) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">removeChild</span>(<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;reportpoint&#x27;</span>));</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">appendChild</span>(aLabel);</span><br><span class=\"line\">  aLabel.<span class=\"title function_\">click</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2-防抖函数\"><a href=\"#2-防抖函数\" class=\"headerlink\" title=\"2. 防抖函数\"></a>2. 防抖函数</h3><p>防抖函数的原理就是通过延时器控制用户在短时间内进行重复操作的时候取消上一次操作</p>\n<figure class=\"highlight js\"><figcaption><span>防抖函数</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 防抖函数 debounce()</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">function</span>&#125; fn 事件触发的操作</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">number</span>&#125; delay 多少毫秒内连续触发事件，不会执行</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@returns</span> &#123;<span class=\"type\">Function</span>&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">debounce</span>(<span class=\"params\">fn, delay</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> timer = <span class=\"literal\">null</span> ;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> self = <span class=\"variable language_\">this</span> ; <span class=\"comment\">// 注意this指向</span></span><br><span class=\"line\">    args = <span class=\"variable language_\">arguments</span>; <span class=\"comment\">// 拿到函数的入参</span></span><br><span class=\"line\"></span><br><span class=\"line\">    timer &amp;&amp; <span class=\"built_in\">clearTimeout</span>(timer);</span><br><span class=\"line\">    timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      fn.<span class=\"title function_\">apply</span>(self, args);</span><br><span class=\"line\">    &#125;, delay)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 假设现有以下点击事件，clickEvent()</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> input1 = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;input1&#x27;</span>);</span><br><span class=\"line\">input1.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;keyup&#x27;</span>,<span class=\"title function_\">debounce</span>(action1,<span class=\"number\">1000</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">action1</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(input1.<span class=\"property\">value</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"3-节流函数\"><a href=\"#3-节流函数\" class=\"headerlink\" title=\"3. 节流函数\"></a>3. 节流函数</h3><p>节流函数的原理就是通过控制延时器,当高频事件触发，n秒内只会执行一次</p>\n<figure class=\"highlight js\"><figcaption><span>节流函数</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 节流函数 throttle()</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">function</span>&#125; fn 事件触发的操作</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">number</span>&#125; delay 多少毫秒内连续触发事件，只会执行一次</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@returns</span> &#123;<span class=\"type\">Function</span>&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">throttle</span>(<span class=\"params\">fn, delay</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> timer = <span class=\"literal\">null</span> ;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> flag = <span class=\"literal\">true</span> ; <span class=\"comment\">// 当前是否正在执行...</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!flag) <span class=\"keyword\">return</span></span><br><span class=\"line\">    flag = <span class=\"literal\">false</span>; </span><br><span class=\"line\">    <span class=\"keyword\">let</span> self = <span class=\"variable language_\">this</span> ; <span class=\"comment\">// 注意this指向</span></span><br><span class=\"line\">    args = <span class=\"variable language_\">arguments</span>; <span class=\"comment\">// 拿到函数的入参</span></span><br><span class=\"line\"></span><br><span class=\"line\">    timer &amp;&amp; <span class=\"built_in\">clearTimeout</span>(timer);</span><br><span class=\"line\">    timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      flag = <span class=\"literal\">true</span>; <span class=\"comment\">// 时间到了，可以继续执行下一次事件</span></span><br><span class=\"line\">      fn.<span class=\"title function_\">apply</span>(self, args);</span><br><span class=\"line\">    &#125;, delay)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用的规则同 <a href='#防抖函数'> 防抖函数 </a></p>\n<hr>\n<h3 id=\"4-将字符串运行成js脚本的几种方式\"><a href=\"#4-将字符串运行成js脚本的几种方式\" class=\"headerlink\" title=\"4. 将字符串运行成js脚本的几种方式\"></a>4. 将字符串运行成js脚本的几种方式</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1.</span> <span class=\"built_in\">eval</span>(<span class=\"string\">&#x27;字符串&#x27;</span>)</span><br><span class=\"line\"><span class=\"number\">2.</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Function</span>(<span class=\"string\">&#x27;字符串&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">3.</span> <span class=\"built_in\">setTimeout</span>(<span class=\"string\">&#x27;字符串&#x27;</span>, <span class=\"number\">1000</span>)</span><br><span class=\"line\"><span class=\"number\">4.</span> <span class=\"built_in\">setInterval</span>(<span class=\"string\">&#x27;字符串&#x27;</span>, <span class=\"number\">1000</span>)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"5-浏览器复制内容到剪切板\"><a href=\"#5-浏览器复制内容到剪切板\" class=\"headerlink\" title=\"5. 浏览器复制内容到剪切板\"></a>5. 浏览器复制内容到剪切板</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 浏览器复制内容到剪切板 copyText()</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; text 需要复制的内容</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@returns</span> <span class=\"variable\">null</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">copyText</span> = (<span class=\"params\">text</span>)=&gt;&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> range = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createRange</span>();</span><br><span class=\"line\">  <span class=\"keyword\">var</span> copyDOM = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;a&#x27;</span>);</span><br><span class=\"line\">  copyDOM.<span class=\"property\">innerHTML</span> = text;</span><br><span class=\"line\">  <span class=\"variable language_\">window</span>.<span class=\"title function_\">getSelection</span>().<span class=\"title function_\">removeAllRanges</span>();</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">appendChild</span>(copyDOM)</span><br><span class=\"line\">  range.<span class=\"title function_\">selectNode</span>(copyDOM);</span><br><span class=\"line\">  <span class=\"variable language_\">window</span>.<span class=\"title function_\">getSelection</span>().<span class=\"title function_\">addRange</span>(range);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> successful = <span class=\"variable language_\">document</span>.<span class=\"title function_\">execCommand</span>(<span class=\"string\">&#x27;copy&#x27;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(successful)&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 复制成功到剪切板</span></span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 复制失败，一般是因为浏览器不支持复制</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">removeChild</span>(copyDOM)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"6-取随机字符串\"><a href=\"#6-取随机字符串\" class=\"headerlink\" title=\"6. 取随机字符串\"></a>6. 取随机字符串</h3><p>取随机字符串根据业务的不同会有不一样的取值方式，用作签名的一部分、用做随机密码….<br>这里我采用的是获取长度不定、去除容易混淆的字符oOLl,9gq,Vv,Uu,I1的随机位数的随机字符</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 取随机字符串 randomString()</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">number</span>&#125; len 随机字符串的长度</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@returns</span> <span class=\"variable\">null</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">randomString</span>(<span class=\"params\">len</span>) &#123;</span><br><span class=\"line\">  len = len || <span class=\"number\">32</span>; <span class=\"comment\">// 默认随机生成32位长度字符串</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> $chars = <span class=\"string\">&#x27;ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678&#x27;</span>;    <span class=\"comment\">/****默认去掉了容易混淆的字符oOLl,9gq,Vv,Uu,I1****/</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> maxPos = $chars.<span class=\"property\">length</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> randomStr = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">    randomStr += $chars.<span class=\"title function_\">charAt</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">floor</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * maxPos));</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> randomStr;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"7-异步加载一段js脚本\"><a href=\"#7-异步加载一段js脚本\" class=\"headerlink\" title=\"7. 异步加载一段js脚本\"></a>7. 异步加载一段js脚本</h3><p>如： 异步引入网页悬浮脚本、异步引入高德地图、腾讯地图等。</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span> 异步加载  一段js放在 header</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">object</span>&#125; <span class=\"variable\">url</span> - js 的 url</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">function</span>&#125; <span class=\"variable\">callback</span> - 成功回调</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@returns</span> &#123;<span class=\"type\"> promise&lt;any&gt;</span>&#125;&#125; promise</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">loadScript</span> = (<span class=\"params\">url: <span class=\"built_in\">string</span></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> <span class=\"attr\">script</span>: <span class=\"built_in\">any</span> = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;script&#x27;</span>)</span><br><span class=\"line\">      script.<span class=\"property\">type</span> = <span class=\"string\">&#x27;text/javascript&#x27;</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (script.<span class=\"property\">readyState</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//IE</span></span><br><span class=\"line\">        script.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (</span><br><span class=\"line\">            script.<span class=\"property\">readyState</span> == <span class=\"string\">&#x27;loaded&#x27;</span> ||</span><br><span class=\"line\">            script.<span class=\"property\">readyState</span> == <span class=\"string\">&#x27;complete&#x27;</span></span><br><span class=\"line\">          ) &#123;</span><br><span class=\"line\">            script.<span class=\"property\">onreadystatechange</span> = <span class=\"literal\">null</span></span><br><span class=\"line\">            <span class=\"title class_\">Promise</span>.<span class=\"title function_\">resolve</span>(<span class=\"number\">0</span>)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//Others: Firefox, Safari, Chrome, and Opera</span></span><br><span class=\"line\">        script.<span class=\"property\">onload</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">          <span class=\"title class_\">Promise</span>.<span class=\"title function_\">resolve</span>(<span class=\"number\">0</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      script.<span class=\"property\">src</span> = url</span><br><span class=\"line\">      <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">appendChild</span>(script)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">      <span class=\"title class_\">Promise</span>.<span class=\"title function_\">reject</span>(e)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"8-获取页面高度\"><a href=\"#8-获取页面高度\" class=\"headerlink\" title=\"8. 获取页面高度\"></a>8. 获取页面高度</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// get page height</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">getPageHeight</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> g = <span class=\"variable language_\">document</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> a = g.<span class=\"property\">body</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> f = g.<span class=\"property\">documentElement</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> d = g.<span class=\"property\">compatMode</span> === <span class=\"string\">&#x27;BackCompat&#x27;</span> ? a : g.<span class=\"property\">documentElement</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"title class_\">Math</span>.<span class=\"title function_\">max</span>(f.<span class=\"property\">scrollHeight</span>, a.<span class=\"property\">scrollHeight</span>, d.<span class=\"property\">clientHeight</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"9-获取页面可视高度\"><a href=\"#9-获取页面可视高度\" class=\"headerlink\" title=\"9. 获取页面可视高度\"></a>9. 获取页面可视高度</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// get page view height</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">getPageViewHeight</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> d = <span class=\"variable language_\">document</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> a = d.<span class=\"property\">compatMode</span> === <span class=\"string\">&#x27;BackCompat&#x27;</span> ? d.<span class=\"property\">body</span> : d.<span class=\"property\">documentElement</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> a.<span class=\"property\">clientHeight</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"10-获取页面可视宽度\"><a href=\"#10-获取页面可视宽度\" class=\"headerlink\" title=\"10. 获取页面可视宽度\"></a>10. 获取页面可视宽度</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// get page view width</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">getPageViewWidth</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> d = <span class=\"variable language_\">document</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> a = d.<span class=\"property\">compatMode</span> === <span class=\"string\">&#x27;BackCompat&#x27;</span> ? d.<span class=\"property\">body</span> : d.<span class=\"property\">documentElement</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> a.<span class=\"property\">clientWidth</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"11-获取页面宽度\"><a href=\"#11-获取页面宽度\" class=\"headerlink\" title=\"11. 获取页面宽度\"></a>11. 获取页面宽度</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// get page width</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">getPageWidth</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> g = <span class=\"variable language_\">document</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> a = g.<span class=\"property\">body</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> f = g.<span class=\"property\">documentElement</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> d = g.<span class=\"property\">compatMode</span> === <span class=\"string\">&#x27;BackCompat&#x27;</span> ? a : g.<span class=\"property\">documentElement</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"title class_\">Math</span>.<span class=\"title function_\">max</span>(f.<span class=\"property\">scrollWidth</span>, a.<span class=\"property\">scrollWidth</span>, d.<span class=\"property\">clientWidth</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"12-判断当前设备\"><a href=\"#12-判断当前设备\" class=\"headerlink\" title=\"12. 判断当前设备\"></a>12. 判断当前设备</h3><h4 id=\"是否为安卓设备\"><a href=\"#是否为安卓设备\" class=\"headerlink\" title=\"是否为安卓设备\"></a>是否为安卓设备</h4><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">isAndroidMobileDevice</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"regexp\">/android/i</span>.<span class=\"title function_\">test</span>(navigator.<span class=\"property\">userAgent</span>.<span class=\"title function_\">toLowerCase</span>())</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"是否为苹果设备\"><a href=\"#是否为苹果设备\" class=\"headerlink\" title=\"是否为苹果设备\"></a>是否为苹果设备</h4><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">isAppleMobileDevice</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"regexp\">/iphone|ipod|ipad|Macintosh/i</span>.<span class=\"title function_\">test</span>(navigator.<span class=\"property\">userAgent</span>.<span class=\"title function_\">toLowerCase</span>())</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"是否为iPhoneX\"><a href=\"#是否为iPhoneX\" class=\"headerlink\" title=\"是否为iPhoneX\"></a>是否为iPhoneX</h4><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">isIphonex</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"comment\">// X XS, XS Max, XR</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> xSeriesConfig = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">devicePixelRatio</span>: <span class=\"number\">3</span>,</span><br><span class=\"line\">      <span class=\"attr\">width</span>: <span class=\"number\">375</span>,</span><br><span class=\"line\">      <span class=\"attr\">height</span>: <span class=\"number\">812</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">devicePixelRatio</span>: <span class=\"number\">3</span>,</span><br><span class=\"line\">      <span class=\"attr\">width</span>: <span class=\"number\">414</span>,</span><br><span class=\"line\">      <span class=\"attr\">height</span>: <span class=\"number\">896</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">devicePixelRatio</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">      <span class=\"attr\">width</span>: <span class=\"number\">414</span>,</span><br><span class=\"line\">      <span class=\"attr\">height</span>: <span class=\"number\">896</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"variable language_\">window</span> !== <span class=\"string\">&#x27;undefined&#x27;</span> &amp;&amp; <span class=\"variable language_\">window</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> isIOS = <span class=\"regexp\">/iphone/gi</span>.<span class=\"title function_\">test</span>(<span class=\"variable language_\">window</span>.<span class=\"property\">navigator</span>.<span class=\"property\">userAgent</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isIOS) <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; devicePixelRatio, screen &#125; = <span class=\"variable language_\">window</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; width, height &#125; = screen</span><br><span class=\"line\">    <span class=\"keyword\">return</span> xSeriesConfig.<span class=\"title function_\">some</span>(</span><br><span class=\"line\">      <span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span></span><br><span class=\"line\">        item.<span class=\"property\">devicePixelRatio</span> === devicePixelRatio &amp;&amp;</span><br><span class=\"line\">        item.<span class=\"property\">width</span> === width &amp;&amp;</span><br><span class=\"line\">        item.<span class=\"property\">height</span> === height</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"是否为手机设备\"><a href=\"#是否为手机设备\" class=\"headerlink\" title=\"是否为手机设备\"></a>是否为手机设备</h4><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">isMobileUserAgent</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"regexp\">/iphone|ipod|android.*mobile|windows.*phone|blackberry.*mobile/i</span>.<span class=\"title function_\">test</span>(</span><br><span class=\"line\">    <span class=\"variable language_\">window</span>.<span class=\"property\">navigator</span>.<span class=\"property\">userAgent</span>.<span class=\"title function_\">toLowerCase</span>()</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"13-设置cookie\"><a href=\"#13-设置cookie\" class=\"headerlink\" title=\"13. 设置cookie\"></a>13. 设置cookie</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span> 设置 cookie</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@params</span> &#123;<span class=\"type\">string</span>&#125; <span class=\"variable\">cookie</span> -键名</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@params</span> &#123;<span class=\"type\">any</span>&#125; <span class=\"variable\">value</span> -存入的值</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@params</span> &#123;<span class=\"type\">Hours</span>&#125; <span class=\"variable\">number</span> -有效期限</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setCookie</span> = (<span class=\"params\">name: <span class=\"built_in\">string</span>, value: <span class=\"built_in\">any</span>, Hours: <span class=\"built_in\">number</span></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> d = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>()</span><br><span class=\"line\">  <span class=\"keyword\">const</span> offset = <span class=\"number\">8</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> utc = d.<span class=\"title function_\">getTime</span>() + d.<span class=\"title function_\">getTimezoneOffset</span>() * <span class=\"number\">60000</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> nd = utc + <span class=\"number\">3600000</span> * offset</span><br><span class=\"line\">  <span class=\"keyword\">const</span> exp = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>(nd)</span><br><span class=\"line\">  exp.<span class=\"title function_\">setTime</span>(exp.<span class=\"title function_\">getTime</span>() + <span class=\"title class_\">Hours</span> * <span class=\"number\">60</span> * <span class=\"number\">60</span> * <span class=\"number\">1000</span>)</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"property\">cookie</span> =</span><br><span class=\"line\">    name +</span><br><span class=\"line\">    <span class=\"string\">&#x27;=&#x27;</span> +</span><br><span class=\"line\">    <span class=\"built_in\">escape</span>(value) +</span><br><span class=\"line\">    <span class=\"string\">&#x27;;path=/;expires=&#x27;</span> +</span><br><span class=\"line\">    exp.<span class=\"title function_\">toUTCString</span>() +</span><br><span class=\"line\">    <span class=\"string\">&#x27;;domain=360doc.com;&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"14-获取字符串对应的字节数\"><a href=\"#14-获取字符串对应的字节数\" class=\"headerlink\" title=\"14. 获取字符串对应的字节数\"></a>14. 获取字符串对应的字节数</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span> 获取字节数</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> s 字符串</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">getBytesLength</span> = (<span class=\"params\">s: string</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> s.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/[^\\x00-\\xff]/gi</span>, <span class=\"string\">&#x27;--&#x27;</span>).<span class=\"property\">length</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"15-获取本地的时间\"><a href=\"#15-获取本地的时间\" class=\"headerlink\" title=\"15. 获取本地的时间\"></a>15. 获取本地的时间</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 获取本地的时间</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">getServerTime</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> <span class=\"attr\">xmlHttp</span>: <span class=\"title class_\">XMLHttpRequest</span></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">srvTime</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// FF, Opera, Safari, Chrome</span></span><br><span class=\"line\">      xmlHttp = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>()</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (err1) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// IE</span></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        xmlHttp = <span class=\"keyword\">new</span> <span class=\"title class_\">ActiveXObject</span>(<span class=\"string\">&#x27;Msxml2.XMLHTTP&#x27;</span>)</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (err2) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          xmlHttp = <span class=\"keyword\">new</span> <span class=\"title class_\">ActiveXObject</span>(<span class=\"string\">&#x27;Microsoft.XMLHTTP&#x27;</span>)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (eerr3) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// AJAX not supported, use CPU time.</span></span><br><span class=\"line\">          <span class=\"title function_\">alert</span>(<span class=\"string\">&#x27;AJAX not supported&#x27;</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    xmlHttp.<span class=\"title function_\">open</span>(<span class=\"string\">&#x27;HEAD&#x27;</span>, <span class=\"variable language_\">window</span>.<span class=\"property\">location</span>.<span class=\"property\">href</span>.<span class=\"title function_\">toString</span>(), <span class=\"literal\">false</span>)</span><br><span class=\"line\">    xmlHttp.<span class=\"title function_\">setRequestHeader</span>(<span class=\"string\">&#x27;Content-Type&#x27;</span>, <span class=\"string\">&#x27;text/html&#x27;</span>)</span><br><span class=\"line\">    xmlHttp.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> xmlHttp.<span class=\"title function_\">getResponseHeader</span>(<span class=\"string\">&#x27;Date&#x27;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> st = <span class=\"title function_\">srvTime</span>()</span><br><span class=\"line\">  <span class=\"keyword\">var</span> date = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>(st <span class=\"keyword\">as</span> <span class=\"built_in\">string</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> timestamp = date.<span class=\"title function_\">getTime</span>()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> timestamp</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"16-获取浏览器的Cookie的值\"><a href=\"#16-获取浏览器的Cookie的值\" class=\"headerlink\" title=\"16. 获取浏览器的Cookie的值\"></a>16. 获取浏览器的Cookie的值</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 获取浏览器的Cookie的值</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">cookie</span> = name =&gt; <span class=\"string\">`; <span class=\"subst\">$&#123;<span class=\"variable language_\">document</span>.cookie&#125;</span>`</span>.<span class=\"title function_\">split</span>(<span class=\"string\">`; <span class=\"subst\">$&#123;name&#125;</span>=`</span>).<span class=\"title function_\">pop</span>().<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;;&#x27;</span>).<span class=\"title function_\">shift</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 获取token </span></span><br><span class=\"line\"><span class=\"title function_\">cookie</span>(<span class=\"string\">&#x27;TOKEN&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"17-颜色RGB转十六进制\"><a href=\"#17-颜色RGB转十六进制\" class=\"headerlink\" title=\"17. 颜色RGB转十六进制\"></a>17. 颜色RGB转十六进制</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 颜色RGB转十六进制</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">rgbToHex</span> = (<span class=\"params\">r, g, b</span>) =&gt; <span class=\"string\">&quot;#&quot;</span> + ((<span class=\"number\">1</span> &lt;&lt; <span class=\"number\">24</span>) + (r &lt;&lt; <span class=\"number\">16</span>) + (g &lt;&lt; <span class=\"number\">8</span>) + b).<span class=\"title function_\">toString</span>(<span class=\"number\">16</span>).<span class=\"title function_\">slice</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">rgbToHex</span>(<span class=\"number\">0</span>, <span class=\"number\">51</span>, <span class=\"number\">255</span>); </span><br><span class=\"line\"><span class=\"comment\">// Result: #0033ff</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"18-复制到剪贴板-新的API\"><a href=\"#18-复制到剪贴板-新的API\" class=\"headerlink\" title=\"18. 复制到剪贴板(新的API)\"></a>18. 复制到剪贴板(新的API)</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 复制到剪贴板</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">copyToClipboard</span> = (<span class=\"params\">text</span>) =&gt; navigator.<span class=\"property\">clipboard</span>.<span class=\"title function_\">writeText</span>(text);</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"title function_\">copyToClipboard</span>(<span class=\"string\">&quot;Hello World&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"19-清除所有Cookie\"><a href=\"#19-清除所有Cookie\" class=\"headerlink\" title=\"19. 清除所有Cookie\"></a>19. 清除所有Cookie</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 清除所有Cookie</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> clearCookies = <span class=\"variable language_\">document</span>.<span class=\"property\">cookie</span>.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;;&#x27;</span>).<span class=\"title function_\">forEach</span>(<span class=\"function\"><span class=\"params\">cookie</span> =&gt;</span> <span class=\"variable language_\">document</span>.<span class=\"property\">cookie</span> = cookie.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/^ +/</span>, <span class=\"string\">&#x27;&#x27;</span>).<span class=\"title function_\">replace</span>(<span class=\"regexp\">/=.*/</span>, <span class=\"string\">`=;expires=<span class=\"subst\">$&#123;<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(<span class=\"number\">0</span>).toUTCString()&#125;</span>;path=/`</span>));</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"20-生成随机十六进制颜色\"><a href=\"#20-生成随机十六进制颜色\" class=\"headerlink\" title=\"20. 生成随机十六进制颜色\"></a>20. 生成随机十六进制颜色</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 生成随机十六进制颜色</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">randomHex</span> = (<span class=\"params\"></span>) =&gt; <span class=\"string\">`#<span class=\"subst\">$&#123;<span class=\"built_in\">Math</span>.floor(<span class=\"built_in\">Math</span>.random() * <span class=\"number\">0xffffff</span>).toString(<span class=\"number\">16</span>).padEnd(<span class=\"number\">6</span>, <span class=\"string\">&quot;0&quot;</span>)&#125;</span>`</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\"> <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">randomHex</span>());</span><br><span class=\"line\"><span class=\"comment\">// Result: #92b008</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"21-从URL获取查询参数-–-JS\"><a href=\"#21-从URL获取查询参数-–-JS\" class=\"headerlink\" title=\"21. 从URL获取查询参数 – JS\"></a>21. 从URL获取查询参数 – JS</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 从URL获取查询参数</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">getParameters</span> = (<span class=\"params\">URL</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"variable constant_\">URL</span> = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(</span><br><span class=\"line\">    <span class=\"string\">&#x27;&#123;&quot;&#x27;</span> +</span><br><span class=\"line\">      <span class=\"built_in\">decodeURI</span>(<span class=\"variable constant_\">URL</span>.<span class=\"title function_\">split</span>(<span class=\"string\">&quot;?&quot;</span>)[<span class=\"number\">1</span>])</span><br><span class=\"line\">        .<span class=\"title function_\">replace</span>(<span class=\"regexp\">/&quot;/g</span>, <span class=\"string\">&#x27;\\\\&quot;&#x27;</span>)</span><br><span class=\"line\">        .<span class=\"title function_\">replace</span>(<span class=\"regexp\">/&amp;/g</span>, <span class=\"string\">&#x27;&quot;,&quot;&#x27;</span>)</span><br><span class=\"line\">        .<span class=\"title function_\">replace</span>(<span class=\"regexp\">/=/g</span>, <span class=\"string\">&#x27;&quot;:&quot;&#x27;</span>) +</span><br><span class=\"line\">      <span class=\"string\">&#x27;&quot;&#125;&#x27;</span></span><br><span class=\"line\">  );</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(<span class=\"variable constant_\">URL</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 调用</span></span><br><span class=\"line\"><span class=\"title function_\">getParameters</span>(<span class=\"variable language_\">window</span>.<span class=\"property\">location</span>);</span><br><span class=\"line\"><span class=\"comment\">// Result: &#123; search : &quot;easy&quot;, page : 3 &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>或者： </p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 从URL获取查询参数</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"title class_\">Object</span>.<span class=\"title function_\">fromEntries</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">URLSearchParams</span>(<span class=\"variable language_\">window</span>.<span class=\"property\">location</span>.<span class=\"property\">search</span>))</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"22-检查用户的设备是否在暗黑模式\"><a href=\"#22-检查用户的设备是否在暗黑模式\" class=\"headerlink\" title=\"22. 检查用户的设备是否在暗黑模式\"></a>22. 检查用户的设备是否在暗黑模式</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 检查用户的设备是否在暗黑模式</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> <span class=\"variable\">Boolean</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> isDarkMode = <span class=\"variable language_\">window</span>.<span class=\"property\">matchMedia</span> &amp;&amp; <span class=\"variable language_\">window</span>.<span class=\"title function_\">matchMedia</span>(<span class=\"string\">&#x27;(prefers-color-scheme: dark)&#x27;</span>).<span class=\"property\">matches</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"23-下载一个Excel文档\"><a href=\"#23-下载一个Excel文档\" class=\"headerlink\" title=\"23. 下载一个Excel文档\"></a>23. 下载一个Excel文档</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 下载一个链接</span></span><br><span class=\"line\"><span class=\"comment\"> */</span> </span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">download</span>(<span class=\"params\">link, name</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(!name)&#123;</span><br><span class=\"line\">    name = link.<span class=\"title function_\">slice</span>(link.<span class=\"title function_\">lastIndexOf</span>(<span class=\"string\">&#x27;/&#x27;</span>) + <span class=\"number\">1</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> eleLink = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;a&#x27;</span>)</span><br><span class=\"line\">  eleLink.<span class=\"property\">download</span> = name</span><br><span class=\"line\">  eleLink.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&#x27;none&#x27;</span></span><br><span class=\"line\">  eleLink.<span class=\"property\">href</span> = link</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">appendChild</span>(eleLink)</span><br><span class=\"line\">  eleLink.<span class=\"title function_\">click</span>()</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">removeChild</span>(eleLink)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//下载excel</span></span><br><span class=\"line\"><span class=\"title function_\">download</span>(<span class=\"string\">&#x27;http://111.229.14.189/file/1.xlsx&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"24-浏览器中下载一些DOM内容-JSON文件\"><a href=\"#24-浏览器中下载一些DOM内容-JSON文件\" class=\"headerlink\" title=\"24. 浏览器中下载一些DOM内容/JSON文件\"></a>24. 浏览器中下载一些DOM内容/JSON文件</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 浏览器下载静态文件</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">String</span>&#125; name 文件名</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">String</span>&#125; content 文件内容</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">downloadFile</span>(<span class=\"params\">name, content</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> name == <span class=\"string\">&#x27;undefined&#x27;</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(<span class=\"string\">&#x27;The first parameter name is a must&#x27;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> content == <span class=\"string\">&#x27;undefined&#x27;</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(<span class=\"string\">&#x27;The second parameter content is a must&#x27;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!(content <span class=\"keyword\">instanceof</span> <span class=\"title class_\">Blob</span>)) &#123;</span><br><span class=\"line\">    content = <span class=\"keyword\">new</span> <span class=\"title class_\">Blob</span>([content])</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> link = <span class=\"variable constant_\">URL</span>.<span class=\"title function_\">createObjectURL</span>(content)</span><br><span class=\"line\">  <span class=\"title function_\">download</span>(link, name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 调用下载</span></span><br><span class=\"line\"><span class=\"title function_\">downloadFile</span>(<span class=\"string\">&#x27;1.txt&#x27;</span>,<span class=\"string\">&#x27;lalalallalalla&#x27;</span>)</span><br><span class=\"line\"><span class=\"title function_\">downloadFile</span>(<span class=\"string\">&#x27;1.json&#x27;</span>,<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;<span class=\"attr\">name</span>:<span class=\"string\">&#x27;hahahha&#x27;</span>&#125;))</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"25-浏览器下载MP4-PDF-图片等\"><a href=\"#25-浏览器下载MP4-PDF-图片等\" class=\"headerlink\" title=\"25. 浏览器下载MP4/PDF/图片等\"></a>25. 浏览器下载MP4/PDF/图片等</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 浏览器下载MP4/PDF/图片等</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> axios <span class=\"keyword\">from</span> <span class=\"string\">&#x27;axios&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">//提供一个link，完成文件下载，link可以是  http://xxx.com/xxx.xls</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">downloadByLink</span>(<span class=\"params\">link,fileName</span>)&#123;</span><br><span class=\"line\">  axios.<span class=\"title function_\">request</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">url</span>: link,</span><br><span class=\"line\">    <span class=\"attr\">responseType</span>: <span class=\"string\">&#x27;blob&#x27;</span> <span class=\"comment\">// 关键代码，让axios把响应改成blob</span></span><br><span class=\"line\">  &#125;).<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> link = <span class=\"variable constant_\">URL</span>.<span class=\"title function_\">createObjectURL</span>(res.<span class=\"property\">data</span>)</span><br><span class=\"line\">    <span class=\"title function_\">download</span>(link, fileName)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>注意：会有同源策略的限制，需要配置转发</p>\n<hr>\n<h3 id=\"26-去除对象中的空元素\"><a href=\"#26-去除对象中的空元素\" class=\"headerlink\" title=\"26. 去除对象中的空元素\"></a>26. 去除对象中的空元素</h3><p>给后端发送数据的时候，要判断某个属性是不是空字符串，然后给后端拼参数，这块逻辑抽离出来就是<code>cleanObject</code>，代码实现如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * cleanObject 去除对象中的空元素</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"title function_\">cleanObject</span> = (<span class=\"params\">object</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"comment\">// Object.assign(&#123;&#125;, object)</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!object) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;&#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> result = &#123; ...object &#125;;</span><br><span class=\"line\">  <span class=\"title class_\">Object</span>.<span class=\"title function_\">keys</span>(result).<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">key</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> value = result[key];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"title function_\">isVoid</span>(value)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">delete</span> result[key];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 判断是否为空</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"title function_\">isVoid</span> = (<span class=\"params\">value</span>) =&gt;</span><br><span class=\"line\">  value === <span class=\"literal\">undefined</span> || value === <span class=\"literal\">null</span> || value === <span class=\"string\">&quot;&quot;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>使用：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> res = <span class=\"title function_\">cleanObject</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>:<span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">pageSize</span>:<span class=\"number\">10</span>,</span><br><span class=\"line\">    <span class=\"attr\">page</span>:<span class=\"number\">1</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;res&quot;</span>, res) <span class=\"comment\">// 输出 &#123; page:1,pageSize:10 &#125;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"27-常用的正则验证\"><a href=\"#27-常用的正则验证\" class=\"headerlink\" title=\"27. 常用的正则验证\"></a>27. 常用的正则验证</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 常用的正则验证</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> checkStr = <span class=\"keyword\">function</span>(<span class=\"params\">str, type</span>) &#123; <span class=\"comment\">// 常用正则验证，注意type大小写</span></span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (type) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;phone&#x27;</span>: <span class=\"comment\">// 手机号码</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^1[3|4|5|6|7|8|9][0-9]&#123;9&#125;$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;tel&#x27;</span>: <span class=\"comment\">// 座机</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^(0\\d&#123;2,3&#125;-\\d&#123;7,8&#125;)(-\\d&#123;1,4&#125;)?$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;card&#x27;</span>: <span class=\"comment\">// 身份证</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/(^\\d&#123;15&#125;$)|(^\\d&#123;18&#125;$)|(^\\d&#123;17&#125;(\\d|X|x)$)/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;pwd&#x27;</span>: <span class=\"comment\">// 密码以字母开头，长度在6~18之间，只能包含字母、数字和下划线</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^[a-zA-Z]\\w&#123;5,17&#125;$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;postal&#x27;</span>: <span class=\"comment\">// 邮政编码</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/[1-9]\\d&#123;5&#125;(?!\\d)/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;QQ&#x27;</span>: <span class=\"comment\">// QQ号</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^[1-9][0-9]&#123;4,9&#125;$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;email&#x27;</span>: <span class=\"comment\">// 邮箱</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^[\\w-]+(.[\\w-]+)*@[\\w-]+(.[\\w-]+)+$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;money&#x27;</span>: <span class=\"comment\">// 金额(小数点2位)</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^\\d*(?:.\\d&#123;0,2&#125;)?$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;URL&#x27;</span>: <span class=\"comment\">// 网址</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/(http|ftp|https):/</span><span class=\"regexp\">/[\\w-_]+(.[\\w-_]+)+([\\w-.,@?^=%&amp;:/~+#]*[\\w-@?^=%&amp;/~+#])?/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;IP&#x27;</span>: <span class=\"comment\">// IP</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/((?:(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d)\\.)&#123;3&#125;(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d))/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;date&#x27;</span>: <span class=\"comment\">// 日期时间</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^(\\d&#123;4&#125;)-(\\d&#123;2&#125;)-(\\d&#123;2&#125;) (\\d&#123;2&#125;)(?::\\d&#123;2&#125;|:(\\d&#123;2&#125;):(\\d&#123;2&#125;))$/</span>.<span class=\"title function_\">test</span>(str) ||</span><br><span class=\"line\">        <span class=\"regexp\">/^(\\d&#123;4&#125;)-(\\d&#123;2&#125;)-(\\d&#123;2&#125;)$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;number&#x27;</span>: <span class=\"comment\">// 数字</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^[0-9]$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;english&#x27;</span>: <span class=\"comment\">// 英文</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^[a-zA-Z]+$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;chinese&#x27;</span>: <span class=\"comment\">// 中文</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^[\\u4E00-\\u9FA5]+$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;lower&#x27;</span>: <span class=\"comment\">// 小写</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^[a-z]+$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;upper&#x27;</span>: <span class=\"comment\">// 大写</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^[A-Z]+$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;HTML&#x27;</span>: <span class=\"comment\">// HTML标记</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/&lt;(&quot;[^&quot;]*&quot;|&#x27;[^&#x27;]*&#x27;|[^&#x27;&quot;&gt;])*&gt;/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"attr\">default</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"28-阿拉伯数字转中文大写数字\"><a href=\"#28-阿拉伯数字转中文大写数字\" class=\"headerlink\" title=\"28. 阿拉伯数字转中文大写数字\"></a>28. 阿拉伯数字转中文大写数字</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 阿拉伯数字转中文大写数字</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> numberToChinese = <span class=\"keyword\">function</span>(<span class=\"params\">num</span>) &#123; <span class=\"comment\">// 将阿拉伯数字翻译成中文的大写数字</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable constant_\">AA</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"string\">&#x27;零&#x27;</span>, <span class=\"string\">&#x27;一&#x27;</span>, <span class=\"string\">&#x27;二&#x27;</span>, <span class=\"string\">&#x27;三&#x27;</span>, <span class=\"string\">&#x27;四&#x27;</span>, <span class=\"string\">&#x27;五&#x27;</span>, <span class=\"string\">&#x27;六&#x27;</span>, <span class=\"string\">&#x27;七&#x27;</span>, <span class=\"string\">&#x27;八&#x27;</span>, <span class=\"string\">&#x27;九&#x27;</span>, <span class=\"string\">&#x27;十&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable constant_\">BB</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;十&#x27;</span>, <span class=\"string\">&#x27;百&#x27;</span>, <span class=\"string\">&#x27;仟&#x27;</span>, <span class=\"string\">&#x27;萬&#x27;</span>, <span class=\"string\">&#x27;億&#x27;</span>, <span class=\"string\">&#x27;点&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">let</span> a = (<span class=\"string\">&#x27;&#x27;</span> + num).<span class=\"title function_\">replace</span>(<span class=\"regexp\">/(^0*)/g</span>, <span class=\"string\">&#x27;&#x27;</span>).<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;.&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">let</span> k = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> re = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = a[<span class=\"number\">0</span>].<span class=\"property\">length</span> - <span class=\"number\">1</span>; i &gt;= <span class=\"number\">0</span>; i--) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (k) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"number\">0</span>:</span><br><span class=\"line\">        re = <span class=\"variable constant_\">BB</span>[<span class=\"number\">7</span>] + re</span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"keyword\">new</span> <span class=\"title class_\">RegExp</span>(<span class=\"string\">&#x27;0&#123;4&#125;//d&#123;&#x27;</span> + (a[<span class=\"number\">0</span>].<span class=\"property\">length</span> - i - <span class=\"number\">1</span>) + <span class=\"string\">&#x27;&#125;$&#x27;</span>).<span class=\"title function_\">test</span>(a[<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">          re = <span class=\"variable constant_\">BB</span>[<span class=\"number\">4</span>] + re</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"number\">8</span>:</span><br><span class=\"line\">        re = <span class=\"variable constant_\">BB</span>[<span class=\"number\">5</span>] + re</span><br><span class=\"line\">        <span class=\"variable constant_\">BB</span>[<span class=\"number\">7</span>] = <span class=\"variable constant_\">BB</span>[<span class=\"number\">5</span>]</span><br><span class=\"line\">        k = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (k % <span class=\"number\">4</span> === <span class=\"number\">2</span> &amp;&amp; a[<span class=\"number\">0</span>].<span class=\"title function_\">charAt</span>(i + <span class=\"number\">2</span>) !== <span class=\"number\">0</span> &amp;&amp; a[<span class=\"number\">0</span>].<span class=\"title function_\">charAt</span>(i + <span class=\"number\">1</span>) === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      re = <span class=\"variable constant_\">AA</span>[<span class=\"number\">0</span>] + re</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (a[<span class=\"number\">0</span>].<span class=\"title function_\">charAt</span>(i) !== <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      re = <span class=\"variable constant_\">AA</span>[a[<span class=\"number\">0</span>].<span class=\"title function_\">charAt</span>(i)] + <span class=\"variable constant_\">BB</span>[k % <span class=\"number\">4</span>] + re</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    k++</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (a.<span class=\"property\">length</span> &gt; <span class=\"number\">1</span>) &#123; <span class=\"comment\">// 加上小数部分(如果有小数部分)</span></span><br><span class=\"line\">    re += <span class=\"variable constant_\">BB</span>[<span class=\"number\">6</span>]</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; a[<span class=\"number\">1</span>].<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">      re += <span class=\"variable constant_\">AA</span>[a[<span class=\"number\">1</span>].<span class=\"title function_\">charAt</span>(i)]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (re === <span class=\"string\">&#x27;一十&#x27;</span>) &#123;</span><br><span class=\"line\">    re = <span class=\"string\">&#x27;十&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (re.<span class=\"title function_\">match</span>(<span class=\"regexp\">/^一/</span>) &amp;&amp; re.<span class=\"property\">length</span> === <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">    re = re.<span class=\"title function_\">replace</span>(<span class=\"string\">&#x27;一&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> re</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"29-base64图片下载功能\"><a href=\"#29-base64图片下载功能\" class=\"headerlink\" title=\"29. base64图片下载功能\"></a>29. base64图片下载功能</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * base64图片下载功能</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> downloadFile = <span class=\"keyword\">function</span>(<span class=\"params\">base64, fileName</span>) &#123; <span class=\"comment\">//base64图片下载功能</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> base64ToBlob = <span class=\"keyword\">function</span>(<span class=\"params\">code</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> parts = code.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;;base64,&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> contentType = parts[<span class=\"number\">0</span>].<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;:&#x27;</span>)[<span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"keyword\">let</span> raw = <span class=\"variable language_\">window</span>.<span class=\"title function_\">atob</span>(parts[<span class=\"number\">1</span>]);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> rawLength = raw.<span class=\"property\">length</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> uInt8Array = <span class=\"keyword\">new</span> <span class=\"title class_\">Uint8Array</span>(rawLength);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; rawLength; ++i) &#123;</span><br><span class=\"line\">      uInt8Array[i] = raw.<span class=\"title function_\">charCodeAt</span>(i);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Blob</span>([uInt8Array], &#123;</span><br><span class=\"line\">      <span class=\"attr\">type</span>: contentType</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> aLink = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;a&#x27;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> blob = <span class=\"title function_\">base64ToBlob</span>(base64); <span class=\"comment\">//new Blob([content]);</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> evt = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createEvent</span>(<span class=\"string\">&quot;HTMLEvents&quot;</span>);</span><br><span class=\"line\">  evt.<span class=\"title function_\">initEvent</span>(<span class=\"string\">&quot;click&quot;</span>, <span class=\"literal\">true</span>, <span class=\"literal\">true</span>); <span class=\"comment\">//initEvent不加后两个参数在FF下会报错  事件类型，是否冒泡，是否阻止浏览器的默认行为</span></span><br><span class=\"line\">  aLink.<span class=\"property\">download</span> = fileName;</span><br><span class=\"line\">  aLink.<span class=\"property\">href</span> = <span class=\"variable constant_\">URL</span>.<span class=\"title function_\">createObjectURL</span>(blob);</span><br><span class=\"line\">  aLink.<span class=\"title function_\">click</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"30-获取div高度\"><a href=\"#30-获取div高度\" class=\"headerlink\" title=\"30. 获取div高度\"></a>30. 获取div高度</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 获取div高度</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> div = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\"><span class=\"variable language_\">window</span>.<span class=\"title function_\">getComputedStyle</span>(div).<span class=\"title function_\">getPropertyValue</span>(<span class=\"string\">&#x27;height&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n\n<hr>\n<h3 id=\"31-将base64转化成可用formData提交的文件\"><a href=\"#31-将base64转化成可用formData提交的文件\" class=\"headerlink\" title=\"31. 将base64转化成可用formData提交的文件\"></a>31. 将base64转化成可用formData提交的文件</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * convertBase64UrlToBlob 将base64转化成可用formdata提交的文件</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; urlData base64位的url</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@returns</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">convertBase64UrlToBlob</span> = (<span class=\"params\">urlData</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"comment\">//去掉url的头，并转换为byte</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> split = urlData.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;,&#x27;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> bytes = <span class=\"variable language_\">window</span>.<span class=\"title function_\">atob</span>(split[<span class=\"number\">1</span>]);</span><br><span class=\"line\">  <span class=\"comment\">//处理异常,将ascii码小于0的转换为大于0</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> ab = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayBuffer</span>(bytes.<span class=\"property\">length</span>);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> ia = <span class=\"keyword\">new</span> <span class=\"title class_\">Uint8Array</span>(ab);</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; bytes.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">    ia[i] = bytes.<span class=\"title function_\">charCodeAt</span>(i);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Blob</span>([ab], &#123; <span class=\"attr\">type</span>: split[<span class=\"number\">0</span>].<span class=\"title function_\">match</span>(<span class=\"regexp\">/:(.*?);/</span>)[<span class=\"number\">1</span>] &#125;);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"32-找到对象中所有可能存在的字符串，并替换掉其中的-lt-gt-分别为全角的＜＞（）\"><a href=\"#32-找到对象中所有可能存在的字符串，并替换掉其中的-lt-gt-分别为全角的＜＞（）\" class=\"headerlink\" title=\"32. 找到对象中所有可能存在的字符串，并替换掉其中的&lt;, &gt;, (, )分别为全角的＜＞（）\"></a>32. 找到对象中所有可能存在的字符串，并替换掉其中的&lt;, &gt;, (, )分别为全角的＜＞（）</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 找到对象中所有可能存在的字符串，并替换掉其中的&lt;, &gt;, (, )分别为全角的＜＞（）</span></span><br><span class=\"line\"><span class=\"comment\"> * 可以自定义拓展更多的规则</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">object</span>&#125; obj 需要处理的对象</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> &#123;<span class=\"type\">object</span>&#125; aim obj</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"title function_\">formatString</span> = (<span class=\"params\">obj</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> key <span class=\"keyword\">in</span> obj) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!obj.<span class=\"title function_\">hasOwnProperty</span>(key)) <span class=\"keyword\">return</span>; <span class=\"comment\">// 排除掉原型继承而来的属性</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> obj[key] == <span class=\"string\">&#x27;string&#x27;</span>) &#123;</span><br><span class=\"line\">      obj[key] = obj[key]</span><br><span class=\"line\">        .<span class=\"title function_\">replace</span>(<span class=\"regexp\">/&lt;/g</span>, <span class=\"string\">&#x27;＜&#x27;</span>)</span><br><span class=\"line\">        .<span class=\"title function_\">replace</span>(<span class=\"regexp\">/&gt;/g</span>, <span class=\"string\">&#x27;＞&#x27;</span>)</span><br><span class=\"line\">        .<span class=\"title function_\">replace</span>(<span class=\"regexp\">/\\(/g</span>, <span class=\"string\">&#x27;（&#x27;</span>)</span><br><span class=\"line\">        .<span class=\"title function_\">replace</span>(<span class=\"regexp\">/\\)/g</span>, <span class=\"string\">&#x27;）&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> obj[key] == <span class=\"string\">&#x27;object&#x27;</span> || <span class=\"keyword\">typeof</span> obj[key] == <span class=\"string\">&#x27;function&#x27;</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">formatString</span>(obj[key]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"33-将对象格式转化为get请求所需要的参数\"><a href=\"#33-将对象格式转化为get请求所需要的参数\" class=\"headerlink\" title=\"33. 将对象格式转化为get请求所需要的参数\"></a>33. 将对象格式转化为get请求所需要的参数</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * getParams 将对象格式转化为get请求所需要的参数</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">object</span>&#125; params 需要处理的对象</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> &#123;<span class=\"type\">object</span>&#125; aim obj</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">getParams</span>(<span class=\"params\">params</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> paramStr = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">  <span class=\"title class_\">Object</span>.<span class=\"title function_\">keys</span>(params).<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (paramStr === <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">      paramStr = <span class=\"string\">`<span class=\"subst\">$&#123;item&#125;</span>=<span class=\"subst\">$&#123;params[item]&#125;</span>`</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      paramStr = <span class=\"string\">`<span class=\"subst\">$&#123;paramStr&#125;</span>&amp;<span class=\"subst\">$&#123;item&#125;</span>=<span class=\"subst\">$&#123;params[item]&#125;</span>`</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> paramStr;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"34-获取图片真实的宽高（非真实渲染）\"><a href=\"#34-获取图片真实的宽高（非真实渲染）\" class=\"headerlink\" title=\"34. 获取图片真实的宽高（非真实渲染）\"></a>34. 获取图片真实的宽高（非真实渲染）</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * getImageSize 获取图片的宽高</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; url 需要处理的图片路径</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> &#123;<span class=\"type\">object</span>&#125; &#123;<span class=\"type\"> width: number, height: number </span>&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">getImageSize</span>(<span class=\"params\">url: <span class=\"built_in\">string</span></span>): <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">any</span>&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> image = <span class=\"keyword\">new</span> <span class=\"title class_\">Image</span>();</span><br><span class=\"line\">    image.<span class=\"property\">onload</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">resolve</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">width</span>: image.<span class=\"property\">width</span>, <span class=\"comment\">// 或naturalWidth</span></span><br><span class=\"line\">        <span class=\"attr\">height</span>: image.<span class=\"property\">height</span>, <span class=\"comment\">// 或naturalHeight</span></span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      <span class=\"comment\">// 注释中这两个属性在Firefox/Chrome/Safari/Opera及IE9+里已经实现</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    image.<span class=\"property\">onerror</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">reject</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(<span class=\"string\">&#x27;error&#x27;</span>));</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    image.<span class=\"property\">src</span> = url;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"35-递归拿出对象数组中所有指定的字段项，并返回新数组\"><a href=\"#35-递归拿出对象数组中所有指定的字段项，并返回新数组\" class=\"headerlink\" title=\"35. 递归拿出对象数组中所有指定的字段项，并返回新数组\"></a>35. 递归拿出对象数组中所有指定的字段项，并返回新数组</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 递归拿出所有指定的字段项</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Array</span>&#125; <span class=\"variable\">list</span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; <span class=\"variable\">key</span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; <span class=\"variable\">child</span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@returns</span> &#123;<span class=\"type\">Array</span>&#125; 返回所有key的集合</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">getKeyList</span>(<span class=\"params\">list: <span class=\"built_in\">Array</span>&lt;<span class=\"built_in\">any</span>&gt;, key: <span class=\"built_in\">string</span>, child = <span class=\"string\">&#x27;children&#x27;</span></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> <span class=\"attr\">result</span>: <span class=\"built_in\">any</span>[] = [];</span><br><span class=\"line\">  list.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">listItem</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    listItem[key] &amp;&amp; result.<span class=\"title function_\">push</span>(listItem[key]);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (listItem[child] &amp;&amp; listItem[child].<span class=\"property\">length</span>) &#123;</span><br><span class=\"line\">      result.<span class=\"title function_\">push</span>(...<span class=\"title function_\">getKeyList</span>(listItem[child], key, child));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>整理项目开发中经常使用的Javascript片段, 以便Ctrl + C</p>","more":"<h3 id=\"1-创建a标签-打开新页面\"><a href=\"#1-创建a标签-打开新页面\" class=\"headerlink\" title=\"1. 创建a标签,打开新页面\"></a>1. 创建a标签,打开新页面</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 创建a标签,打开新页面 openURL()</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">String</span>&#125; url 目标地址</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@returns</span> <span class=\"variable\">null</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">openURL</span>(<span class=\"params\">url</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> aLabel = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;a&#x27;</span>);</span><br><span class=\"line\">  <span class=\"comment\">//设置链接</span></span><br><span class=\"line\">  aLabel.<span class=\"title function_\">setAttribute</span>(<span class=\"string\">&#x27;href&#x27;</span>, url);</span><br><span class=\"line\">  <span class=\"comment\">//新窗口打开链接</span></span><br><span class=\"line\">  aLabel.<span class=\"title function_\">setAttribute</span>(<span class=\"string\">&#x27;target&#x27;</span>, <span class=\"string\">&#x27;_blank&#x27;</span>);</span><br><span class=\"line\">  <span class=\"comment\">//设置标签ID</span></span><br><span class=\"line\">  aLabel.<span class=\"title function_\">setAttribute</span>(<span class=\"string\">&#x27;id&#x27;</span>, <span class=\"string\">&#x27;reportpoint&#x27;</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 防止反复添加</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;reportpoint&#x27;</span>)) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">removeChild</span>(<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;reportpoint&#x27;</span>));</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">appendChild</span>(aLabel);</span><br><span class=\"line\">  aLabel.<span class=\"title function_\">click</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2-防抖函数\"><a href=\"#2-防抖函数\" class=\"headerlink\" title=\"2. 防抖函数\"></a>2. 防抖函数</h3><p>防抖函数的原理就是通过延时器控制用户在短时间内进行重复操作的时候取消上一次操作</p>\n<figure class=\"highlight js\"><figcaption><span>防抖函数</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 防抖函数 debounce()</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">function</span>&#125; fn 事件触发的操作</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">number</span>&#125; delay 多少毫秒内连续触发事件，不会执行</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@returns</span> &#123;<span class=\"type\">Function</span>&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">debounce</span>(<span class=\"params\">fn, delay</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> timer = <span class=\"literal\">null</span> ;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> self = <span class=\"variable language_\">this</span> ; <span class=\"comment\">// 注意this指向</span></span><br><span class=\"line\">    args = <span class=\"variable language_\">arguments</span>; <span class=\"comment\">// 拿到函数的入参</span></span><br><span class=\"line\"></span><br><span class=\"line\">    timer &amp;&amp; <span class=\"built_in\">clearTimeout</span>(timer);</span><br><span class=\"line\">    timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      fn.<span class=\"title function_\">apply</span>(self, args);</span><br><span class=\"line\">    &#125;, delay)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 假设现有以下点击事件，clickEvent()</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> input1 = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;input1&#x27;</span>);</span><br><span class=\"line\">input1.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;keyup&#x27;</span>,<span class=\"title function_\">debounce</span>(action1,<span class=\"number\">1000</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">action1</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(input1.<span class=\"property\">value</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"3-节流函数\"><a href=\"#3-节流函数\" class=\"headerlink\" title=\"3. 节流函数\"></a>3. 节流函数</h3><p>节流函数的原理就是通过控制延时器,当高频事件触发，n秒内只会执行一次</p>\n<figure class=\"highlight js\"><figcaption><span>节流函数</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 节流函数 throttle()</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">function</span>&#125; fn 事件触发的操作</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">number</span>&#125; delay 多少毫秒内连续触发事件，只会执行一次</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@returns</span> &#123;<span class=\"type\">Function</span>&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">throttle</span>(<span class=\"params\">fn, delay</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> timer = <span class=\"literal\">null</span> ;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> flag = <span class=\"literal\">true</span> ; <span class=\"comment\">// 当前是否正在执行...</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!flag) <span class=\"keyword\">return</span></span><br><span class=\"line\">    flag = <span class=\"literal\">false</span>; </span><br><span class=\"line\">    <span class=\"keyword\">let</span> self = <span class=\"variable language_\">this</span> ; <span class=\"comment\">// 注意this指向</span></span><br><span class=\"line\">    args = <span class=\"variable language_\">arguments</span>; <span class=\"comment\">// 拿到函数的入参</span></span><br><span class=\"line\"></span><br><span class=\"line\">    timer &amp;&amp; <span class=\"built_in\">clearTimeout</span>(timer);</span><br><span class=\"line\">    timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      flag = <span class=\"literal\">true</span>; <span class=\"comment\">// 时间到了，可以继续执行下一次事件</span></span><br><span class=\"line\">      fn.<span class=\"title function_\">apply</span>(self, args);</span><br><span class=\"line\">    &#125;, delay)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用的规则同 <a href='#防抖函数'> 防抖函数 </a></p>\n<hr>\n<h3 id=\"4-将字符串运行成js脚本的几种方式\"><a href=\"#4-将字符串运行成js脚本的几种方式\" class=\"headerlink\" title=\"4. 将字符串运行成js脚本的几种方式\"></a>4. 将字符串运行成js脚本的几种方式</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1.</span> <span class=\"built_in\">eval</span>(<span class=\"string\">&#x27;字符串&#x27;</span>)</span><br><span class=\"line\"><span class=\"number\">2.</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Function</span>(<span class=\"string\">&#x27;字符串&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">3.</span> <span class=\"built_in\">setTimeout</span>(<span class=\"string\">&#x27;字符串&#x27;</span>, <span class=\"number\">1000</span>)</span><br><span class=\"line\"><span class=\"number\">4.</span> <span class=\"built_in\">setInterval</span>(<span class=\"string\">&#x27;字符串&#x27;</span>, <span class=\"number\">1000</span>)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"5-浏览器复制内容到剪切板\"><a href=\"#5-浏览器复制内容到剪切板\" class=\"headerlink\" title=\"5. 浏览器复制内容到剪切板\"></a>5. 浏览器复制内容到剪切板</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 浏览器复制内容到剪切板 copyText()</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; text 需要复制的内容</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@returns</span> <span class=\"variable\">null</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">copyText</span> = (<span class=\"params\">text</span>)=&gt;&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> range = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createRange</span>();</span><br><span class=\"line\">  <span class=\"keyword\">var</span> copyDOM = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;a&#x27;</span>);</span><br><span class=\"line\">  copyDOM.<span class=\"property\">innerHTML</span> = text;</span><br><span class=\"line\">  <span class=\"variable language_\">window</span>.<span class=\"title function_\">getSelection</span>().<span class=\"title function_\">removeAllRanges</span>();</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">appendChild</span>(copyDOM)</span><br><span class=\"line\">  range.<span class=\"title function_\">selectNode</span>(copyDOM);</span><br><span class=\"line\">  <span class=\"variable language_\">window</span>.<span class=\"title function_\">getSelection</span>().<span class=\"title function_\">addRange</span>(range);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> successful = <span class=\"variable language_\">document</span>.<span class=\"title function_\">execCommand</span>(<span class=\"string\">&#x27;copy&#x27;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(successful)&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 复制成功到剪切板</span></span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 复制失败，一般是因为浏览器不支持复制</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">removeChild</span>(copyDOM)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"6-取随机字符串\"><a href=\"#6-取随机字符串\" class=\"headerlink\" title=\"6. 取随机字符串\"></a>6. 取随机字符串</h3><p>取随机字符串根据业务的不同会有不一样的取值方式，用作签名的一部分、用做随机密码….<br>这里我采用的是获取长度不定、去除容易混淆的字符oOLl,9gq,Vv,Uu,I1的随机位数的随机字符</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 取随机字符串 randomString()</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">number</span>&#125; len 随机字符串的长度</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@returns</span> <span class=\"variable\">null</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">randomString</span>(<span class=\"params\">len</span>) &#123;</span><br><span class=\"line\">  len = len || <span class=\"number\">32</span>; <span class=\"comment\">// 默认随机生成32位长度字符串</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> $chars = <span class=\"string\">&#x27;ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678&#x27;</span>;    <span class=\"comment\">/****默认去掉了容易混淆的字符oOLl,9gq,Vv,Uu,I1****/</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> maxPos = $chars.<span class=\"property\">length</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> randomStr = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">    randomStr += $chars.<span class=\"title function_\">charAt</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">floor</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * maxPos));</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> randomStr;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"7-异步加载一段js脚本\"><a href=\"#7-异步加载一段js脚本\" class=\"headerlink\" title=\"7. 异步加载一段js脚本\"></a>7. 异步加载一段js脚本</h3><p>如： 异步引入网页悬浮脚本、异步引入高德地图、腾讯地图等。</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span> 异步加载  一段js放在 header</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">object</span>&#125; <span class=\"variable\">url</span> - js 的 url</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">function</span>&#125; <span class=\"variable\">callback</span> - 成功回调</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@returns</span> &#123;<span class=\"type\"> promise&lt;any&gt;</span>&#125;&#125; promise</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">loadScript</span> = (<span class=\"params\">url: <span class=\"built_in\">string</span></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> <span class=\"attr\">script</span>: <span class=\"built_in\">any</span> = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;script&#x27;</span>)</span><br><span class=\"line\">      script.<span class=\"property\">type</span> = <span class=\"string\">&#x27;text/javascript&#x27;</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (script.<span class=\"property\">readyState</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//IE</span></span><br><span class=\"line\">        script.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (</span><br><span class=\"line\">            script.<span class=\"property\">readyState</span> == <span class=\"string\">&#x27;loaded&#x27;</span> ||</span><br><span class=\"line\">            script.<span class=\"property\">readyState</span> == <span class=\"string\">&#x27;complete&#x27;</span></span><br><span class=\"line\">          ) &#123;</span><br><span class=\"line\">            script.<span class=\"property\">onreadystatechange</span> = <span class=\"literal\">null</span></span><br><span class=\"line\">            <span class=\"title class_\">Promise</span>.<span class=\"title function_\">resolve</span>(<span class=\"number\">0</span>)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//Others: Firefox, Safari, Chrome, and Opera</span></span><br><span class=\"line\">        script.<span class=\"property\">onload</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">          <span class=\"title class_\">Promise</span>.<span class=\"title function_\">resolve</span>(<span class=\"number\">0</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      script.<span class=\"property\">src</span> = url</span><br><span class=\"line\">      <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">appendChild</span>(script)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">      <span class=\"title class_\">Promise</span>.<span class=\"title function_\">reject</span>(e)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"8-获取页面高度\"><a href=\"#8-获取页面高度\" class=\"headerlink\" title=\"8. 获取页面高度\"></a>8. 获取页面高度</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// get page height</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">getPageHeight</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> g = <span class=\"variable language_\">document</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> a = g.<span class=\"property\">body</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> f = g.<span class=\"property\">documentElement</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> d = g.<span class=\"property\">compatMode</span> === <span class=\"string\">&#x27;BackCompat&#x27;</span> ? a : g.<span class=\"property\">documentElement</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"title class_\">Math</span>.<span class=\"title function_\">max</span>(f.<span class=\"property\">scrollHeight</span>, a.<span class=\"property\">scrollHeight</span>, d.<span class=\"property\">clientHeight</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"9-获取页面可视高度\"><a href=\"#9-获取页面可视高度\" class=\"headerlink\" title=\"9. 获取页面可视高度\"></a>9. 获取页面可视高度</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// get page view height</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">getPageViewHeight</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> d = <span class=\"variable language_\">document</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> a = d.<span class=\"property\">compatMode</span> === <span class=\"string\">&#x27;BackCompat&#x27;</span> ? d.<span class=\"property\">body</span> : d.<span class=\"property\">documentElement</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> a.<span class=\"property\">clientHeight</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"10-获取页面可视宽度\"><a href=\"#10-获取页面可视宽度\" class=\"headerlink\" title=\"10. 获取页面可视宽度\"></a>10. 获取页面可视宽度</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// get page view width</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">getPageViewWidth</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> d = <span class=\"variable language_\">document</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> a = d.<span class=\"property\">compatMode</span> === <span class=\"string\">&#x27;BackCompat&#x27;</span> ? d.<span class=\"property\">body</span> : d.<span class=\"property\">documentElement</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> a.<span class=\"property\">clientWidth</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"11-获取页面宽度\"><a href=\"#11-获取页面宽度\" class=\"headerlink\" title=\"11. 获取页面宽度\"></a>11. 获取页面宽度</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// get page width</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">getPageWidth</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> g = <span class=\"variable language_\">document</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> a = g.<span class=\"property\">body</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> f = g.<span class=\"property\">documentElement</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> d = g.<span class=\"property\">compatMode</span> === <span class=\"string\">&#x27;BackCompat&#x27;</span> ? a : g.<span class=\"property\">documentElement</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"title class_\">Math</span>.<span class=\"title function_\">max</span>(f.<span class=\"property\">scrollWidth</span>, a.<span class=\"property\">scrollWidth</span>, d.<span class=\"property\">clientWidth</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"12-判断当前设备\"><a href=\"#12-判断当前设备\" class=\"headerlink\" title=\"12. 判断当前设备\"></a>12. 判断当前设备</h3><h4 id=\"是否为安卓设备\"><a href=\"#是否为安卓设备\" class=\"headerlink\" title=\"是否为安卓设备\"></a>是否为安卓设备</h4><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">isAndroidMobileDevice</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"regexp\">/android/i</span>.<span class=\"title function_\">test</span>(navigator.<span class=\"property\">userAgent</span>.<span class=\"title function_\">toLowerCase</span>())</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"是否为苹果设备\"><a href=\"#是否为苹果设备\" class=\"headerlink\" title=\"是否为苹果设备\"></a>是否为苹果设备</h4><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">isAppleMobileDevice</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"regexp\">/iphone|ipod|ipad|Macintosh/i</span>.<span class=\"title function_\">test</span>(navigator.<span class=\"property\">userAgent</span>.<span class=\"title function_\">toLowerCase</span>())</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"是否为iPhoneX\"><a href=\"#是否为iPhoneX\" class=\"headerlink\" title=\"是否为iPhoneX\"></a>是否为iPhoneX</h4><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">isIphonex</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"comment\">// X XS, XS Max, XR</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> xSeriesConfig = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">devicePixelRatio</span>: <span class=\"number\">3</span>,</span><br><span class=\"line\">      <span class=\"attr\">width</span>: <span class=\"number\">375</span>,</span><br><span class=\"line\">      <span class=\"attr\">height</span>: <span class=\"number\">812</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">devicePixelRatio</span>: <span class=\"number\">3</span>,</span><br><span class=\"line\">      <span class=\"attr\">width</span>: <span class=\"number\">414</span>,</span><br><span class=\"line\">      <span class=\"attr\">height</span>: <span class=\"number\">896</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">devicePixelRatio</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">      <span class=\"attr\">width</span>: <span class=\"number\">414</span>,</span><br><span class=\"line\">      <span class=\"attr\">height</span>: <span class=\"number\">896</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"variable language_\">window</span> !== <span class=\"string\">&#x27;undefined&#x27;</span> &amp;&amp; <span class=\"variable language_\">window</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> isIOS = <span class=\"regexp\">/iphone/gi</span>.<span class=\"title function_\">test</span>(<span class=\"variable language_\">window</span>.<span class=\"property\">navigator</span>.<span class=\"property\">userAgent</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isIOS) <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; devicePixelRatio, screen &#125; = <span class=\"variable language_\">window</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; width, height &#125; = screen</span><br><span class=\"line\">    <span class=\"keyword\">return</span> xSeriesConfig.<span class=\"title function_\">some</span>(</span><br><span class=\"line\">      <span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span></span><br><span class=\"line\">        item.<span class=\"property\">devicePixelRatio</span> === devicePixelRatio &amp;&amp;</span><br><span class=\"line\">        item.<span class=\"property\">width</span> === width &amp;&amp;</span><br><span class=\"line\">        item.<span class=\"property\">height</span> === height</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"是否为手机设备\"><a href=\"#是否为手机设备\" class=\"headerlink\" title=\"是否为手机设备\"></a>是否为手机设备</h4><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">isMobileUserAgent</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"regexp\">/iphone|ipod|android.*mobile|windows.*phone|blackberry.*mobile/i</span>.<span class=\"title function_\">test</span>(</span><br><span class=\"line\">    <span class=\"variable language_\">window</span>.<span class=\"property\">navigator</span>.<span class=\"property\">userAgent</span>.<span class=\"title function_\">toLowerCase</span>()</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"13-设置cookie\"><a href=\"#13-设置cookie\" class=\"headerlink\" title=\"13. 设置cookie\"></a>13. 设置cookie</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span> 设置 cookie</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@params</span> &#123;<span class=\"type\">string</span>&#125; <span class=\"variable\">cookie</span> -键名</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@params</span> &#123;<span class=\"type\">any</span>&#125; <span class=\"variable\">value</span> -存入的值</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@params</span> &#123;<span class=\"type\">Hours</span>&#125; <span class=\"variable\">number</span> -有效期限</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setCookie</span> = (<span class=\"params\">name: <span class=\"built_in\">string</span>, value: <span class=\"built_in\">any</span>, Hours: <span class=\"built_in\">number</span></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> d = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>()</span><br><span class=\"line\">  <span class=\"keyword\">const</span> offset = <span class=\"number\">8</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> utc = d.<span class=\"title function_\">getTime</span>() + d.<span class=\"title function_\">getTimezoneOffset</span>() * <span class=\"number\">60000</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> nd = utc + <span class=\"number\">3600000</span> * offset</span><br><span class=\"line\">  <span class=\"keyword\">const</span> exp = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>(nd)</span><br><span class=\"line\">  exp.<span class=\"title function_\">setTime</span>(exp.<span class=\"title function_\">getTime</span>() + <span class=\"title class_\">Hours</span> * <span class=\"number\">60</span> * <span class=\"number\">60</span> * <span class=\"number\">1000</span>)</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"property\">cookie</span> =</span><br><span class=\"line\">    name +</span><br><span class=\"line\">    <span class=\"string\">&#x27;=&#x27;</span> +</span><br><span class=\"line\">    <span class=\"built_in\">escape</span>(value) +</span><br><span class=\"line\">    <span class=\"string\">&#x27;;path=/;expires=&#x27;</span> +</span><br><span class=\"line\">    exp.<span class=\"title function_\">toUTCString</span>() +</span><br><span class=\"line\">    <span class=\"string\">&#x27;;domain=360doc.com;&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"14-获取字符串对应的字节数\"><a href=\"#14-获取字符串对应的字节数\" class=\"headerlink\" title=\"14. 获取字符串对应的字节数\"></a>14. 获取字符串对应的字节数</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span> 获取字节数</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> s 字符串</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">getBytesLength</span> = (<span class=\"params\">s: string</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> s.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/[^\\x00-\\xff]/gi</span>, <span class=\"string\">&#x27;--&#x27;</span>).<span class=\"property\">length</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"15-获取本地的时间\"><a href=\"#15-获取本地的时间\" class=\"headerlink\" title=\"15. 获取本地的时间\"></a>15. 获取本地的时间</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 获取本地的时间</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">getServerTime</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> <span class=\"attr\">xmlHttp</span>: <span class=\"title class_\">XMLHttpRequest</span></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">srvTime</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// FF, Opera, Safari, Chrome</span></span><br><span class=\"line\">      xmlHttp = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>()</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (err1) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// IE</span></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        xmlHttp = <span class=\"keyword\">new</span> <span class=\"title class_\">ActiveXObject</span>(<span class=\"string\">&#x27;Msxml2.XMLHTTP&#x27;</span>)</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (err2) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          xmlHttp = <span class=\"keyword\">new</span> <span class=\"title class_\">ActiveXObject</span>(<span class=\"string\">&#x27;Microsoft.XMLHTTP&#x27;</span>)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (eerr3) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// AJAX not supported, use CPU time.</span></span><br><span class=\"line\">          <span class=\"title function_\">alert</span>(<span class=\"string\">&#x27;AJAX not supported&#x27;</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    xmlHttp.<span class=\"title function_\">open</span>(<span class=\"string\">&#x27;HEAD&#x27;</span>, <span class=\"variable language_\">window</span>.<span class=\"property\">location</span>.<span class=\"property\">href</span>.<span class=\"title function_\">toString</span>(), <span class=\"literal\">false</span>)</span><br><span class=\"line\">    xmlHttp.<span class=\"title function_\">setRequestHeader</span>(<span class=\"string\">&#x27;Content-Type&#x27;</span>, <span class=\"string\">&#x27;text/html&#x27;</span>)</span><br><span class=\"line\">    xmlHttp.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> xmlHttp.<span class=\"title function_\">getResponseHeader</span>(<span class=\"string\">&#x27;Date&#x27;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> st = <span class=\"title function_\">srvTime</span>()</span><br><span class=\"line\">  <span class=\"keyword\">var</span> date = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>(st <span class=\"keyword\">as</span> <span class=\"built_in\">string</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> timestamp = date.<span class=\"title function_\">getTime</span>()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> timestamp</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"16-获取浏览器的Cookie的值\"><a href=\"#16-获取浏览器的Cookie的值\" class=\"headerlink\" title=\"16. 获取浏览器的Cookie的值\"></a>16. 获取浏览器的Cookie的值</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 获取浏览器的Cookie的值</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">cookie</span> = name =&gt; <span class=\"string\">`; <span class=\"subst\">$&#123;<span class=\"variable language_\">document</span>.cookie&#125;</span>`</span>.<span class=\"title function_\">split</span>(<span class=\"string\">`; <span class=\"subst\">$&#123;name&#125;</span>=`</span>).<span class=\"title function_\">pop</span>().<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;;&#x27;</span>).<span class=\"title function_\">shift</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 获取token </span></span><br><span class=\"line\"><span class=\"title function_\">cookie</span>(<span class=\"string\">&#x27;TOKEN&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"17-颜色RGB转十六进制\"><a href=\"#17-颜色RGB转十六进制\" class=\"headerlink\" title=\"17. 颜色RGB转十六进制\"></a>17. 颜色RGB转十六进制</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 颜色RGB转十六进制</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">rgbToHex</span> = (<span class=\"params\">r, g, b</span>) =&gt; <span class=\"string\">&quot;#&quot;</span> + ((<span class=\"number\">1</span> &lt;&lt; <span class=\"number\">24</span>) + (r &lt;&lt; <span class=\"number\">16</span>) + (g &lt;&lt; <span class=\"number\">8</span>) + b).<span class=\"title function_\">toString</span>(<span class=\"number\">16</span>).<span class=\"title function_\">slice</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">rgbToHex</span>(<span class=\"number\">0</span>, <span class=\"number\">51</span>, <span class=\"number\">255</span>); </span><br><span class=\"line\"><span class=\"comment\">// Result: #0033ff</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"18-复制到剪贴板-新的API\"><a href=\"#18-复制到剪贴板-新的API\" class=\"headerlink\" title=\"18. 复制到剪贴板(新的API)\"></a>18. 复制到剪贴板(新的API)</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 复制到剪贴板</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">copyToClipboard</span> = (<span class=\"params\">text</span>) =&gt; navigator.<span class=\"property\">clipboard</span>.<span class=\"title function_\">writeText</span>(text);</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"title function_\">copyToClipboard</span>(<span class=\"string\">&quot;Hello World&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"19-清除所有Cookie\"><a href=\"#19-清除所有Cookie\" class=\"headerlink\" title=\"19. 清除所有Cookie\"></a>19. 清除所有Cookie</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 清除所有Cookie</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> clearCookies = <span class=\"variable language_\">document</span>.<span class=\"property\">cookie</span>.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;;&#x27;</span>).<span class=\"title function_\">forEach</span>(<span class=\"function\"><span class=\"params\">cookie</span> =&gt;</span> <span class=\"variable language_\">document</span>.<span class=\"property\">cookie</span> = cookie.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/^ +/</span>, <span class=\"string\">&#x27;&#x27;</span>).<span class=\"title function_\">replace</span>(<span class=\"regexp\">/=.*/</span>, <span class=\"string\">`=;expires=<span class=\"subst\">$&#123;<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(<span class=\"number\">0</span>).toUTCString()&#125;</span>;path=/`</span>));</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"20-生成随机十六进制颜色\"><a href=\"#20-生成随机十六进制颜色\" class=\"headerlink\" title=\"20. 生成随机十六进制颜色\"></a>20. 生成随机十六进制颜色</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 生成随机十六进制颜色</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">randomHex</span> = (<span class=\"params\"></span>) =&gt; <span class=\"string\">`#<span class=\"subst\">$&#123;<span class=\"built_in\">Math</span>.floor(<span class=\"built_in\">Math</span>.random() * <span class=\"number\">0xffffff</span>).toString(<span class=\"number\">16</span>).padEnd(<span class=\"number\">6</span>, <span class=\"string\">&quot;0&quot;</span>)&#125;</span>`</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\"> <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"title function_\">randomHex</span>());</span><br><span class=\"line\"><span class=\"comment\">// Result: #92b008</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"21-从URL获取查询参数-–-JS\"><a href=\"#21-从URL获取查询参数-–-JS\" class=\"headerlink\" title=\"21. 从URL获取查询参数 – JS\"></a>21. 从URL获取查询参数 – JS</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 从URL获取查询参数</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">getParameters</span> = (<span class=\"params\">URL</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"variable constant_\">URL</span> = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(</span><br><span class=\"line\">    <span class=\"string\">&#x27;&#123;&quot;&#x27;</span> +</span><br><span class=\"line\">      <span class=\"built_in\">decodeURI</span>(<span class=\"variable constant_\">URL</span>.<span class=\"title function_\">split</span>(<span class=\"string\">&quot;?&quot;</span>)[<span class=\"number\">1</span>])</span><br><span class=\"line\">        .<span class=\"title function_\">replace</span>(<span class=\"regexp\">/&quot;/g</span>, <span class=\"string\">&#x27;\\\\&quot;&#x27;</span>)</span><br><span class=\"line\">        .<span class=\"title function_\">replace</span>(<span class=\"regexp\">/&amp;/g</span>, <span class=\"string\">&#x27;&quot;,&quot;&#x27;</span>)</span><br><span class=\"line\">        .<span class=\"title function_\">replace</span>(<span class=\"regexp\">/=/g</span>, <span class=\"string\">&#x27;&quot;:&quot;&#x27;</span>) +</span><br><span class=\"line\">      <span class=\"string\">&#x27;&quot;&#125;&#x27;</span></span><br><span class=\"line\">  );</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(<span class=\"variable constant_\">URL</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 调用</span></span><br><span class=\"line\"><span class=\"title function_\">getParameters</span>(<span class=\"variable language_\">window</span>.<span class=\"property\">location</span>);</span><br><span class=\"line\"><span class=\"comment\">// Result: &#123; search : &quot;easy&quot;, page : 3 &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>或者： </p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 从URL获取查询参数</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"title class_\">Object</span>.<span class=\"title function_\">fromEntries</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">URLSearchParams</span>(<span class=\"variable language_\">window</span>.<span class=\"property\">location</span>.<span class=\"property\">search</span>))</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"22-检查用户的设备是否在暗黑模式\"><a href=\"#22-检查用户的设备是否在暗黑模式\" class=\"headerlink\" title=\"22. 检查用户的设备是否在暗黑模式\"></a>22. 检查用户的设备是否在暗黑模式</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 检查用户的设备是否在暗黑模式</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> <span class=\"variable\">Boolean</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> isDarkMode = <span class=\"variable language_\">window</span>.<span class=\"property\">matchMedia</span> &amp;&amp; <span class=\"variable language_\">window</span>.<span class=\"title function_\">matchMedia</span>(<span class=\"string\">&#x27;(prefers-color-scheme: dark)&#x27;</span>).<span class=\"property\">matches</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"23-下载一个Excel文档\"><a href=\"#23-下载一个Excel文档\" class=\"headerlink\" title=\"23. 下载一个Excel文档\"></a>23. 下载一个Excel文档</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 下载一个链接</span></span><br><span class=\"line\"><span class=\"comment\"> */</span> </span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">download</span>(<span class=\"params\">link, name</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(!name)&#123;</span><br><span class=\"line\">    name = link.<span class=\"title function_\">slice</span>(link.<span class=\"title function_\">lastIndexOf</span>(<span class=\"string\">&#x27;/&#x27;</span>) + <span class=\"number\">1</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> eleLink = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;a&#x27;</span>)</span><br><span class=\"line\">  eleLink.<span class=\"property\">download</span> = name</span><br><span class=\"line\">  eleLink.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&#x27;none&#x27;</span></span><br><span class=\"line\">  eleLink.<span class=\"property\">href</span> = link</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">appendChild</span>(eleLink)</span><br><span class=\"line\">  eleLink.<span class=\"title function_\">click</span>()</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">removeChild</span>(eleLink)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//下载excel</span></span><br><span class=\"line\"><span class=\"title function_\">download</span>(<span class=\"string\">&#x27;http://111.229.14.189/file/1.xlsx&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"24-浏览器中下载一些DOM内容-JSON文件\"><a href=\"#24-浏览器中下载一些DOM内容-JSON文件\" class=\"headerlink\" title=\"24. 浏览器中下载一些DOM内容/JSON文件\"></a>24. 浏览器中下载一些DOM内容/JSON文件</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 浏览器下载静态文件</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">String</span>&#125; name 文件名</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">String</span>&#125; content 文件内容</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">downloadFile</span>(<span class=\"params\">name, content</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> name == <span class=\"string\">&#x27;undefined&#x27;</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(<span class=\"string\">&#x27;The first parameter name is a must&#x27;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> content == <span class=\"string\">&#x27;undefined&#x27;</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(<span class=\"string\">&#x27;The second parameter content is a must&#x27;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!(content <span class=\"keyword\">instanceof</span> <span class=\"title class_\">Blob</span>)) &#123;</span><br><span class=\"line\">    content = <span class=\"keyword\">new</span> <span class=\"title class_\">Blob</span>([content])</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> link = <span class=\"variable constant_\">URL</span>.<span class=\"title function_\">createObjectURL</span>(content)</span><br><span class=\"line\">  <span class=\"title function_\">download</span>(link, name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 调用下载</span></span><br><span class=\"line\"><span class=\"title function_\">downloadFile</span>(<span class=\"string\">&#x27;1.txt&#x27;</span>,<span class=\"string\">&#x27;lalalallalalla&#x27;</span>)</span><br><span class=\"line\"><span class=\"title function_\">downloadFile</span>(<span class=\"string\">&#x27;1.json&#x27;</span>,<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;<span class=\"attr\">name</span>:<span class=\"string\">&#x27;hahahha&#x27;</span>&#125;))</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"25-浏览器下载MP4-PDF-图片等\"><a href=\"#25-浏览器下载MP4-PDF-图片等\" class=\"headerlink\" title=\"25. 浏览器下载MP4/PDF/图片等\"></a>25. 浏览器下载MP4/PDF/图片等</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 浏览器下载MP4/PDF/图片等</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> axios <span class=\"keyword\">from</span> <span class=\"string\">&#x27;axios&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">//提供一个link，完成文件下载，link可以是  http://xxx.com/xxx.xls</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">downloadByLink</span>(<span class=\"params\">link,fileName</span>)&#123;</span><br><span class=\"line\">  axios.<span class=\"title function_\">request</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">url</span>: link,</span><br><span class=\"line\">    <span class=\"attr\">responseType</span>: <span class=\"string\">&#x27;blob&#x27;</span> <span class=\"comment\">// 关键代码，让axios把响应改成blob</span></span><br><span class=\"line\">  &#125;).<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> link = <span class=\"variable constant_\">URL</span>.<span class=\"title function_\">createObjectURL</span>(res.<span class=\"property\">data</span>)</span><br><span class=\"line\">    <span class=\"title function_\">download</span>(link, fileName)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>注意：会有同源策略的限制，需要配置转发</p>\n<hr>\n<h3 id=\"26-去除对象中的空元素\"><a href=\"#26-去除对象中的空元素\" class=\"headerlink\" title=\"26. 去除对象中的空元素\"></a>26. 去除对象中的空元素</h3><p>给后端发送数据的时候，要判断某个属性是不是空字符串，然后给后端拼参数，这块逻辑抽离出来就是<code>cleanObject</code>，代码实现如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * cleanObject 去除对象中的空元素</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"title function_\">cleanObject</span> = (<span class=\"params\">object</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"comment\">// Object.assign(&#123;&#125;, object)</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!object) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;&#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> result = &#123; ...object &#125;;</span><br><span class=\"line\">  <span class=\"title class_\">Object</span>.<span class=\"title function_\">keys</span>(result).<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">key</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> value = result[key];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"title function_\">isVoid</span>(value)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">delete</span> result[key];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 判断是否为空</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"title function_\">isVoid</span> = (<span class=\"params\">value</span>) =&gt;</span><br><span class=\"line\">  value === <span class=\"literal\">undefined</span> || value === <span class=\"literal\">null</span> || value === <span class=\"string\">&quot;&quot;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>使用：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> res = <span class=\"title function_\">cleanObject</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>:<span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">pageSize</span>:<span class=\"number\">10</span>,</span><br><span class=\"line\">    <span class=\"attr\">page</span>:<span class=\"number\">1</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;res&quot;</span>, res) <span class=\"comment\">// 输出 &#123; page:1,pageSize:10 &#125;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"27-常用的正则验证\"><a href=\"#27-常用的正则验证\" class=\"headerlink\" title=\"27. 常用的正则验证\"></a>27. 常用的正则验证</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 常用的正则验证</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> checkStr = <span class=\"keyword\">function</span>(<span class=\"params\">str, type</span>) &#123; <span class=\"comment\">// 常用正则验证，注意type大小写</span></span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (type) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;phone&#x27;</span>: <span class=\"comment\">// 手机号码</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^1[3|4|5|6|7|8|9][0-9]&#123;9&#125;$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;tel&#x27;</span>: <span class=\"comment\">// 座机</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^(0\\d&#123;2,3&#125;-\\d&#123;7,8&#125;)(-\\d&#123;1,4&#125;)?$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;card&#x27;</span>: <span class=\"comment\">// 身份证</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/(^\\d&#123;15&#125;$)|(^\\d&#123;18&#125;$)|(^\\d&#123;17&#125;(\\d|X|x)$)/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;pwd&#x27;</span>: <span class=\"comment\">// 密码以字母开头，长度在6~18之间，只能包含字母、数字和下划线</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^[a-zA-Z]\\w&#123;5,17&#125;$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;postal&#x27;</span>: <span class=\"comment\">// 邮政编码</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/[1-9]\\d&#123;5&#125;(?!\\d)/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;QQ&#x27;</span>: <span class=\"comment\">// QQ号</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^[1-9][0-9]&#123;4,9&#125;$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;email&#x27;</span>: <span class=\"comment\">// 邮箱</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^[\\w-]+(.[\\w-]+)*@[\\w-]+(.[\\w-]+)+$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;money&#x27;</span>: <span class=\"comment\">// 金额(小数点2位)</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^\\d*(?:.\\d&#123;0,2&#125;)?$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;URL&#x27;</span>: <span class=\"comment\">// 网址</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/(http|ftp|https):/</span><span class=\"regexp\">/[\\w-_]+(.[\\w-_]+)+([\\w-.,@?^=%&amp;:/~+#]*[\\w-@?^=%&amp;/~+#])?/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;IP&#x27;</span>: <span class=\"comment\">// IP</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/((?:(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d)\\.)&#123;3&#125;(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d))/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;date&#x27;</span>: <span class=\"comment\">// 日期时间</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^(\\d&#123;4&#125;)-(\\d&#123;2&#125;)-(\\d&#123;2&#125;) (\\d&#123;2&#125;)(?::\\d&#123;2&#125;|:(\\d&#123;2&#125;):(\\d&#123;2&#125;))$/</span>.<span class=\"title function_\">test</span>(str) ||</span><br><span class=\"line\">        <span class=\"regexp\">/^(\\d&#123;4&#125;)-(\\d&#123;2&#125;)-(\\d&#123;2&#125;)$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;number&#x27;</span>: <span class=\"comment\">// 数字</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^[0-9]$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;english&#x27;</span>: <span class=\"comment\">// 英文</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^[a-zA-Z]+$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;chinese&#x27;</span>: <span class=\"comment\">// 中文</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^[\\u4E00-\\u9FA5]+$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;lower&#x27;</span>: <span class=\"comment\">// 小写</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^[a-z]+$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;upper&#x27;</span>: <span class=\"comment\">// 大写</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/^[A-Z]+$/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;HTML&#x27;</span>: <span class=\"comment\">// HTML标记</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"regexp\">/&lt;(&quot;[^&quot;]*&quot;|&#x27;[^&#x27;]*&#x27;|[^&#x27;&quot;&gt;])*&gt;/</span>.<span class=\"title function_\">test</span>(str)</span><br><span class=\"line\">    <span class=\"attr\">default</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"28-阿拉伯数字转中文大写数字\"><a href=\"#28-阿拉伯数字转中文大写数字\" class=\"headerlink\" title=\"28. 阿拉伯数字转中文大写数字\"></a>28. 阿拉伯数字转中文大写数字</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 阿拉伯数字转中文大写数字</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> numberToChinese = <span class=\"keyword\">function</span>(<span class=\"params\">num</span>) &#123; <span class=\"comment\">// 将阿拉伯数字翻译成中文的大写数字</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable constant_\">AA</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"string\">&#x27;零&#x27;</span>, <span class=\"string\">&#x27;一&#x27;</span>, <span class=\"string\">&#x27;二&#x27;</span>, <span class=\"string\">&#x27;三&#x27;</span>, <span class=\"string\">&#x27;四&#x27;</span>, <span class=\"string\">&#x27;五&#x27;</span>, <span class=\"string\">&#x27;六&#x27;</span>, <span class=\"string\">&#x27;七&#x27;</span>, <span class=\"string\">&#x27;八&#x27;</span>, <span class=\"string\">&#x27;九&#x27;</span>, <span class=\"string\">&#x27;十&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable constant_\">BB</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;十&#x27;</span>, <span class=\"string\">&#x27;百&#x27;</span>, <span class=\"string\">&#x27;仟&#x27;</span>, <span class=\"string\">&#x27;萬&#x27;</span>, <span class=\"string\">&#x27;億&#x27;</span>, <span class=\"string\">&#x27;点&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">let</span> a = (<span class=\"string\">&#x27;&#x27;</span> + num).<span class=\"title function_\">replace</span>(<span class=\"regexp\">/(^0*)/g</span>, <span class=\"string\">&#x27;&#x27;</span>).<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;.&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">let</span> k = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> re = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = a[<span class=\"number\">0</span>].<span class=\"property\">length</span> - <span class=\"number\">1</span>; i &gt;= <span class=\"number\">0</span>; i--) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (k) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"number\">0</span>:</span><br><span class=\"line\">        re = <span class=\"variable constant_\">BB</span>[<span class=\"number\">7</span>] + re</span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"keyword\">new</span> <span class=\"title class_\">RegExp</span>(<span class=\"string\">&#x27;0&#123;4&#125;//d&#123;&#x27;</span> + (a[<span class=\"number\">0</span>].<span class=\"property\">length</span> - i - <span class=\"number\">1</span>) + <span class=\"string\">&#x27;&#125;$&#x27;</span>).<span class=\"title function_\">test</span>(a[<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">          re = <span class=\"variable constant_\">BB</span>[<span class=\"number\">4</span>] + re</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"number\">8</span>:</span><br><span class=\"line\">        re = <span class=\"variable constant_\">BB</span>[<span class=\"number\">5</span>] + re</span><br><span class=\"line\">        <span class=\"variable constant_\">BB</span>[<span class=\"number\">7</span>] = <span class=\"variable constant_\">BB</span>[<span class=\"number\">5</span>]</span><br><span class=\"line\">        k = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (k % <span class=\"number\">4</span> === <span class=\"number\">2</span> &amp;&amp; a[<span class=\"number\">0</span>].<span class=\"title function_\">charAt</span>(i + <span class=\"number\">2</span>) !== <span class=\"number\">0</span> &amp;&amp; a[<span class=\"number\">0</span>].<span class=\"title function_\">charAt</span>(i + <span class=\"number\">1</span>) === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      re = <span class=\"variable constant_\">AA</span>[<span class=\"number\">0</span>] + re</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (a[<span class=\"number\">0</span>].<span class=\"title function_\">charAt</span>(i) !== <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      re = <span class=\"variable constant_\">AA</span>[a[<span class=\"number\">0</span>].<span class=\"title function_\">charAt</span>(i)] + <span class=\"variable constant_\">BB</span>[k % <span class=\"number\">4</span>] + re</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    k++</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (a.<span class=\"property\">length</span> &gt; <span class=\"number\">1</span>) &#123; <span class=\"comment\">// 加上小数部分(如果有小数部分)</span></span><br><span class=\"line\">    re += <span class=\"variable constant_\">BB</span>[<span class=\"number\">6</span>]</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; a[<span class=\"number\">1</span>].<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">      re += <span class=\"variable constant_\">AA</span>[a[<span class=\"number\">1</span>].<span class=\"title function_\">charAt</span>(i)]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (re === <span class=\"string\">&#x27;一十&#x27;</span>) &#123;</span><br><span class=\"line\">    re = <span class=\"string\">&#x27;十&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (re.<span class=\"title function_\">match</span>(<span class=\"regexp\">/^一/</span>) &amp;&amp; re.<span class=\"property\">length</span> === <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">    re = re.<span class=\"title function_\">replace</span>(<span class=\"string\">&#x27;一&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> re</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"29-base64图片下载功能\"><a href=\"#29-base64图片下载功能\" class=\"headerlink\" title=\"29. base64图片下载功能\"></a>29. base64图片下载功能</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * base64图片下载功能</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> downloadFile = <span class=\"keyword\">function</span>(<span class=\"params\">base64, fileName</span>) &#123; <span class=\"comment\">//base64图片下载功能</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> base64ToBlob = <span class=\"keyword\">function</span>(<span class=\"params\">code</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> parts = code.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;;base64,&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> contentType = parts[<span class=\"number\">0</span>].<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;:&#x27;</span>)[<span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"keyword\">let</span> raw = <span class=\"variable language_\">window</span>.<span class=\"title function_\">atob</span>(parts[<span class=\"number\">1</span>]);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> rawLength = raw.<span class=\"property\">length</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> uInt8Array = <span class=\"keyword\">new</span> <span class=\"title class_\">Uint8Array</span>(rawLength);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; rawLength; ++i) &#123;</span><br><span class=\"line\">      uInt8Array[i] = raw.<span class=\"title function_\">charCodeAt</span>(i);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Blob</span>([uInt8Array], &#123;</span><br><span class=\"line\">      <span class=\"attr\">type</span>: contentType</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> aLink = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;a&#x27;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> blob = <span class=\"title function_\">base64ToBlob</span>(base64); <span class=\"comment\">//new Blob([content]);</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> evt = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createEvent</span>(<span class=\"string\">&quot;HTMLEvents&quot;</span>);</span><br><span class=\"line\">  evt.<span class=\"title function_\">initEvent</span>(<span class=\"string\">&quot;click&quot;</span>, <span class=\"literal\">true</span>, <span class=\"literal\">true</span>); <span class=\"comment\">//initEvent不加后两个参数在FF下会报错  事件类型，是否冒泡，是否阻止浏览器的默认行为</span></span><br><span class=\"line\">  aLink.<span class=\"property\">download</span> = fileName;</span><br><span class=\"line\">  aLink.<span class=\"property\">href</span> = <span class=\"variable constant_\">URL</span>.<span class=\"title function_\">createObjectURL</span>(blob);</span><br><span class=\"line\">  aLink.<span class=\"title function_\">click</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"30-获取div高度\"><a href=\"#30-获取div高度\" class=\"headerlink\" title=\"30. 获取div高度\"></a>30. 获取div高度</h3><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 获取div高度</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> div = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\"><span class=\"variable language_\">window</span>.<span class=\"title function_\">getComputedStyle</span>(div).<span class=\"title function_\">getPropertyValue</span>(<span class=\"string\">&#x27;height&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n\n<hr>\n<h3 id=\"31-将base64转化成可用formData提交的文件\"><a href=\"#31-将base64转化成可用formData提交的文件\" class=\"headerlink\" title=\"31. 将base64转化成可用formData提交的文件\"></a>31. 将base64转化成可用formData提交的文件</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * convertBase64UrlToBlob 将base64转化成可用formdata提交的文件</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; urlData base64位的url</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@returns</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">convertBase64UrlToBlob</span> = (<span class=\"params\">urlData</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"comment\">//去掉url的头，并转换为byte</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> split = urlData.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;,&#x27;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> bytes = <span class=\"variable language_\">window</span>.<span class=\"title function_\">atob</span>(split[<span class=\"number\">1</span>]);</span><br><span class=\"line\">  <span class=\"comment\">//处理异常,将ascii码小于0的转换为大于0</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> ab = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayBuffer</span>(bytes.<span class=\"property\">length</span>);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> ia = <span class=\"keyword\">new</span> <span class=\"title class_\">Uint8Array</span>(ab);</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; bytes.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">    ia[i] = bytes.<span class=\"title function_\">charCodeAt</span>(i);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Blob</span>([ab], &#123; <span class=\"attr\">type</span>: split[<span class=\"number\">0</span>].<span class=\"title function_\">match</span>(<span class=\"regexp\">/:(.*?);/</span>)[<span class=\"number\">1</span>] &#125;);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"32-找到对象中所有可能存在的字符串，并替换掉其中的-lt-gt-分别为全角的＜＞（）\"><a href=\"#32-找到对象中所有可能存在的字符串，并替换掉其中的-lt-gt-分别为全角的＜＞（）\" class=\"headerlink\" title=\"32. 找到对象中所有可能存在的字符串，并替换掉其中的&lt;, &gt;, (, )分别为全角的＜＞（）\"></a>32. 找到对象中所有可能存在的字符串，并替换掉其中的&lt;, &gt;, (, )分别为全角的＜＞（）</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 找到对象中所有可能存在的字符串，并替换掉其中的&lt;, &gt;, (, )分别为全角的＜＞（）</span></span><br><span class=\"line\"><span class=\"comment\"> * 可以自定义拓展更多的规则</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">object</span>&#125; obj 需要处理的对象</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> &#123;<span class=\"type\">object</span>&#125; aim obj</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"title function_\">formatString</span> = (<span class=\"params\">obj</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> key <span class=\"keyword\">in</span> obj) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!obj.<span class=\"title function_\">hasOwnProperty</span>(key)) <span class=\"keyword\">return</span>; <span class=\"comment\">// 排除掉原型继承而来的属性</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> obj[key] == <span class=\"string\">&#x27;string&#x27;</span>) &#123;</span><br><span class=\"line\">      obj[key] = obj[key]</span><br><span class=\"line\">        .<span class=\"title function_\">replace</span>(<span class=\"regexp\">/&lt;/g</span>, <span class=\"string\">&#x27;＜&#x27;</span>)</span><br><span class=\"line\">        .<span class=\"title function_\">replace</span>(<span class=\"regexp\">/&gt;/g</span>, <span class=\"string\">&#x27;＞&#x27;</span>)</span><br><span class=\"line\">        .<span class=\"title function_\">replace</span>(<span class=\"regexp\">/\\(/g</span>, <span class=\"string\">&#x27;（&#x27;</span>)</span><br><span class=\"line\">        .<span class=\"title function_\">replace</span>(<span class=\"regexp\">/\\)/g</span>, <span class=\"string\">&#x27;）&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> obj[key] == <span class=\"string\">&#x27;object&#x27;</span> || <span class=\"keyword\">typeof</span> obj[key] == <span class=\"string\">&#x27;function&#x27;</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">formatString</span>(obj[key]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"33-将对象格式转化为get请求所需要的参数\"><a href=\"#33-将对象格式转化为get请求所需要的参数\" class=\"headerlink\" title=\"33. 将对象格式转化为get请求所需要的参数\"></a>33. 将对象格式转化为get请求所需要的参数</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * getParams 将对象格式转化为get请求所需要的参数</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">object</span>&#125; params 需要处理的对象</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> &#123;<span class=\"type\">object</span>&#125; aim obj</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">getParams</span>(<span class=\"params\">params</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> paramStr = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">  <span class=\"title class_\">Object</span>.<span class=\"title function_\">keys</span>(params).<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (paramStr === <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">      paramStr = <span class=\"string\">`<span class=\"subst\">$&#123;item&#125;</span>=<span class=\"subst\">$&#123;params[item]&#125;</span>`</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      paramStr = <span class=\"string\">`<span class=\"subst\">$&#123;paramStr&#125;</span>&amp;<span class=\"subst\">$&#123;item&#125;</span>=<span class=\"subst\">$&#123;params[item]&#125;</span>`</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> paramStr;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"34-获取图片真实的宽高（非真实渲染）\"><a href=\"#34-获取图片真实的宽高（非真实渲染）\" class=\"headerlink\" title=\"34. 获取图片真实的宽高（非真实渲染）\"></a>34. 获取图片真实的宽高（非真实渲染）</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * getImageSize 获取图片的宽高</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; url 需要处理的图片路径</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> &#123;<span class=\"type\">object</span>&#125; &#123;<span class=\"type\"> width: number, height: number </span>&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">getImageSize</span>(<span class=\"params\">url: <span class=\"built_in\">string</span></span>): <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">any</span>&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> image = <span class=\"keyword\">new</span> <span class=\"title class_\">Image</span>();</span><br><span class=\"line\">    image.<span class=\"property\">onload</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">resolve</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">width</span>: image.<span class=\"property\">width</span>, <span class=\"comment\">// 或naturalWidth</span></span><br><span class=\"line\">        <span class=\"attr\">height</span>: image.<span class=\"property\">height</span>, <span class=\"comment\">// 或naturalHeight</span></span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      <span class=\"comment\">// 注释中这两个属性在Firefox/Chrome/Safari/Opera及IE9+里已经实现</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    image.<span class=\"property\">onerror</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">reject</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(<span class=\"string\">&#x27;error&#x27;</span>));</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    image.<span class=\"property\">src</span> = url;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"35-递归拿出对象数组中所有指定的字段项，并返回新数组\"><a href=\"#35-递归拿出对象数组中所有指定的字段项，并返回新数组\" class=\"headerlink\" title=\"35. 递归拿出对象数组中所有指定的字段项，并返回新数组\"></a>35. 递归拿出对象数组中所有指定的字段项，并返回新数组</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 递归拿出所有指定的字段项</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Array</span>&#125; <span class=\"variable\">list</span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; <span class=\"variable\">key</span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; <span class=\"variable\">child</span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@returns</span> &#123;<span class=\"type\">Array</span>&#125; 返回所有key的集合</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">getKeyList</span>(<span class=\"params\">list: <span class=\"built_in\">Array</span>&lt;<span class=\"built_in\">any</span>&gt;, key: <span class=\"built_in\">string</span>, child = <span class=\"string\">&#x27;children&#x27;</span></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> <span class=\"attr\">result</span>: <span class=\"built_in\">any</span>[] = [];</span><br><span class=\"line\">  list.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">listItem</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    listItem[key] &amp;&amp; result.<span class=\"title function_\">push</span>(listItem[key]);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (listItem[child] &amp;&amp; listItem[child].<span class=\"property\">length</span>) &#123;</span><br><span class=\"line\">      result.<span class=\"title function_\">push</span>(...<span class=\"title function_\">getKeyList</span>(listItem[child], key, child));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"filter、map、reduce的使用","abbrlink":"4109","date":"2021-10-04T15:20:38.000Z","copyright":true,"_content":"\n记录数组的三个API对比。\n\n<!-- more -->\n\n<!-- ############################################## 1. filter、map、reduce的使用 ############################################## -->\n\n直接使用一个小的案例去说明他们的关系：\n\n```js\nconst nums = [10, 20, 111, 444, 40, 50];\n// 对于数据nums现有三个需求：\n// 1.取出所有小于100的数字\n// 2.将所有小于100的数字进行转化 --乘以2\n// 3.将所有的newNums2数字相加得到最后的结果。\n```\n\n## 使用普通 for 循环去处理以上需求\n\n> 需求 1：取出所有小于 100 的数字\n\n```js\nlet newNums = [];\nfor (let n of nums) {\n  if (n < 100) {\n    newNums.push(n);\n  }\n}\n```\n\n> 需求 2： 将所有小于 100 的数字进行转化 --乘以 2\n\n```js\nlet newNums2 = [];\nfor (let n of newNums) {\n  newNums2.push(n * 2);\n}\n```\n\n> 需求 3： 将所有的 newNums2 数字相加得到最后的结果。\n\n```js\nlet total = 0;\nfor (let n of newNums2) {\n  total += n;\n}\n```\n\n## filter / map / reduce 完成以上需求\n\n```js\n//需求1：取出所有小于100的数字\nnums.filter(function (n) {\n  //filter中的回调函数有一个要求：必须返回一个boolean值\n  //当返回true时，函数内部会自动将本次回调的n加入到一个新的数组中\n  //当返回为false时，函数内部会过滤掉这次的n\n  return n < 100; //这里就可以直接满足第一个需求\n});\n//这里会返回一个新的数组，就是包含nums中所有值小于100的新数组\nlet newNums = nums.filter(function (n) {\n  return n < 100;\n});\nconsole.log(newNums); // [10,20,40,50]\n```\n\n```js\n//需求2： 将所有小于100的数字进行转化 --乘以2\nlet newNums2 = newNums.map(function (n) {\n  return n * 2;\n});\nconsole.log(newNums2); // [20,40,80,100]\n```\n\n```js\n//需求3：将所有的newNums2数字相加得到最后的结果\n//reduce作用：对数组中所有的内容进行汇总\nnewNums2.reduce(function (preValue, n) {\n  //preValue 是上一次返回的值\n  //return 100; //对应下面的过程\n  return preValue + n;\n}, 0);\n//reduce(参数1，参数2); 会返回最后汇总的结果; 参数1：整合数据操作、参数2：初始值\n//这里面的function会执行4次，\n/**\n\t第一次： preValue->0 ; n -> 20;\n\t第二次： preValue->100 ; n ->40;\n\t第二次： preValue->100 ; n ->80;\n\t第二次： preValue->100 ; n ->100;\n*/\n```\n\n> 计算最终的结果\n\n```js\nlet total = nums\n  .filter(function (n) {\n    return n < 100;\n  })\n  .map(function (n) {\n    return n * 2;\n  })\n  .reduce(function (preValue, n) {\n    return preValue + n;\n  }, 0);\n```\n\n这样的话就很好的简化了代码，逻辑也会更加清楚。\n什么？还是不够简化？那下面的代码呢？\n\n```js\nlet total = nums\n  .filter(n => n < 100)\n  .map(n => n * 2)\n  .reduce((preValue, n) => preValue + n);\nconsole.log(total); // total = 240;\n```\n\n## 总结\n\n> filter: 对数组进行过滤，当返回值为 true 时，才会返回当前处理的元素。\n\n> map: 映射，可以对数组中每个元素进行操作，并逐一返回，生成一个新的数组。\n\n> reduce: 接收一个函数作为累加器，数组中的每个值（从左到右）开始合并，最终返回一个值。\n> reduce 可接收的参数: reduce((参数 1,参数 2,参数 3,参数 4) => {}, 参数 5)\n> &nbsp;&nbsp;参数 1. previousValue(上一次调用回调函数返回的值，或者是提供的初始值（initialValue）)\n> &nbsp;&nbsp;参数 2. currentValue(数组中当前被处理的元素)\n> &nbsp;&nbsp;参数 3. index（当前元素在数组中的索引）\n> &nbsp;&nbsp;参数 4. array（调用 reduce 的数组）\n> 并且 reduce 可以传入一个初始值（参数 5），初始值的格式随意定义，如果不传，默认是 previousValue\n\n<!-- *** -->\n<!-- ############################################## 1. end ############################################## -->\n","source":"_posts/filter、map、reduce的使用.md","raw":"---\ntitle: filter、map、reduce的使用\ntags:\n  - 知识积累\n  - 前端开发\ncategories: \n  - 前端知识积累\n  - Javascript\nabbrlink: '4109'\ndate: 2021-10-04 23:20:38\ncopyright: true\n---\n\n记录数组的三个API对比。\n\n<!-- more -->\n\n<!-- ############################################## 1. filter、map、reduce的使用 ############################################## -->\n\n直接使用一个小的案例去说明他们的关系：\n\n```js\nconst nums = [10, 20, 111, 444, 40, 50];\n// 对于数据nums现有三个需求：\n// 1.取出所有小于100的数字\n// 2.将所有小于100的数字进行转化 --乘以2\n// 3.将所有的newNums2数字相加得到最后的结果。\n```\n\n## 使用普通 for 循环去处理以上需求\n\n> 需求 1：取出所有小于 100 的数字\n\n```js\nlet newNums = [];\nfor (let n of nums) {\n  if (n < 100) {\n    newNums.push(n);\n  }\n}\n```\n\n> 需求 2： 将所有小于 100 的数字进行转化 --乘以 2\n\n```js\nlet newNums2 = [];\nfor (let n of newNums) {\n  newNums2.push(n * 2);\n}\n```\n\n> 需求 3： 将所有的 newNums2 数字相加得到最后的结果。\n\n```js\nlet total = 0;\nfor (let n of newNums2) {\n  total += n;\n}\n```\n\n## filter / map / reduce 完成以上需求\n\n```js\n//需求1：取出所有小于100的数字\nnums.filter(function (n) {\n  //filter中的回调函数有一个要求：必须返回一个boolean值\n  //当返回true时，函数内部会自动将本次回调的n加入到一个新的数组中\n  //当返回为false时，函数内部会过滤掉这次的n\n  return n < 100; //这里就可以直接满足第一个需求\n});\n//这里会返回一个新的数组，就是包含nums中所有值小于100的新数组\nlet newNums = nums.filter(function (n) {\n  return n < 100;\n});\nconsole.log(newNums); // [10,20,40,50]\n```\n\n```js\n//需求2： 将所有小于100的数字进行转化 --乘以2\nlet newNums2 = newNums.map(function (n) {\n  return n * 2;\n});\nconsole.log(newNums2); // [20,40,80,100]\n```\n\n```js\n//需求3：将所有的newNums2数字相加得到最后的结果\n//reduce作用：对数组中所有的内容进行汇总\nnewNums2.reduce(function (preValue, n) {\n  //preValue 是上一次返回的值\n  //return 100; //对应下面的过程\n  return preValue + n;\n}, 0);\n//reduce(参数1，参数2); 会返回最后汇总的结果; 参数1：整合数据操作、参数2：初始值\n//这里面的function会执行4次，\n/**\n\t第一次： preValue->0 ; n -> 20;\n\t第二次： preValue->100 ; n ->40;\n\t第二次： preValue->100 ; n ->80;\n\t第二次： preValue->100 ; n ->100;\n*/\n```\n\n> 计算最终的结果\n\n```js\nlet total = nums\n  .filter(function (n) {\n    return n < 100;\n  })\n  .map(function (n) {\n    return n * 2;\n  })\n  .reduce(function (preValue, n) {\n    return preValue + n;\n  }, 0);\n```\n\n这样的话就很好的简化了代码，逻辑也会更加清楚。\n什么？还是不够简化？那下面的代码呢？\n\n```js\nlet total = nums\n  .filter(n => n < 100)\n  .map(n => n * 2)\n  .reduce((preValue, n) => preValue + n);\nconsole.log(total); // total = 240;\n```\n\n## 总结\n\n> filter: 对数组进行过滤，当返回值为 true 时，才会返回当前处理的元素。\n\n> map: 映射，可以对数组中每个元素进行操作，并逐一返回，生成一个新的数组。\n\n> reduce: 接收一个函数作为累加器，数组中的每个值（从左到右）开始合并，最终返回一个值。\n> reduce 可接收的参数: reduce((参数 1,参数 2,参数 3,参数 4) => {}, 参数 5)\n> &nbsp;&nbsp;参数 1. previousValue(上一次调用回调函数返回的值，或者是提供的初始值（initialValue）)\n> &nbsp;&nbsp;参数 2. currentValue(数组中当前被处理的元素)\n> &nbsp;&nbsp;参数 3. index（当前元素在数组中的索引）\n> &nbsp;&nbsp;参数 4. array（调用 reduce 的数组）\n> 并且 reduce 可以传入一个初始值（参数 5），初始值的格式随意定义，如果不传，默认是 previousValue\n\n<!-- *** -->\n<!-- ############################################## 1. end ############################################## -->\n","slug":"filter、map、reduce的使用","published":1,"updated":"2022-08-26T01:42:59.881Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl79tdvva00035d9k30t26s9v","content":"<p>记录数组的三个API对比。</p>\n<span id=\"more\"></span>\n\n<!-- ############################################## 1. filter、map、reduce的使用 ############################################## -->\n\n<p>直接使用一个小的案例去说明他们的关系：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> nums = [<span class=\"number\">10</span>, <span class=\"number\">20</span>, <span class=\"number\">111</span>, <span class=\"number\">444</span>, <span class=\"number\">40</span>, <span class=\"number\">50</span>];</span><br><span class=\"line\"><span class=\"comment\">// 对于数据nums现有三个需求：</span></span><br><span class=\"line\"><span class=\"comment\">// 1.取出所有小于100的数字</span></span><br><span class=\"line\"><span class=\"comment\">// 2.将所有小于100的数字进行转化 --乘以2</span></span><br><span class=\"line\"><span class=\"comment\">// 3.将所有的newNums2数字相加得到最后的结果。</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"使用普通-for-循环去处理以上需求\"><a href=\"#使用普通-for-循环去处理以上需求\" class=\"headerlink\" title=\"使用普通 for 循环去处理以上需求\"></a>使用普通 for 循环去处理以上需求</h2><blockquote>\n<p>需求 1：取出所有小于 100 的数字</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> newNums = [];</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> n <span class=\"keyword\">of</span> nums) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n &lt; <span class=\"number\">100</span>) &#123;</span><br><span class=\"line\">    newNums.<span class=\"title function_\">push</span>(n);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>需求 2： 将所有小于 100 的数字进行转化 –乘以 2</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> newNums2 = [];</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> n <span class=\"keyword\">of</span> newNums) &#123;</span><br><span class=\"line\">  newNums2.<span class=\"title function_\">push</span>(n * <span class=\"number\">2</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>需求 3： 将所有的 newNums2 数字相加得到最后的结果。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> total = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> n <span class=\"keyword\">of</span> newNums2) &#123;</span><br><span class=\"line\">  total += n;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"filter-map-reduce-完成以上需求\"><a href=\"#filter-map-reduce-完成以上需求\" class=\"headerlink\" title=\"filter / map / reduce 完成以上需求\"></a>filter / map / reduce 完成以上需求</h2><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//需求1：取出所有小于100的数字</span></span><br><span class=\"line\">nums.<span class=\"title function_\">filter</span>(<span class=\"keyword\">function</span> (<span class=\"params\">n</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">//filter中的回调函数有一个要求：必须返回一个boolean值</span></span><br><span class=\"line\">  <span class=\"comment\">//当返回true时，函数内部会自动将本次回调的n加入到一个新的数组中</span></span><br><span class=\"line\">  <span class=\"comment\">//当返回为false时，函数内部会过滤掉这次的n</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> n &lt; <span class=\"number\">100</span>; <span class=\"comment\">//这里就可以直接满足第一个需求</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">//这里会返回一个新的数组，就是包含nums中所有值小于100的新数组</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> newNums = nums.<span class=\"title function_\">filter</span>(<span class=\"keyword\">function</span> (<span class=\"params\">n</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> n &lt; <span class=\"number\">100</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(newNums); <span class=\"comment\">// [10,20,40,50]</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//需求2： 将所有小于100的数字进行转化 --乘以2</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> newNums2 = newNums.<span class=\"title function_\">map</span>(<span class=\"keyword\">function</span> (<span class=\"params\">n</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> n * <span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(newNums2); <span class=\"comment\">// [20,40,80,100]</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//需求3：将所有的newNums2数字相加得到最后的结果</span></span><br><span class=\"line\"><span class=\"comment\">//reduce作用：对数组中所有的内容进行汇总</span></span><br><span class=\"line\">newNums2.<span class=\"title function_\">reduce</span>(<span class=\"keyword\">function</span> (<span class=\"params\">preValue, n</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">//preValue 是上一次返回的值</span></span><br><span class=\"line\">  <span class=\"comment\">//return 100; //对应下面的过程</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> preValue + n;</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"comment\">//reduce(参数1，参数2); 会返回最后汇总的结果; 参数1：整合数据操作、参数2：初始值</span></span><br><span class=\"line\"><span class=\"comment\">//这里面的function会执行4次，</span></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  第一次： preValue-&gt;0 ; n -&gt; 20;</span></span><br><span class=\"line\"><span class=\"comment\">  第二次： preValue-&gt;100 ; n -&gt;40;</span></span><br><span class=\"line\"><span class=\"comment\">  第二次： preValue-&gt;100 ; n -&gt;80;</span></span><br><span class=\"line\"><span class=\"comment\">  第二次： preValue-&gt;100 ; n -&gt;100;</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>计算最终的结果</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> total = nums</span><br><span class=\"line\">  .<span class=\"title function_\">filter</span>(<span class=\"keyword\">function</span> (<span class=\"params\">n</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> n &lt; <span class=\"number\">100</span>;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .<span class=\"title function_\">map</span>(<span class=\"keyword\">function</span> (<span class=\"params\">n</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> n * <span class=\"number\">2</span>;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .<span class=\"title function_\">reduce</span>(<span class=\"keyword\">function</span> (<span class=\"params\">preValue, n</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> preValue + n;</span><br><span class=\"line\">  &#125;, <span class=\"number\">0</span>);</span><br></pre></td></tr></table></figure>\n\n<p>这样的话就很好的简化了代码，逻辑也会更加清楚。<br>什么？还是不够简化？那下面的代码呢？</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> total = nums</span><br><span class=\"line\">  .<span class=\"title function_\">filter</span>(<span class=\"function\"><span class=\"params\">n</span> =&gt;</span> n &lt; <span class=\"number\">100</span>)</span><br><span class=\"line\">  .<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">n</span> =&gt;</span> n * <span class=\"number\">2</span>)</span><br><span class=\"line\">  .<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">preValue, n</span>) =&gt;</span> preValue + n);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(total); <span class=\"comment\">// total = 240;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><blockquote>\n<p>filter: 对数组进行过滤，当返回值为 true 时，才会返回当前处理的元素。</p>\n</blockquote>\n<blockquote>\n<p>map: 映射，可以对数组中每个元素进行操作，并逐一返回，生成一个新的数组。</p>\n</blockquote>\n<blockquote>\n<p>reduce: 接收一个函数作为累加器，数组中的每个值（从左到右）开始合并，最终返回一个值。<br>reduce 可接收的参数: reduce((参数 1,参数 2,参数 3,参数 4) =&gt; {}, 参数 5)<br>&nbsp;&nbsp;参数 1. previousValue(上一次调用回调函数返回的值，或者是提供的初始值（initialValue）)<br>&nbsp;&nbsp;参数 2. currentValue(数组中当前被处理的元素)<br>&nbsp;&nbsp;参数 3. index（当前元素在数组中的索引）<br>&nbsp;&nbsp;参数 4. array（调用 reduce 的数组）<br>并且 reduce 可以传入一个初始值（参数 5），初始值的格式随意定义，如果不传，默认是 previousValue</p>\n</blockquote>\n<!-- *** -->\n<!-- ############################################## 1. end ############################################## -->\n","site":{"data":{}},"excerpt":"<p>记录数组的三个API对比。</p>","more":"<!-- ############################################## 1. filter、map、reduce的使用 ############################################## -->\n\n<p>直接使用一个小的案例去说明他们的关系：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> nums = [<span class=\"number\">10</span>, <span class=\"number\">20</span>, <span class=\"number\">111</span>, <span class=\"number\">444</span>, <span class=\"number\">40</span>, <span class=\"number\">50</span>];</span><br><span class=\"line\"><span class=\"comment\">// 对于数据nums现有三个需求：</span></span><br><span class=\"line\"><span class=\"comment\">// 1.取出所有小于100的数字</span></span><br><span class=\"line\"><span class=\"comment\">// 2.将所有小于100的数字进行转化 --乘以2</span></span><br><span class=\"line\"><span class=\"comment\">// 3.将所有的newNums2数字相加得到最后的结果。</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"使用普通-for-循环去处理以上需求\"><a href=\"#使用普通-for-循环去处理以上需求\" class=\"headerlink\" title=\"使用普通 for 循环去处理以上需求\"></a>使用普通 for 循环去处理以上需求</h2><blockquote>\n<p>需求 1：取出所有小于 100 的数字</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> newNums = [];</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> n <span class=\"keyword\">of</span> nums) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n &lt; <span class=\"number\">100</span>) &#123;</span><br><span class=\"line\">    newNums.<span class=\"title function_\">push</span>(n);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>需求 2： 将所有小于 100 的数字进行转化 –乘以 2</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> newNums2 = [];</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> n <span class=\"keyword\">of</span> newNums) &#123;</span><br><span class=\"line\">  newNums2.<span class=\"title function_\">push</span>(n * <span class=\"number\">2</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>需求 3： 将所有的 newNums2 数字相加得到最后的结果。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> total = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> n <span class=\"keyword\">of</span> newNums2) &#123;</span><br><span class=\"line\">  total += n;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"filter-map-reduce-完成以上需求\"><a href=\"#filter-map-reduce-完成以上需求\" class=\"headerlink\" title=\"filter / map / reduce 完成以上需求\"></a>filter / map / reduce 完成以上需求</h2><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//需求1：取出所有小于100的数字</span></span><br><span class=\"line\">nums.<span class=\"title function_\">filter</span>(<span class=\"keyword\">function</span> (<span class=\"params\">n</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">//filter中的回调函数有一个要求：必须返回一个boolean值</span></span><br><span class=\"line\">  <span class=\"comment\">//当返回true时，函数内部会自动将本次回调的n加入到一个新的数组中</span></span><br><span class=\"line\">  <span class=\"comment\">//当返回为false时，函数内部会过滤掉这次的n</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> n &lt; <span class=\"number\">100</span>; <span class=\"comment\">//这里就可以直接满足第一个需求</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">//这里会返回一个新的数组，就是包含nums中所有值小于100的新数组</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> newNums = nums.<span class=\"title function_\">filter</span>(<span class=\"keyword\">function</span> (<span class=\"params\">n</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> n &lt; <span class=\"number\">100</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(newNums); <span class=\"comment\">// [10,20,40,50]</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//需求2： 将所有小于100的数字进行转化 --乘以2</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> newNums2 = newNums.<span class=\"title function_\">map</span>(<span class=\"keyword\">function</span> (<span class=\"params\">n</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> n * <span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(newNums2); <span class=\"comment\">// [20,40,80,100]</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//需求3：将所有的newNums2数字相加得到最后的结果</span></span><br><span class=\"line\"><span class=\"comment\">//reduce作用：对数组中所有的内容进行汇总</span></span><br><span class=\"line\">newNums2.<span class=\"title function_\">reduce</span>(<span class=\"keyword\">function</span> (<span class=\"params\">preValue, n</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">//preValue 是上一次返回的值</span></span><br><span class=\"line\">  <span class=\"comment\">//return 100; //对应下面的过程</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> preValue + n;</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"comment\">//reduce(参数1，参数2); 会返回最后汇总的结果; 参数1：整合数据操作、参数2：初始值</span></span><br><span class=\"line\"><span class=\"comment\">//这里面的function会执行4次，</span></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  第一次： preValue-&gt;0 ; n -&gt; 20;</span></span><br><span class=\"line\"><span class=\"comment\">  第二次： preValue-&gt;100 ; n -&gt;40;</span></span><br><span class=\"line\"><span class=\"comment\">  第二次： preValue-&gt;100 ; n -&gt;80;</span></span><br><span class=\"line\"><span class=\"comment\">  第二次： preValue-&gt;100 ; n -&gt;100;</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>计算最终的结果</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> total = nums</span><br><span class=\"line\">  .<span class=\"title function_\">filter</span>(<span class=\"keyword\">function</span> (<span class=\"params\">n</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> n &lt; <span class=\"number\">100</span>;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .<span class=\"title function_\">map</span>(<span class=\"keyword\">function</span> (<span class=\"params\">n</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> n * <span class=\"number\">2</span>;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .<span class=\"title function_\">reduce</span>(<span class=\"keyword\">function</span> (<span class=\"params\">preValue, n</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> preValue + n;</span><br><span class=\"line\">  &#125;, <span class=\"number\">0</span>);</span><br></pre></td></tr></table></figure>\n\n<p>这样的话就很好的简化了代码，逻辑也会更加清楚。<br>什么？还是不够简化？那下面的代码呢？</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> total = nums</span><br><span class=\"line\">  .<span class=\"title function_\">filter</span>(<span class=\"function\"><span class=\"params\">n</span> =&gt;</span> n &lt; <span class=\"number\">100</span>)</span><br><span class=\"line\">  .<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">n</span> =&gt;</span> n * <span class=\"number\">2</span>)</span><br><span class=\"line\">  .<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">preValue, n</span>) =&gt;</span> preValue + n);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(total); <span class=\"comment\">// total = 240;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><blockquote>\n<p>filter: 对数组进行过滤，当返回值为 true 时，才会返回当前处理的元素。</p>\n</blockquote>\n<blockquote>\n<p>map: 映射，可以对数组中每个元素进行操作，并逐一返回，生成一个新的数组。</p>\n</blockquote>\n<blockquote>\n<p>reduce: 接收一个函数作为累加器，数组中的每个值（从左到右）开始合并，最终返回一个值。<br>reduce 可接收的参数: reduce((参数 1,参数 2,参数 3,参数 4) =&gt; {}, 参数 5)<br>&nbsp;&nbsp;参数 1. previousValue(上一次调用回调函数返回的值，或者是提供的初始值（initialValue）)<br>&nbsp;&nbsp;参数 2. currentValue(数组中当前被处理的元素)<br>&nbsp;&nbsp;参数 3. index（当前元素在数组中的索引）<br>&nbsp;&nbsp;参数 4. array（调用 reduce 的数组）<br>并且 reduce 可以传入一个初始值（参数 5），初始值的格式随意定义，如果不传，默认是 previousValue</p>\n</blockquote>\n<!-- *** -->\n<!-- ############################################## 1. end ############################################## -->"},{"title":"关于跨域，我想说.....","abbrlink":"9ff3","date":"2021-10-08T11:15:12.000Z","copyright":true,"_content":"\n初始跨域的时候比较费解头疼，所以记录下来自己对跨域的理解。\n\n<!-- more -->\n\n## 什么是跨域？什么是浏览器同源政策？\n>  跨域：\n>​  \t浏览器可能存放用户信息，为了保护用户信息，禁止非同源请求来获取本网站的信息，为了解决同源限制所作出的行为叫做跨域。\n>  同源政策:\n>    两个ip地址，只有符合以下三个条件时才可以叫做同源，同源的地址之间互相访问不存在跨域问题；\n>    1.协议相同\n>    2.域名相同\n>    3.端口相同\n>    只要有一个条件不符合，就会发生跨域问题。\n\n```js\nhttp://www.baidu.com/a   //http:默认端口是8080\nhttps://www.baidu/com/b  //https:默认端口是443\nA.同源 B.不同源，协议不同 C.不同源，端口不同 {D.不同源，协议和端口不同}\n```\n\n## 跨域方式有哪些？\n\n```js\nvar xhr = new XMLHttpRequest();\nxhr.open(\"get\",\"https://suggest.taobao.com/sug?code=utf-8&q=%E8%BE%A3%E6%9D%A1\");\nxhr.send();\n\nxhr.onreadystatechange = function(){\n    if(xhr.readyState == 4){\n         console.log(xhr.responseText);\n       }\n}\n//这里会显示出现跨域阻止\n```\n\n### 跨域问题的第一种解决方式\n\n这里以自己搭建的淘宝和京东后台模拟为例\n\n* 1.淘宝\n\n```js\n//淘宝----------前端js代码\nconst xhr = new XMLHttpRequest();\n//这里默认的请求地址是 http://localhost:8080/getInfo\n// xhr.open(\"get\",\"/getInfo\");\n//现在想要请求京东的资源\nxhr.open(\"get\",\"http://localhost:9000/getInfo\");\nxhr.send();\nxhr.onreadystatechange = function (){\n  if(xhr.readyState == 4){\n    document.querySelector(\"span\").innerText = xhr.responseText;\n  }\n}\n```\n\n```js\n//淘宝----------后端js代码\nconst express = require(\"express\");\nconst web = express();\nweb.use(express.static(\"public\"));\n\nweb.get(\"/getInfo\",function (req,res){\n  const goodList = [\n    {\n      name : \"雷神电脑\",\n      price : 9999\n    },{\n      name : \"苹果手机\",\n      price : 6999\n    },{\n      name : \"耐克球鞋\",\n      price : 999\n    }\n  ];\n  res.send(goodList);\n})\n\nweb.listen(\"8080\",function (){\n  console.log(\"8080端口启动\");\n})\n```\n\n* 京东\n\n```js\n//京东----------前端js代码 和淘宝的一致\n//京东请求自己网站的数据，没有同源限制也就没有跨域问题\nconst xhr = new XMLHttpRequest();\n  xhr.open(\"get\",\"/getInfo\");\n  xhr.send();\n  xhr.onreadystatechange = function (){\n    if(xhr.readyState == 4){\n      console.log(xhr.responseText);\n      document.querySelector(\"span\").innerText = xhr.responseText;\n    }\n  }\n```\n\n```js\n//京东----------后端js代码\nconst express = require(\"express\");\nconst web = express();\nweb.use(express.static(\"public\"));\n\nweb.get(\"/getInfo\",function (req,res){\n  //-------------------------------------------------------- \n  res.set(\"Access-Control-Allow-Origin\",\"http://localhost:8080\")\n  //-------------------------------------------------------- \n  const bookList = [\n    {\n      name : \"海王\",\n      price : 99.99\n    },{\n      name : \"海贼王\",\n      price : 699\n    },{\n      name : \"海尔兄弟\",\n      price : 111\n    }\n  ];\n  res.send(bookList);\n})\n\nweb.listen(\"9000\",function (){\n  console.log(\"9000端口启动\");\n})\n```\n\n> 在这里，淘宝网站想要请求京东网站的资源时，发生了跨域请求。如果没有解决这个问题是没法请求到京东的数据的。\n>\n> 这里就有了第一种解决的方案，在京东的后端接口中声明，\n>\n> ```js\n> res.set(\"Access-Control-Allow-Origin\",\"希望可以被请求的地址\")  \n> //这里可以写* 代表所有的不同源的网站\n> ```\n\n总结：\n\n```js\n这里请求京东的资源会发生跨域请求,由于浏览器的同源限制，会拦截跨域请求\n*  控制台输出：\n*    已拦截跨源请求：同源策略禁止读取位于 http://localhost:9000/getInfo 的远程资源。\n*    （原因：CORS 头缺少 'Access-Control-Allow-Origin'）。\n*  只需要在对应的接口中设置：\n*    res.set(\"Access-Control-Allow-Origin\",\"希望可以被请求的地址\")  这里可以写* 代表所有的不同源的网站\n```\n\n###  跨域问题的第二种解决方式\n\n> 问题剖析：\n>\n> ​\t跨域问题最根本产生的原因就是浏览器为了保护用户信息而设置了同源限制，只有同源的情况下才可以访问数据。同源限制也只是在浏览器中存在，在app等环境下运行就不会有同源限制，所以只需要想办法让请求发生不在浏览器中就可以。这里可以使用后台来请求外部资源，然后再返回给前端就可以解决跨域问题。\n\n```html\n<!-- 前端代码 -->\n<body>\n请输入您要查询的关键字：<input type=\"text\" onblur=\"getInfo()\">\n<span></span>\n<script>\n  function getInfo() {\n    const keywords = document.querySelector(\"input\").value;\n    const xhr = new XMLHttpRequest();\n    //现在想要请求动态的资源,链接中的q参数是可变的，传入一个参数给后端\n    xhr.open(\"get\", \"/getInfo?keyWords=\" + keywords);\n    xhr.send();\n    xhr.onreadystatechange = function () {\n      if (xhr.readyState == 4) {\n        document.querySelector(\"span\").innerText = xhr.responseText;\n      }\n    }\n  }\n</script>\n</body>\n```\n\n```js\nconst express = require(\"express\");\nconst web = express();\nweb.use(express.static(\"public\"));\nconst https = require(\"https\")\n\nweb.get(\"/getInfo\", function (req, res) {\n  const keywords = req.query.keyWords; // 这个keywords是一个汉字字符,拼接成的url是带有中文的，需要编码\n  let url = \"https://suggest.taobao.com/sug?code=utf-8&q=\" + keywords;\n  //https请求不能解析带有中文的地址\n  url = encodeURI(url);\n  //在这里请求外部数据\n  //请求淘宝的一个搜索关键字的资源\n  https.get(url, function (httpsRes) {\n    let bufferData = \"\";\n    httpsRes.on(\"data\", function (data) {\n      bufferData += data;\n    });\n    httpsRes.on(\"end\", function () {\n      //此时bufferData是一个buffer类型的数据\n      bufferData = JSON.parse(bufferData);\n      //将拼接到的资源返回给前端\n      res.send(bufferData);\n    })\n  })\n})\n\nweb.listen(\"8080\", function () {\n  console.log(\"8080端口启动\");\n})\n```\n\n### 跨域问题的第三种解决方式\n\n> 在以往的html中，也有请求外部资源的时候\n\n比如：\n\n```html\n<img src=\"地址\" alt=\"\">\n<a href=\"地址\"></a>\n<link rel=\"stylesheet\" href=\"地址\">\n<script src=\"地址\"></script>\n```\n\n这些请求都可以请求成功，说明浏览器对于标签的外部资源请求是没有限制的，那么我们使用标签的形式进行请求跨域资源。\n\n```html\n<script>\n  function myCallBack(data){\n    console.log(data);\n    //data里面存放了{result:[Array(数据)]}\n  }\n</script>\n<script src=\"https://suggest.taobao.com/sug?code=utf-8&q=%E8%BE%A3%E6%9D%A1&callback=myCallBack\"></script>\n```\n\n\n> 在标签中进行跨域请求就不需要在接口中增加一行 res.set(\"Access-Control-Allow-Origin\",\"允许的对象\")\n> 也不需要通过后台的方式进行跨域请求\n> 只需要在标签中声明请求的目标资源地址就可以了，更加方便\n>\n> 但是这种方式也有一个问题：\n> \t怎么才能得到请求到的资源?\n> \t这里需要给请求的资源地址后面添加一个callback 回调函数\n\n### 跨域问题的第四个解决方式\n\n> 搭配jquery中的dataType : jsonp解决跨域问题\n\n```html\n<script src=\"./jQuery.js\"></script>\n<script type=\"text/javascript\">\n  $.ajax({\n    url : \"https://suggest.taobao.com/sug?code=utf-8&q=%E8%BE%A3%E6%9D%A1\",\n    type : \"get\",\n    dataType : \"jsonP\",\n    success(res){\n      console.log(res.result)\n    }\n  })\n</script>\n```\n\n### 跨域问题的第五个解决方式（vue）\n\n下面的例子中创建一个home.vue组件：\n\n```vue\n<template>\n  <div>\n    <button @click=\"sendQuest\">发送跨域请求</button>\n  </div>\n</template>\n\n<script>\n// 这里需要安装axios模块 npm install axios\nimport axios from \"axios\"\n\nexport default {\n  name: \"home\",\n  methods: {\n    sendQuest() {\n      // 这里发生了跨域请求，请求不到数据。在config/index中进行配置\n      // axios.get(\"https://suggest.taobao.com/sug?code=utf-8&q=%E9%A6%99%E6%B0%B4\")\n      axios.get(\"/taoBao/sug?code=utf-8&q=%E9%A6%99%E6%B0%B4\")\n      .then(function (data) {\n        // 请求成功\n        console.log(data);\n      },function (err) {\n        // 请求错误\n        console.log(err);\n      })\n    }\n  }\n}\n</script>\n\n<style scoped>\n\n</style>\n<!-- 当点击按钮的时候进行数据跨域请求， -->\n```\n\n在config/index.js/dev/proxyTable中进行配置：\n\n```js\n// proxy 代理  table 表  代理表 \n// vue当中使用代理表进行跨域  （反向代理）\n// 代理表跨域 是把url当中相同的部分截取出来\nproxyTable: {\n  '/taoBao':{\n    // target目标\n     target:\"https://suggest.taobao.com\" , \n    //  是否改变请求源\n     changeOrigin:true , \n    //  路径重写\n     pathRewrite:{\n        '^/taoBao':\"\"\n     }\n  }\n},\n```\n\n> 这样就可以实现vue中的跨域请求\n\n\n","source":"_posts/关于跨域，我想说.md","raw":"---\ntitle: 关于跨域，我想说.....\nabbrlink: 9ff3\ndate: 2021-10-08 19:15:12\ntags:\n  - 前端开发\n  - 面试题\ncategories: \n  - 前端知识积累\n  - 网络相关\ncopyright: true\n---\n\n初始跨域的时候比较费解头疼，所以记录下来自己对跨域的理解。\n\n<!-- more -->\n\n## 什么是跨域？什么是浏览器同源政策？\n>  跨域：\n>​  \t浏览器可能存放用户信息，为了保护用户信息，禁止非同源请求来获取本网站的信息，为了解决同源限制所作出的行为叫做跨域。\n>  同源政策:\n>    两个ip地址，只有符合以下三个条件时才可以叫做同源，同源的地址之间互相访问不存在跨域问题；\n>    1.协议相同\n>    2.域名相同\n>    3.端口相同\n>    只要有一个条件不符合，就会发生跨域问题。\n\n```js\nhttp://www.baidu.com/a   //http:默认端口是8080\nhttps://www.baidu/com/b  //https:默认端口是443\nA.同源 B.不同源，协议不同 C.不同源，端口不同 {D.不同源，协议和端口不同}\n```\n\n## 跨域方式有哪些？\n\n```js\nvar xhr = new XMLHttpRequest();\nxhr.open(\"get\",\"https://suggest.taobao.com/sug?code=utf-8&q=%E8%BE%A3%E6%9D%A1\");\nxhr.send();\n\nxhr.onreadystatechange = function(){\n    if(xhr.readyState == 4){\n         console.log(xhr.responseText);\n       }\n}\n//这里会显示出现跨域阻止\n```\n\n### 跨域问题的第一种解决方式\n\n这里以自己搭建的淘宝和京东后台模拟为例\n\n* 1.淘宝\n\n```js\n//淘宝----------前端js代码\nconst xhr = new XMLHttpRequest();\n//这里默认的请求地址是 http://localhost:8080/getInfo\n// xhr.open(\"get\",\"/getInfo\");\n//现在想要请求京东的资源\nxhr.open(\"get\",\"http://localhost:9000/getInfo\");\nxhr.send();\nxhr.onreadystatechange = function (){\n  if(xhr.readyState == 4){\n    document.querySelector(\"span\").innerText = xhr.responseText;\n  }\n}\n```\n\n```js\n//淘宝----------后端js代码\nconst express = require(\"express\");\nconst web = express();\nweb.use(express.static(\"public\"));\n\nweb.get(\"/getInfo\",function (req,res){\n  const goodList = [\n    {\n      name : \"雷神电脑\",\n      price : 9999\n    },{\n      name : \"苹果手机\",\n      price : 6999\n    },{\n      name : \"耐克球鞋\",\n      price : 999\n    }\n  ];\n  res.send(goodList);\n})\n\nweb.listen(\"8080\",function (){\n  console.log(\"8080端口启动\");\n})\n```\n\n* 京东\n\n```js\n//京东----------前端js代码 和淘宝的一致\n//京东请求自己网站的数据，没有同源限制也就没有跨域问题\nconst xhr = new XMLHttpRequest();\n  xhr.open(\"get\",\"/getInfo\");\n  xhr.send();\n  xhr.onreadystatechange = function (){\n    if(xhr.readyState == 4){\n      console.log(xhr.responseText);\n      document.querySelector(\"span\").innerText = xhr.responseText;\n    }\n  }\n```\n\n```js\n//京东----------后端js代码\nconst express = require(\"express\");\nconst web = express();\nweb.use(express.static(\"public\"));\n\nweb.get(\"/getInfo\",function (req,res){\n  //-------------------------------------------------------- \n  res.set(\"Access-Control-Allow-Origin\",\"http://localhost:8080\")\n  //-------------------------------------------------------- \n  const bookList = [\n    {\n      name : \"海王\",\n      price : 99.99\n    },{\n      name : \"海贼王\",\n      price : 699\n    },{\n      name : \"海尔兄弟\",\n      price : 111\n    }\n  ];\n  res.send(bookList);\n})\n\nweb.listen(\"9000\",function (){\n  console.log(\"9000端口启动\");\n})\n```\n\n> 在这里，淘宝网站想要请求京东网站的资源时，发生了跨域请求。如果没有解决这个问题是没法请求到京东的数据的。\n>\n> 这里就有了第一种解决的方案，在京东的后端接口中声明，\n>\n> ```js\n> res.set(\"Access-Control-Allow-Origin\",\"希望可以被请求的地址\")  \n> //这里可以写* 代表所有的不同源的网站\n> ```\n\n总结：\n\n```js\n这里请求京东的资源会发生跨域请求,由于浏览器的同源限制，会拦截跨域请求\n*  控制台输出：\n*    已拦截跨源请求：同源策略禁止读取位于 http://localhost:9000/getInfo 的远程资源。\n*    （原因：CORS 头缺少 'Access-Control-Allow-Origin'）。\n*  只需要在对应的接口中设置：\n*    res.set(\"Access-Control-Allow-Origin\",\"希望可以被请求的地址\")  这里可以写* 代表所有的不同源的网站\n```\n\n###  跨域问题的第二种解决方式\n\n> 问题剖析：\n>\n> ​\t跨域问题最根本产生的原因就是浏览器为了保护用户信息而设置了同源限制，只有同源的情况下才可以访问数据。同源限制也只是在浏览器中存在，在app等环境下运行就不会有同源限制，所以只需要想办法让请求发生不在浏览器中就可以。这里可以使用后台来请求外部资源，然后再返回给前端就可以解决跨域问题。\n\n```html\n<!-- 前端代码 -->\n<body>\n请输入您要查询的关键字：<input type=\"text\" onblur=\"getInfo()\">\n<span></span>\n<script>\n  function getInfo() {\n    const keywords = document.querySelector(\"input\").value;\n    const xhr = new XMLHttpRequest();\n    //现在想要请求动态的资源,链接中的q参数是可变的，传入一个参数给后端\n    xhr.open(\"get\", \"/getInfo?keyWords=\" + keywords);\n    xhr.send();\n    xhr.onreadystatechange = function () {\n      if (xhr.readyState == 4) {\n        document.querySelector(\"span\").innerText = xhr.responseText;\n      }\n    }\n  }\n</script>\n</body>\n```\n\n```js\nconst express = require(\"express\");\nconst web = express();\nweb.use(express.static(\"public\"));\nconst https = require(\"https\")\n\nweb.get(\"/getInfo\", function (req, res) {\n  const keywords = req.query.keyWords; // 这个keywords是一个汉字字符,拼接成的url是带有中文的，需要编码\n  let url = \"https://suggest.taobao.com/sug?code=utf-8&q=\" + keywords;\n  //https请求不能解析带有中文的地址\n  url = encodeURI(url);\n  //在这里请求外部数据\n  //请求淘宝的一个搜索关键字的资源\n  https.get(url, function (httpsRes) {\n    let bufferData = \"\";\n    httpsRes.on(\"data\", function (data) {\n      bufferData += data;\n    });\n    httpsRes.on(\"end\", function () {\n      //此时bufferData是一个buffer类型的数据\n      bufferData = JSON.parse(bufferData);\n      //将拼接到的资源返回给前端\n      res.send(bufferData);\n    })\n  })\n})\n\nweb.listen(\"8080\", function () {\n  console.log(\"8080端口启动\");\n})\n```\n\n### 跨域问题的第三种解决方式\n\n> 在以往的html中，也有请求外部资源的时候\n\n比如：\n\n```html\n<img src=\"地址\" alt=\"\">\n<a href=\"地址\"></a>\n<link rel=\"stylesheet\" href=\"地址\">\n<script src=\"地址\"></script>\n```\n\n这些请求都可以请求成功，说明浏览器对于标签的外部资源请求是没有限制的，那么我们使用标签的形式进行请求跨域资源。\n\n```html\n<script>\n  function myCallBack(data){\n    console.log(data);\n    //data里面存放了{result:[Array(数据)]}\n  }\n</script>\n<script src=\"https://suggest.taobao.com/sug?code=utf-8&q=%E8%BE%A3%E6%9D%A1&callback=myCallBack\"></script>\n```\n\n\n> 在标签中进行跨域请求就不需要在接口中增加一行 res.set(\"Access-Control-Allow-Origin\",\"允许的对象\")\n> 也不需要通过后台的方式进行跨域请求\n> 只需要在标签中声明请求的目标资源地址就可以了，更加方便\n>\n> 但是这种方式也有一个问题：\n> \t怎么才能得到请求到的资源?\n> \t这里需要给请求的资源地址后面添加一个callback 回调函数\n\n### 跨域问题的第四个解决方式\n\n> 搭配jquery中的dataType : jsonp解决跨域问题\n\n```html\n<script src=\"./jQuery.js\"></script>\n<script type=\"text/javascript\">\n  $.ajax({\n    url : \"https://suggest.taobao.com/sug?code=utf-8&q=%E8%BE%A3%E6%9D%A1\",\n    type : \"get\",\n    dataType : \"jsonP\",\n    success(res){\n      console.log(res.result)\n    }\n  })\n</script>\n```\n\n### 跨域问题的第五个解决方式（vue）\n\n下面的例子中创建一个home.vue组件：\n\n```vue\n<template>\n  <div>\n    <button @click=\"sendQuest\">发送跨域请求</button>\n  </div>\n</template>\n\n<script>\n// 这里需要安装axios模块 npm install axios\nimport axios from \"axios\"\n\nexport default {\n  name: \"home\",\n  methods: {\n    sendQuest() {\n      // 这里发生了跨域请求，请求不到数据。在config/index中进行配置\n      // axios.get(\"https://suggest.taobao.com/sug?code=utf-8&q=%E9%A6%99%E6%B0%B4\")\n      axios.get(\"/taoBao/sug?code=utf-8&q=%E9%A6%99%E6%B0%B4\")\n      .then(function (data) {\n        // 请求成功\n        console.log(data);\n      },function (err) {\n        // 请求错误\n        console.log(err);\n      })\n    }\n  }\n}\n</script>\n\n<style scoped>\n\n</style>\n<!-- 当点击按钮的时候进行数据跨域请求， -->\n```\n\n在config/index.js/dev/proxyTable中进行配置：\n\n```js\n// proxy 代理  table 表  代理表 \n// vue当中使用代理表进行跨域  （反向代理）\n// 代理表跨域 是把url当中相同的部分截取出来\nproxyTable: {\n  '/taoBao':{\n    // target目标\n     target:\"https://suggest.taobao.com\" , \n    //  是否改变请求源\n     changeOrigin:true , \n    //  路径重写\n     pathRewrite:{\n        '^/taoBao':\"\"\n     }\n  }\n},\n```\n\n> 这样就可以实现vue中的跨域请求\n\n\n","slug":"关于跨域，我想说","published":1,"updated":"2022-08-26T01:42:59.882Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl79tdvvc00075d9k4wpygpt5","content":"<p>初始跨域的时候比较费解头疼，所以记录下来自己对跨域的理解。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"什么是跨域？什么是浏览器同源政策？\"><a href=\"#什么是跨域？什么是浏览器同源政策？\" class=\"headerlink\" title=\"什么是跨域？什么是浏览器同源政策？\"></a>什么是跨域？什么是浏览器同源政策？</h2><blockquote>\n<p> 跨域：<br>​      浏览器可能存放用户信息，为了保护用户信息，禁止非同源请求来获取本网站的信息，为了解决同源限制所作出的行为叫做跨域。<br> 同源政策:<br>   两个ip地址，只有符合以下三个条件时才可以叫做同源，同源的地址之间互相访问不存在跨域问题；<br>   1.协议相同<br>   2.域名相同<br>   3.端口相同<br>   只要有一个条件不符合，就会发生跨域问题。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//www.baidu.com/a   //http:默认端口是8080</span></span><br><span class=\"line\"><span class=\"attr\">https</span>:<span class=\"comment\">//www.baidu/com/b  //https:默认端口是443</span></span><br><span class=\"line\">A.同源 B.不同源，协议不同 C.不同源，端口不同 &#123;D.不同源，协议和端口不同&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"跨域方式有哪些？\"><a href=\"#跨域方式有哪些？\" class=\"headerlink\" title=\"跨域方式有哪些？\"></a>跨域方式有哪些？</h2><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span><br><span class=\"line\">xhr.<span class=\"title function_\">open</span>(<span class=\"string\">&quot;get&quot;</span>,<span class=\"string\">&quot;https://suggest.taobao.com/sug?code=utf-8&amp;q=%E8%BE%A3%E6%9D%A1&quot;</span>);</span><br><span class=\"line\">xhr.<span class=\"title function_\">send</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">xhr.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(xhr.<span class=\"property\">readyState</span> == <span class=\"number\">4</span>)&#123;</span><br><span class=\"line\">         <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(xhr.<span class=\"property\">responseText</span>);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//这里会显示出现跨域阻止</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"跨域问题的第一种解决方式\"><a href=\"#跨域问题的第一种解决方式\" class=\"headerlink\" title=\"跨域问题的第一种解决方式\"></a>跨域问题的第一种解决方式</h3><p>这里以自己搭建的淘宝和京东后台模拟为例</p>\n<ul>\n<li>1.淘宝</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//淘宝----------前端js代码</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span><br><span class=\"line\"><span class=\"comment\">//这里默认的请求地址是 http://localhost:8080/getInfo</span></span><br><span class=\"line\"><span class=\"comment\">// xhr.open(&quot;get&quot;,&quot;/getInfo&quot;);</span></span><br><span class=\"line\"><span class=\"comment\">//现在想要请求京东的资源</span></span><br><span class=\"line\">xhr.<span class=\"title function_\">open</span>(<span class=\"string\">&quot;get&quot;</span>,<span class=\"string\">&quot;http://localhost:9000/getInfo&quot;</span>);</span><br><span class=\"line\">xhr.<span class=\"title function_\">send</span>();</span><br><span class=\"line\">xhr.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(xhr.<span class=\"property\">readyState</span> == <span class=\"number\">4</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&quot;span&quot;</span>).<span class=\"property\">innerText</span> = xhr.<span class=\"property\">responseText</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//淘宝----------后端js代码</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;express&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> web = <span class=\"title function_\">express</span>();</span><br><span class=\"line\">web.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">static</span>(<span class=\"string\">&quot;public&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">web.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;/getInfo&quot;</span>,<span class=\"keyword\">function</span> (<span class=\"params\">req,res</span>)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> goodList = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name : <span class=\"string\">&quot;雷神电脑&quot;</span>,</span><br><span class=\"line\">      price : <span class=\"number\">9999</span></span><br><span class=\"line\">    &#125;,&#123;</span><br><span class=\"line\">      name : <span class=\"string\">&quot;苹果手机&quot;</span>,</span><br><span class=\"line\">      price : <span class=\"number\">6999</span></span><br><span class=\"line\">    &#125;,&#123;</span><br><span class=\"line\">      name : <span class=\"string\">&quot;耐克球鞋&quot;</span>,</span><br><span class=\"line\">      price : <span class=\"number\">999</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(goodList);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">web.<span class=\"title function_\">listen</span>(<span class=\"string\">&quot;8080&quot;</span>,<span class=\"keyword\">function</span> (<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;8080端口启动&quot;</span>);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>京东</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//京东----------前端js代码 和淘宝的一致</span></span><br><span class=\"line\"><span class=\"comment\">//京东请求自己网站的数据，没有同源限制也就没有跨域问题</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span><br><span class=\"line\">  xhr.<span class=\"title function_\">open</span>(<span class=\"string\">&quot;get&quot;</span>,<span class=\"string\">&quot;/getInfo&quot;</span>);</span><br><span class=\"line\">  xhr.<span class=\"title function_\">send</span>();</span><br><span class=\"line\">  xhr.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(xhr.<span class=\"property\">readyState</span> == <span class=\"number\">4</span>)&#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(xhr.<span class=\"property\">responseText</span>);</span><br><span class=\"line\">      <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&quot;span&quot;</span>).<span class=\"property\">innerText</span> = xhr.<span class=\"property\">responseText</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//京东----------后端js代码</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;express&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> web = <span class=\"title function_\">express</span>();</span><br><span class=\"line\">web.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">static</span>(<span class=\"string\">&quot;public&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">web.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;/getInfo&quot;</span>,<span class=\"keyword\">function</span> (<span class=\"params\">req,res</span>)&#123;</span><br><span class=\"line\">  <span class=\"comment\">//-------------------------------------------------------- </span></span><br><span class=\"line\">  res.<span class=\"title function_\">set</span>(<span class=\"string\">&quot;Access-Control-Allow-Origin&quot;</span>,<span class=\"string\">&quot;http://localhost:8080&quot;</span>)</span><br><span class=\"line\">  <span class=\"comment\">//-------------------------------------------------------- </span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> bookList = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name : <span class=\"string\">&quot;海王&quot;</span>,</span><br><span class=\"line\">      price : <span class=\"number\">99.99</span></span><br><span class=\"line\">    &#125;,&#123;</span><br><span class=\"line\">      name : <span class=\"string\">&quot;海贼王&quot;</span>,</span><br><span class=\"line\">      price : <span class=\"number\">699</span></span><br><span class=\"line\">    &#125;,&#123;</span><br><span class=\"line\">      name : <span class=\"string\">&quot;海尔兄弟&quot;</span>,</span><br><span class=\"line\">      price : <span class=\"number\">111</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(bookList);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">web.<span class=\"title function_\">listen</span>(<span class=\"string\">&quot;9000&quot;</span>,<span class=\"keyword\">function</span> (<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;9000端口启动&quot;</span>);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>在这里，淘宝网站想要请求京东网站的资源时，发生了跨域请求。如果没有解决这个问题是没法请求到京东的数据的。</p>\n<p>这里就有了第一种解决的方案，在京东的后端接口中声明，</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">res.<span class=\"title function_\">set</span>(<span class=\"string\">&quot;Access-Control-Allow-Origin&quot;</span>,<span class=\"string\">&quot;希望可以被请求的地址&quot;</span>)  </span><br><span class=\"line\"><span class=\"comment\">//这里可以写* 代表所有的不同源的网站</span></span><br></pre></td></tr></table></figure>\n</blockquote>\n<p>总结：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">这里请求京东的资源会发生跨域请求,由于浏览器的同源限制，会拦截跨域请求</span><br><span class=\"line\">*  控制台输出：</span><br><span class=\"line\">*    已拦截跨源请求：同源策略禁止读取位于 <span class=\"attr\">http</span>:<span class=\"comment\">//localhost:9000/getInfo 的远程资源。</span></span><br><span class=\"line\">*    （原因：<span class=\"variable constant_\">CORS</span> 头缺少 <span class=\"string\">&#x27;Access-Control-Allow-Origin&#x27;</span>）。</span><br><span class=\"line\">*  只需要在对应的接口中设置：</span><br><span class=\"line\">*    res.<span class=\"title function_\">set</span>(<span class=\"string\">&quot;Access-Control-Allow-Origin&quot;</span>,<span class=\"string\">&quot;希望可以被请求的地址&quot;</span>)  这里可以写* 代表所有的不同源的网站</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"跨域问题的第二种解决方式\"><a href=\"#跨域问题的第二种解决方式\" class=\"headerlink\" title=\"跨域问题的第二种解决方式\"></a>跨域问题的第二种解决方式</h3><blockquote>\n<p>问题剖析：</p>\n<p>​    跨域问题最根本产生的原因就是浏览器为了保护用户信息而设置了同源限制，只有同源的情况下才可以访问数据。同源限制也只是在浏览器中存在，在app等环境下运行就不会有同源限制，所以只需要想办法让请求发生不在浏览器中就可以。这里可以使用后台来请求外部资源，然后再返回给前端就可以解决跨域问题。</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 前端代码 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">请输入您要查询的关键字：<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">onblur</span>=<span class=\"string\">&quot;getInfo()&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">function</span> <span class=\"title function_\">getInfo</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">const</span> keywords = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&quot;input&quot;</span>).<span class=\"property\">value</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">const</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">//现在想要请求动态的资源,链接中的q参数是可变的，传入一个参数给后端</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    xhr.<span class=\"title function_\">open</span>(<span class=\"string\">&quot;get&quot;</span>, <span class=\"string\">&quot;/getInfo?keyWords=&quot;</span> + keywords);</span></span><br><span class=\"line\"><span class=\"language-javascript\">    xhr.<span class=\"title function_\">send</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\">    xhr.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">if</span> (xhr.<span class=\"property\">readyState</span> == <span class=\"number\">4</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&quot;span&quot;</span>).<span class=\"property\">innerText</span> = xhr.<span class=\"property\">responseText</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;express&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> web = <span class=\"title function_\">express</span>();</span><br><span class=\"line\">web.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">static</span>(<span class=\"string\">&quot;public&quot;</span>));</span><br><span class=\"line\"><span class=\"keyword\">const</span> https = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;https&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">web.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;/getInfo&quot;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> keywords = req.<span class=\"property\">query</span>.<span class=\"property\">keyWords</span>; <span class=\"comment\">// 这个keywords是一个汉字字符,拼接成的url是带有中文的，需要编码</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> url = <span class=\"string\">&quot;https://suggest.taobao.com/sug?code=utf-8&amp;q=&quot;</span> + keywords;</span><br><span class=\"line\">  <span class=\"comment\">//https请求不能解析带有中文的地址</span></span><br><span class=\"line\">  url = <span class=\"built_in\">encodeURI</span>(url);</span><br><span class=\"line\">  <span class=\"comment\">//在这里请求外部数据</span></span><br><span class=\"line\">  <span class=\"comment\">//请求淘宝的一个搜索关键字的资源</span></span><br><span class=\"line\">  https.<span class=\"title function_\">get</span>(url, <span class=\"keyword\">function</span> (<span class=\"params\">httpsRes</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bufferData = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">    httpsRes.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;data&quot;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">data</span>) &#123;</span><br><span class=\"line\">      bufferData += data;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    httpsRes.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;end&quot;</span>, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">//此时bufferData是一个buffer类型的数据</span></span><br><span class=\"line\">      bufferData = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(bufferData);</span><br><span class=\"line\">      <span class=\"comment\">//将拼接到的资源返回给前端</span></span><br><span class=\"line\">      res.<span class=\"title function_\">send</span>(bufferData);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">web.<span class=\"title function_\">listen</span>(<span class=\"string\">&quot;8080&quot;</span>, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;8080端口启动&quot;</span>);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"跨域问题的第三种解决方式\"><a href=\"#跨域问题的第三种解决方式\" class=\"headerlink\" title=\"跨域问题的第三种解决方式\"></a>跨域问题的第三种解决方式</h3><blockquote>\n<p>在以往的html中，也有请求外部资源的时候</p>\n</blockquote>\n<p>比如：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;地址&quot;</span> <span class=\"attr\">alt</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;地址&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;地址&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;地址&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>这些请求都可以请求成功，说明浏览器对于标签的外部资源请求是没有限制的，那么我们使用标签的形式进行请求跨域资源。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">function</span> <span class=\"title function_\">myCallBack</span>(<span class=\"params\">data</span>)&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(data);</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">//data里面存放了&#123;result:[Array(数据)]&#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://suggest.taobao.com/sug?code=utf-8&amp;q=%E8%BE%A3%E6%9D%A1&amp;callback=myCallBack&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n<blockquote>\n<p>在标签中进行跨域请求就不需要在接口中增加一行 res.set(“Access-Control-Allow-Origin”,”允许的对象”)<br>也不需要通过后台的方式进行跨域请求<br>只需要在标签中声明请求的目标资源地址就可以了，更加方便</p>\n<p>但是这种方式也有一个问题：<br>    怎么才能得到请求到的资源?<br>    这里需要给请求的资源地址后面添加一个callback 回调函数</p>\n</blockquote>\n<h3 id=\"跨域问题的第四个解决方式\"><a href=\"#跨域问题的第四个解决方式\" class=\"headerlink\" title=\"跨域问题的第四个解决方式\"></a>跨域问题的第四个解决方式</h3><blockquote>\n<p>搭配jquery中的dataType : jsonp解决跨域问题</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./jQuery.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  $.<span class=\"title function_\">ajax</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    url : <span class=\"string\">&quot;https://suggest.taobao.com/sug?code=utf-8&amp;q=%E8%BE%A3%E6%9D%A1&quot;</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    type : <span class=\"string\">&quot;get&quot;</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    dataType : <span class=\"string\">&quot;jsonP&quot;</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">success</span>(<span class=\"params\">res</span>)&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res.<span class=\"property\">result</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"跨域问题的第五个解决方式（vue）\"><a href=\"#跨域问题的第五个解决方式（vue）\" class=\"headerlink\" title=\"跨域问题的第五个解决方式（vue）\"></a>跨域问题的第五个解决方式（vue）</h3><p>下面的例子中创建一个home.vue组件：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div&gt;</span><br><span class=\"line\">    &lt;button @click=&quot;sendQuest&quot;&gt;发送跨域请求&lt;/button&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">// 这里需要安装axios模块 npm install axios</span><br><span class=\"line\">import axios from &quot;axios&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">export default &#123;</span><br><span class=\"line\">  name: &quot;home&quot;,</span><br><span class=\"line\">  methods: &#123;</span><br><span class=\"line\">    sendQuest() &#123;</span><br><span class=\"line\">      // 这里发生了跨域请求，请求不到数据。在config/index中进行配置</span><br><span class=\"line\">      // axios.get(&quot;https://suggest.taobao.com/sug?code=utf-8&amp;q=%E9%A6%99%E6%B0%B4&quot;)</span><br><span class=\"line\">      axios.get(&quot;/taoBao/sug?code=utf-8&amp;q=%E9%A6%99%E6%B0%B4&quot;)</span><br><span class=\"line\">      .then(function (data) &#123;</span><br><span class=\"line\">        // 请求成功</span><br><span class=\"line\">        console.log(data);</span><br><span class=\"line\">      &#125;,function (err) &#123;</span><br><span class=\"line\">        // 请求错误</span><br><span class=\"line\">        console.log(err);</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;style scoped&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\">&lt;!-- 当点击按钮的时候进行数据跨域请求， --&gt;</span><br></pre></td></tr></table></figure>\n\n<p>在config/index.js/dev/proxyTable中进行配置：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// proxy 代理  table 表  代理表 </span></span><br><span class=\"line\"><span class=\"comment\">// vue当中使用代理表进行跨域  （反向代理）</span></span><br><span class=\"line\"><span class=\"comment\">// 代理表跨域 是把url当中相同的部分截取出来</span></span><br><span class=\"line\"><span class=\"attr\">proxyTable</span>: &#123;</span><br><span class=\"line\">  <span class=\"string\">&#x27;/taoBao&#x27;</span>:&#123;</span><br><span class=\"line\">    <span class=\"comment\">// target目标</span></span><br><span class=\"line\">     <span class=\"attr\">target</span>:<span class=\"string\">&quot;https://suggest.taobao.com&quot;</span> , </span><br><span class=\"line\">    <span class=\"comment\">//  是否改变请求源</span></span><br><span class=\"line\">     <span class=\"attr\">changeOrigin</span>:<span class=\"literal\">true</span> , </span><br><span class=\"line\">    <span class=\"comment\">//  路径重写</span></span><br><span class=\"line\">     <span class=\"attr\">pathRewrite</span>:&#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;^/taoBao&#x27;</span>:<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>这样就可以实现vue中的跨域请求</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p>初始跨域的时候比较费解头疼，所以记录下来自己对跨域的理解。</p>","more":"<h2 id=\"什么是跨域？什么是浏览器同源政策？\"><a href=\"#什么是跨域？什么是浏览器同源政策？\" class=\"headerlink\" title=\"什么是跨域？什么是浏览器同源政策？\"></a>什么是跨域？什么是浏览器同源政策？</h2><blockquote>\n<p> 跨域：<br>​      浏览器可能存放用户信息，为了保护用户信息，禁止非同源请求来获取本网站的信息，为了解决同源限制所作出的行为叫做跨域。<br> 同源政策:<br>   两个ip地址，只有符合以下三个条件时才可以叫做同源，同源的地址之间互相访问不存在跨域问题；<br>   1.协议相同<br>   2.域名相同<br>   3.端口相同<br>   只要有一个条件不符合，就会发生跨域问题。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//www.baidu.com/a   //http:默认端口是8080</span></span><br><span class=\"line\"><span class=\"attr\">https</span>:<span class=\"comment\">//www.baidu/com/b  //https:默认端口是443</span></span><br><span class=\"line\">A.同源 B.不同源，协议不同 C.不同源，端口不同 &#123;D.不同源，协议和端口不同&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"跨域方式有哪些？\"><a href=\"#跨域方式有哪些？\" class=\"headerlink\" title=\"跨域方式有哪些？\"></a>跨域方式有哪些？</h2><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span><br><span class=\"line\">xhr.<span class=\"title function_\">open</span>(<span class=\"string\">&quot;get&quot;</span>,<span class=\"string\">&quot;https://suggest.taobao.com/sug?code=utf-8&amp;q=%E8%BE%A3%E6%9D%A1&quot;</span>);</span><br><span class=\"line\">xhr.<span class=\"title function_\">send</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">xhr.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(xhr.<span class=\"property\">readyState</span> == <span class=\"number\">4</span>)&#123;</span><br><span class=\"line\">         <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(xhr.<span class=\"property\">responseText</span>);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//这里会显示出现跨域阻止</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"跨域问题的第一种解决方式\"><a href=\"#跨域问题的第一种解决方式\" class=\"headerlink\" title=\"跨域问题的第一种解决方式\"></a>跨域问题的第一种解决方式</h3><p>这里以自己搭建的淘宝和京东后台模拟为例</p>\n<ul>\n<li>1.淘宝</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//淘宝----------前端js代码</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span><br><span class=\"line\"><span class=\"comment\">//这里默认的请求地址是 http://localhost:8080/getInfo</span></span><br><span class=\"line\"><span class=\"comment\">// xhr.open(&quot;get&quot;,&quot;/getInfo&quot;);</span></span><br><span class=\"line\"><span class=\"comment\">//现在想要请求京东的资源</span></span><br><span class=\"line\">xhr.<span class=\"title function_\">open</span>(<span class=\"string\">&quot;get&quot;</span>,<span class=\"string\">&quot;http://localhost:9000/getInfo&quot;</span>);</span><br><span class=\"line\">xhr.<span class=\"title function_\">send</span>();</span><br><span class=\"line\">xhr.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(xhr.<span class=\"property\">readyState</span> == <span class=\"number\">4</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&quot;span&quot;</span>).<span class=\"property\">innerText</span> = xhr.<span class=\"property\">responseText</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//淘宝----------后端js代码</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;express&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> web = <span class=\"title function_\">express</span>();</span><br><span class=\"line\">web.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">static</span>(<span class=\"string\">&quot;public&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">web.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;/getInfo&quot;</span>,<span class=\"keyword\">function</span> (<span class=\"params\">req,res</span>)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> goodList = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name : <span class=\"string\">&quot;雷神电脑&quot;</span>,</span><br><span class=\"line\">      price : <span class=\"number\">9999</span></span><br><span class=\"line\">    &#125;,&#123;</span><br><span class=\"line\">      name : <span class=\"string\">&quot;苹果手机&quot;</span>,</span><br><span class=\"line\">      price : <span class=\"number\">6999</span></span><br><span class=\"line\">    &#125;,&#123;</span><br><span class=\"line\">      name : <span class=\"string\">&quot;耐克球鞋&quot;</span>,</span><br><span class=\"line\">      price : <span class=\"number\">999</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(goodList);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">web.<span class=\"title function_\">listen</span>(<span class=\"string\">&quot;8080&quot;</span>,<span class=\"keyword\">function</span> (<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;8080端口启动&quot;</span>);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>京东</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//京东----------前端js代码 和淘宝的一致</span></span><br><span class=\"line\"><span class=\"comment\">//京东请求自己网站的数据，没有同源限制也就没有跨域问题</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span><br><span class=\"line\">  xhr.<span class=\"title function_\">open</span>(<span class=\"string\">&quot;get&quot;</span>,<span class=\"string\">&quot;/getInfo&quot;</span>);</span><br><span class=\"line\">  xhr.<span class=\"title function_\">send</span>();</span><br><span class=\"line\">  xhr.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(xhr.<span class=\"property\">readyState</span> == <span class=\"number\">4</span>)&#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(xhr.<span class=\"property\">responseText</span>);</span><br><span class=\"line\">      <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&quot;span&quot;</span>).<span class=\"property\">innerText</span> = xhr.<span class=\"property\">responseText</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//京东----------后端js代码</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;express&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> web = <span class=\"title function_\">express</span>();</span><br><span class=\"line\">web.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">static</span>(<span class=\"string\">&quot;public&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">web.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;/getInfo&quot;</span>,<span class=\"keyword\">function</span> (<span class=\"params\">req,res</span>)&#123;</span><br><span class=\"line\">  <span class=\"comment\">//-------------------------------------------------------- </span></span><br><span class=\"line\">  res.<span class=\"title function_\">set</span>(<span class=\"string\">&quot;Access-Control-Allow-Origin&quot;</span>,<span class=\"string\">&quot;http://localhost:8080&quot;</span>)</span><br><span class=\"line\">  <span class=\"comment\">//-------------------------------------------------------- </span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> bookList = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name : <span class=\"string\">&quot;海王&quot;</span>,</span><br><span class=\"line\">      price : <span class=\"number\">99.99</span></span><br><span class=\"line\">    &#125;,&#123;</span><br><span class=\"line\">      name : <span class=\"string\">&quot;海贼王&quot;</span>,</span><br><span class=\"line\">      price : <span class=\"number\">699</span></span><br><span class=\"line\">    &#125;,&#123;</span><br><span class=\"line\">      name : <span class=\"string\">&quot;海尔兄弟&quot;</span>,</span><br><span class=\"line\">      price : <span class=\"number\">111</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(bookList);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">web.<span class=\"title function_\">listen</span>(<span class=\"string\">&quot;9000&quot;</span>,<span class=\"keyword\">function</span> (<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;9000端口启动&quot;</span>);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>在这里，淘宝网站想要请求京东网站的资源时，发生了跨域请求。如果没有解决这个问题是没法请求到京东的数据的。</p>\n<p>这里就有了第一种解决的方案，在京东的后端接口中声明，</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">res.<span class=\"title function_\">set</span>(<span class=\"string\">&quot;Access-Control-Allow-Origin&quot;</span>,<span class=\"string\">&quot;希望可以被请求的地址&quot;</span>)  </span><br><span class=\"line\"><span class=\"comment\">//这里可以写* 代表所有的不同源的网站</span></span><br></pre></td></tr></table></figure>\n</blockquote>\n<p>总结：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">这里请求京东的资源会发生跨域请求,由于浏览器的同源限制，会拦截跨域请求</span><br><span class=\"line\">*  控制台输出：</span><br><span class=\"line\">*    已拦截跨源请求：同源策略禁止读取位于 <span class=\"attr\">http</span>:<span class=\"comment\">//localhost:9000/getInfo 的远程资源。</span></span><br><span class=\"line\">*    （原因：<span class=\"variable constant_\">CORS</span> 头缺少 <span class=\"string\">&#x27;Access-Control-Allow-Origin&#x27;</span>）。</span><br><span class=\"line\">*  只需要在对应的接口中设置：</span><br><span class=\"line\">*    res.<span class=\"title function_\">set</span>(<span class=\"string\">&quot;Access-Control-Allow-Origin&quot;</span>,<span class=\"string\">&quot;希望可以被请求的地址&quot;</span>)  这里可以写* 代表所有的不同源的网站</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"跨域问题的第二种解决方式\"><a href=\"#跨域问题的第二种解决方式\" class=\"headerlink\" title=\"跨域问题的第二种解决方式\"></a>跨域问题的第二种解决方式</h3><blockquote>\n<p>问题剖析：</p>\n<p>​    跨域问题最根本产生的原因就是浏览器为了保护用户信息而设置了同源限制，只有同源的情况下才可以访问数据。同源限制也只是在浏览器中存在，在app等环境下运行就不会有同源限制，所以只需要想办法让请求发生不在浏览器中就可以。这里可以使用后台来请求外部资源，然后再返回给前端就可以解决跨域问题。</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 前端代码 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">请输入您要查询的关键字：<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">onblur</span>=<span class=\"string\">&quot;getInfo()&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">function</span> <span class=\"title function_\">getInfo</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">const</span> keywords = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&quot;input&quot;</span>).<span class=\"property\">value</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">const</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">//现在想要请求动态的资源,链接中的q参数是可变的，传入一个参数给后端</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    xhr.<span class=\"title function_\">open</span>(<span class=\"string\">&quot;get&quot;</span>, <span class=\"string\">&quot;/getInfo?keyWords=&quot;</span> + keywords);</span></span><br><span class=\"line\"><span class=\"language-javascript\">    xhr.<span class=\"title function_\">send</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\">    xhr.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">if</span> (xhr.<span class=\"property\">readyState</span> == <span class=\"number\">4</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&quot;span&quot;</span>).<span class=\"property\">innerText</span> = xhr.<span class=\"property\">responseText</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;express&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> web = <span class=\"title function_\">express</span>();</span><br><span class=\"line\">web.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">static</span>(<span class=\"string\">&quot;public&quot;</span>));</span><br><span class=\"line\"><span class=\"keyword\">const</span> https = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;https&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">web.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;/getInfo&quot;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> keywords = req.<span class=\"property\">query</span>.<span class=\"property\">keyWords</span>; <span class=\"comment\">// 这个keywords是一个汉字字符,拼接成的url是带有中文的，需要编码</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> url = <span class=\"string\">&quot;https://suggest.taobao.com/sug?code=utf-8&amp;q=&quot;</span> + keywords;</span><br><span class=\"line\">  <span class=\"comment\">//https请求不能解析带有中文的地址</span></span><br><span class=\"line\">  url = <span class=\"built_in\">encodeURI</span>(url);</span><br><span class=\"line\">  <span class=\"comment\">//在这里请求外部数据</span></span><br><span class=\"line\">  <span class=\"comment\">//请求淘宝的一个搜索关键字的资源</span></span><br><span class=\"line\">  https.<span class=\"title function_\">get</span>(url, <span class=\"keyword\">function</span> (<span class=\"params\">httpsRes</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bufferData = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">    httpsRes.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;data&quot;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">data</span>) &#123;</span><br><span class=\"line\">      bufferData += data;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    httpsRes.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;end&quot;</span>, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">//此时bufferData是一个buffer类型的数据</span></span><br><span class=\"line\">      bufferData = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(bufferData);</span><br><span class=\"line\">      <span class=\"comment\">//将拼接到的资源返回给前端</span></span><br><span class=\"line\">      res.<span class=\"title function_\">send</span>(bufferData);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">web.<span class=\"title function_\">listen</span>(<span class=\"string\">&quot;8080&quot;</span>, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;8080端口启动&quot;</span>);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"跨域问题的第三种解决方式\"><a href=\"#跨域问题的第三种解决方式\" class=\"headerlink\" title=\"跨域问题的第三种解决方式\"></a>跨域问题的第三种解决方式</h3><blockquote>\n<p>在以往的html中，也有请求外部资源的时候</p>\n</blockquote>\n<p>比如：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;地址&quot;</span> <span class=\"attr\">alt</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;地址&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;地址&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;地址&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>这些请求都可以请求成功，说明浏览器对于标签的外部资源请求是没有限制的，那么我们使用标签的形式进行请求跨域资源。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">function</span> <span class=\"title function_\">myCallBack</span>(<span class=\"params\">data</span>)&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(data);</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">//data里面存放了&#123;result:[Array(数据)]&#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://suggest.taobao.com/sug?code=utf-8&amp;q=%E8%BE%A3%E6%9D%A1&amp;callback=myCallBack&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n<blockquote>\n<p>在标签中进行跨域请求就不需要在接口中增加一行 res.set(“Access-Control-Allow-Origin”,”允许的对象”)<br>也不需要通过后台的方式进行跨域请求<br>只需要在标签中声明请求的目标资源地址就可以了，更加方便</p>\n<p>但是这种方式也有一个问题：<br>    怎么才能得到请求到的资源?<br>    这里需要给请求的资源地址后面添加一个callback 回调函数</p>\n</blockquote>\n<h3 id=\"跨域问题的第四个解决方式\"><a href=\"#跨域问题的第四个解决方式\" class=\"headerlink\" title=\"跨域问题的第四个解决方式\"></a>跨域问题的第四个解决方式</h3><blockquote>\n<p>搭配jquery中的dataType : jsonp解决跨域问题</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./jQuery.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  $.<span class=\"title function_\">ajax</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    url : <span class=\"string\">&quot;https://suggest.taobao.com/sug?code=utf-8&amp;q=%E8%BE%A3%E6%9D%A1&quot;</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    type : <span class=\"string\">&quot;get&quot;</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    dataType : <span class=\"string\">&quot;jsonP&quot;</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">success</span>(<span class=\"params\">res</span>)&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res.<span class=\"property\">result</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"跨域问题的第五个解决方式（vue）\"><a href=\"#跨域问题的第五个解决方式（vue）\" class=\"headerlink\" title=\"跨域问题的第五个解决方式（vue）\"></a>跨域问题的第五个解决方式（vue）</h3><p>下面的例子中创建一个home.vue组件：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div&gt;</span><br><span class=\"line\">    &lt;button @click=&quot;sendQuest&quot;&gt;发送跨域请求&lt;/button&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">// 这里需要安装axios模块 npm install axios</span><br><span class=\"line\">import axios from &quot;axios&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">export default &#123;</span><br><span class=\"line\">  name: &quot;home&quot;,</span><br><span class=\"line\">  methods: &#123;</span><br><span class=\"line\">    sendQuest() &#123;</span><br><span class=\"line\">      // 这里发生了跨域请求，请求不到数据。在config/index中进行配置</span><br><span class=\"line\">      // axios.get(&quot;https://suggest.taobao.com/sug?code=utf-8&amp;q=%E9%A6%99%E6%B0%B4&quot;)</span><br><span class=\"line\">      axios.get(&quot;/taoBao/sug?code=utf-8&amp;q=%E9%A6%99%E6%B0%B4&quot;)</span><br><span class=\"line\">      .then(function (data) &#123;</span><br><span class=\"line\">        // 请求成功</span><br><span class=\"line\">        console.log(data);</span><br><span class=\"line\">      &#125;,function (err) &#123;</span><br><span class=\"line\">        // 请求错误</span><br><span class=\"line\">        console.log(err);</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;style scoped&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\">&lt;!-- 当点击按钮的时候进行数据跨域请求， --&gt;</span><br></pre></td></tr></table></figure>\n\n<p>在config/index.js/dev/proxyTable中进行配置：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// proxy 代理  table 表  代理表 </span></span><br><span class=\"line\"><span class=\"comment\">// vue当中使用代理表进行跨域  （反向代理）</span></span><br><span class=\"line\"><span class=\"comment\">// 代理表跨域 是把url当中相同的部分截取出来</span></span><br><span class=\"line\"><span class=\"attr\">proxyTable</span>: &#123;</span><br><span class=\"line\">  <span class=\"string\">&#x27;/taoBao&#x27;</span>:&#123;</span><br><span class=\"line\">    <span class=\"comment\">// target目标</span></span><br><span class=\"line\">     <span class=\"attr\">target</span>:<span class=\"string\">&quot;https://suggest.taobao.com&quot;</span> , </span><br><span class=\"line\">    <span class=\"comment\">//  是否改变请求源</span></span><br><span class=\"line\">     <span class=\"attr\">changeOrigin</span>:<span class=\"literal\">true</span> , </span><br><span class=\"line\">    <span class=\"comment\">//  路径重写</span></span><br><span class=\"line\">     <span class=\"attr\">pathRewrite</span>:&#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;^/taoBao&#x27;</span>:<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>这样就可以实现vue中的跨域请求</p>\n</blockquote>"},{"title":"Hello World","abbrlink":"3eeb","date":"2021-06-22T11:41:45.000Z","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","source":"_posts/hello-world.md","raw":"---\ntitle: Hello World\nabbrlink: 3eeb\ndate: 2021-06-22 19:41:45\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","slug":"hello-world","published":1,"updated":"2022-08-26T01:42:59.881Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl79tdvvd00095d9k7zuy1uon","content":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n"},{"title":"前端常见面试题积累","abbrlink":"f36c","date":"2021-10-05T06:36:25.000Z","copyright":true,"top":2,"_content":"\n分享个人面试过程中常见的问题，也包含自己对问题的理解。不断完善.....\n<!-- more -->\n\n<!-- ########################## 1.在js中当对象使用new关键字的时候，程序内部都做了什么？ ########################## -->\n### new关键字的原理\n当对象使用new关键字创建的时候，程序内部都做了什么？\n&nbsp;&nbsp;&nbsp;1.开辟内存地址，里面放置一个空的对象\n&nbsp;&nbsp;&nbsp;2.this指向了空的对象\n&nbsp;&nbsp;&nbsp;3.构造函数的参数给空的对象赋值\n&nbsp;&nbsp;&nbsp;4.将赋值后的对象返回给外面使用\n***\n<!-- ########################## 1.end ########################## -->\n\n<!-- ########################## 2.跨域问题 ########################## -->\n### 跨域的产生原因和如何解决？\n关于跨域，我想要整理一篇独立的文章去解释的理解，这里直接链接到 [关于跨域，我想说.....](/post/9ff3.html)\n<!-- *** -->\n\n","source":"_posts/前端常见面试题积累.md","raw":"---\ntitle: 前端常见面试题积累\nabbrlink: f36c\ndate: 2021-10-05 14:36:25\ntags:\n  - 前端开发\n  - 知识积累\ncategories: 前端面试题\ncopyright: true\ntop: 2\n---\n\n分享个人面试过程中常见的问题，也包含自己对问题的理解。不断完善.....\n<!-- more -->\n\n<!-- ########################## 1.在js中当对象使用new关键字的时候，程序内部都做了什么？ ########################## -->\n### new关键字的原理\n当对象使用new关键字创建的时候，程序内部都做了什么？\n&nbsp;&nbsp;&nbsp;1.开辟内存地址，里面放置一个空的对象\n&nbsp;&nbsp;&nbsp;2.this指向了空的对象\n&nbsp;&nbsp;&nbsp;3.构造函数的参数给空的对象赋值\n&nbsp;&nbsp;&nbsp;4.将赋值后的对象返回给外面使用\n***\n<!-- ########################## 1.end ########################## -->\n\n<!-- ########################## 2.跨域问题 ########################## -->\n### 跨域的产生原因和如何解决？\n关于跨域，我想要整理一篇独立的文章去解释的理解，这里直接链接到 [关于跨域，我想说.....](/post/9ff3.html)\n<!-- *** -->\n\n","slug":"前端常见面试题积累","published":1,"updated":"2022-08-26T01:42:59.882Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl79tdvvd000a5d9k12881hp6","content":"<p>分享个人面试过程中常见的问题，也包含自己对问题的理解。不断完善…..</p>\n<span id=\"more\"></span>\n\n<!-- ########################## 1.在js中当对象使用new关键字的时候，程序内部都做了什么？ ########################## -->\n<h3 id=\"new关键字的原理\"><a href=\"#new关键字的原理\" class=\"headerlink\" title=\"new关键字的原理\"></a>new关键字的原理</h3><p>当对象使用new关键字创建的时候，程序内部都做了什么？<br>&nbsp;&nbsp;&nbsp;1.开辟内存地址，里面放置一个空的对象<br>&nbsp;&nbsp;&nbsp;2.this指向了空的对象<br>&nbsp;&nbsp;&nbsp;3.构造函数的参数给空的对象赋值<br>&nbsp;&nbsp;&nbsp;4.将赋值后的对象返回给外面使用</p>\n<hr>\n<!-- ########################## 1.end ########################## -->\n\n<!-- ########################## 2.跨域问题 ########################## -->\n<h3 id=\"跨域的产生原因和如何解决？\"><a href=\"#跨域的产生原因和如何解决？\" class=\"headerlink\" title=\"跨域的产生原因和如何解决？\"></a>跨域的产生原因和如何解决？</h3><p>关于跨域，我想要整理一篇独立的文章去解释的理解，这里直接链接到 <a href=\"/post/9ff3.html\">关于跨域，我想说…..</a></p>\n<!-- *** -->\n\n","site":{"data":{}},"excerpt":"<p>分享个人面试过程中常见的问题，也包含自己对问题的理解。不断完善…..</p>","more":"<!-- ########################## 1.在js中当对象使用new关键字的时候，程序内部都做了什么？ ########################## -->\n<h3 id=\"new关键字的原理\"><a href=\"#new关键字的原理\" class=\"headerlink\" title=\"new关键字的原理\"></a>new关键字的原理</h3><p>当对象使用new关键字创建的时候，程序内部都做了什么？<br>&nbsp;&nbsp;&nbsp;1.开辟内存地址，里面放置一个空的对象<br>&nbsp;&nbsp;&nbsp;2.this指向了空的对象<br>&nbsp;&nbsp;&nbsp;3.构造函数的参数给空的对象赋值<br>&nbsp;&nbsp;&nbsp;4.将赋值后的对象返回给外面使用</p>\n<hr>\n<!-- ########################## 1.end ########################## -->\n\n<!-- ########################## 2.跨域问题 ########################## -->\n<h3 id=\"跨域的产生原因和如何解决？\"><a href=\"#跨域的产生原因和如何解决？\" class=\"headerlink\" title=\"跨域的产生原因和如何解决？\"></a>跨域的产生原因和如何解决？</h3><p>关于跨域，我想要整理一篇独立的文章去解释的理解，这里直接链接到 <a href=\"/post/9ff3.html\">关于跨域，我想说…..</a></p>\n<!-- *** -->"},{"title":"国密4加密算法JS版本","abbrlink":"0","copyright":true,"_content":"\n国密 4 加密算法，网上多是 JAVA 版本，偶然见到有一个 TS 版本的。为了和后端保持一致的加密算法，需要在前端处理一些加密信息，所以改写为 JS 版本，备份以防之后丢失。\n\n<!-- more -->\n\n```js\n/**\n * @描述: 国密4加密算法\n * @Author: Jingtaooo\n * @Date: 2022/3/31 11:26 上午\n * @FilePath: /src/utils/system/SM4Util.js\n */\n\nimport base64js from 'base64-js'; // 用base64-js模块包代替下面的base64js方法，减少代码量\nfunction SM4_Context() {\n  this.mode = 1;\n  this.isPadding = true;\n  this.sk = new Array(32);\n}\n\nconst stringToByte = function (str) {\n  var bytes = new Array();\n  var len, c;\n  len = str.length;\n  for (var i = 0; i < len; i++) {\n    c = str.charCodeAt(i);\n    if (c >= 0x010000 && c <= 0x10ffff) {\n      bytes.push(((c >> 18) & 0x07) | 0xf0);\n      bytes.push(((c >> 12) & 0x3f) | 0x80);\n      bytes.push(((c >> 6) & 0x3f) | 0x80);\n      bytes.push((c & 0x3f) | 0x80);\n    } else if (c >= 0x000800 && c <= 0x00ffff) {\n      bytes.push(((c >> 12) & 0x0f) | 0xe0);\n      bytes.push(((c >> 6) & 0x3f) | 0x80);\n      bytes.push((c & 0x3f) | 0x80);\n    } else if (c >= 0x000080 && c <= 0x0007ff) {\n      bytes.push(((c >> 6) & 0x1f) | 0xc0);\n      bytes.push((c & 0x3f) | 0x80);\n    } else {\n      bytes.push(c & 0xff);\n    }\n  }\n  return bytes;\n};\n\nfunction SM4() {\n  this.SM4_ENCRYPT = 1;\n  this.SM4_DECRYPT = 0;\n\n  var SboxTable = [\n    0xd6, 0x90, 0xe9, 0xfe, 0xcc, 0xe1, 0x3d, 0xb7, 0x16, 0xb6, 0x14, 0xc2, 0x28, 0xfb, 0x2c, 0x05, 0x2b, 0x67, 0x9a, 0x76, 0x2a, 0xbe, 0x04, 0xc3, 0xaa, 0x44, 0x13, 0x26, 0x49,\n    0x86, 0x06, 0x99, 0x9c, 0x42, 0x50, 0xf4, 0x91, 0xef, 0x98, 0x7a, 0x33, 0x54, 0x0b, 0x43, 0xed, 0xcf, 0xac, 0x62, 0xe4, 0xb3, 0x1c, 0xa9, 0xc9, 0x08, 0xe8, 0x95, 0x80, 0xdf,\n    0x94, 0xfa, 0x75, 0x8f, 0x3f, 0xa6, 0x47, 0x07, 0xa7, 0xfc, 0xf3, 0x73, 0x17, 0xba, 0x83, 0x59, 0x3c, 0x19, 0xe6, 0x85, 0x4f, 0xa8, 0x68, 0x6b, 0x81, 0xb2, 0x71, 0x64, 0xda,\n    0x8b, 0xf8, 0xeb, 0x0f, 0x4b, 0x70, 0x56, 0x9d, 0x35, 0x1e, 0x24, 0x0e, 0x5e, 0x63, 0x58, 0xd1, 0xa2, 0x25, 0x22, 0x7c, 0x3b, 0x01, 0x21, 0x78, 0x87, 0xd4, 0x00, 0x46, 0x57,\n    0x9f, 0xd3, 0x27, 0x52, 0x4c, 0x36, 0x02, 0xe7, 0xa0, 0xc4, 0xc8, 0x9e, 0xea, 0xbf, 0x8a, 0xd2, 0x40, 0xc7, 0x38, 0xb5, 0xa3, 0xf7, 0xf2, 0xce, 0xf9, 0x61, 0x15, 0xa1, 0xe0,\n    0xae, 0x5d, 0xa4, 0x9b, 0x34, 0x1a, 0x55, 0xad, 0x93, 0x32, 0x30, 0xf5, 0x8c, 0xb1, 0xe3, 0x1d, 0xf6, 0xe2, 0x2e, 0x82, 0x66, 0xca, 0x60, 0xc0, 0x29, 0x23, 0xab, 0x0d, 0x53,\n    0x4e, 0x6f, 0xd5, 0xdb, 0x37, 0x45, 0xde, 0xfd, 0x8e, 0x2f, 0x03, 0xff, 0x6a, 0x72, 0x6d, 0x6c, 0x5b, 0x51, 0x8d, 0x1b, 0xaf, 0x92, 0xbb, 0xdd, 0xbc, 0x7f, 0x11, 0xd9, 0x5c,\n    0x41, 0x1f, 0x10, 0x5a, 0xd8, 0x0a, 0xc1, 0x31, 0x88, 0xa5, 0xcd, 0x7b, 0xbd, 0x2d, 0x74, 0xd0, 0x12, 0xb8, 0xe5, 0xb4, 0xb0, 0x89, 0x69, 0x97, 0x4a, 0x0c, 0x96, 0x77, 0x7e,\n    0x65, 0xb9, 0xf1, 0x09, 0xc5, 0x6e, 0xc6, 0x84, 0x18, 0xf0, 0x7d, 0xec, 0x3a, 0xdc, 0x4d, 0x20, 0x79, 0xee, 0x5f, 0x3e, 0xd7, 0xcb, 0x39, 0x48,\n  ];\n\n  var FK = [0xa3b1bac6, 0x56aa3350, 0x677d9197, 0xb27022dc];\n\n  var CK = [\n    0x00070e15, 0x1c232a31, 0x383f464d, 0x545b6269, 0x70777e85, 0x8c939aa1, 0xa8afb6bd, 0xc4cbd2d9, 0xe0e7eef5, 0xfc030a11, 0x181f262d, 0x343b4249, 0x50575e65, 0x6c737a81,\n    0x888f969d, 0xa4abb2b9, 0xc0c7ced5, 0xdce3eaf1, 0xf8ff060d, 0x141b2229, 0x30373e45, 0x4c535a61, 0x686f767d, 0x848b9299, 0xa0a7aeb5, 0xbcc3cad1, 0xd8dfe6ed, 0xf4fb0209,\n    0x10171e25, 0x2c333a41, 0x484f565d, 0x646b7279,\n  ];\n\n  this.GET_ULONG_BE = function (b, i) {\n    return ((b[i] & 0xff) << 24) | ((b[i + 1] & 0xff) << 16) | ((b[i + 2] & 0xff) << 8) | (b[i + 3] & 0xff & 0xffffffff);\n  };\n\n  this.PUT_ULONG_BE = function (n, b, i) {\n    var t1 = 0xff & (n >> 24);\n    var t2 = 0xff & (n >> 16);\n    var t3 = 0xff & (n >> 8);\n    var t4 = 0xff & n;\n    b[i] = t1 > 128 ? t1 - 256 : t1;\n    b[i + 1] = t2 > 128 ? t2 - 256 : t2;\n    b[i + 2] = t3 > 128 ? t3 - 256 : t3;\n    b[i + 3] = t4 > 128 ? t4 - 256 : t4;\n  };\n\n  this.SHL = function (x, n) {\n    return (x & 0xffffffff) << n;\n  };\n\n  this.ROTL = function (x, n) {\n    var s = this.SHL(x, n);\n    var ss = x >> (32 - n);\n    return this.SHL(x, n) | (x >> (32 - n));\n  };\n\n  this.sm4Lt = function (ka) {\n    var bb = 0;\n    var c = 0;\n    var a = new Array(4);\n    var b = new Array(4);\n    this.PUT_ULONG_BE(ka, a, 0);\n    b[0] = this.sm4Sbox(a[0]);\n    b[1] = this.sm4Sbox(a[1]);\n    b[2] = this.sm4Sbox(a[2]);\n    b[3] = this.sm4Sbox(a[3]);\n    bb = this.GET_ULONG_BE(b, 0);\n    c = bb ^ this.ROTL(bb, 2) ^ this.ROTL(bb, 10) ^ this.ROTL(bb, 18) ^ this.ROTL(bb, 24);\n    return c;\n  };\n\n  this.sm4F = function (x0, x1, x2, x3, rk) {\n    return x0 ^ this.sm4Lt(x1 ^ x2 ^ x3 ^ rk);\n  };\n\n  this.sm4CalciRK = function (ka) {\n    var bb = 0;\n    var rk = 0;\n    var a = new Array(4);\n    var b = new Array(4);\n    this.PUT_ULONG_BE(ka, a, 0);\n    b[0] = this.sm4Sbox(a[0]);\n    b[1] = this.sm4Sbox(a[1]);\n    b[2] = this.sm4Sbox(a[2]);\n    b[3] = this.sm4Sbox(a[3]);\n    bb = this.GET_ULONG_BE(b, 0);\n    rk = bb ^ this.ROTL(bb, 13) ^ this.ROTL(bb, 23);\n    return rk;\n  };\n\n  this.sm4Sbox = function (inch) {\n    var i = inch & 0xff;\n    var retVal = SboxTable[i];\n    return retVal > 128 ? retVal - 256 : retVal;\n  };\n\n  this.sm4_setkey_enc = function (ctx, key) {\n    if (ctx == null) {\n      alert('ctx is null!');\n      return false;\n    }\n    if (key == null || key.length != 16) {\n      alert('key error!');\n      return false;\n    }\n    ctx.mode = this.SM4_ENCRYPT;\n    this.sm4_setkey(ctx.sk, key);\n  };\n\n  this.sm4_setkey = function (SK, key) {\n    var MK = new Array(4);\n    var k = new Array(36);\n    var i = 0;\n    MK[0] = this.GET_ULONG_BE(key, 0);\n    MK[1] = this.GET_ULONG_BE(key, 4);\n    MK[2] = this.GET_ULONG_BE(key, 8);\n    MK[3] = this.GET_ULONG_BE(key, 12);\n    k[0] = MK[0] ^ FK[0];\n    k[1] = MK[1] ^ FK[1];\n    k[2] = MK[2] ^ FK[2];\n    k[3] = MK[3] ^ FK[3];\n    for (var i = 0; i < 32; i++) {\n      k[i + 4] = k[i] ^ this.sm4CalciRK(k[i + 1] ^ k[i + 2] ^ k[i + 3] ^ CK[i]);\n      SK[i] = k[i + 4];\n    }\n  };\n  this.padding = function (input, mode) {\n    if (input == null) {\n      return null;\n    }\n    var ret = null;\n    if (mode == this.SM4_ENCRYPT) {\n      var p = parseInt(16 - (input.length % 16));\n      ret = input.slice(0);\n      for (var i = 0; i < p; i++) {\n        ret[input.length + i] = p;\n      }\n    } else {\n      var p = input[input.length - 1];\n      ret = input.slice(0, input.length - p);\n    }\n    return ret;\n  };\n  this.sm4_one_round = function (sk, input, output) {\n    var i = 0;\n    var ulbuf = new Array(36);\n    ulbuf[0] = this.GET_ULONG_BE(input, 0);\n    ulbuf[1] = this.GET_ULONG_BE(input, 4);\n    ulbuf[2] = this.GET_ULONG_BE(input, 8);\n    ulbuf[3] = this.GET_ULONG_BE(input, 12);\n    while (i < 32) {\n      ulbuf[i + 4] = this.sm4F(ulbuf[i], ulbuf[i + 1], ulbuf[i + 2], ulbuf[i + 3], sk[i]);\n      i++;\n    }\n    this.PUT_ULONG_BE(ulbuf[35], output, 0);\n    this.PUT_ULONG_BE(ulbuf[34], output, 4);\n    this.PUT_ULONG_BE(ulbuf[33], output, 8);\n    this.PUT_ULONG_BE(ulbuf[32], output, 12);\n  };\n\n  this.sm4_crypt_ecb = function (ctx, input) {\n    if (input == null) {\n      alert('input is null!');\n    }\n    if (ctx.isPadding && ctx.mode == this.SM4_ENCRYPT) {\n      input = this.padding(input, this.SM4_ENCRYPT);\n    }\n\n    var i = 0;\n    var length = input.length;\n    var bous = new Array();\n    for (; length > 0; length -= 16) {\n      var out = new Array(16);\n      var ins = input.slice(i * 16, 16 * (i + 1));\n      this.sm4_one_round(ctx.sk, ins, out);\n      bous = bous.concat(out);\n      i++;\n    }\n\n    var output = bous;\n    if (ctx.isPadding && ctx.mode == this.SM4_DECRYPT) {\n      output = this.padding(output, this.SM4_DECRYPT);\n    }\n    for (var i = 0; i < output.length; i++) {\n      if (output[i] < 0) {\n        output[i] = output[i] + 256;\n      }\n    }\n    return output;\n  };\n\n  this.sm4_crypt_cbc = function (ctx, iv, input) {\n    if (iv == null || iv.length != 16) {\n      alert('iv error!');\n    }\n\n    if (input == null) {\n      alert('input is null!');\n    }\n\n    if (ctx.isPadding && ctx.mode == this.SM4_ENCRYPT) {\n      input = this.padding(input, this.SM4_ENCRYPT);\n    }\n\n    var i = 0;\n    var length = input.length;\n    var bous = new Array();\n    if (ctx.mode == this.SM4_ENCRYPT) {\n      var k = 0;\n      for (; length > 0; length -= 16) {\n        var out = new Array(16);\n        var out1 = new Array(16);\n        var ins = input.slice(k * 16, 16 * (k + 1));\n\n        for (i = 0; i < 16; i++) {\n          out[i] = ins[i] ^ iv[i];\n        }\n        this.sm4_one_round(ctx.sk, out, out1);\n        iv = out1.slice(0, 16);\n        bous = bous.concat(out1);\n        k++;\n      }\n    } else {\n      var temp = [];\n      var k = 0;\n      for (; length > 0; length -= 16) {\n        var out = new Array(16);\n        var out1 = new Array(16);\n        var ins = input.slice(k * 16, 16 * (k + 1));\n        temp = ins.slice(0, 16);\n        sm4_one_round(ctx.sk, ins, out);\n        for (i = 0; i < 16; i++) {\n          out1[i] = out[i] ^ iv[i];\n        }\n        iv = temp.slice(0, 16);\n        bous = bous.concat(out1);\n        k++;\n      }\n    }\n\n    var output = bous;\n    if (ctx.isPadding && ctx.mode == this.SM4_DECRYPT) {\n      output = this.padding(output, this.SM4_DECRYPT);\n    }\n\n    for (var i = 0; i < output.length; i++) {\n      if (output[i] < 0) {\n        output[i] = output[i] + 256;\n      }\n    }\n    return output;\n  };\n}\n\nconst secretKey = 'w7bqTgHGZH5PD0cy';\n// const iv = '';\n// const hexString = false;\n\nexport function encryptData_ECB(plainText) {\n  try {\n    var sm4 = new SM4();\n    var ctx = new SM4_Context();\n    ctx.isPadding = true;\n    ctx.mode = sm4.SM4_ENCRYPT;\n    var keyBytes = stringToByte(secretKey);\n    sm4.sm4_setkey_enc(ctx, keyBytes);\n    var encrypted = sm4.sm4_crypt_ecb(ctx, stringToByte(plainText));\n    var cipherText = base64js.fromByteArray(encrypted);\n    if (cipherText != null && cipherText.trim().length > 0) {\n      cipherText.replace(/(\\s*|\\t|\\r|\\n)/g, '');\n    }\n    return cipherText;\n  } catch (e) {\n    console.error(e);\n    return null;\n  }\n}\n\n/**\n * base64js\n */\n/**\n * base64js\n * base64js.toByteArray(d.input)\n * base64js.fromByteArray(c);\n */\n//  (function(r) {\n//   if (typeof exports === \"object\" && typeof module !== \"undefined\") {\n//     module.exports = r();\n//   } else {\n//     if (typeof define === \"function\" && define.amd) {\n//       define([], r);\n//     } else {\n//       var e;\n//       if (typeof window !== \"undefined\") {\n//         e = window;\n//       } else {\n//         if (typeof global !== \"undefined\") {\n//           e = global;\n//         } else {\n//           if (typeof self !== \"undefined\") {\n//             e = self;\n//           } else {\n//             e = this;\n//           }\n//         }\n//       }\n//       e.base64js = r();\n//     }\n//   }\n// })(function() {\n//   var r, e, t;\n//   return (function r(e, t, n) {\n//     function o(i, a) {\n//       if (!t[i]) {\n//         if (!e[i]) {\n//           var u = typeof require == \"function\" && require;\n//           if (!a && u) {\n//             return u(i, !0);\n//           }\n//           if (f) {\n//             return f(i, !0);\n//           }\n//           var d = new Error(\"Cannot find module '\" + i + \"'\");\n//           throw ((d.code = \"MODULE_NOT_FOUND\"), d);\n//         }\n//         var c = (t[i] = { exports: {} });\n//         e[i][0].call(\n//           c.exports,\n//           function(r) {\n//             var t = e[i][1][r];\n//             return o(t ? t : r);\n//           },\n//           c,\n//           c.exports,\n//           r,\n//           e,\n//           t,\n//           n\n//         );\n//       }\n//       return t[i].exports;\n//     }\n//     var f = typeof require == \"function\" && require;\n//     for (var i = 0; i < n.length; i++) {\n//       o(n[i]);\n//     }\n//     return o;\n//   })(\n//     {\n//       \"/\": [\n//         function(r, e, t) {\n//           t.byteLength = c;\n//           t.toByteArray = v;\n//           t.fromByteArray = s;\n//           var n = [];\n//           var o = [];\n//           var f = typeof Uint8Array !== \"undefined\" ? Uint8Array : Array;\n//           var i =\n//             \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n//           for (var a = 0, u = i.length; a < u; ++a) {\n//             n[a] = i[a];\n//             o[i.charCodeAt(a)] = a;\n//           }\n//           o[\"-\".charCodeAt(0)] = 62;\n//           o[\"_\".charCodeAt(0)] = 63;\n//           function d(r) {\n//             var e = r.length;\n//             if (e % 4 > 0) {\n//               throw new Error(\"Invalid string. Length must be a multiple of 4\");\n//             }\n//             return r[e - 2] === \"=\" ? 2 : r[e - 1] === \"=\" ? 1 : 0;\n//           }\n//           function c(r) {\n//             return (r.length * 3) / 4 - d(r);\n//           }\n//           function v(r) {\n//             var e, t, n, i, a;\n//             var u = r.length;\n//             i = d(r);\n//             a = new f((u * 3) / 4 - i);\n//             t = i > 0 ? u - 4 : u;\n//             var c = 0;\n//             for (e = 0; e < t; e += 4) {\n//               n =\n//                 (o[r.charCodeAt(e)] << 18) |\n//                 (o[r.charCodeAt(e + 1)] << 12) |\n//                 (o[r.charCodeAt(e + 2)] << 6) |\n//                 o[r.charCodeAt(e + 3)];\n//               a[c++] = (n >> 16) & 255;\n//               a[c++] = (n >> 8) & 255;\n//               a[c++] = n & 255;\n//             }\n//             if (i === 2) {\n//               n = (o[r.charCodeAt(e)] << 2) | (o[r.charCodeAt(e + 1)] >> 4);\n//               a[c++] = n & 255;\n//             } else {\n//               if (i === 1) {\n//                 n =\n//                   (o[r.charCodeAt(e)] << 10) |\n//                   (o[r.charCodeAt(e + 1)] << 4) |\n//                   (o[r.charCodeAt(e + 2)] >> 2);\n//                 a[c++] = (n >> 8) & 255;\n//                 a[c++] = n & 255;\n//               }\n//             }\n//             return a;\n//           }\n//           function l(r) {\n//             return (\n//               n[(r >> 18) & 63] +\n//               n[(r >> 12) & 63] +\n//               n[(r >> 6) & 63] +\n//               n[r & 63]\n//             );\n//           }\n//           function h(r, e, t) {\n//             var n;\n//             var o = [];\n//             for (var f = e; f < t; f += 3) {\n//               n = (r[f] << 16) + (r[f + 1] << 8) + r[f + 2];\n//               o.push(l(n));\n//             }\n//             return o.join(\"\");\n//           }\n//           function s(r) {\n//             var e;\n//             var t = r.length;\n//             var o = t % 3;\n//             var f = \"\";\n//             var i = [];\n//             var a = 16383;\n//             for (var u = 0, d = t - o; u < d; u += a) {\n//               i.push(h(r, u, u + a > d ? d : u + a));\n//             }\n//             if (o === 1) {\n//               e = r[t - 1];\n//               f += n[e >> 2];\n//               f += n[(e << 4) & 63];\n//               f += \"==\";\n//             } else {\n//               if (o === 2) {\n//                 e = (r[t - 2] << 8) + r[t - 1];\n//                 f += n[e >> 10];\n//                 f += n[(e >> 4) & 63];\n//                 f += n[(e << 2) & 63];\n//                 f += \"=\";\n//               }\n//             }\n//             i.push(f);\n//             return i.join(\"\");\n//           }\n//         },\n//         {},\n//       ],\n//     },\n//     {},\n//     []\n//   )(\"/\");\n// });\n```\n","source":"_posts/国密4加密算法备份.md","raw":"---\ntitle: 国密4加密算法JS版本\nabbrlink: '0'\ntags:\n  - 备份\ncopyright: true\ncategories: 个人备份\n---\n\n国密 4 加密算法，网上多是 JAVA 版本，偶然见到有一个 TS 版本的。为了和后端保持一致的加密算法，需要在前端处理一些加密信息，所以改写为 JS 版本，备份以防之后丢失。\n\n<!-- more -->\n\n```js\n/**\n * @描述: 国密4加密算法\n * @Author: Jingtaooo\n * @Date: 2022/3/31 11:26 上午\n * @FilePath: /src/utils/system/SM4Util.js\n */\n\nimport base64js from 'base64-js'; // 用base64-js模块包代替下面的base64js方法，减少代码量\nfunction SM4_Context() {\n  this.mode = 1;\n  this.isPadding = true;\n  this.sk = new Array(32);\n}\n\nconst stringToByte = function (str) {\n  var bytes = new Array();\n  var len, c;\n  len = str.length;\n  for (var i = 0; i < len; i++) {\n    c = str.charCodeAt(i);\n    if (c >= 0x010000 && c <= 0x10ffff) {\n      bytes.push(((c >> 18) & 0x07) | 0xf0);\n      bytes.push(((c >> 12) & 0x3f) | 0x80);\n      bytes.push(((c >> 6) & 0x3f) | 0x80);\n      bytes.push((c & 0x3f) | 0x80);\n    } else if (c >= 0x000800 && c <= 0x00ffff) {\n      bytes.push(((c >> 12) & 0x0f) | 0xe0);\n      bytes.push(((c >> 6) & 0x3f) | 0x80);\n      bytes.push((c & 0x3f) | 0x80);\n    } else if (c >= 0x000080 && c <= 0x0007ff) {\n      bytes.push(((c >> 6) & 0x1f) | 0xc0);\n      bytes.push((c & 0x3f) | 0x80);\n    } else {\n      bytes.push(c & 0xff);\n    }\n  }\n  return bytes;\n};\n\nfunction SM4() {\n  this.SM4_ENCRYPT = 1;\n  this.SM4_DECRYPT = 0;\n\n  var SboxTable = [\n    0xd6, 0x90, 0xe9, 0xfe, 0xcc, 0xe1, 0x3d, 0xb7, 0x16, 0xb6, 0x14, 0xc2, 0x28, 0xfb, 0x2c, 0x05, 0x2b, 0x67, 0x9a, 0x76, 0x2a, 0xbe, 0x04, 0xc3, 0xaa, 0x44, 0x13, 0x26, 0x49,\n    0x86, 0x06, 0x99, 0x9c, 0x42, 0x50, 0xf4, 0x91, 0xef, 0x98, 0x7a, 0x33, 0x54, 0x0b, 0x43, 0xed, 0xcf, 0xac, 0x62, 0xe4, 0xb3, 0x1c, 0xa9, 0xc9, 0x08, 0xe8, 0x95, 0x80, 0xdf,\n    0x94, 0xfa, 0x75, 0x8f, 0x3f, 0xa6, 0x47, 0x07, 0xa7, 0xfc, 0xf3, 0x73, 0x17, 0xba, 0x83, 0x59, 0x3c, 0x19, 0xe6, 0x85, 0x4f, 0xa8, 0x68, 0x6b, 0x81, 0xb2, 0x71, 0x64, 0xda,\n    0x8b, 0xf8, 0xeb, 0x0f, 0x4b, 0x70, 0x56, 0x9d, 0x35, 0x1e, 0x24, 0x0e, 0x5e, 0x63, 0x58, 0xd1, 0xa2, 0x25, 0x22, 0x7c, 0x3b, 0x01, 0x21, 0x78, 0x87, 0xd4, 0x00, 0x46, 0x57,\n    0x9f, 0xd3, 0x27, 0x52, 0x4c, 0x36, 0x02, 0xe7, 0xa0, 0xc4, 0xc8, 0x9e, 0xea, 0xbf, 0x8a, 0xd2, 0x40, 0xc7, 0x38, 0xb5, 0xa3, 0xf7, 0xf2, 0xce, 0xf9, 0x61, 0x15, 0xa1, 0xe0,\n    0xae, 0x5d, 0xa4, 0x9b, 0x34, 0x1a, 0x55, 0xad, 0x93, 0x32, 0x30, 0xf5, 0x8c, 0xb1, 0xe3, 0x1d, 0xf6, 0xe2, 0x2e, 0x82, 0x66, 0xca, 0x60, 0xc0, 0x29, 0x23, 0xab, 0x0d, 0x53,\n    0x4e, 0x6f, 0xd5, 0xdb, 0x37, 0x45, 0xde, 0xfd, 0x8e, 0x2f, 0x03, 0xff, 0x6a, 0x72, 0x6d, 0x6c, 0x5b, 0x51, 0x8d, 0x1b, 0xaf, 0x92, 0xbb, 0xdd, 0xbc, 0x7f, 0x11, 0xd9, 0x5c,\n    0x41, 0x1f, 0x10, 0x5a, 0xd8, 0x0a, 0xc1, 0x31, 0x88, 0xa5, 0xcd, 0x7b, 0xbd, 0x2d, 0x74, 0xd0, 0x12, 0xb8, 0xe5, 0xb4, 0xb0, 0x89, 0x69, 0x97, 0x4a, 0x0c, 0x96, 0x77, 0x7e,\n    0x65, 0xb9, 0xf1, 0x09, 0xc5, 0x6e, 0xc6, 0x84, 0x18, 0xf0, 0x7d, 0xec, 0x3a, 0xdc, 0x4d, 0x20, 0x79, 0xee, 0x5f, 0x3e, 0xd7, 0xcb, 0x39, 0x48,\n  ];\n\n  var FK = [0xa3b1bac6, 0x56aa3350, 0x677d9197, 0xb27022dc];\n\n  var CK = [\n    0x00070e15, 0x1c232a31, 0x383f464d, 0x545b6269, 0x70777e85, 0x8c939aa1, 0xa8afb6bd, 0xc4cbd2d9, 0xe0e7eef5, 0xfc030a11, 0x181f262d, 0x343b4249, 0x50575e65, 0x6c737a81,\n    0x888f969d, 0xa4abb2b9, 0xc0c7ced5, 0xdce3eaf1, 0xf8ff060d, 0x141b2229, 0x30373e45, 0x4c535a61, 0x686f767d, 0x848b9299, 0xa0a7aeb5, 0xbcc3cad1, 0xd8dfe6ed, 0xf4fb0209,\n    0x10171e25, 0x2c333a41, 0x484f565d, 0x646b7279,\n  ];\n\n  this.GET_ULONG_BE = function (b, i) {\n    return ((b[i] & 0xff) << 24) | ((b[i + 1] & 0xff) << 16) | ((b[i + 2] & 0xff) << 8) | (b[i + 3] & 0xff & 0xffffffff);\n  };\n\n  this.PUT_ULONG_BE = function (n, b, i) {\n    var t1 = 0xff & (n >> 24);\n    var t2 = 0xff & (n >> 16);\n    var t3 = 0xff & (n >> 8);\n    var t4 = 0xff & n;\n    b[i] = t1 > 128 ? t1 - 256 : t1;\n    b[i + 1] = t2 > 128 ? t2 - 256 : t2;\n    b[i + 2] = t3 > 128 ? t3 - 256 : t3;\n    b[i + 3] = t4 > 128 ? t4 - 256 : t4;\n  };\n\n  this.SHL = function (x, n) {\n    return (x & 0xffffffff) << n;\n  };\n\n  this.ROTL = function (x, n) {\n    var s = this.SHL(x, n);\n    var ss = x >> (32 - n);\n    return this.SHL(x, n) | (x >> (32 - n));\n  };\n\n  this.sm4Lt = function (ka) {\n    var bb = 0;\n    var c = 0;\n    var a = new Array(4);\n    var b = new Array(4);\n    this.PUT_ULONG_BE(ka, a, 0);\n    b[0] = this.sm4Sbox(a[0]);\n    b[1] = this.sm4Sbox(a[1]);\n    b[2] = this.sm4Sbox(a[2]);\n    b[3] = this.sm4Sbox(a[3]);\n    bb = this.GET_ULONG_BE(b, 0);\n    c = bb ^ this.ROTL(bb, 2) ^ this.ROTL(bb, 10) ^ this.ROTL(bb, 18) ^ this.ROTL(bb, 24);\n    return c;\n  };\n\n  this.sm4F = function (x0, x1, x2, x3, rk) {\n    return x0 ^ this.sm4Lt(x1 ^ x2 ^ x3 ^ rk);\n  };\n\n  this.sm4CalciRK = function (ka) {\n    var bb = 0;\n    var rk = 0;\n    var a = new Array(4);\n    var b = new Array(4);\n    this.PUT_ULONG_BE(ka, a, 0);\n    b[0] = this.sm4Sbox(a[0]);\n    b[1] = this.sm4Sbox(a[1]);\n    b[2] = this.sm4Sbox(a[2]);\n    b[3] = this.sm4Sbox(a[3]);\n    bb = this.GET_ULONG_BE(b, 0);\n    rk = bb ^ this.ROTL(bb, 13) ^ this.ROTL(bb, 23);\n    return rk;\n  };\n\n  this.sm4Sbox = function (inch) {\n    var i = inch & 0xff;\n    var retVal = SboxTable[i];\n    return retVal > 128 ? retVal - 256 : retVal;\n  };\n\n  this.sm4_setkey_enc = function (ctx, key) {\n    if (ctx == null) {\n      alert('ctx is null!');\n      return false;\n    }\n    if (key == null || key.length != 16) {\n      alert('key error!');\n      return false;\n    }\n    ctx.mode = this.SM4_ENCRYPT;\n    this.sm4_setkey(ctx.sk, key);\n  };\n\n  this.sm4_setkey = function (SK, key) {\n    var MK = new Array(4);\n    var k = new Array(36);\n    var i = 0;\n    MK[0] = this.GET_ULONG_BE(key, 0);\n    MK[1] = this.GET_ULONG_BE(key, 4);\n    MK[2] = this.GET_ULONG_BE(key, 8);\n    MK[3] = this.GET_ULONG_BE(key, 12);\n    k[0] = MK[0] ^ FK[0];\n    k[1] = MK[1] ^ FK[1];\n    k[2] = MK[2] ^ FK[2];\n    k[3] = MK[3] ^ FK[3];\n    for (var i = 0; i < 32; i++) {\n      k[i + 4] = k[i] ^ this.sm4CalciRK(k[i + 1] ^ k[i + 2] ^ k[i + 3] ^ CK[i]);\n      SK[i] = k[i + 4];\n    }\n  };\n  this.padding = function (input, mode) {\n    if (input == null) {\n      return null;\n    }\n    var ret = null;\n    if (mode == this.SM4_ENCRYPT) {\n      var p = parseInt(16 - (input.length % 16));\n      ret = input.slice(0);\n      for (var i = 0; i < p; i++) {\n        ret[input.length + i] = p;\n      }\n    } else {\n      var p = input[input.length - 1];\n      ret = input.slice(0, input.length - p);\n    }\n    return ret;\n  };\n  this.sm4_one_round = function (sk, input, output) {\n    var i = 0;\n    var ulbuf = new Array(36);\n    ulbuf[0] = this.GET_ULONG_BE(input, 0);\n    ulbuf[1] = this.GET_ULONG_BE(input, 4);\n    ulbuf[2] = this.GET_ULONG_BE(input, 8);\n    ulbuf[3] = this.GET_ULONG_BE(input, 12);\n    while (i < 32) {\n      ulbuf[i + 4] = this.sm4F(ulbuf[i], ulbuf[i + 1], ulbuf[i + 2], ulbuf[i + 3], sk[i]);\n      i++;\n    }\n    this.PUT_ULONG_BE(ulbuf[35], output, 0);\n    this.PUT_ULONG_BE(ulbuf[34], output, 4);\n    this.PUT_ULONG_BE(ulbuf[33], output, 8);\n    this.PUT_ULONG_BE(ulbuf[32], output, 12);\n  };\n\n  this.sm4_crypt_ecb = function (ctx, input) {\n    if (input == null) {\n      alert('input is null!');\n    }\n    if (ctx.isPadding && ctx.mode == this.SM4_ENCRYPT) {\n      input = this.padding(input, this.SM4_ENCRYPT);\n    }\n\n    var i = 0;\n    var length = input.length;\n    var bous = new Array();\n    for (; length > 0; length -= 16) {\n      var out = new Array(16);\n      var ins = input.slice(i * 16, 16 * (i + 1));\n      this.sm4_one_round(ctx.sk, ins, out);\n      bous = bous.concat(out);\n      i++;\n    }\n\n    var output = bous;\n    if (ctx.isPadding && ctx.mode == this.SM4_DECRYPT) {\n      output = this.padding(output, this.SM4_DECRYPT);\n    }\n    for (var i = 0; i < output.length; i++) {\n      if (output[i] < 0) {\n        output[i] = output[i] + 256;\n      }\n    }\n    return output;\n  };\n\n  this.sm4_crypt_cbc = function (ctx, iv, input) {\n    if (iv == null || iv.length != 16) {\n      alert('iv error!');\n    }\n\n    if (input == null) {\n      alert('input is null!');\n    }\n\n    if (ctx.isPadding && ctx.mode == this.SM4_ENCRYPT) {\n      input = this.padding(input, this.SM4_ENCRYPT);\n    }\n\n    var i = 0;\n    var length = input.length;\n    var bous = new Array();\n    if (ctx.mode == this.SM4_ENCRYPT) {\n      var k = 0;\n      for (; length > 0; length -= 16) {\n        var out = new Array(16);\n        var out1 = new Array(16);\n        var ins = input.slice(k * 16, 16 * (k + 1));\n\n        for (i = 0; i < 16; i++) {\n          out[i] = ins[i] ^ iv[i];\n        }\n        this.sm4_one_round(ctx.sk, out, out1);\n        iv = out1.slice(0, 16);\n        bous = bous.concat(out1);\n        k++;\n      }\n    } else {\n      var temp = [];\n      var k = 0;\n      for (; length > 0; length -= 16) {\n        var out = new Array(16);\n        var out1 = new Array(16);\n        var ins = input.slice(k * 16, 16 * (k + 1));\n        temp = ins.slice(0, 16);\n        sm4_one_round(ctx.sk, ins, out);\n        for (i = 0; i < 16; i++) {\n          out1[i] = out[i] ^ iv[i];\n        }\n        iv = temp.slice(0, 16);\n        bous = bous.concat(out1);\n        k++;\n      }\n    }\n\n    var output = bous;\n    if (ctx.isPadding && ctx.mode == this.SM4_DECRYPT) {\n      output = this.padding(output, this.SM4_DECRYPT);\n    }\n\n    for (var i = 0; i < output.length; i++) {\n      if (output[i] < 0) {\n        output[i] = output[i] + 256;\n      }\n    }\n    return output;\n  };\n}\n\nconst secretKey = 'w7bqTgHGZH5PD0cy';\n// const iv = '';\n// const hexString = false;\n\nexport function encryptData_ECB(plainText) {\n  try {\n    var sm4 = new SM4();\n    var ctx = new SM4_Context();\n    ctx.isPadding = true;\n    ctx.mode = sm4.SM4_ENCRYPT;\n    var keyBytes = stringToByte(secretKey);\n    sm4.sm4_setkey_enc(ctx, keyBytes);\n    var encrypted = sm4.sm4_crypt_ecb(ctx, stringToByte(plainText));\n    var cipherText = base64js.fromByteArray(encrypted);\n    if (cipherText != null && cipherText.trim().length > 0) {\n      cipherText.replace(/(\\s*|\\t|\\r|\\n)/g, '');\n    }\n    return cipherText;\n  } catch (e) {\n    console.error(e);\n    return null;\n  }\n}\n\n/**\n * base64js\n */\n/**\n * base64js\n * base64js.toByteArray(d.input)\n * base64js.fromByteArray(c);\n */\n//  (function(r) {\n//   if (typeof exports === \"object\" && typeof module !== \"undefined\") {\n//     module.exports = r();\n//   } else {\n//     if (typeof define === \"function\" && define.amd) {\n//       define([], r);\n//     } else {\n//       var e;\n//       if (typeof window !== \"undefined\") {\n//         e = window;\n//       } else {\n//         if (typeof global !== \"undefined\") {\n//           e = global;\n//         } else {\n//           if (typeof self !== \"undefined\") {\n//             e = self;\n//           } else {\n//             e = this;\n//           }\n//         }\n//       }\n//       e.base64js = r();\n//     }\n//   }\n// })(function() {\n//   var r, e, t;\n//   return (function r(e, t, n) {\n//     function o(i, a) {\n//       if (!t[i]) {\n//         if (!e[i]) {\n//           var u = typeof require == \"function\" && require;\n//           if (!a && u) {\n//             return u(i, !0);\n//           }\n//           if (f) {\n//             return f(i, !0);\n//           }\n//           var d = new Error(\"Cannot find module '\" + i + \"'\");\n//           throw ((d.code = \"MODULE_NOT_FOUND\"), d);\n//         }\n//         var c = (t[i] = { exports: {} });\n//         e[i][0].call(\n//           c.exports,\n//           function(r) {\n//             var t = e[i][1][r];\n//             return o(t ? t : r);\n//           },\n//           c,\n//           c.exports,\n//           r,\n//           e,\n//           t,\n//           n\n//         );\n//       }\n//       return t[i].exports;\n//     }\n//     var f = typeof require == \"function\" && require;\n//     for (var i = 0; i < n.length; i++) {\n//       o(n[i]);\n//     }\n//     return o;\n//   })(\n//     {\n//       \"/\": [\n//         function(r, e, t) {\n//           t.byteLength = c;\n//           t.toByteArray = v;\n//           t.fromByteArray = s;\n//           var n = [];\n//           var o = [];\n//           var f = typeof Uint8Array !== \"undefined\" ? Uint8Array : Array;\n//           var i =\n//             \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n//           for (var a = 0, u = i.length; a < u; ++a) {\n//             n[a] = i[a];\n//             o[i.charCodeAt(a)] = a;\n//           }\n//           o[\"-\".charCodeAt(0)] = 62;\n//           o[\"_\".charCodeAt(0)] = 63;\n//           function d(r) {\n//             var e = r.length;\n//             if (e % 4 > 0) {\n//               throw new Error(\"Invalid string. Length must be a multiple of 4\");\n//             }\n//             return r[e - 2] === \"=\" ? 2 : r[e - 1] === \"=\" ? 1 : 0;\n//           }\n//           function c(r) {\n//             return (r.length * 3) / 4 - d(r);\n//           }\n//           function v(r) {\n//             var e, t, n, i, a;\n//             var u = r.length;\n//             i = d(r);\n//             a = new f((u * 3) / 4 - i);\n//             t = i > 0 ? u - 4 : u;\n//             var c = 0;\n//             for (e = 0; e < t; e += 4) {\n//               n =\n//                 (o[r.charCodeAt(e)] << 18) |\n//                 (o[r.charCodeAt(e + 1)] << 12) |\n//                 (o[r.charCodeAt(e + 2)] << 6) |\n//                 o[r.charCodeAt(e + 3)];\n//               a[c++] = (n >> 16) & 255;\n//               a[c++] = (n >> 8) & 255;\n//               a[c++] = n & 255;\n//             }\n//             if (i === 2) {\n//               n = (o[r.charCodeAt(e)] << 2) | (o[r.charCodeAt(e + 1)] >> 4);\n//               a[c++] = n & 255;\n//             } else {\n//               if (i === 1) {\n//                 n =\n//                   (o[r.charCodeAt(e)] << 10) |\n//                   (o[r.charCodeAt(e + 1)] << 4) |\n//                   (o[r.charCodeAt(e + 2)] >> 2);\n//                 a[c++] = (n >> 8) & 255;\n//                 a[c++] = n & 255;\n//               }\n//             }\n//             return a;\n//           }\n//           function l(r) {\n//             return (\n//               n[(r >> 18) & 63] +\n//               n[(r >> 12) & 63] +\n//               n[(r >> 6) & 63] +\n//               n[r & 63]\n//             );\n//           }\n//           function h(r, e, t) {\n//             var n;\n//             var o = [];\n//             for (var f = e; f < t; f += 3) {\n//               n = (r[f] << 16) + (r[f + 1] << 8) + r[f + 2];\n//               o.push(l(n));\n//             }\n//             return o.join(\"\");\n//           }\n//           function s(r) {\n//             var e;\n//             var t = r.length;\n//             var o = t % 3;\n//             var f = \"\";\n//             var i = [];\n//             var a = 16383;\n//             for (var u = 0, d = t - o; u < d; u += a) {\n//               i.push(h(r, u, u + a > d ? d : u + a));\n//             }\n//             if (o === 1) {\n//               e = r[t - 1];\n//               f += n[e >> 2];\n//               f += n[(e << 4) & 63];\n//               f += \"==\";\n//             } else {\n//               if (o === 2) {\n//                 e = (r[t - 2] << 8) + r[t - 1];\n//                 f += n[e >> 10];\n//                 f += n[(e >> 4) & 63];\n//                 f += n[(e << 2) & 63];\n//                 f += \"=\";\n//               }\n//             }\n//             i.push(f);\n//             return i.join(\"\");\n//           }\n//         },\n//         {},\n//       ],\n//     },\n//     {},\n//     []\n//   )(\"/\");\n// });\n```\n","slug":"国密4加密算法备份","published":1,"date":"2022-08-26T01:42:59.882Z","updated":"2022-08-26T01:42:59.882Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl79tdvve000d5d9kcfof4x60","content":"<p>国密 4 加密算法，网上多是 JAVA 版本，偶然见到有一个 TS 版本的。为了和后端保持一致的加密算法，需要在前端处理一些加密信息，所以改写为 JS 版本，备份以防之后丢失。</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * @描述: 国密4加密算法</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Author</span>: Jingtaooo</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Date</span>: 2022/3/31 11:26 上午</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@FilePath</span>: /src/utils/system/SM4Util.js</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> base64js <span class=\"keyword\">from</span> <span class=\"string\">&#x27;base64-js&#x27;</span>; <span class=\"comment\">// 用base64-js模块包代替下面的base64js方法，减少代码量</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">SM4_Context</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">mode</span> = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">isPadding</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">sk</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">32</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> stringToByte = <span class=\"keyword\">function</span> (<span class=\"params\">str</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> bytes = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>();</span><br><span class=\"line\">  <span class=\"keyword\">var</span> len, c;</span><br><span class=\"line\">  len = str.<span class=\"property\">length</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">    c = str.<span class=\"title function_\">charCodeAt</span>(i);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (c &gt;= <span class=\"number\">0x010000</span> &amp;&amp; c &lt;= <span class=\"number\">0x10ffff</span>) &#123;</span><br><span class=\"line\">      bytes.<span class=\"title function_\">push</span>(((c &gt;&gt; <span class=\"number\">18</span>) &amp; <span class=\"number\">0x07</span>) | <span class=\"number\">0xf0</span>);</span><br><span class=\"line\">      bytes.<span class=\"title function_\">push</span>(((c &gt;&gt; <span class=\"number\">12</span>) &amp; <span class=\"number\">0x3f</span>) | <span class=\"number\">0x80</span>);</span><br><span class=\"line\">      bytes.<span class=\"title function_\">push</span>(((c &gt;&gt; <span class=\"number\">6</span>) &amp; <span class=\"number\">0x3f</span>) | <span class=\"number\">0x80</span>);</span><br><span class=\"line\">      bytes.<span class=\"title function_\">push</span>((c &amp; <span class=\"number\">0x3f</span>) | <span class=\"number\">0x80</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (c &gt;= <span class=\"number\">0x000800</span> &amp;&amp; c &lt;= <span class=\"number\">0x00ffff</span>) &#123;</span><br><span class=\"line\">      bytes.<span class=\"title function_\">push</span>(((c &gt;&gt; <span class=\"number\">12</span>) &amp; <span class=\"number\">0x0f</span>) | <span class=\"number\">0xe0</span>);</span><br><span class=\"line\">      bytes.<span class=\"title function_\">push</span>(((c &gt;&gt; <span class=\"number\">6</span>) &amp; <span class=\"number\">0x3f</span>) | <span class=\"number\">0x80</span>);</span><br><span class=\"line\">      bytes.<span class=\"title function_\">push</span>((c &amp; <span class=\"number\">0x3f</span>) | <span class=\"number\">0x80</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (c &gt;= <span class=\"number\">0x000080</span> &amp;&amp; c &lt;= <span class=\"number\">0x0007ff</span>) &#123;</span><br><span class=\"line\">      bytes.<span class=\"title function_\">push</span>(((c &gt;&gt; <span class=\"number\">6</span>) &amp; <span class=\"number\">0x1f</span>) | <span class=\"number\">0xc0</span>);</span><br><span class=\"line\">      bytes.<span class=\"title function_\">push</span>((c &amp; <span class=\"number\">0x3f</span>) | <span class=\"number\">0x80</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      bytes.<span class=\"title function_\">push</span>(c &amp; <span class=\"number\">0xff</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> bytes;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">SM4</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_ENCRYPT</span> = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_DECRYPT</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> <span class=\"title class_\">SboxTable</span> = [</span><br><span class=\"line\">    <span class=\"number\">0xd6</span>, <span class=\"number\">0x90</span>, <span class=\"number\">0xe9</span>, <span class=\"number\">0xfe</span>, <span class=\"number\">0xcc</span>, <span class=\"number\">0xe1</span>, <span class=\"number\">0x3d</span>, <span class=\"number\">0xb7</span>, <span class=\"number\">0x16</span>, <span class=\"number\">0xb6</span>, <span class=\"number\">0x14</span>, <span class=\"number\">0xc2</span>, <span class=\"number\">0x28</span>, <span class=\"number\">0xfb</span>, <span class=\"number\">0x2c</span>, <span class=\"number\">0x05</span>, <span class=\"number\">0x2b</span>, <span class=\"number\">0x67</span>, <span class=\"number\">0x9a</span>, <span class=\"number\">0x76</span>, <span class=\"number\">0x2a</span>, <span class=\"number\">0xbe</span>, <span class=\"number\">0x04</span>, <span class=\"number\">0xc3</span>, <span class=\"number\">0xaa</span>, <span class=\"number\">0x44</span>, <span class=\"number\">0x13</span>, <span class=\"number\">0x26</span>, <span class=\"number\">0x49</span>,</span><br><span class=\"line\">    <span class=\"number\">0x86</span>, <span class=\"number\">0x06</span>, <span class=\"number\">0x99</span>, <span class=\"number\">0x9c</span>, <span class=\"number\">0x42</span>, <span class=\"number\">0x50</span>, <span class=\"number\">0xf4</span>, <span class=\"number\">0x91</span>, <span class=\"number\">0xef</span>, <span class=\"number\">0x98</span>, <span class=\"number\">0x7a</span>, <span class=\"number\">0x33</span>, <span class=\"number\">0x54</span>, <span class=\"number\">0x0b</span>, <span class=\"number\">0x43</span>, <span class=\"number\">0xed</span>, <span class=\"number\">0xcf</span>, <span class=\"number\">0xac</span>, <span class=\"number\">0x62</span>, <span class=\"number\">0xe4</span>, <span class=\"number\">0xb3</span>, <span class=\"number\">0x1c</span>, <span class=\"number\">0xa9</span>, <span class=\"number\">0xc9</span>, <span class=\"number\">0x08</span>, <span class=\"number\">0xe8</span>, <span class=\"number\">0x95</span>, <span class=\"number\">0x80</span>, <span class=\"number\">0xdf</span>,</span><br><span class=\"line\">    <span class=\"number\">0x94</span>, <span class=\"number\">0xfa</span>, <span class=\"number\">0x75</span>, <span class=\"number\">0x8f</span>, <span class=\"number\">0x3f</span>, <span class=\"number\">0xa6</span>, <span class=\"number\">0x47</span>, <span class=\"number\">0x07</span>, <span class=\"number\">0xa7</span>, <span class=\"number\">0xfc</span>, <span class=\"number\">0xf3</span>, <span class=\"number\">0x73</span>, <span class=\"number\">0x17</span>, <span class=\"number\">0xba</span>, <span class=\"number\">0x83</span>, <span class=\"number\">0x59</span>, <span class=\"number\">0x3c</span>, <span class=\"number\">0x19</span>, <span class=\"number\">0xe6</span>, <span class=\"number\">0x85</span>, <span class=\"number\">0x4f</span>, <span class=\"number\">0xa8</span>, <span class=\"number\">0x68</span>, <span class=\"number\">0x6b</span>, <span class=\"number\">0x81</span>, <span class=\"number\">0xb2</span>, <span class=\"number\">0x71</span>, <span class=\"number\">0x64</span>, <span class=\"number\">0xda</span>,</span><br><span class=\"line\">    <span class=\"number\">0x8b</span>, <span class=\"number\">0xf8</span>, <span class=\"number\">0xeb</span>, <span class=\"number\">0x0f</span>, <span class=\"number\">0x4b</span>, <span class=\"number\">0x70</span>, <span class=\"number\">0x56</span>, <span class=\"number\">0x9d</span>, <span class=\"number\">0x35</span>, <span class=\"number\">0x1e</span>, <span class=\"number\">0x24</span>, <span class=\"number\">0x0e</span>, <span class=\"number\">0x5e</span>, <span class=\"number\">0x63</span>, <span class=\"number\">0x58</span>, <span class=\"number\">0xd1</span>, <span class=\"number\">0xa2</span>, <span class=\"number\">0x25</span>, <span class=\"number\">0x22</span>, <span class=\"number\">0x7c</span>, <span class=\"number\">0x3b</span>, <span class=\"number\">0x01</span>, <span class=\"number\">0x21</span>, <span class=\"number\">0x78</span>, <span class=\"number\">0x87</span>, <span class=\"number\">0xd4</span>, <span class=\"number\">0x00</span>, <span class=\"number\">0x46</span>, <span class=\"number\">0x57</span>,</span><br><span class=\"line\">    <span class=\"number\">0x9f</span>, <span class=\"number\">0xd3</span>, <span class=\"number\">0x27</span>, <span class=\"number\">0x52</span>, <span class=\"number\">0x4c</span>, <span class=\"number\">0x36</span>, <span class=\"number\">0x02</span>, <span class=\"number\">0xe7</span>, <span class=\"number\">0xa0</span>, <span class=\"number\">0xc4</span>, <span class=\"number\">0xc8</span>, <span class=\"number\">0x9e</span>, <span class=\"number\">0xea</span>, <span class=\"number\">0xbf</span>, <span class=\"number\">0x8a</span>, <span class=\"number\">0xd2</span>, <span class=\"number\">0x40</span>, <span class=\"number\">0xc7</span>, <span class=\"number\">0x38</span>, <span class=\"number\">0xb5</span>, <span class=\"number\">0xa3</span>, <span class=\"number\">0xf7</span>, <span class=\"number\">0xf2</span>, <span class=\"number\">0xce</span>, <span class=\"number\">0xf9</span>, <span class=\"number\">0x61</span>, <span class=\"number\">0x15</span>, <span class=\"number\">0xa1</span>, <span class=\"number\">0xe0</span>,</span><br><span class=\"line\">    <span class=\"number\">0xae</span>, <span class=\"number\">0x5d</span>, <span class=\"number\">0xa4</span>, <span class=\"number\">0x9b</span>, <span class=\"number\">0x34</span>, <span class=\"number\">0x1a</span>, <span class=\"number\">0x55</span>, <span class=\"number\">0xad</span>, <span class=\"number\">0x93</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0xf5</span>, <span class=\"number\">0x8c</span>, <span class=\"number\">0xb1</span>, <span class=\"number\">0xe3</span>, <span class=\"number\">0x1d</span>, <span class=\"number\">0xf6</span>, <span class=\"number\">0xe2</span>, <span class=\"number\">0x2e</span>, <span class=\"number\">0x82</span>, <span class=\"number\">0x66</span>, <span class=\"number\">0xca</span>, <span class=\"number\">0x60</span>, <span class=\"number\">0xc0</span>, <span class=\"number\">0x29</span>, <span class=\"number\">0x23</span>, <span class=\"number\">0xab</span>, <span class=\"number\">0x0d</span>, <span class=\"number\">0x53</span>,</span><br><span class=\"line\">    <span class=\"number\">0x4e</span>, <span class=\"number\">0x6f</span>, <span class=\"number\">0xd5</span>, <span class=\"number\">0xdb</span>, <span class=\"number\">0x37</span>, <span class=\"number\">0x45</span>, <span class=\"number\">0xde</span>, <span class=\"number\">0xfd</span>, <span class=\"number\">0x8e</span>, <span class=\"number\">0x2f</span>, <span class=\"number\">0x03</span>, <span class=\"number\">0xff</span>, <span class=\"number\">0x6a</span>, <span class=\"number\">0x72</span>, <span class=\"number\">0x6d</span>, <span class=\"number\">0x6c</span>, <span class=\"number\">0x5b</span>, <span class=\"number\">0x51</span>, <span class=\"number\">0x8d</span>, <span class=\"number\">0x1b</span>, <span class=\"number\">0xaf</span>, <span class=\"number\">0x92</span>, <span class=\"number\">0xbb</span>, <span class=\"number\">0xdd</span>, <span class=\"number\">0xbc</span>, <span class=\"number\">0x7f</span>, <span class=\"number\">0x11</span>, <span class=\"number\">0xd9</span>, <span class=\"number\">0x5c</span>,</span><br><span class=\"line\">    <span class=\"number\">0x41</span>, <span class=\"number\">0x1f</span>, <span class=\"number\">0x10</span>, <span class=\"number\">0x5a</span>, <span class=\"number\">0xd8</span>, <span class=\"number\">0x0a</span>, <span class=\"number\">0xc1</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0x88</span>, <span class=\"number\">0xa5</span>, <span class=\"number\">0xcd</span>, <span class=\"number\">0x7b</span>, <span class=\"number\">0xbd</span>, <span class=\"number\">0x2d</span>, <span class=\"number\">0x74</span>, <span class=\"number\">0xd0</span>, <span class=\"number\">0x12</span>, <span class=\"number\">0xb8</span>, <span class=\"number\">0xe5</span>, <span class=\"number\">0xb4</span>, <span class=\"number\">0xb0</span>, <span class=\"number\">0x89</span>, <span class=\"number\">0x69</span>, <span class=\"number\">0x97</span>, <span class=\"number\">0x4a</span>, <span class=\"number\">0x0c</span>, <span class=\"number\">0x96</span>, <span class=\"number\">0x77</span>, <span class=\"number\">0x7e</span>,</span><br><span class=\"line\">    <span class=\"number\">0x65</span>, <span class=\"number\">0xb9</span>, <span class=\"number\">0xf1</span>, <span class=\"number\">0x09</span>, <span class=\"number\">0xc5</span>, <span class=\"number\">0x6e</span>, <span class=\"number\">0xc6</span>, <span class=\"number\">0x84</span>, <span class=\"number\">0x18</span>, <span class=\"number\">0xf0</span>, <span class=\"number\">0x7d</span>, <span class=\"number\">0xec</span>, <span class=\"number\">0x3a</span>, <span class=\"number\">0xdc</span>, <span class=\"number\">0x4d</span>, <span class=\"number\">0x20</span>, <span class=\"number\">0x79</span>, <span class=\"number\">0xee</span>, <span class=\"number\">0x5f</span>, <span class=\"number\">0x3e</span>, <span class=\"number\">0xd7</span>, <span class=\"number\">0xcb</span>, <span class=\"number\">0x39</span>, <span class=\"number\">0x48</span>,</span><br><span class=\"line\">  ];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> <span class=\"variable constant_\">FK</span> = [<span class=\"number\">0xa3b1bac6</span>, <span class=\"number\">0x56aa3350</span>, <span class=\"number\">0x677d9197</span>, <span class=\"number\">0xb27022dc</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> <span class=\"variable constant_\">CK</span> = [</span><br><span class=\"line\">    <span class=\"number\">0x00070e15</span>, <span class=\"number\">0x1c232a31</span>, <span class=\"number\">0x383f464d</span>, <span class=\"number\">0x545b6269</span>, <span class=\"number\">0x70777e85</span>, <span class=\"number\">0x8c939aa1</span>, <span class=\"number\">0xa8afb6bd</span>, <span class=\"number\">0xc4cbd2d9</span>, <span class=\"number\">0xe0e7eef5</span>, <span class=\"number\">0xfc030a11</span>, <span class=\"number\">0x181f262d</span>, <span class=\"number\">0x343b4249</span>, <span class=\"number\">0x50575e65</span>, <span class=\"number\">0x6c737a81</span>,</span><br><span class=\"line\">    <span class=\"number\">0x888f969d</span>, <span class=\"number\">0xa4abb2b9</span>, <span class=\"number\">0xc0c7ced5</span>, <span class=\"number\">0xdce3eaf1</span>, <span class=\"number\">0xf8ff060d</span>, <span class=\"number\">0x141b2229</span>, <span class=\"number\">0x30373e45</span>, <span class=\"number\">0x4c535a61</span>, <span class=\"number\">0x686f767d</span>, <span class=\"number\">0x848b9299</span>, <span class=\"number\">0xa0a7aeb5</span>, <span class=\"number\">0xbcc3cad1</span>, <span class=\"number\">0xd8dfe6ed</span>, <span class=\"number\">0xf4fb0209</span>,</span><br><span class=\"line\">    <span class=\"number\">0x10171e25</span>, <span class=\"number\">0x2c333a41</span>, <span class=\"number\">0x484f565d</span>, <span class=\"number\">0x646b7279</span>,</span><br><span class=\"line\">  ];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">GET_ULONG_BE</span> = <span class=\"keyword\">function</span> (<span class=\"params\">b, i</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ((b[i] &amp; <span class=\"number\">0xff</span>) &lt;&lt; <span class=\"number\">24</span>) | ((b[i + <span class=\"number\">1</span>] &amp; <span class=\"number\">0xff</span>) &lt;&lt; <span class=\"number\">16</span>) | ((b[i + <span class=\"number\">2</span>] &amp; <span class=\"number\">0xff</span>) &lt;&lt; <span class=\"number\">8</span>) | (b[i + <span class=\"number\">3</span>] &amp; <span class=\"number\">0xff</span> &amp; <span class=\"number\">0xffffffff</span>);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">PUT_ULONG_BE</span> = <span class=\"keyword\">function</span> (<span class=\"params\">n, b, i</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> t1 = <span class=\"number\">0xff</span> &amp; (n &gt;&gt; <span class=\"number\">24</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> t2 = <span class=\"number\">0xff</span> &amp; (n &gt;&gt; <span class=\"number\">16</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> t3 = <span class=\"number\">0xff</span> &amp; (n &gt;&gt; <span class=\"number\">8</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> t4 = <span class=\"number\">0xff</span> &amp; n;</span><br><span class=\"line\">    b[i] = t1 &gt; <span class=\"number\">128</span> ? t1 - <span class=\"number\">256</span> : t1;</span><br><span class=\"line\">    b[i + <span class=\"number\">1</span>] = t2 &gt; <span class=\"number\">128</span> ? t2 - <span class=\"number\">256</span> : t2;</span><br><span class=\"line\">    b[i + <span class=\"number\">2</span>] = t3 &gt; <span class=\"number\">128</span> ? t3 - <span class=\"number\">256</span> : t3;</span><br><span class=\"line\">    b[i + <span class=\"number\">3</span>] = t4 &gt; <span class=\"number\">128</span> ? t4 - <span class=\"number\">256</span> : t4;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">SHL</span> = <span class=\"keyword\">function</span> (<span class=\"params\">x, n</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (x &amp; <span class=\"number\">0xffffffff</span>) &lt;&lt; n;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">ROTL</span> = <span class=\"keyword\">function</span> (<span class=\"params\">x, n</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> s = <span class=\"variable language_\">this</span>.<span class=\"title function_\">SHL</span>(x, n);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ss = x &gt;&gt; (<span class=\"number\">32</span> - n);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"title function_\">SHL</span>(x, n) | (x &gt;&gt; (<span class=\"number\">32</span> - n));</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">sm4Lt</span> = <span class=\"keyword\">function</span> (<span class=\"params\">ka</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> bb = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> c = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> a = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">4</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> b = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">4</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">PUT_ULONG_BE</span>(ka, a, <span class=\"number\">0</span>);</span><br><span class=\"line\">    b[<span class=\"number\">0</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4Sbox</span>(a[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    b[<span class=\"number\">1</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4Sbox</span>(a[<span class=\"number\">1</span>]);</span><br><span class=\"line\">    b[<span class=\"number\">2</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4Sbox</span>(a[<span class=\"number\">2</span>]);</span><br><span class=\"line\">    b[<span class=\"number\">3</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4Sbox</span>(a[<span class=\"number\">3</span>]);</span><br><span class=\"line\">    bb = <span class=\"variable language_\">this</span>.<span class=\"title function_\">GET_ULONG_BE</span>(b, <span class=\"number\">0</span>);</span><br><span class=\"line\">    c = bb ^ <span class=\"variable language_\">this</span>.<span class=\"title function_\">ROTL</span>(bb, <span class=\"number\">2</span>) ^ <span class=\"variable language_\">this</span>.<span class=\"title function_\">ROTL</span>(bb, <span class=\"number\">10</span>) ^ <span class=\"variable language_\">this</span>.<span class=\"title function_\">ROTL</span>(bb, <span class=\"number\">18</span>) ^ <span class=\"variable language_\">this</span>.<span class=\"title function_\">ROTL</span>(bb, <span class=\"number\">24</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> c;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">sm4F</span> = <span class=\"keyword\">function</span> (<span class=\"params\">x0, x1, x2, x3, rk</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x0 ^ <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4Lt</span>(x1 ^ x2 ^ x3 ^ rk);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">sm4CalciRK</span> = <span class=\"keyword\">function</span> (<span class=\"params\">ka</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> bb = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> rk = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> a = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">4</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> b = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">4</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">PUT_ULONG_BE</span>(ka, a, <span class=\"number\">0</span>);</span><br><span class=\"line\">    b[<span class=\"number\">0</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4Sbox</span>(a[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    b[<span class=\"number\">1</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4Sbox</span>(a[<span class=\"number\">1</span>]);</span><br><span class=\"line\">    b[<span class=\"number\">2</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4Sbox</span>(a[<span class=\"number\">2</span>]);</span><br><span class=\"line\">    b[<span class=\"number\">3</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4Sbox</span>(a[<span class=\"number\">3</span>]);</span><br><span class=\"line\">    bb = <span class=\"variable language_\">this</span>.<span class=\"title function_\">GET_ULONG_BE</span>(b, <span class=\"number\">0</span>);</span><br><span class=\"line\">    rk = bb ^ <span class=\"variable language_\">this</span>.<span class=\"title function_\">ROTL</span>(bb, <span class=\"number\">13</span>) ^ <span class=\"variable language_\">this</span>.<span class=\"title function_\">ROTL</span>(bb, <span class=\"number\">23</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> rk;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">sm4Sbox</span> = <span class=\"keyword\">function</span> (<span class=\"params\">inch</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> i = inch &amp; <span class=\"number\">0xff</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> retVal = <span class=\"title class_\">SboxTable</span>[i];</span><br><span class=\"line\">    <span class=\"keyword\">return</span> retVal &gt; <span class=\"number\">128</span> ? retVal - <span class=\"number\">256</span> : retVal;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">sm4_setkey_enc</span> = <span class=\"keyword\">function</span> (<span class=\"params\">ctx, key</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">alert</span>(<span class=\"string\">&#x27;ctx is null!&#x27;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (key == <span class=\"literal\">null</span> || key.<span class=\"property\">length</span> != <span class=\"number\">16</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">alert</span>(<span class=\"string\">&#x27;key error!&#x27;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ctx.<span class=\"property\">mode</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_ENCRYPT</span>;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4_setkey</span>(ctx.<span class=\"property\">sk</span>, key);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">sm4_setkey</span> = <span class=\"keyword\">function</span> (<span class=\"params\">SK, key</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> <span class=\"variable constant_\">MK</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">4</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> k = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">36</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"variable constant_\">MK</span>[<span class=\"number\">0</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">GET_ULONG_BE</span>(key, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"variable constant_\">MK</span>[<span class=\"number\">1</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">GET_ULONG_BE</span>(key, <span class=\"number\">4</span>);</span><br><span class=\"line\">    <span class=\"variable constant_\">MK</span>[<span class=\"number\">2</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">GET_ULONG_BE</span>(key, <span class=\"number\">8</span>);</span><br><span class=\"line\">    <span class=\"variable constant_\">MK</span>[<span class=\"number\">3</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">GET_ULONG_BE</span>(key, <span class=\"number\">12</span>);</span><br><span class=\"line\">    k[<span class=\"number\">0</span>] = <span class=\"variable constant_\">MK</span>[<span class=\"number\">0</span>] ^ <span class=\"variable constant_\">FK</span>[<span class=\"number\">0</span>];</span><br><span class=\"line\">    k[<span class=\"number\">1</span>] = <span class=\"variable constant_\">MK</span>[<span class=\"number\">1</span>] ^ <span class=\"variable constant_\">FK</span>[<span class=\"number\">1</span>];</span><br><span class=\"line\">    k[<span class=\"number\">2</span>] = <span class=\"variable constant_\">MK</span>[<span class=\"number\">2</span>] ^ <span class=\"variable constant_\">FK</span>[<span class=\"number\">2</span>];</span><br><span class=\"line\">    k[<span class=\"number\">3</span>] = <span class=\"variable constant_\">MK</span>[<span class=\"number\">3</span>] ^ <span class=\"variable constant_\">FK</span>[<span class=\"number\">3</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">32</span>; i++) &#123;</span><br><span class=\"line\">      k[i + <span class=\"number\">4</span>] = k[i] ^ <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4CalciRK</span>(k[i + <span class=\"number\">1</span>] ^ k[i + <span class=\"number\">2</span>] ^ k[i + <span class=\"number\">3</span>] ^ <span class=\"variable constant_\">CK</span>[i]);</span><br><span class=\"line\">      <span class=\"variable constant_\">SK</span>[i] = k[i + <span class=\"number\">4</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">padding</span> = <span class=\"keyword\">function</span> (<span class=\"params\">input, mode</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (input == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ret = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mode == <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_ENCRYPT</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> p = <span class=\"built_in\">parseInt</span>(<span class=\"number\">16</span> - (input.<span class=\"property\">length</span> % <span class=\"number\">16</span>));</span><br><span class=\"line\">      ret = input.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; p; i++) &#123;</span><br><span class=\"line\">        ret[input.<span class=\"property\">length</span> + i] = p;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> p = input[input.<span class=\"property\">length</span> - <span class=\"number\">1</span>];</span><br><span class=\"line\">      ret = input.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>, input.<span class=\"property\">length</span> - p);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">sm4_one_round</span> = <span class=\"keyword\">function</span> (<span class=\"params\">sk, input, output</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ulbuf = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">36</span>);</span><br><span class=\"line\">    ulbuf[<span class=\"number\">0</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">GET_ULONG_BE</span>(input, <span class=\"number\">0</span>);</span><br><span class=\"line\">    ulbuf[<span class=\"number\">1</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">GET_ULONG_BE</span>(input, <span class=\"number\">4</span>);</span><br><span class=\"line\">    ulbuf[<span class=\"number\">2</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">GET_ULONG_BE</span>(input, <span class=\"number\">8</span>);</span><br><span class=\"line\">    ulbuf[<span class=\"number\">3</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">GET_ULONG_BE</span>(input, <span class=\"number\">12</span>);</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (i &lt; <span class=\"number\">32</span>) &#123;</span><br><span class=\"line\">      ulbuf[i + <span class=\"number\">4</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4F</span>(ulbuf[i], ulbuf[i + <span class=\"number\">1</span>], ulbuf[i + <span class=\"number\">2</span>], ulbuf[i + <span class=\"number\">3</span>], sk[i]);</span><br><span class=\"line\">      i++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">PUT_ULONG_BE</span>(ulbuf[<span class=\"number\">35</span>], output, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">PUT_ULONG_BE</span>(ulbuf[<span class=\"number\">34</span>], output, <span class=\"number\">4</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">PUT_ULONG_BE</span>(ulbuf[<span class=\"number\">33</span>], output, <span class=\"number\">8</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">PUT_ULONG_BE</span>(ulbuf[<span class=\"number\">32</span>], output, <span class=\"number\">12</span>);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">sm4_crypt_ecb</span> = <span class=\"keyword\">function</span> (<span class=\"params\">ctx, input</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (input == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">alert</span>(<span class=\"string\">&#x27;input is null!&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx.<span class=\"property\">isPadding</span> &amp;&amp; ctx.<span class=\"property\">mode</span> == <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_ENCRYPT</span>) &#123;</span><br><span class=\"line\">      input = <span class=\"variable language_\">this</span>.<span class=\"title function_\">padding</span>(input, <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_ENCRYPT</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> length = input.<span class=\"property\">length</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> bous = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (; length &gt; <span class=\"number\">0</span>; length -= <span class=\"number\">16</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> out = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">16</span>);</span><br><span class=\"line\">      <span class=\"keyword\">var</span> ins = input.<span class=\"title function_\">slice</span>(i * <span class=\"number\">16</span>, <span class=\"number\">16</span> * (i + <span class=\"number\">1</span>));</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4_one_round</span>(ctx.<span class=\"property\">sk</span>, ins, out);</span><br><span class=\"line\">      bous = bous.<span class=\"title function_\">concat</span>(out);</span><br><span class=\"line\">      i++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> output = bous;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx.<span class=\"property\">isPadding</span> &amp;&amp; ctx.<span class=\"property\">mode</span> == <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_DECRYPT</span>) &#123;</span><br><span class=\"line\">      output = <span class=\"variable language_\">this</span>.<span class=\"title function_\">padding</span>(output, <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_DECRYPT</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; output.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (output[i] &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        output[i] = output[i] + <span class=\"number\">256</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> output;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">sm4_crypt_cbc</span> = <span class=\"keyword\">function</span> (<span class=\"params\">ctx, iv, input</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (iv == <span class=\"literal\">null</span> || iv.<span class=\"property\">length</span> != <span class=\"number\">16</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">alert</span>(<span class=\"string\">&#x27;iv error!&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (input == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">alert</span>(<span class=\"string\">&#x27;input is null!&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx.<span class=\"property\">isPadding</span> &amp;&amp; ctx.<span class=\"property\">mode</span> == <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_ENCRYPT</span>) &#123;</span><br><span class=\"line\">      input = <span class=\"variable language_\">this</span>.<span class=\"title function_\">padding</span>(input, <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_ENCRYPT</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> length = input.<span class=\"property\">length</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> bous = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx.<span class=\"property\">mode</span> == <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_ENCRYPT</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> k = <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (; length &gt; <span class=\"number\">0</span>; length -= <span class=\"number\">16</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> out = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">16</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> out1 = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">16</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> ins = input.<span class=\"title function_\">slice</span>(k * <span class=\"number\">16</span>, <span class=\"number\">16</span> * (k + <span class=\"number\">1</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">16</span>; i++) &#123;</span><br><span class=\"line\">          out[i] = ins[i] ^ iv[i];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4_one_round</span>(ctx.<span class=\"property\">sk</span>, out, out1);</span><br><span class=\"line\">        iv = out1.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>, <span class=\"number\">16</span>);</span><br><span class=\"line\">        bous = bous.<span class=\"title function_\">concat</span>(out1);</span><br><span class=\"line\">        k++;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> temp = [];</span><br><span class=\"line\">      <span class=\"keyword\">var</span> k = <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (; length &gt; <span class=\"number\">0</span>; length -= <span class=\"number\">16</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> out = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">16</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> out1 = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">16</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> ins = input.<span class=\"title function_\">slice</span>(k * <span class=\"number\">16</span>, <span class=\"number\">16</span> * (k + <span class=\"number\">1</span>));</span><br><span class=\"line\">        temp = ins.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>, <span class=\"number\">16</span>);</span><br><span class=\"line\">        <span class=\"title function_\">sm4_one_round</span>(ctx.<span class=\"property\">sk</span>, ins, out);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">16</span>; i++) &#123;</span><br><span class=\"line\">          out1[i] = out[i] ^ iv[i];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        iv = temp.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>, <span class=\"number\">16</span>);</span><br><span class=\"line\">        bous = bous.<span class=\"title function_\">concat</span>(out1);</span><br><span class=\"line\">        k++;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> output = bous;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx.<span class=\"property\">isPadding</span> &amp;&amp; ctx.<span class=\"property\">mode</span> == <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_DECRYPT</span>) &#123;</span><br><span class=\"line\">      output = <span class=\"variable language_\">this</span>.<span class=\"title function_\">padding</span>(output, <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_DECRYPT</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; output.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (output[i] &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        output[i] = output[i] + <span class=\"number\">256</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> output;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> secretKey = <span class=\"string\">&#x27;w7bqTgHGZH5PD0cy&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\">// const iv = &#x27;&#x27;;</span></span><br><span class=\"line\"><span class=\"comment\">// const hexString = false;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">encryptData_ECB</span>(<span class=\"params\">plainText</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> sm4 = <span class=\"keyword\">new</span> <span class=\"title class_\">SM4</span>();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ctx = <span class=\"keyword\">new</span> <span class=\"title class_\">SM4</span>_Context();</span><br><span class=\"line\">    ctx.<span class=\"property\">isPadding</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    ctx.<span class=\"property\">mode</span> = sm4.<span class=\"property\">SM4_ENCRYPT</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> keyBytes = <span class=\"title function_\">stringToByte</span>(secretKey);</span><br><span class=\"line\">    sm4.<span class=\"title function_\">sm4_setkey_enc</span>(ctx, keyBytes);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> encrypted = sm4.<span class=\"title function_\">sm4_crypt_ecb</span>(ctx, <span class=\"title function_\">stringToByte</span>(plainText));</span><br><span class=\"line\">    <span class=\"keyword\">var</span> cipherText = base64js.<span class=\"title function_\">fromByteArray</span>(encrypted);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cipherText != <span class=\"literal\">null</span> &amp;&amp; cipherText.<span class=\"title function_\">trim</span>().<span class=\"property\">length</span> &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      cipherText.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/(\\s*|\\t|\\r|\\n)/g</span>, <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> cipherText;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(e);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * base64js</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * base64js</span></span><br><span class=\"line\"><span class=\"comment\"> * base64js.toByteArray(d.input)</span></span><br><span class=\"line\"><span class=\"comment\"> * base64js.fromByteArray(c);</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"comment\">//  (function(r) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//   if (typeof exports === &quot;object&quot; &amp;&amp; typeof module !== &quot;undefined&quot;) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//     module.exports = r();</span></span><br><span class=\"line\"><span class=\"comment\">//   &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//     if (typeof define === &quot;function&quot; &amp;&amp; define.amd) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//       define([], r);</span></span><br><span class=\"line\"><span class=\"comment\">//     &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//       var e;</span></span><br><span class=\"line\"><span class=\"comment\">//       if (typeof window !== &quot;undefined&quot;) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//         e = window;</span></span><br><span class=\"line\"><span class=\"comment\">//       &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//         if (typeof global !== &quot;undefined&quot;) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//           e = global;</span></span><br><span class=\"line\"><span class=\"comment\">//         &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//           if (typeof self !== &quot;undefined&quot;) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             e = self;</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             e = this;</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//         &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//       &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//       e.base64js = r();</span></span><br><span class=\"line\"><span class=\"comment\">//     &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//   &#125;</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;)(function() &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//   var r, e, t;</span></span><br><span class=\"line\"><span class=\"comment\">//   return (function r(e, t, n) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//     function o(i, a) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//       if (!t[i]) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//         if (!e[i]) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//           var u = typeof require == &quot;function&quot; &amp;&amp; require;</span></span><br><span class=\"line\"><span class=\"comment\">//           if (!a &amp;&amp; u) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             return u(i, !0);</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//           if (f) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             return f(i, !0);</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//           var d = new Error(&quot;Cannot find module &#x27;&quot; + i + &quot;&#x27;&quot;);</span></span><br><span class=\"line\"><span class=\"comment\">//           throw ((d.code = &quot;MODULE_NOT_FOUND&quot;), d);</span></span><br><span class=\"line\"><span class=\"comment\">//         &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//         var c = (t[i] = &#123; exports: &#123;&#125; &#125;);</span></span><br><span class=\"line\"><span class=\"comment\">//         e[i][0].call(</span></span><br><span class=\"line\"><span class=\"comment\">//           c.exports,</span></span><br><span class=\"line\"><span class=\"comment\">//           function(r) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             var t = e[i][1][r];</span></span><br><span class=\"line\"><span class=\"comment\">//             return o(t ? t : r);</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">//           c,</span></span><br><span class=\"line\"><span class=\"comment\">//           c.exports,</span></span><br><span class=\"line\"><span class=\"comment\">//           r,</span></span><br><span class=\"line\"><span class=\"comment\">//           e,</span></span><br><span class=\"line\"><span class=\"comment\">//           t,</span></span><br><span class=\"line\"><span class=\"comment\">//           n</span></span><br><span class=\"line\"><span class=\"comment\">//         );</span></span><br><span class=\"line\"><span class=\"comment\">//       &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//       return t[i].exports;</span></span><br><span class=\"line\"><span class=\"comment\">//     &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//     var f = typeof require == &quot;function&quot; &amp;&amp; require;</span></span><br><span class=\"line\"><span class=\"comment\">//     for (var i = 0; i &lt; n.length; i++) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//       o(n[i]);</span></span><br><span class=\"line\"><span class=\"comment\">//     &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//     return o;</span></span><br><span class=\"line\"><span class=\"comment\">//   &#125;)(</span></span><br><span class=\"line\"><span class=\"comment\">//     &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//       &quot;/&quot;: [</span></span><br><span class=\"line\"><span class=\"comment\">//         function(r, e, t) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//           t.byteLength = c;</span></span><br><span class=\"line\"><span class=\"comment\">//           t.toByteArray = v;</span></span><br><span class=\"line\"><span class=\"comment\">//           t.fromByteArray = s;</span></span><br><span class=\"line\"><span class=\"comment\">//           var n = [];</span></span><br><span class=\"line\"><span class=\"comment\">//           var o = [];</span></span><br><span class=\"line\"><span class=\"comment\">//           var f = typeof Uint8Array !== &quot;undefined&quot; ? Uint8Array : Array;</span></span><br><span class=\"line\"><span class=\"comment\">//           var i =</span></span><br><span class=\"line\"><span class=\"comment\">//             &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">//           for (var a = 0, u = i.length; a &lt; u; ++a) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             n[a] = i[a];</span></span><br><span class=\"line\"><span class=\"comment\">//             o[i.charCodeAt(a)] = a;</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//           o[&quot;-&quot;.charCodeAt(0)] = 62;</span></span><br><span class=\"line\"><span class=\"comment\">//           o[&quot;_&quot;.charCodeAt(0)] = 63;</span></span><br><span class=\"line\"><span class=\"comment\">//           function d(r) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             var e = r.length;</span></span><br><span class=\"line\"><span class=\"comment\">//             if (e % 4 &gt; 0) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//               throw new Error(&quot;Invalid string. Length must be a multiple of 4&quot;);</span></span><br><span class=\"line\"><span class=\"comment\">//             &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//             return r[e - 2] === &quot;=&quot; ? 2 : r[e - 1] === &quot;=&quot; ? 1 : 0;</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//           function c(r) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             return (r.length * 3) / 4 - d(r);</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//           function v(r) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             var e, t, n, i, a;</span></span><br><span class=\"line\"><span class=\"comment\">//             var u = r.length;</span></span><br><span class=\"line\"><span class=\"comment\">//             i = d(r);</span></span><br><span class=\"line\"><span class=\"comment\">//             a = new f((u * 3) / 4 - i);</span></span><br><span class=\"line\"><span class=\"comment\">//             t = i &gt; 0 ? u - 4 : u;</span></span><br><span class=\"line\"><span class=\"comment\">//             var c = 0;</span></span><br><span class=\"line\"><span class=\"comment\">//             for (e = 0; e &lt; t; e += 4) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//               n =</span></span><br><span class=\"line\"><span class=\"comment\">//                 (o[r.charCodeAt(e)] &lt;&lt; 18) |</span></span><br><span class=\"line\"><span class=\"comment\">//                 (o[r.charCodeAt(e + 1)] &lt;&lt; 12) |</span></span><br><span class=\"line\"><span class=\"comment\">//                 (o[r.charCodeAt(e + 2)] &lt;&lt; 6) |</span></span><br><span class=\"line\"><span class=\"comment\">//                 o[r.charCodeAt(e + 3)];</span></span><br><span class=\"line\"><span class=\"comment\">//               a[c++] = (n &gt;&gt; 16) &amp; 255;</span></span><br><span class=\"line\"><span class=\"comment\">//               a[c++] = (n &gt;&gt; 8) &amp; 255;</span></span><br><span class=\"line\"><span class=\"comment\">//               a[c++] = n &amp; 255;</span></span><br><span class=\"line\"><span class=\"comment\">//             &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//             if (i === 2) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//               n = (o[r.charCodeAt(e)] &lt;&lt; 2) | (o[r.charCodeAt(e + 1)] &gt;&gt; 4);</span></span><br><span class=\"line\"><span class=\"comment\">//               a[c++] = n &amp; 255;</span></span><br><span class=\"line\"><span class=\"comment\">//             &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//               if (i === 1) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//                 n =</span></span><br><span class=\"line\"><span class=\"comment\">//                   (o[r.charCodeAt(e)] &lt;&lt; 10) |</span></span><br><span class=\"line\"><span class=\"comment\">//                   (o[r.charCodeAt(e + 1)] &lt;&lt; 4) |</span></span><br><span class=\"line\"><span class=\"comment\">//                   (o[r.charCodeAt(e + 2)] &gt;&gt; 2);</span></span><br><span class=\"line\"><span class=\"comment\">//                 a[c++] = (n &gt;&gt; 8) &amp; 255;</span></span><br><span class=\"line\"><span class=\"comment\">//                 a[c++] = n &amp; 255;</span></span><br><span class=\"line\"><span class=\"comment\">//               &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//             &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//             return a;</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//           function l(r) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             return (</span></span><br><span class=\"line\"><span class=\"comment\">//               n[(r &gt;&gt; 18) &amp; 63] +</span></span><br><span class=\"line\"><span class=\"comment\">//               n[(r &gt;&gt; 12) &amp; 63] +</span></span><br><span class=\"line\"><span class=\"comment\">//               n[(r &gt;&gt; 6) &amp; 63] +</span></span><br><span class=\"line\"><span class=\"comment\">//               n[r &amp; 63]</span></span><br><span class=\"line\"><span class=\"comment\">//             );</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//           function h(r, e, t) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             var n;</span></span><br><span class=\"line\"><span class=\"comment\">//             var o = [];</span></span><br><span class=\"line\"><span class=\"comment\">//             for (var f = e; f &lt; t; f += 3) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//               n = (r[f] &lt;&lt; 16) + (r[f + 1] &lt;&lt; 8) + r[f + 2];</span></span><br><span class=\"line\"><span class=\"comment\">//               o.push(l(n));</span></span><br><span class=\"line\"><span class=\"comment\">//             &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//             return o.join(&quot;&quot;);</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//           function s(r) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             var e;</span></span><br><span class=\"line\"><span class=\"comment\">//             var t = r.length;</span></span><br><span class=\"line\"><span class=\"comment\">//             var o = t % 3;</span></span><br><span class=\"line\"><span class=\"comment\">//             var f = &quot;&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">//             var i = [];</span></span><br><span class=\"line\"><span class=\"comment\">//             var a = 16383;</span></span><br><span class=\"line\"><span class=\"comment\">//             for (var u = 0, d = t - o; u &lt; d; u += a) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//               i.push(h(r, u, u + a &gt; d ? d : u + a));</span></span><br><span class=\"line\"><span class=\"comment\">//             &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//             if (o === 1) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//               e = r[t - 1];</span></span><br><span class=\"line\"><span class=\"comment\">//               f += n[e &gt;&gt; 2];</span></span><br><span class=\"line\"><span class=\"comment\">//               f += n[(e &lt;&lt; 4) &amp; 63];</span></span><br><span class=\"line\"><span class=\"comment\">//               f += &quot;==&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">//             &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//               if (o === 2) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//                 e = (r[t - 2] &lt;&lt; 8) + r[t - 1];</span></span><br><span class=\"line\"><span class=\"comment\">//                 f += n[e &gt;&gt; 10];</span></span><br><span class=\"line\"><span class=\"comment\">//                 f += n[(e &gt;&gt; 4) &amp; 63];</span></span><br><span class=\"line\"><span class=\"comment\">//                 f += n[(e &lt;&lt; 2) &amp; 63];</span></span><br><span class=\"line\"><span class=\"comment\">//                 f += &quot;=&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">//               &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//             &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//             i.push(f);</span></span><br><span class=\"line\"><span class=\"comment\">//             return i.join(&quot;&quot;);</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//         &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">//         &#123;&#125;,</span></span><br><span class=\"line\"><span class=\"comment\">//       ],</span></span><br><span class=\"line\"><span class=\"comment\">//     &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">//     &#123;&#125;,</span></span><br><span class=\"line\"><span class=\"comment\">//     []</span></span><br><span class=\"line\"><span class=\"comment\">//   )(&quot;/&quot;);</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;);</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>国密 4 加密算法，网上多是 JAVA 版本，偶然见到有一个 TS 版本的。为了和后端保持一致的加密算法，需要在前端处理一些加密信息，所以改写为 JS 版本，备份以防之后丢失。</p>","more":"<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * @描述: 国密4加密算法</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Author</span>: Jingtaooo</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Date</span>: 2022/3/31 11:26 上午</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@FilePath</span>: /src/utils/system/SM4Util.js</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> base64js <span class=\"keyword\">from</span> <span class=\"string\">&#x27;base64-js&#x27;</span>; <span class=\"comment\">// 用base64-js模块包代替下面的base64js方法，减少代码量</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">SM4_Context</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">mode</span> = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">isPadding</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">sk</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">32</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> stringToByte = <span class=\"keyword\">function</span> (<span class=\"params\">str</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> bytes = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>();</span><br><span class=\"line\">  <span class=\"keyword\">var</span> len, c;</span><br><span class=\"line\">  len = str.<span class=\"property\">length</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">    c = str.<span class=\"title function_\">charCodeAt</span>(i);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (c &gt;= <span class=\"number\">0x010000</span> &amp;&amp; c &lt;= <span class=\"number\">0x10ffff</span>) &#123;</span><br><span class=\"line\">      bytes.<span class=\"title function_\">push</span>(((c &gt;&gt; <span class=\"number\">18</span>) &amp; <span class=\"number\">0x07</span>) | <span class=\"number\">0xf0</span>);</span><br><span class=\"line\">      bytes.<span class=\"title function_\">push</span>(((c &gt;&gt; <span class=\"number\">12</span>) &amp; <span class=\"number\">0x3f</span>) | <span class=\"number\">0x80</span>);</span><br><span class=\"line\">      bytes.<span class=\"title function_\">push</span>(((c &gt;&gt; <span class=\"number\">6</span>) &amp; <span class=\"number\">0x3f</span>) | <span class=\"number\">0x80</span>);</span><br><span class=\"line\">      bytes.<span class=\"title function_\">push</span>((c &amp; <span class=\"number\">0x3f</span>) | <span class=\"number\">0x80</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (c &gt;= <span class=\"number\">0x000800</span> &amp;&amp; c &lt;= <span class=\"number\">0x00ffff</span>) &#123;</span><br><span class=\"line\">      bytes.<span class=\"title function_\">push</span>(((c &gt;&gt; <span class=\"number\">12</span>) &amp; <span class=\"number\">0x0f</span>) | <span class=\"number\">0xe0</span>);</span><br><span class=\"line\">      bytes.<span class=\"title function_\">push</span>(((c &gt;&gt; <span class=\"number\">6</span>) &amp; <span class=\"number\">0x3f</span>) | <span class=\"number\">0x80</span>);</span><br><span class=\"line\">      bytes.<span class=\"title function_\">push</span>((c &amp; <span class=\"number\">0x3f</span>) | <span class=\"number\">0x80</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (c &gt;= <span class=\"number\">0x000080</span> &amp;&amp; c &lt;= <span class=\"number\">0x0007ff</span>) &#123;</span><br><span class=\"line\">      bytes.<span class=\"title function_\">push</span>(((c &gt;&gt; <span class=\"number\">6</span>) &amp; <span class=\"number\">0x1f</span>) | <span class=\"number\">0xc0</span>);</span><br><span class=\"line\">      bytes.<span class=\"title function_\">push</span>((c &amp; <span class=\"number\">0x3f</span>) | <span class=\"number\">0x80</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      bytes.<span class=\"title function_\">push</span>(c &amp; <span class=\"number\">0xff</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> bytes;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">SM4</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_ENCRYPT</span> = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_DECRYPT</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> <span class=\"title class_\">SboxTable</span> = [</span><br><span class=\"line\">    <span class=\"number\">0xd6</span>, <span class=\"number\">0x90</span>, <span class=\"number\">0xe9</span>, <span class=\"number\">0xfe</span>, <span class=\"number\">0xcc</span>, <span class=\"number\">0xe1</span>, <span class=\"number\">0x3d</span>, <span class=\"number\">0xb7</span>, <span class=\"number\">0x16</span>, <span class=\"number\">0xb6</span>, <span class=\"number\">0x14</span>, <span class=\"number\">0xc2</span>, <span class=\"number\">0x28</span>, <span class=\"number\">0xfb</span>, <span class=\"number\">0x2c</span>, <span class=\"number\">0x05</span>, <span class=\"number\">0x2b</span>, <span class=\"number\">0x67</span>, <span class=\"number\">0x9a</span>, <span class=\"number\">0x76</span>, <span class=\"number\">0x2a</span>, <span class=\"number\">0xbe</span>, <span class=\"number\">0x04</span>, <span class=\"number\">0xc3</span>, <span class=\"number\">0xaa</span>, <span class=\"number\">0x44</span>, <span class=\"number\">0x13</span>, <span class=\"number\">0x26</span>, <span class=\"number\">0x49</span>,</span><br><span class=\"line\">    <span class=\"number\">0x86</span>, <span class=\"number\">0x06</span>, <span class=\"number\">0x99</span>, <span class=\"number\">0x9c</span>, <span class=\"number\">0x42</span>, <span class=\"number\">0x50</span>, <span class=\"number\">0xf4</span>, <span class=\"number\">0x91</span>, <span class=\"number\">0xef</span>, <span class=\"number\">0x98</span>, <span class=\"number\">0x7a</span>, <span class=\"number\">0x33</span>, <span class=\"number\">0x54</span>, <span class=\"number\">0x0b</span>, <span class=\"number\">0x43</span>, <span class=\"number\">0xed</span>, <span class=\"number\">0xcf</span>, <span class=\"number\">0xac</span>, <span class=\"number\">0x62</span>, <span class=\"number\">0xe4</span>, <span class=\"number\">0xb3</span>, <span class=\"number\">0x1c</span>, <span class=\"number\">0xa9</span>, <span class=\"number\">0xc9</span>, <span class=\"number\">0x08</span>, <span class=\"number\">0xe8</span>, <span class=\"number\">0x95</span>, <span class=\"number\">0x80</span>, <span class=\"number\">0xdf</span>,</span><br><span class=\"line\">    <span class=\"number\">0x94</span>, <span class=\"number\">0xfa</span>, <span class=\"number\">0x75</span>, <span class=\"number\">0x8f</span>, <span class=\"number\">0x3f</span>, <span class=\"number\">0xa6</span>, <span class=\"number\">0x47</span>, <span class=\"number\">0x07</span>, <span class=\"number\">0xa7</span>, <span class=\"number\">0xfc</span>, <span class=\"number\">0xf3</span>, <span class=\"number\">0x73</span>, <span class=\"number\">0x17</span>, <span class=\"number\">0xba</span>, <span class=\"number\">0x83</span>, <span class=\"number\">0x59</span>, <span class=\"number\">0x3c</span>, <span class=\"number\">0x19</span>, <span class=\"number\">0xe6</span>, <span class=\"number\">0x85</span>, <span class=\"number\">0x4f</span>, <span class=\"number\">0xa8</span>, <span class=\"number\">0x68</span>, <span class=\"number\">0x6b</span>, <span class=\"number\">0x81</span>, <span class=\"number\">0xb2</span>, <span class=\"number\">0x71</span>, <span class=\"number\">0x64</span>, <span class=\"number\">0xda</span>,</span><br><span class=\"line\">    <span class=\"number\">0x8b</span>, <span class=\"number\">0xf8</span>, <span class=\"number\">0xeb</span>, <span class=\"number\">0x0f</span>, <span class=\"number\">0x4b</span>, <span class=\"number\">0x70</span>, <span class=\"number\">0x56</span>, <span class=\"number\">0x9d</span>, <span class=\"number\">0x35</span>, <span class=\"number\">0x1e</span>, <span class=\"number\">0x24</span>, <span class=\"number\">0x0e</span>, <span class=\"number\">0x5e</span>, <span class=\"number\">0x63</span>, <span class=\"number\">0x58</span>, <span class=\"number\">0xd1</span>, <span class=\"number\">0xa2</span>, <span class=\"number\">0x25</span>, <span class=\"number\">0x22</span>, <span class=\"number\">0x7c</span>, <span class=\"number\">0x3b</span>, <span class=\"number\">0x01</span>, <span class=\"number\">0x21</span>, <span class=\"number\">0x78</span>, <span class=\"number\">0x87</span>, <span class=\"number\">0xd4</span>, <span class=\"number\">0x00</span>, <span class=\"number\">0x46</span>, <span class=\"number\">0x57</span>,</span><br><span class=\"line\">    <span class=\"number\">0x9f</span>, <span class=\"number\">0xd3</span>, <span class=\"number\">0x27</span>, <span class=\"number\">0x52</span>, <span class=\"number\">0x4c</span>, <span class=\"number\">0x36</span>, <span class=\"number\">0x02</span>, <span class=\"number\">0xe7</span>, <span class=\"number\">0xa0</span>, <span class=\"number\">0xc4</span>, <span class=\"number\">0xc8</span>, <span class=\"number\">0x9e</span>, <span class=\"number\">0xea</span>, <span class=\"number\">0xbf</span>, <span class=\"number\">0x8a</span>, <span class=\"number\">0xd2</span>, <span class=\"number\">0x40</span>, <span class=\"number\">0xc7</span>, <span class=\"number\">0x38</span>, <span class=\"number\">0xb5</span>, <span class=\"number\">0xa3</span>, <span class=\"number\">0xf7</span>, <span class=\"number\">0xf2</span>, <span class=\"number\">0xce</span>, <span class=\"number\">0xf9</span>, <span class=\"number\">0x61</span>, <span class=\"number\">0x15</span>, <span class=\"number\">0xa1</span>, <span class=\"number\">0xe0</span>,</span><br><span class=\"line\">    <span class=\"number\">0xae</span>, <span class=\"number\">0x5d</span>, <span class=\"number\">0xa4</span>, <span class=\"number\">0x9b</span>, <span class=\"number\">0x34</span>, <span class=\"number\">0x1a</span>, <span class=\"number\">0x55</span>, <span class=\"number\">0xad</span>, <span class=\"number\">0x93</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0xf5</span>, <span class=\"number\">0x8c</span>, <span class=\"number\">0xb1</span>, <span class=\"number\">0xe3</span>, <span class=\"number\">0x1d</span>, <span class=\"number\">0xf6</span>, <span class=\"number\">0xe2</span>, <span class=\"number\">0x2e</span>, <span class=\"number\">0x82</span>, <span class=\"number\">0x66</span>, <span class=\"number\">0xca</span>, <span class=\"number\">0x60</span>, <span class=\"number\">0xc0</span>, <span class=\"number\">0x29</span>, <span class=\"number\">0x23</span>, <span class=\"number\">0xab</span>, <span class=\"number\">0x0d</span>, <span class=\"number\">0x53</span>,</span><br><span class=\"line\">    <span class=\"number\">0x4e</span>, <span class=\"number\">0x6f</span>, <span class=\"number\">0xd5</span>, <span class=\"number\">0xdb</span>, <span class=\"number\">0x37</span>, <span class=\"number\">0x45</span>, <span class=\"number\">0xde</span>, <span class=\"number\">0xfd</span>, <span class=\"number\">0x8e</span>, <span class=\"number\">0x2f</span>, <span class=\"number\">0x03</span>, <span class=\"number\">0xff</span>, <span class=\"number\">0x6a</span>, <span class=\"number\">0x72</span>, <span class=\"number\">0x6d</span>, <span class=\"number\">0x6c</span>, <span class=\"number\">0x5b</span>, <span class=\"number\">0x51</span>, <span class=\"number\">0x8d</span>, <span class=\"number\">0x1b</span>, <span class=\"number\">0xaf</span>, <span class=\"number\">0x92</span>, <span class=\"number\">0xbb</span>, <span class=\"number\">0xdd</span>, <span class=\"number\">0xbc</span>, <span class=\"number\">0x7f</span>, <span class=\"number\">0x11</span>, <span class=\"number\">0xd9</span>, <span class=\"number\">0x5c</span>,</span><br><span class=\"line\">    <span class=\"number\">0x41</span>, <span class=\"number\">0x1f</span>, <span class=\"number\">0x10</span>, <span class=\"number\">0x5a</span>, <span class=\"number\">0xd8</span>, <span class=\"number\">0x0a</span>, <span class=\"number\">0xc1</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0x88</span>, <span class=\"number\">0xa5</span>, <span class=\"number\">0xcd</span>, <span class=\"number\">0x7b</span>, <span class=\"number\">0xbd</span>, <span class=\"number\">0x2d</span>, <span class=\"number\">0x74</span>, <span class=\"number\">0xd0</span>, <span class=\"number\">0x12</span>, <span class=\"number\">0xb8</span>, <span class=\"number\">0xe5</span>, <span class=\"number\">0xb4</span>, <span class=\"number\">0xb0</span>, <span class=\"number\">0x89</span>, <span class=\"number\">0x69</span>, <span class=\"number\">0x97</span>, <span class=\"number\">0x4a</span>, <span class=\"number\">0x0c</span>, <span class=\"number\">0x96</span>, <span class=\"number\">0x77</span>, <span class=\"number\">0x7e</span>,</span><br><span class=\"line\">    <span class=\"number\">0x65</span>, <span class=\"number\">0xb9</span>, <span class=\"number\">0xf1</span>, <span class=\"number\">0x09</span>, <span class=\"number\">0xc5</span>, <span class=\"number\">0x6e</span>, <span class=\"number\">0xc6</span>, <span class=\"number\">0x84</span>, <span class=\"number\">0x18</span>, <span class=\"number\">0xf0</span>, <span class=\"number\">0x7d</span>, <span class=\"number\">0xec</span>, <span class=\"number\">0x3a</span>, <span class=\"number\">0xdc</span>, <span class=\"number\">0x4d</span>, <span class=\"number\">0x20</span>, <span class=\"number\">0x79</span>, <span class=\"number\">0xee</span>, <span class=\"number\">0x5f</span>, <span class=\"number\">0x3e</span>, <span class=\"number\">0xd7</span>, <span class=\"number\">0xcb</span>, <span class=\"number\">0x39</span>, <span class=\"number\">0x48</span>,</span><br><span class=\"line\">  ];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> <span class=\"variable constant_\">FK</span> = [<span class=\"number\">0xa3b1bac6</span>, <span class=\"number\">0x56aa3350</span>, <span class=\"number\">0x677d9197</span>, <span class=\"number\">0xb27022dc</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> <span class=\"variable constant_\">CK</span> = [</span><br><span class=\"line\">    <span class=\"number\">0x00070e15</span>, <span class=\"number\">0x1c232a31</span>, <span class=\"number\">0x383f464d</span>, <span class=\"number\">0x545b6269</span>, <span class=\"number\">0x70777e85</span>, <span class=\"number\">0x8c939aa1</span>, <span class=\"number\">0xa8afb6bd</span>, <span class=\"number\">0xc4cbd2d9</span>, <span class=\"number\">0xe0e7eef5</span>, <span class=\"number\">0xfc030a11</span>, <span class=\"number\">0x181f262d</span>, <span class=\"number\">0x343b4249</span>, <span class=\"number\">0x50575e65</span>, <span class=\"number\">0x6c737a81</span>,</span><br><span class=\"line\">    <span class=\"number\">0x888f969d</span>, <span class=\"number\">0xa4abb2b9</span>, <span class=\"number\">0xc0c7ced5</span>, <span class=\"number\">0xdce3eaf1</span>, <span class=\"number\">0xf8ff060d</span>, <span class=\"number\">0x141b2229</span>, <span class=\"number\">0x30373e45</span>, <span class=\"number\">0x4c535a61</span>, <span class=\"number\">0x686f767d</span>, <span class=\"number\">0x848b9299</span>, <span class=\"number\">0xa0a7aeb5</span>, <span class=\"number\">0xbcc3cad1</span>, <span class=\"number\">0xd8dfe6ed</span>, <span class=\"number\">0xf4fb0209</span>,</span><br><span class=\"line\">    <span class=\"number\">0x10171e25</span>, <span class=\"number\">0x2c333a41</span>, <span class=\"number\">0x484f565d</span>, <span class=\"number\">0x646b7279</span>,</span><br><span class=\"line\">  ];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">GET_ULONG_BE</span> = <span class=\"keyword\">function</span> (<span class=\"params\">b, i</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ((b[i] &amp; <span class=\"number\">0xff</span>) &lt;&lt; <span class=\"number\">24</span>) | ((b[i + <span class=\"number\">1</span>] &amp; <span class=\"number\">0xff</span>) &lt;&lt; <span class=\"number\">16</span>) | ((b[i + <span class=\"number\">2</span>] &amp; <span class=\"number\">0xff</span>) &lt;&lt; <span class=\"number\">8</span>) | (b[i + <span class=\"number\">3</span>] &amp; <span class=\"number\">0xff</span> &amp; <span class=\"number\">0xffffffff</span>);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">PUT_ULONG_BE</span> = <span class=\"keyword\">function</span> (<span class=\"params\">n, b, i</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> t1 = <span class=\"number\">0xff</span> &amp; (n &gt;&gt; <span class=\"number\">24</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> t2 = <span class=\"number\">0xff</span> &amp; (n &gt;&gt; <span class=\"number\">16</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> t3 = <span class=\"number\">0xff</span> &amp; (n &gt;&gt; <span class=\"number\">8</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> t4 = <span class=\"number\">0xff</span> &amp; n;</span><br><span class=\"line\">    b[i] = t1 &gt; <span class=\"number\">128</span> ? t1 - <span class=\"number\">256</span> : t1;</span><br><span class=\"line\">    b[i + <span class=\"number\">1</span>] = t2 &gt; <span class=\"number\">128</span> ? t2 - <span class=\"number\">256</span> : t2;</span><br><span class=\"line\">    b[i + <span class=\"number\">2</span>] = t3 &gt; <span class=\"number\">128</span> ? t3 - <span class=\"number\">256</span> : t3;</span><br><span class=\"line\">    b[i + <span class=\"number\">3</span>] = t4 &gt; <span class=\"number\">128</span> ? t4 - <span class=\"number\">256</span> : t4;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">SHL</span> = <span class=\"keyword\">function</span> (<span class=\"params\">x, n</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (x &amp; <span class=\"number\">0xffffffff</span>) &lt;&lt; n;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">ROTL</span> = <span class=\"keyword\">function</span> (<span class=\"params\">x, n</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> s = <span class=\"variable language_\">this</span>.<span class=\"title function_\">SHL</span>(x, n);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ss = x &gt;&gt; (<span class=\"number\">32</span> - n);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"title function_\">SHL</span>(x, n) | (x &gt;&gt; (<span class=\"number\">32</span> - n));</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">sm4Lt</span> = <span class=\"keyword\">function</span> (<span class=\"params\">ka</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> bb = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> c = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> a = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">4</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> b = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">4</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">PUT_ULONG_BE</span>(ka, a, <span class=\"number\">0</span>);</span><br><span class=\"line\">    b[<span class=\"number\">0</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4Sbox</span>(a[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    b[<span class=\"number\">1</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4Sbox</span>(a[<span class=\"number\">1</span>]);</span><br><span class=\"line\">    b[<span class=\"number\">2</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4Sbox</span>(a[<span class=\"number\">2</span>]);</span><br><span class=\"line\">    b[<span class=\"number\">3</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4Sbox</span>(a[<span class=\"number\">3</span>]);</span><br><span class=\"line\">    bb = <span class=\"variable language_\">this</span>.<span class=\"title function_\">GET_ULONG_BE</span>(b, <span class=\"number\">0</span>);</span><br><span class=\"line\">    c = bb ^ <span class=\"variable language_\">this</span>.<span class=\"title function_\">ROTL</span>(bb, <span class=\"number\">2</span>) ^ <span class=\"variable language_\">this</span>.<span class=\"title function_\">ROTL</span>(bb, <span class=\"number\">10</span>) ^ <span class=\"variable language_\">this</span>.<span class=\"title function_\">ROTL</span>(bb, <span class=\"number\">18</span>) ^ <span class=\"variable language_\">this</span>.<span class=\"title function_\">ROTL</span>(bb, <span class=\"number\">24</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> c;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">sm4F</span> = <span class=\"keyword\">function</span> (<span class=\"params\">x0, x1, x2, x3, rk</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x0 ^ <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4Lt</span>(x1 ^ x2 ^ x3 ^ rk);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">sm4CalciRK</span> = <span class=\"keyword\">function</span> (<span class=\"params\">ka</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> bb = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> rk = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> a = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">4</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> b = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">4</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">PUT_ULONG_BE</span>(ka, a, <span class=\"number\">0</span>);</span><br><span class=\"line\">    b[<span class=\"number\">0</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4Sbox</span>(a[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    b[<span class=\"number\">1</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4Sbox</span>(a[<span class=\"number\">1</span>]);</span><br><span class=\"line\">    b[<span class=\"number\">2</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4Sbox</span>(a[<span class=\"number\">2</span>]);</span><br><span class=\"line\">    b[<span class=\"number\">3</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4Sbox</span>(a[<span class=\"number\">3</span>]);</span><br><span class=\"line\">    bb = <span class=\"variable language_\">this</span>.<span class=\"title function_\">GET_ULONG_BE</span>(b, <span class=\"number\">0</span>);</span><br><span class=\"line\">    rk = bb ^ <span class=\"variable language_\">this</span>.<span class=\"title function_\">ROTL</span>(bb, <span class=\"number\">13</span>) ^ <span class=\"variable language_\">this</span>.<span class=\"title function_\">ROTL</span>(bb, <span class=\"number\">23</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> rk;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">sm4Sbox</span> = <span class=\"keyword\">function</span> (<span class=\"params\">inch</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> i = inch &amp; <span class=\"number\">0xff</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> retVal = <span class=\"title class_\">SboxTable</span>[i];</span><br><span class=\"line\">    <span class=\"keyword\">return</span> retVal &gt; <span class=\"number\">128</span> ? retVal - <span class=\"number\">256</span> : retVal;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">sm4_setkey_enc</span> = <span class=\"keyword\">function</span> (<span class=\"params\">ctx, key</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">alert</span>(<span class=\"string\">&#x27;ctx is null!&#x27;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (key == <span class=\"literal\">null</span> || key.<span class=\"property\">length</span> != <span class=\"number\">16</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">alert</span>(<span class=\"string\">&#x27;key error!&#x27;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ctx.<span class=\"property\">mode</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_ENCRYPT</span>;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4_setkey</span>(ctx.<span class=\"property\">sk</span>, key);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">sm4_setkey</span> = <span class=\"keyword\">function</span> (<span class=\"params\">SK, key</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> <span class=\"variable constant_\">MK</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">4</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> k = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">36</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"variable constant_\">MK</span>[<span class=\"number\">0</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">GET_ULONG_BE</span>(key, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"variable constant_\">MK</span>[<span class=\"number\">1</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">GET_ULONG_BE</span>(key, <span class=\"number\">4</span>);</span><br><span class=\"line\">    <span class=\"variable constant_\">MK</span>[<span class=\"number\">2</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">GET_ULONG_BE</span>(key, <span class=\"number\">8</span>);</span><br><span class=\"line\">    <span class=\"variable constant_\">MK</span>[<span class=\"number\">3</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">GET_ULONG_BE</span>(key, <span class=\"number\">12</span>);</span><br><span class=\"line\">    k[<span class=\"number\">0</span>] = <span class=\"variable constant_\">MK</span>[<span class=\"number\">0</span>] ^ <span class=\"variable constant_\">FK</span>[<span class=\"number\">0</span>];</span><br><span class=\"line\">    k[<span class=\"number\">1</span>] = <span class=\"variable constant_\">MK</span>[<span class=\"number\">1</span>] ^ <span class=\"variable constant_\">FK</span>[<span class=\"number\">1</span>];</span><br><span class=\"line\">    k[<span class=\"number\">2</span>] = <span class=\"variable constant_\">MK</span>[<span class=\"number\">2</span>] ^ <span class=\"variable constant_\">FK</span>[<span class=\"number\">2</span>];</span><br><span class=\"line\">    k[<span class=\"number\">3</span>] = <span class=\"variable constant_\">MK</span>[<span class=\"number\">3</span>] ^ <span class=\"variable constant_\">FK</span>[<span class=\"number\">3</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">32</span>; i++) &#123;</span><br><span class=\"line\">      k[i + <span class=\"number\">4</span>] = k[i] ^ <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4CalciRK</span>(k[i + <span class=\"number\">1</span>] ^ k[i + <span class=\"number\">2</span>] ^ k[i + <span class=\"number\">3</span>] ^ <span class=\"variable constant_\">CK</span>[i]);</span><br><span class=\"line\">      <span class=\"variable constant_\">SK</span>[i] = k[i + <span class=\"number\">4</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">padding</span> = <span class=\"keyword\">function</span> (<span class=\"params\">input, mode</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (input == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ret = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mode == <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_ENCRYPT</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> p = <span class=\"built_in\">parseInt</span>(<span class=\"number\">16</span> - (input.<span class=\"property\">length</span> % <span class=\"number\">16</span>));</span><br><span class=\"line\">      ret = input.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; p; i++) &#123;</span><br><span class=\"line\">        ret[input.<span class=\"property\">length</span> + i] = p;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> p = input[input.<span class=\"property\">length</span> - <span class=\"number\">1</span>];</span><br><span class=\"line\">      ret = input.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>, input.<span class=\"property\">length</span> - p);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">sm4_one_round</span> = <span class=\"keyword\">function</span> (<span class=\"params\">sk, input, output</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ulbuf = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">36</span>);</span><br><span class=\"line\">    ulbuf[<span class=\"number\">0</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">GET_ULONG_BE</span>(input, <span class=\"number\">0</span>);</span><br><span class=\"line\">    ulbuf[<span class=\"number\">1</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">GET_ULONG_BE</span>(input, <span class=\"number\">4</span>);</span><br><span class=\"line\">    ulbuf[<span class=\"number\">2</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">GET_ULONG_BE</span>(input, <span class=\"number\">8</span>);</span><br><span class=\"line\">    ulbuf[<span class=\"number\">3</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">GET_ULONG_BE</span>(input, <span class=\"number\">12</span>);</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (i &lt; <span class=\"number\">32</span>) &#123;</span><br><span class=\"line\">      ulbuf[i + <span class=\"number\">4</span>] = <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4F</span>(ulbuf[i], ulbuf[i + <span class=\"number\">1</span>], ulbuf[i + <span class=\"number\">2</span>], ulbuf[i + <span class=\"number\">3</span>], sk[i]);</span><br><span class=\"line\">      i++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">PUT_ULONG_BE</span>(ulbuf[<span class=\"number\">35</span>], output, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">PUT_ULONG_BE</span>(ulbuf[<span class=\"number\">34</span>], output, <span class=\"number\">4</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">PUT_ULONG_BE</span>(ulbuf[<span class=\"number\">33</span>], output, <span class=\"number\">8</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">PUT_ULONG_BE</span>(ulbuf[<span class=\"number\">32</span>], output, <span class=\"number\">12</span>);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">sm4_crypt_ecb</span> = <span class=\"keyword\">function</span> (<span class=\"params\">ctx, input</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (input == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">alert</span>(<span class=\"string\">&#x27;input is null!&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx.<span class=\"property\">isPadding</span> &amp;&amp; ctx.<span class=\"property\">mode</span> == <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_ENCRYPT</span>) &#123;</span><br><span class=\"line\">      input = <span class=\"variable language_\">this</span>.<span class=\"title function_\">padding</span>(input, <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_ENCRYPT</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> length = input.<span class=\"property\">length</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> bous = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (; length &gt; <span class=\"number\">0</span>; length -= <span class=\"number\">16</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> out = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">16</span>);</span><br><span class=\"line\">      <span class=\"keyword\">var</span> ins = input.<span class=\"title function_\">slice</span>(i * <span class=\"number\">16</span>, <span class=\"number\">16</span> * (i + <span class=\"number\">1</span>));</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4_one_round</span>(ctx.<span class=\"property\">sk</span>, ins, out);</span><br><span class=\"line\">      bous = bous.<span class=\"title function_\">concat</span>(out);</span><br><span class=\"line\">      i++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> output = bous;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx.<span class=\"property\">isPadding</span> &amp;&amp; ctx.<span class=\"property\">mode</span> == <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_DECRYPT</span>) &#123;</span><br><span class=\"line\">      output = <span class=\"variable language_\">this</span>.<span class=\"title function_\">padding</span>(output, <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_DECRYPT</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; output.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (output[i] &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        output[i] = output[i] + <span class=\"number\">256</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> output;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">sm4_crypt_cbc</span> = <span class=\"keyword\">function</span> (<span class=\"params\">ctx, iv, input</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (iv == <span class=\"literal\">null</span> || iv.<span class=\"property\">length</span> != <span class=\"number\">16</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">alert</span>(<span class=\"string\">&#x27;iv error!&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (input == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">alert</span>(<span class=\"string\">&#x27;input is null!&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx.<span class=\"property\">isPadding</span> &amp;&amp; ctx.<span class=\"property\">mode</span> == <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_ENCRYPT</span>) &#123;</span><br><span class=\"line\">      input = <span class=\"variable language_\">this</span>.<span class=\"title function_\">padding</span>(input, <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_ENCRYPT</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> length = input.<span class=\"property\">length</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> bous = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx.<span class=\"property\">mode</span> == <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_ENCRYPT</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> k = <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (; length &gt; <span class=\"number\">0</span>; length -= <span class=\"number\">16</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> out = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">16</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> out1 = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">16</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> ins = input.<span class=\"title function_\">slice</span>(k * <span class=\"number\">16</span>, <span class=\"number\">16</span> * (k + <span class=\"number\">1</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">16</span>; i++) &#123;</span><br><span class=\"line\">          out[i] = ins[i] ^ iv[i];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">sm4_one_round</span>(ctx.<span class=\"property\">sk</span>, out, out1);</span><br><span class=\"line\">        iv = out1.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>, <span class=\"number\">16</span>);</span><br><span class=\"line\">        bous = bous.<span class=\"title function_\">concat</span>(out1);</span><br><span class=\"line\">        k++;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> temp = [];</span><br><span class=\"line\">      <span class=\"keyword\">var</span> k = <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (; length &gt; <span class=\"number\">0</span>; length -= <span class=\"number\">16</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> out = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">16</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> out1 = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>(<span class=\"number\">16</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> ins = input.<span class=\"title function_\">slice</span>(k * <span class=\"number\">16</span>, <span class=\"number\">16</span> * (k + <span class=\"number\">1</span>));</span><br><span class=\"line\">        temp = ins.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>, <span class=\"number\">16</span>);</span><br><span class=\"line\">        <span class=\"title function_\">sm4_one_round</span>(ctx.<span class=\"property\">sk</span>, ins, out);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">16</span>; i++) &#123;</span><br><span class=\"line\">          out1[i] = out[i] ^ iv[i];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        iv = temp.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>, <span class=\"number\">16</span>);</span><br><span class=\"line\">        bous = bous.<span class=\"title function_\">concat</span>(out1);</span><br><span class=\"line\">        k++;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> output = bous;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx.<span class=\"property\">isPadding</span> &amp;&amp; ctx.<span class=\"property\">mode</span> == <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_DECRYPT</span>) &#123;</span><br><span class=\"line\">      output = <span class=\"variable language_\">this</span>.<span class=\"title function_\">padding</span>(output, <span class=\"variable language_\">this</span>.<span class=\"property\">SM4_DECRYPT</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; output.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (output[i] &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        output[i] = output[i] + <span class=\"number\">256</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> output;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> secretKey = <span class=\"string\">&#x27;w7bqTgHGZH5PD0cy&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\">// const iv = &#x27;&#x27;;</span></span><br><span class=\"line\"><span class=\"comment\">// const hexString = false;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">encryptData_ECB</span>(<span class=\"params\">plainText</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> sm4 = <span class=\"keyword\">new</span> <span class=\"title class_\">SM4</span>();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ctx = <span class=\"keyword\">new</span> <span class=\"title class_\">SM4</span>_Context();</span><br><span class=\"line\">    ctx.<span class=\"property\">isPadding</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    ctx.<span class=\"property\">mode</span> = sm4.<span class=\"property\">SM4_ENCRYPT</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> keyBytes = <span class=\"title function_\">stringToByte</span>(secretKey);</span><br><span class=\"line\">    sm4.<span class=\"title function_\">sm4_setkey_enc</span>(ctx, keyBytes);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> encrypted = sm4.<span class=\"title function_\">sm4_crypt_ecb</span>(ctx, <span class=\"title function_\">stringToByte</span>(plainText));</span><br><span class=\"line\">    <span class=\"keyword\">var</span> cipherText = base64js.<span class=\"title function_\">fromByteArray</span>(encrypted);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cipherText != <span class=\"literal\">null</span> &amp;&amp; cipherText.<span class=\"title function_\">trim</span>().<span class=\"property\">length</span> &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      cipherText.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/(\\s*|\\t|\\r|\\n)/g</span>, <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> cipherText;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(e);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * base64js</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * base64js</span></span><br><span class=\"line\"><span class=\"comment\"> * base64js.toByteArray(d.input)</span></span><br><span class=\"line\"><span class=\"comment\"> * base64js.fromByteArray(c);</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"comment\">//  (function(r) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//   if (typeof exports === &quot;object&quot; &amp;&amp; typeof module !== &quot;undefined&quot;) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//     module.exports = r();</span></span><br><span class=\"line\"><span class=\"comment\">//   &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//     if (typeof define === &quot;function&quot; &amp;&amp; define.amd) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//       define([], r);</span></span><br><span class=\"line\"><span class=\"comment\">//     &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//       var e;</span></span><br><span class=\"line\"><span class=\"comment\">//       if (typeof window !== &quot;undefined&quot;) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//         e = window;</span></span><br><span class=\"line\"><span class=\"comment\">//       &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//         if (typeof global !== &quot;undefined&quot;) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//           e = global;</span></span><br><span class=\"line\"><span class=\"comment\">//         &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//           if (typeof self !== &quot;undefined&quot;) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             e = self;</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             e = this;</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//         &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//       &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//       e.base64js = r();</span></span><br><span class=\"line\"><span class=\"comment\">//     &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//   &#125;</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;)(function() &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//   var r, e, t;</span></span><br><span class=\"line\"><span class=\"comment\">//   return (function r(e, t, n) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//     function o(i, a) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//       if (!t[i]) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//         if (!e[i]) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//           var u = typeof require == &quot;function&quot; &amp;&amp; require;</span></span><br><span class=\"line\"><span class=\"comment\">//           if (!a &amp;&amp; u) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             return u(i, !0);</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//           if (f) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             return f(i, !0);</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//           var d = new Error(&quot;Cannot find module &#x27;&quot; + i + &quot;&#x27;&quot;);</span></span><br><span class=\"line\"><span class=\"comment\">//           throw ((d.code = &quot;MODULE_NOT_FOUND&quot;), d);</span></span><br><span class=\"line\"><span class=\"comment\">//         &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//         var c = (t[i] = &#123; exports: &#123;&#125; &#125;);</span></span><br><span class=\"line\"><span class=\"comment\">//         e[i][0].call(</span></span><br><span class=\"line\"><span class=\"comment\">//           c.exports,</span></span><br><span class=\"line\"><span class=\"comment\">//           function(r) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             var t = e[i][1][r];</span></span><br><span class=\"line\"><span class=\"comment\">//             return o(t ? t : r);</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">//           c,</span></span><br><span class=\"line\"><span class=\"comment\">//           c.exports,</span></span><br><span class=\"line\"><span class=\"comment\">//           r,</span></span><br><span class=\"line\"><span class=\"comment\">//           e,</span></span><br><span class=\"line\"><span class=\"comment\">//           t,</span></span><br><span class=\"line\"><span class=\"comment\">//           n</span></span><br><span class=\"line\"><span class=\"comment\">//         );</span></span><br><span class=\"line\"><span class=\"comment\">//       &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//       return t[i].exports;</span></span><br><span class=\"line\"><span class=\"comment\">//     &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//     var f = typeof require == &quot;function&quot; &amp;&amp; require;</span></span><br><span class=\"line\"><span class=\"comment\">//     for (var i = 0; i &lt; n.length; i++) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//       o(n[i]);</span></span><br><span class=\"line\"><span class=\"comment\">//     &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//     return o;</span></span><br><span class=\"line\"><span class=\"comment\">//   &#125;)(</span></span><br><span class=\"line\"><span class=\"comment\">//     &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//       &quot;/&quot;: [</span></span><br><span class=\"line\"><span class=\"comment\">//         function(r, e, t) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//           t.byteLength = c;</span></span><br><span class=\"line\"><span class=\"comment\">//           t.toByteArray = v;</span></span><br><span class=\"line\"><span class=\"comment\">//           t.fromByteArray = s;</span></span><br><span class=\"line\"><span class=\"comment\">//           var n = [];</span></span><br><span class=\"line\"><span class=\"comment\">//           var o = [];</span></span><br><span class=\"line\"><span class=\"comment\">//           var f = typeof Uint8Array !== &quot;undefined&quot; ? Uint8Array : Array;</span></span><br><span class=\"line\"><span class=\"comment\">//           var i =</span></span><br><span class=\"line\"><span class=\"comment\">//             &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">//           for (var a = 0, u = i.length; a &lt; u; ++a) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             n[a] = i[a];</span></span><br><span class=\"line\"><span class=\"comment\">//             o[i.charCodeAt(a)] = a;</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//           o[&quot;-&quot;.charCodeAt(0)] = 62;</span></span><br><span class=\"line\"><span class=\"comment\">//           o[&quot;_&quot;.charCodeAt(0)] = 63;</span></span><br><span class=\"line\"><span class=\"comment\">//           function d(r) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             var e = r.length;</span></span><br><span class=\"line\"><span class=\"comment\">//             if (e % 4 &gt; 0) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//               throw new Error(&quot;Invalid string. Length must be a multiple of 4&quot;);</span></span><br><span class=\"line\"><span class=\"comment\">//             &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//             return r[e - 2] === &quot;=&quot; ? 2 : r[e - 1] === &quot;=&quot; ? 1 : 0;</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//           function c(r) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             return (r.length * 3) / 4 - d(r);</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//           function v(r) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             var e, t, n, i, a;</span></span><br><span class=\"line\"><span class=\"comment\">//             var u = r.length;</span></span><br><span class=\"line\"><span class=\"comment\">//             i = d(r);</span></span><br><span class=\"line\"><span class=\"comment\">//             a = new f((u * 3) / 4 - i);</span></span><br><span class=\"line\"><span class=\"comment\">//             t = i &gt; 0 ? u - 4 : u;</span></span><br><span class=\"line\"><span class=\"comment\">//             var c = 0;</span></span><br><span class=\"line\"><span class=\"comment\">//             for (e = 0; e &lt; t; e += 4) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//               n =</span></span><br><span class=\"line\"><span class=\"comment\">//                 (o[r.charCodeAt(e)] &lt;&lt; 18) |</span></span><br><span class=\"line\"><span class=\"comment\">//                 (o[r.charCodeAt(e + 1)] &lt;&lt; 12) |</span></span><br><span class=\"line\"><span class=\"comment\">//                 (o[r.charCodeAt(e + 2)] &lt;&lt; 6) |</span></span><br><span class=\"line\"><span class=\"comment\">//                 o[r.charCodeAt(e + 3)];</span></span><br><span class=\"line\"><span class=\"comment\">//               a[c++] = (n &gt;&gt; 16) &amp; 255;</span></span><br><span class=\"line\"><span class=\"comment\">//               a[c++] = (n &gt;&gt; 8) &amp; 255;</span></span><br><span class=\"line\"><span class=\"comment\">//               a[c++] = n &amp; 255;</span></span><br><span class=\"line\"><span class=\"comment\">//             &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//             if (i === 2) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//               n = (o[r.charCodeAt(e)] &lt;&lt; 2) | (o[r.charCodeAt(e + 1)] &gt;&gt; 4);</span></span><br><span class=\"line\"><span class=\"comment\">//               a[c++] = n &amp; 255;</span></span><br><span class=\"line\"><span class=\"comment\">//             &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//               if (i === 1) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//                 n =</span></span><br><span class=\"line\"><span class=\"comment\">//                   (o[r.charCodeAt(e)] &lt;&lt; 10) |</span></span><br><span class=\"line\"><span class=\"comment\">//                   (o[r.charCodeAt(e + 1)] &lt;&lt; 4) |</span></span><br><span class=\"line\"><span class=\"comment\">//                   (o[r.charCodeAt(e + 2)] &gt;&gt; 2);</span></span><br><span class=\"line\"><span class=\"comment\">//                 a[c++] = (n &gt;&gt; 8) &amp; 255;</span></span><br><span class=\"line\"><span class=\"comment\">//                 a[c++] = n &amp; 255;</span></span><br><span class=\"line\"><span class=\"comment\">//               &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//             &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//             return a;</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//           function l(r) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             return (</span></span><br><span class=\"line\"><span class=\"comment\">//               n[(r &gt;&gt; 18) &amp; 63] +</span></span><br><span class=\"line\"><span class=\"comment\">//               n[(r &gt;&gt; 12) &amp; 63] +</span></span><br><span class=\"line\"><span class=\"comment\">//               n[(r &gt;&gt; 6) &amp; 63] +</span></span><br><span class=\"line\"><span class=\"comment\">//               n[r &amp; 63]</span></span><br><span class=\"line\"><span class=\"comment\">//             );</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//           function h(r, e, t) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             var n;</span></span><br><span class=\"line\"><span class=\"comment\">//             var o = [];</span></span><br><span class=\"line\"><span class=\"comment\">//             for (var f = e; f &lt; t; f += 3) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//               n = (r[f] &lt;&lt; 16) + (r[f + 1] &lt;&lt; 8) + r[f + 2];</span></span><br><span class=\"line\"><span class=\"comment\">//               o.push(l(n));</span></span><br><span class=\"line\"><span class=\"comment\">//             &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//             return o.join(&quot;&quot;);</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//           function s(r) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             var e;</span></span><br><span class=\"line\"><span class=\"comment\">//             var t = r.length;</span></span><br><span class=\"line\"><span class=\"comment\">//             var o = t % 3;</span></span><br><span class=\"line\"><span class=\"comment\">//             var f = &quot;&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">//             var i = [];</span></span><br><span class=\"line\"><span class=\"comment\">//             var a = 16383;</span></span><br><span class=\"line\"><span class=\"comment\">//             for (var u = 0, d = t - o; u &lt; d; u += a) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//               i.push(h(r, u, u + a &gt; d ? d : u + a));</span></span><br><span class=\"line\"><span class=\"comment\">//             &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//             if (o === 1) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//               e = r[t - 1];</span></span><br><span class=\"line\"><span class=\"comment\">//               f += n[e &gt;&gt; 2];</span></span><br><span class=\"line\"><span class=\"comment\">//               f += n[(e &lt;&lt; 4) &amp; 63];</span></span><br><span class=\"line\"><span class=\"comment\">//               f += &quot;==&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">//             &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//               if (o === 2) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//                 e = (r[t - 2] &lt;&lt; 8) + r[t - 1];</span></span><br><span class=\"line\"><span class=\"comment\">//                 f += n[e &gt;&gt; 10];</span></span><br><span class=\"line\"><span class=\"comment\">//                 f += n[(e &gt;&gt; 4) &amp; 63];</span></span><br><span class=\"line\"><span class=\"comment\">//                 f += n[(e &lt;&lt; 2) &amp; 63];</span></span><br><span class=\"line\"><span class=\"comment\">//                 f += &quot;=&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">//               &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//             &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//             i.push(f);</span></span><br><span class=\"line\"><span class=\"comment\">//             return i.join(&quot;&quot;);</span></span><br><span class=\"line\"><span class=\"comment\">//           &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//         &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">//         &#123;&#125;,</span></span><br><span class=\"line\"><span class=\"comment\">//       ],</span></span><br><span class=\"line\"><span class=\"comment\">//     &#125;,</span></span><br><span class=\"line\"><span class=\"comment\">//     &#123;&#125;,</span></span><br><span class=\"line\"><span class=\"comment\">//     []</span></span><br><span class=\"line\"><span class=\"comment\">//   )(&quot;/&quot;);</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;);</span></span><br></pre></td></tr></table></figure>"},{"title":"安装Docker和Jenkins","abbrlink":"21d0","date":"2022-08-23T09:24:14.000Z","_content":"\n自己动手实践部署jenkins记录\n\n<!-- more -->\n\n### 什么是Docker\n\n`Docker` 是一个开源的应用容器引擎。开发者可以将自己的应用打包在自己的镜像里面，然后迁移到其他平台的 `Docker` 中。镜像中可以存放你自己自定义的运行环境，文件，代码，设置等等内容，再也不用担心环境造成的运行问题。镜像共享运行机器的系统内核。\n\n同样， `Docker` 也支持跨平台。你的镜像也可以加载在 `Windows` 和 `Linux`，实现快速运行和部署。\n\n\n\n`Docker` 的优势在于 快速，轻量，灵活。开发者可以制作一个自己自定义的镜像，也可以使用官方或者其他开发者的镜像来启动一个服务。通过将镜像创建为容器，容器之间相互隔离资源和进程不冲突。但硬件资源又是共享的。 创建的镜像也可以通过文件快速分享，也可以上传到镜像库进行存取和管理。同时 `Docker` 的镜像有 `分层策略` ，每次对镜像的更新操作，都会堆叠一个新层。当你拉取 / 推送新版本镜像时，只推送 / 拉取修改的部分。大大加快了镜像的传输效率\n\n那么 `Docker` 在 `CI/CD` 中的作用是什么呢？\n\n`Docker` 贯穿 `CI/CD` 中整个流程。作为应用服务的载体有着非常重要的地位。\n\n我们可以使用 `Docker` 将应用打包成一个镜像，交给 `Kubernetes` 去部署在目标服务集群。并且可以将镜像上传到自己的镜像仓库，做好版本分类处理。\n\n\n\n### 安装Docker\n\n在了解了 `Docker` 的作用后，我们来开始安装 `Docker`。在开始安装之前，需要安装 `device-mapper-persistent-data` 和 `lvm2` 两个依赖。\n\n`device-mapper-persistent-data` 是 `Linux` 下的一个存储驱动， `Linux` 上的高级存储技术。 `Lvm` 的作用则是创建逻辑磁盘分区。这里我们使用 `CentOS` 的 `Yum` 包管理器安装两个依赖：\n\n```shell\nyum install -y yum-utils device-mapper-persistent-data lvm2\n```\n\n依赖安装完毕后，我们将阿里云的 `Docker` 镜像源添加进去。可以加速 `Docker` 的安装。\n\n```shell\nsudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nyum install docker-ce -y\n```\n\n安装完毕，我们就可以使用 `systemctl` 启动来启动 `Docker` 了。`systemctl` 是 `Linux` 的进程管理服务命令，他可以帮助我们启动 `docker` \n\n```shell\nsystemctl start docker\nsystemctl enable docker\n```\n\n接着执行一下 `docker -v` ，这条命令可以用来查看 `Docker` 安装的版本信息。当然也可以帮助我们查看 `docker` 安装状态。如果正常展示版本信息，代表 `Docker` 已经安装成功。\n\n\n\n#### 配置阿里云镜像源\n\n在 `Docker` 安装完毕后，之后我们去拉取 `docker` 镜像时，一般默认会去 `docker` 官方源拉取镜像。但是国内出海网速实在是太慢，所以选择我们更换为 `阿里云镜像仓库` 源进行镜像下载加速。\n\n登录阿里云官网，打开 [阿里云容器镜像服务](https://link.juejin.cn/?target=https%3A%2F%2Fcr.console.aliyun.com)。点击左侧菜单最下面的 `镜像加速器` ，选择 `CentOS` （如下图）。按照官网的提示执行命令，即可更换 `docker` 镜像源地址。\n\n```shel\nsudo mkdir -p /etc/docker\nsudo tee /etc/docker/daemon.json <<-'EOF'\n{\n  \"registry-mirrors\": [\"https://vxedgf56.mirror.aliyuncs.com\"]\n}\nEOF\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n```\n\n\n\n### 安装Jenkins\n\n在安装完 `Docker` 后，我们只是拥有了一个可以承载服务的载体。想实现自动化构建，还需要安装另一个构建工具 `Jenkins`。那什么是 `Jenkins` 呢？\n\n`Jenkins` 是一个基于 `Java` 语言开发的持续构建工具平台，主要用于持续、自动的构建/测试你的软件和项目。它可以执行你预先设定好的设置和构建脚本，也可以和 Git 代码库做集成，实现自动触发和定时触发构建。\n\n\n\n#### 1. 安装OpenJDK\n\n```she\nyum install -y java\n```\n\n#### 2. 使用Yum安装Jenkins\n\n由于 `Yum` 源不自带 `Jenkins` 的安装源，于是我们需要自己导入一份 `Jenkins` 安装源进行安装。导入后，使用 `Yum` 命令安装即可。\n\n```shell\nsudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo\nsudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key\nyum install jenkins\n```\n\n`TIP1:`\n\n执行第一条命令时有概率出现下面的错误，如果出现了，就执行解决中的命令，然后再导入秘钥（第二条）\n\n```she\nERROR: cannot verify pkg.jenkins.io's certificate, issued by ‘/C=US/O=Let's Encrypt/CN=R3’:\n  Issued certificate has expired.\nTo connect to pkg.jenkins.io insecurely, use `--no-check-certificate'.\n```\n\n解决：\n\n```shel\nwget --no-check-certificate -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo\n```\n\n然后重新执行后面的命令。\n\n`TIP2:`\n\n执行下载jenkens命令时很可能出现下面的错误：\n\n```shell\nLoaded plugins: fastestmirror, langpacks\nLoading mirror speeds from cached hostfile\n * base: mirrors.bfsu.edu.cn\n * extras: mirrors.ustc.edu.cn\n * updates: mirrors.bfsu.edu.cn\nNo package jenkins available.\n/* 依赖检测失败 */\n```\n\n解决：\n\n**安装epel-release**\n\n```shell\nyum install -y epel-release\n```\n\n**安装daemonize**\n\n```shell\nyum -y install daemonize\n```\n\n然后重新下载jenkins\n\n#### 3.启动Jenkins\n\n`Jenkins` 安装后，会将启动命令注册到系统 `Service` 命令中。所以我们直接使用系统 `service` 命令启动 `Jenkins` 即可。在这里，有三个命令可以使用，分别对应 启动 / 重启 / 停止 三个命令。\n\n在这里，我们直接调用 `service jenkins start` 启动 Jenkins 即可\n\n```shel\nservice jenkins start\n# service jenkins restart restart 重启 Jenkins\n# service jenkins restart stop 停止 Jenkins\n```\n\n#### 4.给Jenkins放行端口\n\n在启动 `Jenkins` 后，此时 `Jenkins` 会开启它的默认端口 `8080` 。但由于防火墙限制，我们需要手动让防火墙放行 `8080` 端口才能对外访问到界面。\n\n这里我们在 `CentOS` 下的 `firewall-cmd` 防火墙添加端口放行规则，添加完后重启防火墙。\n\n```she\nfirewall-cmd --zone=public --add-port=8080/tcp --permanent\nfirewall-cmd --zone=public --add-port=50000/tcp --permanent\n\nsystemctl reload firewalld\n```\n\n服务启动后，访问 `IP:8080` 。\n\n![WeChat8213c3f9330e1b618a64135d7d506987](https://tva1.sinaimg.cn/large/e6c9d24egy1h5gtzldgypj20yy0riq44.jpg)\n\n#### 5.初始化Jenkins配置\n\n**5.1 解锁Jenkins**\n\n在 `Jenkins` 启动完成后，会自动跳转至`Jenkins` 的解锁界面，你需要输入存放在服务器的初始解锁密码才能进行下一步操作。\n\n`Jenkins` 启动后，会生成一个**初始密码**。该密码在服务器的文件内存放，我们可以进入服务器查看密码内容，将密码填写在 `Jenkins` 的管理员密码输入框内。\n\n```shel\ncat /var/lib/jenkins/secrets/initialAdminPassword\n```\n\n**5.2 下载插件**\n\n因为 `Jenkins` 插件服务器在国外，所以速度不太理想。我们需要更换为清华大学的 `Jenkins` 插件源后，再安装插件，**所以先不要点安装插件。**\n\n更换方法很简单。进入服务器，将 `/var/lib/jenkins/updates/default.json` 内的插件源地址替换成清华大学的源地址，将 google 替换为 baidu 即可。\n\n```shel\nsed -i 's/http:\\/\\/updates.jenkins-ci.org\\/download/https:\\/\\/mirrors.tuna.tsinghua.edu.cn\\/jenkins/g' /var/lib/jenkins/updates/default.json && sed -i 's/http:\\/\\/www.google.com/https:\\/\\/www.baidu.com/g' /var/lib/jenkins/updates/default.json\n```\n\n接着点击 `安装推荐的插件` 即可。稍等一会插件安装完毕。\n\n![image-20211207193019958](https://tva1.sinaimg.cn/large/e6c9d24egy1h5gtusazi3j20uj0u0dhp.jpg)\n\n![WechatIMG1256](https://tva1.sinaimg.cn/large/e6c9d24egy1h5gu0l7hgbj21c10u0di6.jpg)\n\n#### 6.测试安装\n\n到这里，我们的 Jenkins 算是启动成功了。但是，我们还需要对 `Jenkins` 做一点点简单的配置，才可以让它可以构建 `docker` 镜像。\n\n我们点击 `Jenkins` 首页 -> 左侧导航 -> 新建任务 -> **Freestyle project**\n\n**![WeChatf1c493eccf9d6aff70b3f11b17e70d5a](https://tva1.sinaimg.cn/large/e6c9d24egy1h5gu144il8j21no0u0786.jpg)**\n\n新建完毕后，找到 `构建` 一项，选择 `增加构建步骤`，选择 `执行shell` ，输入以下命令：\n\n```she\ndocker -v\ndocker pull node:latest\n```\n\n该命令会去拉取一个 `nodejs` 稳定版的镜像，我们可以来测试 `Docker` 的可用性。\n\n保存后，我们点击左侧菜单的**立即构建**， `Jenkins` 就会开始构建。选择左侧历史记录第一项（最新的一项），点击控制台输出，查看构建日志。\n\n执行后，我们发现提示无访问权限。这又是什么情况呢？这里就不得不提到 `Linux` 下的 `Unix Socket`权限问题了。\n\n#### 7.Unix Socket权限问题\n\n`docker` 的架构是 `C/S` 架构。在我们使用 `docker` 命令时，其实是命令使用 `socket` 与 `docker` 的守护进程进行通信，才能正常执行 `docker` 命令。\n\n而在 `Linux` 中， `Unix socket` 属于 `root` 用户，因此需要 `root` 权限才能访问。官方是这么解释的：\n\n> Manage Docker as a non-root user The docker daemon binds to a Unix socket instead of a TCP port. By default that Unix socket is owned by the user root and other users can only access it using sudo. The docker daemon always runs as the root user. If you don’t want to use sudo when you use the docker command, create a Unix group called docker and add users to it. When the docker daemon starts, it makes the ownership of the Unix socket read/writable by the docker group.\n\n但是在 `docker` 中， `docker` 提供了一个 `用户组` 的概念。我们可以将执行 `Shell` 的用户添加到名称为 `docker` 的用户组，则可以正常执行 `docker` 命令。\n\n而在 `Jenkins` 中执行的终端用户做 `jenkins` ，所以我们只需要将 `jenkins` 加入到 `docker` 用户组即可：\n\n```she\nsudo groupadd docker          #新增docker用户组\nsudo gpasswd -a jenkins docker  #将当前用户添加至docker用户组\nnewgrp docker                 #更新docker用户组\n```\n\n加入后，重启 `Jenkins` ：\n\n```shel\nsudo service jenkins restart\n```\n\n刷新页面等待jenkins重新启动并登入账号密码：\n\n![WeChatf7664d9dfaa1e741a63dacfc54a08b87](https://tva1.sinaimg.cn/large/e6c9d24egy1h5gu1nsn7aj21480rmab5.jpg)\n\n之后重新登录成功后构建:\n\n![WeChatf7664d9dfaa1e741a63dacfc54a08b87](https://tva1.sinaimg.cn/large/e6c9d24egy1h5gu206lt4j21by0u00wm.jpg)\n","source":"_posts/安装Docker和Jenkins.md","raw":"---\ntitle: 安装Docker和Jenkins\ntags: 知识积累\ncategories:\n  - 服务端知识积累\n  - Docker & Jenkins\nabbrlink: 21d0\ndate: 2022-08-23 17:24:14\n---\n\n自己动手实践部署jenkins记录\n\n<!-- more -->\n\n### 什么是Docker\n\n`Docker` 是一个开源的应用容器引擎。开发者可以将自己的应用打包在自己的镜像里面，然后迁移到其他平台的 `Docker` 中。镜像中可以存放你自己自定义的运行环境，文件，代码，设置等等内容，再也不用担心环境造成的运行问题。镜像共享运行机器的系统内核。\n\n同样， `Docker` 也支持跨平台。你的镜像也可以加载在 `Windows` 和 `Linux`，实现快速运行和部署。\n\n\n\n`Docker` 的优势在于 快速，轻量，灵活。开发者可以制作一个自己自定义的镜像，也可以使用官方或者其他开发者的镜像来启动一个服务。通过将镜像创建为容器，容器之间相互隔离资源和进程不冲突。但硬件资源又是共享的。 创建的镜像也可以通过文件快速分享，也可以上传到镜像库进行存取和管理。同时 `Docker` 的镜像有 `分层策略` ，每次对镜像的更新操作，都会堆叠一个新层。当你拉取 / 推送新版本镜像时，只推送 / 拉取修改的部分。大大加快了镜像的传输效率\n\n那么 `Docker` 在 `CI/CD` 中的作用是什么呢？\n\n`Docker` 贯穿 `CI/CD` 中整个流程。作为应用服务的载体有着非常重要的地位。\n\n我们可以使用 `Docker` 将应用打包成一个镜像，交给 `Kubernetes` 去部署在目标服务集群。并且可以将镜像上传到自己的镜像仓库，做好版本分类处理。\n\n\n\n### 安装Docker\n\n在了解了 `Docker` 的作用后，我们来开始安装 `Docker`。在开始安装之前，需要安装 `device-mapper-persistent-data` 和 `lvm2` 两个依赖。\n\n`device-mapper-persistent-data` 是 `Linux` 下的一个存储驱动， `Linux` 上的高级存储技术。 `Lvm` 的作用则是创建逻辑磁盘分区。这里我们使用 `CentOS` 的 `Yum` 包管理器安装两个依赖：\n\n```shell\nyum install -y yum-utils device-mapper-persistent-data lvm2\n```\n\n依赖安装完毕后，我们将阿里云的 `Docker` 镜像源添加进去。可以加速 `Docker` 的安装。\n\n```shell\nsudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nyum install docker-ce -y\n```\n\n安装完毕，我们就可以使用 `systemctl` 启动来启动 `Docker` 了。`systemctl` 是 `Linux` 的进程管理服务命令，他可以帮助我们启动 `docker` \n\n```shell\nsystemctl start docker\nsystemctl enable docker\n```\n\n接着执行一下 `docker -v` ，这条命令可以用来查看 `Docker` 安装的版本信息。当然也可以帮助我们查看 `docker` 安装状态。如果正常展示版本信息，代表 `Docker` 已经安装成功。\n\n\n\n#### 配置阿里云镜像源\n\n在 `Docker` 安装完毕后，之后我们去拉取 `docker` 镜像时，一般默认会去 `docker` 官方源拉取镜像。但是国内出海网速实在是太慢，所以选择我们更换为 `阿里云镜像仓库` 源进行镜像下载加速。\n\n登录阿里云官网，打开 [阿里云容器镜像服务](https://link.juejin.cn/?target=https%3A%2F%2Fcr.console.aliyun.com)。点击左侧菜单最下面的 `镜像加速器` ，选择 `CentOS` （如下图）。按照官网的提示执行命令，即可更换 `docker` 镜像源地址。\n\n```shel\nsudo mkdir -p /etc/docker\nsudo tee /etc/docker/daemon.json <<-'EOF'\n{\n  \"registry-mirrors\": [\"https://vxedgf56.mirror.aliyuncs.com\"]\n}\nEOF\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n```\n\n\n\n### 安装Jenkins\n\n在安装完 `Docker` 后，我们只是拥有了一个可以承载服务的载体。想实现自动化构建，还需要安装另一个构建工具 `Jenkins`。那什么是 `Jenkins` 呢？\n\n`Jenkins` 是一个基于 `Java` 语言开发的持续构建工具平台，主要用于持续、自动的构建/测试你的软件和项目。它可以执行你预先设定好的设置和构建脚本，也可以和 Git 代码库做集成，实现自动触发和定时触发构建。\n\n\n\n#### 1. 安装OpenJDK\n\n```she\nyum install -y java\n```\n\n#### 2. 使用Yum安装Jenkins\n\n由于 `Yum` 源不自带 `Jenkins` 的安装源，于是我们需要自己导入一份 `Jenkins` 安装源进行安装。导入后，使用 `Yum` 命令安装即可。\n\n```shell\nsudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo\nsudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key\nyum install jenkins\n```\n\n`TIP1:`\n\n执行第一条命令时有概率出现下面的错误，如果出现了，就执行解决中的命令，然后再导入秘钥（第二条）\n\n```she\nERROR: cannot verify pkg.jenkins.io's certificate, issued by ‘/C=US/O=Let's Encrypt/CN=R3’:\n  Issued certificate has expired.\nTo connect to pkg.jenkins.io insecurely, use `--no-check-certificate'.\n```\n\n解决：\n\n```shel\nwget --no-check-certificate -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo\n```\n\n然后重新执行后面的命令。\n\n`TIP2:`\n\n执行下载jenkens命令时很可能出现下面的错误：\n\n```shell\nLoaded plugins: fastestmirror, langpacks\nLoading mirror speeds from cached hostfile\n * base: mirrors.bfsu.edu.cn\n * extras: mirrors.ustc.edu.cn\n * updates: mirrors.bfsu.edu.cn\nNo package jenkins available.\n/* 依赖检测失败 */\n```\n\n解决：\n\n**安装epel-release**\n\n```shell\nyum install -y epel-release\n```\n\n**安装daemonize**\n\n```shell\nyum -y install daemonize\n```\n\n然后重新下载jenkins\n\n#### 3.启动Jenkins\n\n`Jenkins` 安装后，会将启动命令注册到系统 `Service` 命令中。所以我们直接使用系统 `service` 命令启动 `Jenkins` 即可。在这里，有三个命令可以使用，分别对应 启动 / 重启 / 停止 三个命令。\n\n在这里，我们直接调用 `service jenkins start` 启动 Jenkins 即可\n\n```shel\nservice jenkins start\n# service jenkins restart restart 重启 Jenkins\n# service jenkins restart stop 停止 Jenkins\n```\n\n#### 4.给Jenkins放行端口\n\n在启动 `Jenkins` 后，此时 `Jenkins` 会开启它的默认端口 `8080` 。但由于防火墙限制，我们需要手动让防火墙放行 `8080` 端口才能对外访问到界面。\n\n这里我们在 `CentOS` 下的 `firewall-cmd` 防火墙添加端口放行规则，添加完后重启防火墙。\n\n```she\nfirewall-cmd --zone=public --add-port=8080/tcp --permanent\nfirewall-cmd --zone=public --add-port=50000/tcp --permanent\n\nsystemctl reload firewalld\n```\n\n服务启动后，访问 `IP:8080` 。\n\n![WeChat8213c3f9330e1b618a64135d7d506987](https://tva1.sinaimg.cn/large/e6c9d24egy1h5gtzldgypj20yy0riq44.jpg)\n\n#### 5.初始化Jenkins配置\n\n**5.1 解锁Jenkins**\n\n在 `Jenkins` 启动完成后，会自动跳转至`Jenkins` 的解锁界面，你需要输入存放在服务器的初始解锁密码才能进行下一步操作。\n\n`Jenkins` 启动后，会生成一个**初始密码**。该密码在服务器的文件内存放，我们可以进入服务器查看密码内容，将密码填写在 `Jenkins` 的管理员密码输入框内。\n\n```shel\ncat /var/lib/jenkins/secrets/initialAdminPassword\n```\n\n**5.2 下载插件**\n\n因为 `Jenkins` 插件服务器在国外，所以速度不太理想。我们需要更换为清华大学的 `Jenkins` 插件源后，再安装插件，**所以先不要点安装插件。**\n\n更换方法很简单。进入服务器，将 `/var/lib/jenkins/updates/default.json` 内的插件源地址替换成清华大学的源地址，将 google 替换为 baidu 即可。\n\n```shel\nsed -i 's/http:\\/\\/updates.jenkins-ci.org\\/download/https:\\/\\/mirrors.tuna.tsinghua.edu.cn\\/jenkins/g' /var/lib/jenkins/updates/default.json && sed -i 's/http:\\/\\/www.google.com/https:\\/\\/www.baidu.com/g' /var/lib/jenkins/updates/default.json\n```\n\n接着点击 `安装推荐的插件` 即可。稍等一会插件安装完毕。\n\n![image-20211207193019958](https://tva1.sinaimg.cn/large/e6c9d24egy1h5gtusazi3j20uj0u0dhp.jpg)\n\n![WechatIMG1256](https://tva1.sinaimg.cn/large/e6c9d24egy1h5gu0l7hgbj21c10u0di6.jpg)\n\n#### 6.测试安装\n\n到这里，我们的 Jenkins 算是启动成功了。但是，我们还需要对 `Jenkins` 做一点点简单的配置，才可以让它可以构建 `docker` 镜像。\n\n我们点击 `Jenkins` 首页 -> 左侧导航 -> 新建任务 -> **Freestyle project**\n\n**![WeChatf1c493eccf9d6aff70b3f11b17e70d5a](https://tva1.sinaimg.cn/large/e6c9d24egy1h5gu144il8j21no0u0786.jpg)**\n\n新建完毕后，找到 `构建` 一项，选择 `增加构建步骤`，选择 `执行shell` ，输入以下命令：\n\n```she\ndocker -v\ndocker pull node:latest\n```\n\n该命令会去拉取一个 `nodejs` 稳定版的镜像，我们可以来测试 `Docker` 的可用性。\n\n保存后，我们点击左侧菜单的**立即构建**， `Jenkins` 就会开始构建。选择左侧历史记录第一项（最新的一项），点击控制台输出，查看构建日志。\n\n执行后，我们发现提示无访问权限。这又是什么情况呢？这里就不得不提到 `Linux` 下的 `Unix Socket`权限问题了。\n\n#### 7.Unix Socket权限问题\n\n`docker` 的架构是 `C/S` 架构。在我们使用 `docker` 命令时，其实是命令使用 `socket` 与 `docker` 的守护进程进行通信，才能正常执行 `docker` 命令。\n\n而在 `Linux` 中， `Unix socket` 属于 `root` 用户，因此需要 `root` 权限才能访问。官方是这么解释的：\n\n> Manage Docker as a non-root user The docker daemon binds to a Unix socket instead of a TCP port. By default that Unix socket is owned by the user root and other users can only access it using sudo. The docker daemon always runs as the root user. If you don’t want to use sudo when you use the docker command, create a Unix group called docker and add users to it. When the docker daemon starts, it makes the ownership of the Unix socket read/writable by the docker group.\n\n但是在 `docker` 中， `docker` 提供了一个 `用户组` 的概念。我们可以将执行 `Shell` 的用户添加到名称为 `docker` 的用户组，则可以正常执行 `docker` 命令。\n\n而在 `Jenkins` 中执行的终端用户做 `jenkins` ，所以我们只需要将 `jenkins` 加入到 `docker` 用户组即可：\n\n```she\nsudo groupadd docker          #新增docker用户组\nsudo gpasswd -a jenkins docker  #将当前用户添加至docker用户组\nnewgrp docker                 #更新docker用户组\n```\n\n加入后，重启 `Jenkins` ：\n\n```shel\nsudo service jenkins restart\n```\n\n刷新页面等待jenkins重新启动并登入账号密码：\n\n![WeChatf7664d9dfaa1e741a63dacfc54a08b87](https://tva1.sinaimg.cn/large/e6c9d24egy1h5gu1nsn7aj21480rmab5.jpg)\n\n之后重新登录成功后构建:\n\n![WeChatf7664d9dfaa1e741a63dacfc54a08b87](https://tva1.sinaimg.cn/large/e6c9d24egy1h5gu206lt4j21by0u00wm.jpg)\n","slug":"安装Docker和Jenkins","published":1,"updated":"2022-08-26T01:42:59.883Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl79tdvvf000e5d9kfy8n4pl8","content":"<p>自己动手实践部署jenkins记录</p>\n<span id=\"more\"></span>\n\n<h3 id=\"什么是Docker\"><a href=\"#什么是Docker\" class=\"headerlink\" title=\"什么是Docker\"></a>什么是Docker</h3><p><code>Docker</code> 是一个开源的应用容器引擎。开发者可以将自己的应用打包在自己的镜像里面，然后迁移到其他平台的 <code>Docker</code> 中。镜像中可以存放你自己自定义的运行环境，文件，代码，设置等等内容，再也不用担心环境造成的运行问题。镜像共享运行机器的系统内核。</p>\n<p>同样， <code>Docker</code> 也支持跨平台。你的镜像也可以加载在 <code>Windows</code> 和 <code>Linux</code>，实现快速运行和部署。</p>\n<p><code>Docker</code> 的优势在于 快速，轻量，灵活。开发者可以制作一个自己自定义的镜像，也可以使用官方或者其他开发者的镜像来启动一个服务。通过将镜像创建为容器，容器之间相互隔离资源和进程不冲突。但硬件资源又是共享的。 创建的镜像也可以通过文件快速分享，也可以上传到镜像库进行存取和管理。同时 <code>Docker</code> 的镜像有 <code>分层策略</code> ，每次对镜像的更新操作，都会堆叠一个新层。当你拉取 / 推送新版本镜像时，只推送 / 拉取修改的部分。大大加快了镜像的传输效率</p>\n<p>那么 <code>Docker</code> 在 <code>CI/CD</code> 中的作用是什么呢？</p>\n<p><code>Docker</code> 贯穿 <code>CI/CD</code> 中整个流程。作为应用服务的载体有着非常重要的地位。</p>\n<p>我们可以使用 <code>Docker</code> 将应用打包成一个镜像，交给 <code>Kubernetes</code> 去部署在目标服务集群。并且可以将镜像上传到自己的镜像仓库，做好版本分类处理。</p>\n<h3 id=\"安装Docker\"><a href=\"#安装Docker\" class=\"headerlink\" title=\"安装Docker\"></a>安装Docker</h3><p>在了解了 <code>Docker</code> 的作用后，我们来开始安装 <code>Docker</code>。在开始安装之前，需要安装 <code>device-mapper-persistent-data</code> 和 <code>lvm2</code> 两个依赖。</p>\n<p><code>device-mapper-persistent-data</code> 是 <code>Linux</code> 下的一个存储驱动， <code>Linux</code> 上的高级存储技术。 <code>Lvm</code> 的作用则是创建逻辑磁盘分区。这里我们使用 <code>CentOS</code> 的 <code>Yum</code> 包管理器安装两个依赖：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>\n\n<p>依赖安装完毕后，我们将阿里云的 <code>Docker</code> 镜像源添加进去。可以加速 <code>Docker</code> 的安装。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class=\"line\">yum install docker-ce -y</span><br></pre></td></tr></table></figure>\n\n<p>安装完毕，我们就可以使用 <code>systemctl</code> 启动来启动 <code>Docker</code> 了。<code>systemctl</code> 是 <code>Linux</code> 的进程管理服务命令，他可以帮助我们启动 <code>docker</code> </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">systemctl start docker</span><br><span class=\"line\">systemctl enable docker</span><br></pre></td></tr></table></figure>\n\n<p>接着执行一下 <code>docker -v</code> ，这条命令可以用来查看 <code>Docker</code> 安装的版本信息。当然也可以帮助我们查看 <code>docker</code> 安装状态。如果正常展示版本信息，代表 <code>Docker</code> 已经安装成功。</p>\n<h4 id=\"配置阿里云镜像源\"><a href=\"#配置阿里云镜像源\" class=\"headerlink\" title=\"配置阿里云镜像源\"></a>配置阿里云镜像源</h4><p>在 <code>Docker</code> 安装完毕后，之后我们去拉取 <code>docker</code> 镜像时，一般默认会去 <code>docker</code> 官方源拉取镜像。但是国内出海网速实在是太慢，所以选择我们更换为 <code>阿里云镜像仓库</code> 源进行镜像下载加速。</p>\n<p>登录阿里云官网，打开 <a href=\"https://link.juejin.cn/?target=https://cr.console.aliyun.com\">阿里云容器镜像服务</a>。点击左侧菜单最下面的 <code>镜像加速器</code> ，选择 <code>CentOS</code> （如下图）。按照官网的提示执行命令，即可更换 <code>docker</code> 镜像源地址。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /etc/docker</span><br><span class=\"line\">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;registry-mirrors&quot;: [&quot;https://vxedgf56.mirror.aliyuncs.com&quot;]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"安装Jenkins\"><a href=\"#安装Jenkins\" class=\"headerlink\" title=\"安装Jenkins\"></a>安装Jenkins</h3><p>在安装完 <code>Docker</code> 后，我们只是拥有了一个可以承载服务的载体。想实现自动化构建，还需要安装另一个构建工具 <code>Jenkins</code>。那什么是 <code>Jenkins</code> 呢？</p>\n<p><code>Jenkins</code> 是一个基于 <code>Java</code> 语言开发的持续构建工具平台，主要用于持续、自动的构建/测试你的软件和项目。它可以执行你预先设定好的设置和构建脚本，也可以和 Git 代码库做集成，实现自动触发和定时触发构建。</p>\n<h4 id=\"1-安装OpenJDK\"><a href=\"#1-安装OpenJDK\" class=\"headerlink\" title=\"1. 安装OpenJDK\"></a>1. 安装OpenJDK</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install -y java</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-使用Yum安装Jenkins\"><a href=\"#2-使用Yum安装Jenkins\" class=\"headerlink\" title=\"2. 使用Yum安装Jenkins\"></a>2. 使用Yum安装Jenkins</h4><p>由于 <code>Yum</code> 源不自带 <code>Jenkins</code> 的安装源，于是我们需要自己导入一份 <code>Jenkins</code> 安装源进行安装。导入后，使用 <code>Yum</code> 命令安装即可。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo</span><br><span class=\"line\">sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key</span><br><span class=\"line\">yum install jenkins</span><br></pre></td></tr></table></figure>\n\n<p><code>TIP1:</code></p>\n<p>执行第一条命令时有概率出现下面的错误，如果出现了，就执行解决中的命令，然后再导入秘钥（第二条）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">ERROR: cannot verify pkg.jenkins.io&#x27;s certificate, issued by ‘/C=US/O=Let&#x27;s Encrypt/CN=R3’:</span><br><span class=\"line\">  Issued certificate has expired.</span><br><span class=\"line\">To connect to pkg.jenkins.io insecurely, use `--no-check-certificate&#x27;.</span><br></pre></td></tr></table></figure>\n\n<p>解决：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget --no-check-certificate -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo</span><br></pre></td></tr></table></figure>\n\n<p>然后重新执行后面的命令。</p>\n<p><code>TIP2:</code></p>\n<p>执行下载jenkens命令时很可能出现下面的错误：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">Loaded plugins: fastestmirror, langpacks</span><br><span class=\"line\">Loading mirror speeds from cached hostfile</span><br><span class=\"line\"> * base: mirrors.bfsu.edu.cn</span><br><span class=\"line\"> * extras: mirrors.ustc.edu.cn</span><br><span class=\"line\"> * updates: mirrors.bfsu.edu.cn</span><br><span class=\"line\">No package jenkins available.</span><br><span class=\"line\">/* 依赖检测失败 */</span><br></pre></td></tr></table></figure>\n\n<p>解决：</p>\n<p><strong>安装epel-release</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install -y epel-release</span><br></pre></td></tr></table></figure>\n\n<p><strong>安装daemonize</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum -y install daemonize</span><br></pre></td></tr></table></figure>\n\n<p>然后重新下载jenkins</p>\n<h4 id=\"3-启动Jenkins\"><a href=\"#3-启动Jenkins\" class=\"headerlink\" title=\"3.启动Jenkins\"></a>3.启动Jenkins</h4><p><code>Jenkins</code> 安装后，会将启动命令注册到系统 <code>Service</code> 命令中。所以我们直接使用系统 <code>service</code> 命令启动 <code>Jenkins</code> 即可。在这里，有三个命令可以使用，分别对应 启动 / 重启 / 停止 三个命令。</p>\n<p>在这里，我们直接调用 <code>service jenkins start</code> 启动 Jenkins 即可</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">service jenkins start</span><br><span class=\"line\"># service jenkins restart restart 重启 Jenkins</span><br><span class=\"line\"># service jenkins restart stop 停止 Jenkins</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-给Jenkins放行端口\"><a href=\"#4-给Jenkins放行端口\" class=\"headerlink\" title=\"4.给Jenkins放行端口\"></a>4.给Jenkins放行端口</h4><p>在启动 <code>Jenkins</code> 后，此时 <code>Jenkins</code> 会开启它的默认端口 <code>8080</code> 。但由于防火墙限制，我们需要手动让防火墙放行 <code>8080</code> 端口才能对外访问到界面。</p>\n<p>这里我们在 <code>CentOS</code> 下的 <code>firewall-cmd</code> 防火墙添加端口放行规则，添加完后重启防火墙。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-port=8080/tcp --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-port=50000/tcp --permanent</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl reload firewalld</span><br></pre></td></tr></table></figure>\n\n<p>服务启动后，访问 <code>IP:8080</code> 。</p>\n<p><img src=\"https://tva1.sinaimg.cn/large/e6c9d24egy1h5gtzldgypj20yy0riq44.jpg\" alt=\"WeChat8213c3f9330e1b618a64135d7d506987\"></p>\n<h4 id=\"5-初始化Jenkins配置\"><a href=\"#5-初始化Jenkins配置\" class=\"headerlink\" title=\"5.初始化Jenkins配置\"></a>5.初始化Jenkins配置</h4><p><strong>5.1 解锁Jenkins</strong></p>\n<p>在 <code>Jenkins</code> 启动完成后，会自动跳转至<code>Jenkins</code> 的解锁界面，你需要输入存放在服务器的初始解锁密码才能进行下一步操作。</p>\n<p><code>Jenkins</code> 启动后，会生成一个<strong>初始密码</strong>。该密码在服务器的文件内存放，我们可以进入服务器查看密码内容，将密码填写在 <code>Jenkins</code> 的管理员密码输入框内。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">cat /var/lib/jenkins/secrets/initialAdminPassword</span><br></pre></td></tr></table></figure>\n\n<p><strong>5.2 下载插件</strong></p>\n<p>因为 <code>Jenkins</code> 插件服务器在国外，所以速度不太理想。我们需要更换为清华大学的 <code>Jenkins</code> 插件源后，再安装插件，<strong>所以先不要点安装插件。</strong></p>\n<p>更换方法很简单。进入服务器，将 <code>/var/lib/jenkins/updates/default.json</code> 内的插件源地址替换成清华大学的源地址，将 google 替换为 baidu 即可。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">sed -i &#x27;s/http:\\/\\/updates.jenkins-ci.org\\/download/https:\\/\\/mirrors.tuna.tsinghua.edu.cn\\/jenkins/g&#x27; /var/lib/jenkins/updates/default.json &amp;&amp; sed -i &#x27;s/http:\\/\\/www.google.com/https:\\/\\/www.baidu.com/g&#x27; /var/lib/jenkins/updates/default.json</span><br></pre></td></tr></table></figure>\n\n<p>接着点击 <code>安装推荐的插件</code> 即可。稍等一会插件安装完毕。</p>\n<p><img src=\"https://tva1.sinaimg.cn/large/e6c9d24egy1h5gtusazi3j20uj0u0dhp.jpg\" alt=\"image-20211207193019958\"></p>\n<p><img src=\"https://tva1.sinaimg.cn/large/e6c9d24egy1h5gu0l7hgbj21c10u0di6.jpg\" alt=\"WechatIMG1256\"></p>\n<h4 id=\"6-测试安装\"><a href=\"#6-测试安装\" class=\"headerlink\" title=\"6.测试安装\"></a>6.测试安装</h4><p>到这里，我们的 Jenkins 算是启动成功了。但是，我们还需要对 <code>Jenkins</code> 做一点点简单的配置，才可以让它可以构建 <code>docker</code> 镜像。</p>\n<p>我们点击 <code>Jenkins</code> 首页 -&gt; 左侧导航 -&gt; 新建任务 -&gt; <strong>Freestyle project</strong></p>\n<p><strong><img src=\"https://tva1.sinaimg.cn/large/e6c9d24egy1h5gu144il8j21no0u0786.jpg\" alt=\"WeChatf1c493eccf9d6aff70b3f11b17e70d5a\"></strong></p>\n<p>新建完毕后，找到 <code>构建</code> 一项，选择 <code>增加构建步骤</code>，选择 <code>执行shell</code> ，输入以下命令：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker -v</span><br><span class=\"line\">docker pull node:latest</span><br></pre></td></tr></table></figure>\n\n<p>该命令会去拉取一个 <code>nodejs</code> 稳定版的镜像，我们可以来测试 <code>Docker</code> 的可用性。</p>\n<p>保存后，我们点击左侧菜单的<strong>立即构建</strong>， <code>Jenkins</code> 就会开始构建。选择左侧历史记录第一项（最新的一项），点击控制台输出，查看构建日志。</p>\n<p>执行后，我们发现提示无访问权限。这又是什么情况呢？这里就不得不提到 <code>Linux</code> 下的 <code>Unix Socket</code>权限问题了。</p>\n<h4 id=\"7-Unix-Socket权限问题\"><a href=\"#7-Unix-Socket权限问题\" class=\"headerlink\" title=\"7.Unix Socket权限问题\"></a>7.Unix Socket权限问题</h4><p><code>docker</code> 的架构是 <code>C/S</code> 架构。在我们使用 <code>docker</code> 命令时，其实是命令使用 <code>socket</code> 与 <code>docker</code> 的守护进程进行通信，才能正常执行 <code>docker</code> 命令。</p>\n<p>而在 <code>Linux</code> 中， <code>Unix socket</code> 属于 <code>root</code> 用户，因此需要 <code>root</code> 权限才能访问。官方是这么解释的：</p>\n<blockquote>\n<p>Manage Docker as a non-root user The docker daemon binds to a Unix socket instead of a TCP port. By default that Unix socket is owned by the user root and other users can only access it using sudo. The docker daemon always runs as the root user. If you don’t want to use sudo when you use the docker command, create a Unix group called docker and add users to it. When the docker daemon starts, it makes the ownership of the Unix socket read/writable by the docker group.</p>\n</blockquote>\n<p>但是在 <code>docker</code> 中， <code>docker</code> 提供了一个 <code>用户组</code> 的概念。我们可以将执行 <code>Shell</code> 的用户添加到名称为 <code>docker</code> 的用户组，则可以正常执行 <code>docker</code> 命令。</p>\n<p>而在 <code>Jenkins</code> 中执行的终端用户做 <code>jenkins</code> ，所以我们只需要将 <code>jenkins</code> 加入到 <code>docker</code> 用户组即可：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo groupadd docker          #新增docker用户组</span><br><span class=\"line\">sudo gpasswd -a jenkins docker  #将当前用户添加至docker用户组</span><br><span class=\"line\">newgrp docker                 #更新docker用户组</span><br></pre></td></tr></table></figure>\n\n<p>加入后，重启 <code>Jenkins</code> ：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo service jenkins restart</span><br></pre></td></tr></table></figure>\n\n<p>刷新页面等待jenkins重新启动并登入账号密码：</p>\n<p><img src=\"https://tva1.sinaimg.cn/large/e6c9d24egy1h5gu1nsn7aj21480rmab5.jpg\" alt=\"WeChatf7664d9dfaa1e741a63dacfc54a08b87\"></p>\n<p>之后重新登录成功后构建:</p>\n<p><img src=\"https://tva1.sinaimg.cn/large/e6c9d24egy1h5gu206lt4j21by0u00wm.jpg\" alt=\"WeChatf7664d9dfaa1e741a63dacfc54a08b87\"></p>\n","site":{"data":{}},"excerpt":"<p>自己动手实践部署jenkins记录</p>","more":"<h3 id=\"什么是Docker\"><a href=\"#什么是Docker\" class=\"headerlink\" title=\"什么是Docker\"></a>什么是Docker</h3><p><code>Docker</code> 是一个开源的应用容器引擎。开发者可以将自己的应用打包在自己的镜像里面，然后迁移到其他平台的 <code>Docker</code> 中。镜像中可以存放你自己自定义的运行环境，文件，代码，设置等等内容，再也不用担心环境造成的运行问题。镜像共享运行机器的系统内核。</p>\n<p>同样， <code>Docker</code> 也支持跨平台。你的镜像也可以加载在 <code>Windows</code> 和 <code>Linux</code>，实现快速运行和部署。</p>\n<p><code>Docker</code> 的优势在于 快速，轻量，灵活。开发者可以制作一个自己自定义的镜像，也可以使用官方或者其他开发者的镜像来启动一个服务。通过将镜像创建为容器，容器之间相互隔离资源和进程不冲突。但硬件资源又是共享的。 创建的镜像也可以通过文件快速分享，也可以上传到镜像库进行存取和管理。同时 <code>Docker</code> 的镜像有 <code>分层策略</code> ，每次对镜像的更新操作，都会堆叠一个新层。当你拉取 / 推送新版本镜像时，只推送 / 拉取修改的部分。大大加快了镜像的传输效率</p>\n<p>那么 <code>Docker</code> 在 <code>CI/CD</code> 中的作用是什么呢？</p>\n<p><code>Docker</code> 贯穿 <code>CI/CD</code> 中整个流程。作为应用服务的载体有着非常重要的地位。</p>\n<p>我们可以使用 <code>Docker</code> 将应用打包成一个镜像，交给 <code>Kubernetes</code> 去部署在目标服务集群。并且可以将镜像上传到自己的镜像仓库，做好版本分类处理。</p>\n<h3 id=\"安装Docker\"><a href=\"#安装Docker\" class=\"headerlink\" title=\"安装Docker\"></a>安装Docker</h3><p>在了解了 <code>Docker</code> 的作用后，我们来开始安装 <code>Docker</code>。在开始安装之前，需要安装 <code>device-mapper-persistent-data</code> 和 <code>lvm2</code> 两个依赖。</p>\n<p><code>device-mapper-persistent-data</code> 是 <code>Linux</code> 下的一个存储驱动， <code>Linux</code> 上的高级存储技术。 <code>Lvm</code> 的作用则是创建逻辑磁盘分区。这里我们使用 <code>CentOS</code> 的 <code>Yum</code> 包管理器安装两个依赖：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>\n\n<p>依赖安装完毕后，我们将阿里云的 <code>Docker</code> 镜像源添加进去。可以加速 <code>Docker</code> 的安装。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class=\"line\">yum install docker-ce -y</span><br></pre></td></tr></table></figure>\n\n<p>安装完毕，我们就可以使用 <code>systemctl</code> 启动来启动 <code>Docker</code> 了。<code>systemctl</code> 是 <code>Linux</code> 的进程管理服务命令，他可以帮助我们启动 <code>docker</code> </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">systemctl start docker</span><br><span class=\"line\">systemctl enable docker</span><br></pre></td></tr></table></figure>\n\n<p>接着执行一下 <code>docker -v</code> ，这条命令可以用来查看 <code>Docker</code> 安装的版本信息。当然也可以帮助我们查看 <code>docker</code> 安装状态。如果正常展示版本信息，代表 <code>Docker</code> 已经安装成功。</p>\n<h4 id=\"配置阿里云镜像源\"><a href=\"#配置阿里云镜像源\" class=\"headerlink\" title=\"配置阿里云镜像源\"></a>配置阿里云镜像源</h4><p>在 <code>Docker</code> 安装完毕后，之后我们去拉取 <code>docker</code> 镜像时，一般默认会去 <code>docker</code> 官方源拉取镜像。但是国内出海网速实在是太慢，所以选择我们更换为 <code>阿里云镜像仓库</code> 源进行镜像下载加速。</p>\n<p>登录阿里云官网，打开 <a href=\"https://link.juejin.cn/?target=https://cr.console.aliyun.com\">阿里云容器镜像服务</a>。点击左侧菜单最下面的 <code>镜像加速器</code> ，选择 <code>CentOS</code> （如下图）。按照官网的提示执行命令，即可更换 <code>docker</code> 镜像源地址。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /etc/docker</span><br><span class=\"line\">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;registry-mirrors&quot;: [&quot;https://vxedgf56.mirror.aliyuncs.com&quot;]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"安装Jenkins\"><a href=\"#安装Jenkins\" class=\"headerlink\" title=\"安装Jenkins\"></a>安装Jenkins</h3><p>在安装完 <code>Docker</code> 后，我们只是拥有了一个可以承载服务的载体。想实现自动化构建，还需要安装另一个构建工具 <code>Jenkins</code>。那什么是 <code>Jenkins</code> 呢？</p>\n<p><code>Jenkins</code> 是一个基于 <code>Java</code> 语言开发的持续构建工具平台，主要用于持续、自动的构建/测试你的软件和项目。它可以执行你预先设定好的设置和构建脚本，也可以和 Git 代码库做集成，实现自动触发和定时触发构建。</p>\n<h4 id=\"1-安装OpenJDK\"><a href=\"#1-安装OpenJDK\" class=\"headerlink\" title=\"1. 安装OpenJDK\"></a>1. 安装OpenJDK</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install -y java</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-使用Yum安装Jenkins\"><a href=\"#2-使用Yum安装Jenkins\" class=\"headerlink\" title=\"2. 使用Yum安装Jenkins\"></a>2. 使用Yum安装Jenkins</h4><p>由于 <code>Yum</code> 源不自带 <code>Jenkins</code> 的安装源，于是我们需要自己导入一份 <code>Jenkins</code> 安装源进行安装。导入后，使用 <code>Yum</code> 命令安装即可。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo</span><br><span class=\"line\">sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key</span><br><span class=\"line\">yum install jenkins</span><br></pre></td></tr></table></figure>\n\n<p><code>TIP1:</code></p>\n<p>执行第一条命令时有概率出现下面的错误，如果出现了，就执行解决中的命令，然后再导入秘钥（第二条）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">ERROR: cannot verify pkg.jenkins.io&#x27;s certificate, issued by ‘/C=US/O=Let&#x27;s Encrypt/CN=R3’:</span><br><span class=\"line\">  Issued certificate has expired.</span><br><span class=\"line\">To connect to pkg.jenkins.io insecurely, use `--no-check-certificate&#x27;.</span><br></pre></td></tr></table></figure>\n\n<p>解决：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget --no-check-certificate -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo</span><br></pre></td></tr></table></figure>\n\n<p>然后重新执行后面的命令。</p>\n<p><code>TIP2:</code></p>\n<p>执行下载jenkens命令时很可能出现下面的错误：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">Loaded plugins: fastestmirror, langpacks</span><br><span class=\"line\">Loading mirror speeds from cached hostfile</span><br><span class=\"line\"> * base: mirrors.bfsu.edu.cn</span><br><span class=\"line\"> * extras: mirrors.ustc.edu.cn</span><br><span class=\"line\"> * updates: mirrors.bfsu.edu.cn</span><br><span class=\"line\">No package jenkins available.</span><br><span class=\"line\">/* 依赖检测失败 */</span><br></pre></td></tr></table></figure>\n\n<p>解决：</p>\n<p><strong>安装epel-release</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install -y epel-release</span><br></pre></td></tr></table></figure>\n\n<p><strong>安装daemonize</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum -y install daemonize</span><br></pre></td></tr></table></figure>\n\n<p>然后重新下载jenkins</p>\n<h4 id=\"3-启动Jenkins\"><a href=\"#3-启动Jenkins\" class=\"headerlink\" title=\"3.启动Jenkins\"></a>3.启动Jenkins</h4><p><code>Jenkins</code> 安装后，会将启动命令注册到系统 <code>Service</code> 命令中。所以我们直接使用系统 <code>service</code> 命令启动 <code>Jenkins</code> 即可。在这里，有三个命令可以使用，分别对应 启动 / 重启 / 停止 三个命令。</p>\n<p>在这里，我们直接调用 <code>service jenkins start</code> 启动 Jenkins 即可</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">service jenkins start</span><br><span class=\"line\"># service jenkins restart restart 重启 Jenkins</span><br><span class=\"line\"># service jenkins restart stop 停止 Jenkins</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-给Jenkins放行端口\"><a href=\"#4-给Jenkins放行端口\" class=\"headerlink\" title=\"4.给Jenkins放行端口\"></a>4.给Jenkins放行端口</h4><p>在启动 <code>Jenkins</code> 后，此时 <code>Jenkins</code> 会开启它的默认端口 <code>8080</code> 。但由于防火墙限制，我们需要手动让防火墙放行 <code>8080</code> 端口才能对外访问到界面。</p>\n<p>这里我们在 <code>CentOS</code> 下的 <code>firewall-cmd</code> 防火墙添加端口放行规则，添加完后重启防火墙。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-port=8080/tcp --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-port=50000/tcp --permanent</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl reload firewalld</span><br></pre></td></tr></table></figure>\n\n<p>服务启动后，访问 <code>IP:8080</code> 。</p>\n<p><img src=\"https://tva1.sinaimg.cn/large/e6c9d24egy1h5gtzldgypj20yy0riq44.jpg\" alt=\"WeChat8213c3f9330e1b618a64135d7d506987\"></p>\n<h4 id=\"5-初始化Jenkins配置\"><a href=\"#5-初始化Jenkins配置\" class=\"headerlink\" title=\"5.初始化Jenkins配置\"></a>5.初始化Jenkins配置</h4><p><strong>5.1 解锁Jenkins</strong></p>\n<p>在 <code>Jenkins</code> 启动完成后，会自动跳转至<code>Jenkins</code> 的解锁界面，你需要输入存放在服务器的初始解锁密码才能进行下一步操作。</p>\n<p><code>Jenkins</code> 启动后，会生成一个<strong>初始密码</strong>。该密码在服务器的文件内存放，我们可以进入服务器查看密码内容，将密码填写在 <code>Jenkins</code> 的管理员密码输入框内。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">cat /var/lib/jenkins/secrets/initialAdminPassword</span><br></pre></td></tr></table></figure>\n\n<p><strong>5.2 下载插件</strong></p>\n<p>因为 <code>Jenkins</code> 插件服务器在国外，所以速度不太理想。我们需要更换为清华大学的 <code>Jenkins</code> 插件源后，再安装插件，<strong>所以先不要点安装插件。</strong></p>\n<p>更换方法很简单。进入服务器，将 <code>/var/lib/jenkins/updates/default.json</code> 内的插件源地址替换成清华大学的源地址，将 google 替换为 baidu 即可。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">sed -i &#x27;s/http:\\/\\/updates.jenkins-ci.org\\/download/https:\\/\\/mirrors.tuna.tsinghua.edu.cn\\/jenkins/g&#x27; /var/lib/jenkins/updates/default.json &amp;&amp; sed -i &#x27;s/http:\\/\\/www.google.com/https:\\/\\/www.baidu.com/g&#x27; /var/lib/jenkins/updates/default.json</span><br></pre></td></tr></table></figure>\n\n<p>接着点击 <code>安装推荐的插件</code> 即可。稍等一会插件安装完毕。</p>\n<p><img src=\"https://tva1.sinaimg.cn/large/e6c9d24egy1h5gtusazi3j20uj0u0dhp.jpg\" alt=\"image-20211207193019958\"></p>\n<p><img src=\"https://tva1.sinaimg.cn/large/e6c9d24egy1h5gu0l7hgbj21c10u0di6.jpg\" alt=\"WechatIMG1256\"></p>\n<h4 id=\"6-测试安装\"><a href=\"#6-测试安装\" class=\"headerlink\" title=\"6.测试安装\"></a>6.测试安装</h4><p>到这里，我们的 Jenkins 算是启动成功了。但是，我们还需要对 <code>Jenkins</code> 做一点点简单的配置，才可以让它可以构建 <code>docker</code> 镜像。</p>\n<p>我们点击 <code>Jenkins</code> 首页 -&gt; 左侧导航 -&gt; 新建任务 -&gt; <strong>Freestyle project</strong></p>\n<p><strong><img src=\"https://tva1.sinaimg.cn/large/e6c9d24egy1h5gu144il8j21no0u0786.jpg\" alt=\"WeChatf1c493eccf9d6aff70b3f11b17e70d5a\"></strong></p>\n<p>新建完毕后，找到 <code>构建</code> 一项，选择 <code>增加构建步骤</code>，选择 <code>执行shell</code> ，输入以下命令：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker -v</span><br><span class=\"line\">docker pull node:latest</span><br></pre></td></tr></table></figure>\n\n<p>该命令会去拉取一个 <code>nodejs</code> 稳定版的镜像，我们可以来测试 <code>Docker</code> 的可用性。</p>\n<p>保存后，我们点击左侧菜单的<strong>立即构建</strong>， <code>Jenkins</code> 就会开始构建。选择左侧历史记录第一项（最新的一项），点击控制台输出，查看构建日志。</p>\n<p>执行后，我们发现提示无访问权限。这又是什么情况呢？这里就不得不提到 <code>Linux</code> 下的 <code>Unix Socket</code>权限问题了。</p>\n<h4 id=\"7-Unix-Socket权限问题\"><a href=\"#7-Unix-Socket权限问题\" class=\"headerlink\" title=\"7.Unix Socket权限问题\"></a>7.Unix Socket权限问题</h4><p><code>docker</code> 的架构是 <code>C/S</code> 架构。在我们使用 <code>docker</code> 命令时，其实是命令使用 <code>socket</code> 与 <code>docker</code> 的守护进程进行通信，才能正常执行 <code>docker</code> 命令。</p>\n<p>而在 <code>Linux</code> 中， <code>Unix socket</code> 属于 <code>root</code> 用户，因此需要 <code>root</code> 权限才能访问。官方是这么解释的：</p>\n<blockquote>\n<p>Manage Docker as a non-root user The docker daemon binds to a Unix socket instead of a TCP port. By default that Unix socket is owned by the user root and other users can only access it using sudo. The docker daemon always runs as the root user. If you don’t want to use sudo when you use the docker command, create a Unix group called docker and add users to it. When the docker daemon starts, it makes the ownership of the Unix socket read/writable by the docker group.</p>\n</blockquote>\n<p>但是在 <code>docker</code> 中， <code>docker</code> 提供了一个 <code>用户组</code> 的概念。我们可以将执行 <code>Shell</code> 的用户添加到名称为 <code>docker</code> 的用户组，则可以正常执行 <code>docker</code> 命令。</p>\n<p>而在 <code>Jenkins</code> 中执行的终端用户做 <code>jenkins</code> ，所以我们只需要将 <code>jenkins</code> 加入到 <code>docker</code> 用户组即可：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo groupadd docker          #新增docker用户组</span><br><span class=\"line\">sudo gpasswd -a jenkins docker  #将当前用户添加至docker用户组</span><br><span class=\"line\">newgrp docker                 #更新docker用户组</span><br></pre></td></tr></table></figure>\n\n<p>加入后，重启 <code>Jenkins</code> ：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo service jenkins restart</span><br></pre></td></tr></table></figure>\n\n<p>刷新页面等待jenkins重新启动并登入账号密码：</p>\n<p><img src=\"https://tva1.sinaimg.cn/large/e6c9d24egy1h5gu1nsn7aj21480rmab5.jpg\" alt=\"WeChatf7664d9dfaa1e741a63dacfc54a08b87\"></p>\n<p>之后重新登录成功后构建:</p>\n<p><img src=\"https://tva1.sinaimg.cn/large/e6c9d24egy1h5gu206lt4j21by0u00wm.jpg\" alt=\"WeChatf7664d9dfaa1e741a63dacfc54a08b87\"></p>"},{"title":"实用的Vue自定义指令（持续完善...）","abbrlink":"a18d","date":"2022-08-18T09:22:11.000Z","_content":"\n常用的几个Vue自定义指令收集，持续更新...\n\n<!-- more -->\n\n\n### 1. 点击元素外部事件\n```ts\n/**\n * v-clickOutside\n * 点击元素外部事件\n * 接收参数：function类型，点击外面时返回true,点击内部时返回false\n */\nimport type { Directive, DirectiveBinding } from 'vue';\ninterface ElType extends HTMLElement {\n  __handleClick__: any;\n}\nconst directive: Directive = {\n  mounted(el: ElType, binding: DirectiveBinding) {\n    if (typeof binding.value !== 'function') {\n      throw 'callback must be a function';\n    }\n    el.__handleClick__ = function (e) {\n      if (el.contains(e.target)) {\n        binding.value(false);\n      } else {\n        binding.value(true);\n      }\n    };\n    document.addEventListener('click', el.__handleClick__);\n  },\n  beforeUnmount(el: ElType) {\n    document.removeEventListener('click', el.__handleClick__);\n  },\n};\n\nexport default directive;\n```\n\n***\n\n### 2. 复制某个值至剪贴板\n\n```ts\n/**\n * v-copy\n * 复制某个值至剪贴板\n * 接收参数：string类型/Ref<string>类型/Reactive<string>类型\n */\nimport type { Directive, DirectiveBinding } from 'vue';\nimport { ElMessage } from 'element-plus';\ninterface ElType extends HTMLElement {\n  copyData: string | number;\n  __handleClick__: any;\n}\nconst directive: Directive = {\n  mounted(el: ElType, binding: DirectiveBinding) {\n    el.copyData = binding.value;\n    el.addEventListener('click', handleClick);\n  },\n  updated(el: ElType, binding: DirectiveBinding) {\n    el.copyData = binding.value;\n  },\n  beforeUnmount(el: ElType) {\n    el.removeEventListener('click', el.__handleClick__);\n  },\n};\n\nfunction handleClick(this: ElType, ev: MouseEvent) {\n  let input = document.createElement('input');\n  input.value = this.copyData.toLocaleString();\n  document.body.appendChild(input);\n  input.select();\n  document.execCommand('Copy');\n  document.body.removeChild(input);\n  ElMessage({\n    type: 'success',\n    message: '复制成功',\n  });\n}\n\nexport default directive;\n```\n\n***\n\n### 3. 按钮防抖指令,可扩展至input\n\n```ts\n/**\n * v-debounce\n * 按钮防抖指令，可自行扩展至input\n * 接收参数：function类型\n */\nimport type { Directive, DirectiveBinding } from 'vue';\ninterface ElType extends HTMLElement {\n  __handleClick__: any;\n}\nconst directive: Directive = {\n  mounted(el: ElType, binding: DirectiveBinding) {\n    if (typeof binding.value !== 'function') {\n      console.error('callback must be a function');\n      return;\n    }\n    let timer: NodeJS.Timeout | null = null;\n    el.__handleClick__ = function (e: ElType) {\n      if (timer) {\n        clearInterval(timer);\n      }\n      timer = setTimeout(() => {\n        binding.value();\n      }, 200);\n    };\n    el.addEventListener('click', el.__handleClick__);\n  },\n  beforeUnmount(el: ElType) {\n    el.removeEventListener('click', el.__handleClick__);\n  },\n};\n\nexport default directive;\n```\n\n***\n\n### 4. 窗口拖拽\n\n```ts\n/**\n * 可基于窗口各种拖拽使用\n */\nimport type { Directive } from 'vue';\ninterface ElType extends HTMLDivElement {\n  __mouseDown__: any;\n  __mouseUp__: any;\n  __mouseMove__: any;\n  __sizeChange__: any;\n}\ninterface DataDialog {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  marginTop?: string | number;\n  top?: number;\n  bottom?: number;\n  left?: number;\n  right?: number;\n}\nconst drag: Directive = {\n  mounted(el: ElType, binding) {\n    if (binding.value) {\n      handleElShow(el);\n    }\n  },\n  updated(el, binding) {\n    if (binding.value) {\n      handleElShow(el);\n    } else {\n      handleElHide(el);\n    }\n  },\n  beforeUnmount(el: ElType) {\n    handleElHide(el);\n  },\n};\n\nfunction handleElShow(el: ElType) {\n  const dialog = el.querySelector('.el-dialog') as HTMLElement;\n  if (!dialog) {\n    return;\n  }\n  const header = el.querySelector('.el-dialog__header') as HTMLElement;\n  const dialogMask = el.querySelector('.el-overlay') as HTMLElement;\n  dialogMask.style.cssText += 'overflow: hidden;';\n  header.style.cursor = 'move';\n  let dragStatus = false;\n  let data = {\n    // 数据源，不变部分为：window信息、dialog信息、mouse初始值信息，可变部分为：拖拽坐标位移\n    window: {\n      // window信息\n      width: 0,\n      height: 0,\n    },\n    dialog: {\n      x: 0,\n      y: 0,\n      width: 0,\n      height: 0,\n      marginTop: '',\n    } as DataDialog, // dialog信息\n    mouse: {\n      // 鼠标初始信息\n      x: 0,\n      y: 0,\n    },\n    drag: {\n      // 拖拽过程信息\n      x: 0,\n      y: 0,\n    },\n  };\n  // 所有的监听只为了修改data数据\n  header.addEventListener('mousedown', mouseDown);\n  document.addEventListener('mousemove', mouseMove);\n  document.addEventListener('mouseup', mouseUp);\n  window.addEventListener('resize', sizeChange);\n  // 边界处理，防止拖动位置溢出\n  function handlePosition() {\n    if (data.mouse.x - data.drag.x >= data.dialog.x) {\n      data.drag.x = data.mouse.x - data.dialog.x;\n    }\n    if (data.drag.x - data.mouse.x >= data.window.width - (data.dialog.x + data.dialog.width)) {\n      data.drag.x = data.mouse.x + data.window.width - data.dialog.x - data.dialog.width;\n    }\n    if (data.mouse.y - data.drag.y >= data.dialog.y) {\n      data.drag.y = data.mouse.y - data.dialog.y;\n    }\n    if (data.drag.y - data.mouse.y >= data.window.height - (data.dialog.y + data.dialog.height)) {\n      data.drag.y = data.mouse.y + data.window.height - data.dialog.y - data.dialog.height;\n    }\n    setPosition();\n  }\n  // 根据data来设置拖动后的位置\n  function setPosition() {\n    let top = data.drag.y - data.mouse.y + data.dialog.y;\n    let left = data.drag.x - data.mouse.x + data.dialog.x;\n    dialog.style.cssText += `position: absolute; top: calc(${top}px - ${data.dialog.marginTop}); left: ${left}px;`;\n  }\n  function mouseDown(e: any) {\n    // 获取dialog目前的位置，坐标, 以及屏幕当前的宽高\n    // 一切初始数据的获取应该放置于此，避免其他如：宽度修改等一系列的影响\n    if (e.button !== 0) {\n      return;\n    }\n    data.window = {\n      width: document.body.clientWidth,\n      height: document.body.clientHeight,\n    };\n    data.dialog = dialog.getBoundingClientRect();\n    data.dialog.marginTop = window.getComputedStyle(dialog).marginTop;\n    data.mouse = {\n      x: e.clientX,\n      y: e.clientY,\n    };\n    dragStatus = true;\n  }\n  function mouseMove(e: any) {\n    if (dragStatus) {\n      data.drag = {\n        x: e.clientX,\n        y: e.clientY,\n      };\n      dialogMask.style.userSelect = 'none';\n      handlePosition();\n    }\n  }\n  function mouseUp(e: any) {\n    dialogMask.style.userSelect = 'auto';\n    dragStatus = false;\n  }\n  function sizeChange(e: any) {\n    // dialog.style.cssText += 'position: static';\n  }\n  // 方便卸载使用\n  el.__mouseDown__ = mouseDown;\n  el.__mouseUp__ = mouseUp;\n  el.__mouseMove__ = mouseMove;\n  el.__sizeChange__ = sizeChange;\n}\n\nfunction handleElHide(el: ElType) {\n  // 避免重复开销，卸载所有的监听\n  // 解决问题：多次创建新的实例 =》 监听不取消 =》 同时存在多个无用的监听，导致页面卡顿\n  document.removeEventListener('mousedown', el.__mouseDown__);\n  document.removeEventListener('mousemove', el.__mouseMove__);\n  document.removeEventListener('mouseup', el.__mouseUp__);\n  window.removeEventListener('resize', el.__sizeChange__);\n}\n\nexport default drag;\n```\n\n***\n\n### 5. 窗口拖拽2，可自定义父级\n\n```ts\n/**\n * 支持父级，自定义父级，以及window作为父级\n * 使用示例：\n * 1. v-dragable\n * 2. v-dragable=\"'father'\" // 使用父级作为父级\n * 3. v-dragable=\"'body'\" // 使用body对象作为父级\n * 4. v-dragable=\"'#app'\" // 使用id作为父级\n * 5. v-dragable=\"'.list'\" // 使用class名作为父级\n * 3-5代表所有可被document.querySelector()解析的参数值\n **/\nimport type { Directive, DirectiveBinding } from 'vue';\ninterface Position {\n  x: number;\n  y: number;\n}\ninterface Mouse {\n  down: Position;\n  move: Position;\n}\ninterface ElType extends HTMLElement {\n  __mouseDown__: any;\n  __mouseUp__: any;\n  __mouseMove__: any;\n  __parentDom__: HTMLElement;\n  __position__: Position;\n}\nconst directive: Directive = {\n  mounted: (el: ElType, binding: DirectiveBinding) => {\n    setParentDom(el, binding, false);\n    // 子级元素位置处理\n    // 1. 获取父子元素当前位置\n    let parentDomRect: DOMRect;\n    let elDomRect: DOMRect;\n    let mouseData: Mouse = {\n      down: { x: 0, y: 0 },\n      move: { x: 0, y: 0 },\n    };\n    let mouseDown: boolean = false;\n    el.__position__ = {\n      x: 0,\n      y: 0,\n    };\n    let bodyUserSelect: string = 'text';\n\n    function handleMouseDown(e: MouseEvent) {\n      if (e.button !== 0) {\n        return;\n      }\n      mouseData.down = {\n        x: e.clientX,\n        y: e.clientY,\n      };\n      mouseDown = true;\n      parentDomRect = el.__parentDom__.getBoundingClientRect();\n      elDomRect = el.getBoundingClientRect();\n      bodyUserSelect = document.querySelector('body')!.style.userSelect;\n      document.querySelector('body')!.style.userSelect = 'none';\n    }\n    function handleMouseMove(e: MouseEvent) {\n      if (!mouseDown) {\n        return;\n      }\n      mouseData.move = {\n        x: e.clientX,\n        y: e.clientY,\n      };\n      setPosition();\n    }\n    function handleMouseUp(e: MouseEvent) {\n      if (mouseDown) {\n        mouseDown = false;\n        document.querySelector('body')!.style.userSelect = bodyUserSelect;\n      }\n    }\n    // 用于设置el元素的Position位置\n    function setPosition() {\n      // 通过几何图形计算更佳，我就是通过几何画图计算出来的当前数据，使用者可以自行计算，得到这两个值\n      const x = mouseData.move.x + elDomRect.x - parentDomRect.x - mouseData.down.x;\n      const y = mouseData.move.y + elDomRect.y - parentDomRect.y - mouseData.down.y;\n      // 进行x,y坐标边界处理判断\n      if (x < 0) {\n        el.__position__.x = 0;\n      } else if (x > parentDomRect.width - elDomRect.width) {\n        el.__position__.x = parentDomRect.width - elDomRect.width;\n      } else {\n        el.__position__.x = x;\n      }\n      if (y < 0) {\n        el.__position__.y = 0;\n      } else if (y > parentDomRect.height - elDomRect.height) {\n        el.__position__.y = parentDomRect.height - elDomRect.height;\n      } else {\n        el.__position__.y = y;\n      }\n      // 渲染到真实dom属性上\n      el.style.cssText += `\n        position: absolute;\n        z-index: 100;\n        left: ${el.__position__.x}px;\n        top: ${el.__position__.y}px;\n      `;\n    }\n    el.__mouseDown__ = handleMouseDown;\n    el.__mouseMove__ = handleMouseMove;\n    el.__mouseUp__ = handleMouseUp;\n    // 2. 监听拖拽事件\n    el.addEventListener('mousedown', el.__mouseDown__);\n    document.addEventListener('mousemove', el.__mouseMove__);\n    document.addEventListener('mouseup', el.__mouseUp__);\n  },\n  updated(el, binding) {\n    setParentDom(el, binding, true);\n  },\n  beforeUnmount(el: ElType) {\n    // 避免重复开销，卸载所有的监听\n    // 解决问题：多次创建新的实例 =》 监听不取消 =》 同时存在多个无用的监听，导致页面性能变差\n    document.removeEventListener('mousedown', el.__mouseDown__);\n    document.removeEventListener('mousemove', el.__mouseMove__);\n    document.removeEventListener('mouseup', el.__mouseUp__);\n  },\n};\n// 设置parentDom，供mounted和update使用\nfunction setParentDom(el: ElType, binding: DirectiveBinding, updated: boolean) {\n  const array = [{ name: 'father', dom: el.parentElement }];\n\n  // 获取父级元素\n  let parentDom: HTMLElement | HTMLBodyElement;\n  // 以下if操作用于确保一定有一个parentDom\n  if (binding.value) {\n    const findArr = array.find((arr) => {\n      return arr.name === binding.value;\n    });\n    if (findArr && findArr.dom) {\n      parentDom = findArr.dom;\n    } else {\n      parentDom =\n        document.querySelector(binding.value) || (array[0].dom as HTMLElement) || array[1].dom;\n    }\n  } else {\n    parentDom = (array[0].dom as HTMLElement) || array[1].dom;\n  }\n  const parentDomRect = parentDom.getBoundingClientRect();\n  const elDomRect = el.getBoundingClientRect();\n  // 把以前的样式重置一下\n  if (el.__parentDom__) {\n    el.__parentDom__.style.position = 'static';\n  }\n  el.__parentDom__ = parentDom;\n  el.__parentDom__.style.position = 'relative';\n\n  if (updated) {\n    el.__position__ = {\n      x: elDomRect.x - parentDomRect.x,\n      y: elDomRect.y - parentDomRect.y,\n    };\n    // return\n    el.style.cssText += `\n      position: absolute;\n      z-index: 100;\n      left: ${el.__position__.x}px;\n      top: ${el.__position__.y}px;\n    `;\n  }\n}\nexport default directive;\n```\n\n***\n\n### 6. 长按指令，长按时触发事件\n\n```ts\n/**\n * v-longpress\n * 长按指令，长按时触发事件\n */\nimport type { Directive, DirectiveBinding } from 'vue';\n\nconst directive: Directive = {\n  mounted(el: HTMLElement, binding: DirectiveBinding) {\n    if (typeof binding.value !== 'function') {\n      throw 'callback must be a function';\n    }\n    // 定义变量\n    let pressTimer: any = null;\n    // 创建计时器（ 2秒后执行函数 ）\n    let start = (e: MouseEvent | TouchEvent) => {\n      if (e.button) {\n        if (e.type === 'click' && e.button !== 0) {\n          return;\n        }\n      }\n      if (pressTimer === null) {\n        pressTimer = setTimeout(() => {\n          handler(e);\n        }, 1000);\n      }\n    };\n    // 取消计时器\n    let cancel = (e) => {\n      if (pressTimer !== null) {\n        clearTimeout(pressTimer);\n        pressTimer = null;\n      }\n    };\n    // 运行函数\n    const handler = (e: MouseEvent | TouchEvent) => {\n      binding.value(e);\n    };\n    // 添加事件监听器\n    el.addEventListener('mousedown', start);\n    el.addEventListener('touchstart', start);\n    // 取消计时器\n    el.addEventListener('click', cancel);\n    el.addEventListener('mouseout', cancel);\n    el.addEventListener('touchend', cancel);\n    el.addEventListener('touchcancel', cancel);\n  },\n};\n\nexport default directive;\n```\n\n***\n\n### 7. 设置水印效果\n\n```ts\n/**\n * v-waterMarker可接收参数，均为非必填\n * { text: 'vue-admin-box', font: '16px Microsoft JhengHei', textColor: '#000' }\n */\nimport { Color, FontFamilyProperty, FontProperty } from 'csstype';\nimport type { Directive, DirectiveBinding } from 'vue';\n\nconst directive: Directive = {\n  mounted(el: HTMLElement, binding: DirectiveBinding) {\n    binding.value ? binding.value : (binding.value = {});\n    addWaterMarker(binding.value.text, el, binding.value.font, binding.value.textColor);\n  },\n};\n\nfunction addWaterMarker(\n  str: string,\n  parentNode: HTMLElement,\n  font: FontProperty,\n  textColor: Color\n) {\n  // 水印文字，父元素，字体，文字颜色\n  var can = document.createElement('canvas') as HTMLCanvasElement;\n  parentNode.appendChild(can);\n  can.width = 300;\n  can.height = 225;\n  can.style.display = 'none';\n  var cans = can.getContext('2d') as CanvasRenderingContext2D;\n  cans.rotate((-20 * Math.PI) / 180);\n  cans.font = font || '16px Microsoft JhengHei';\n  cans.fillStyle = textColor || 'rgba(180, 180, 180, 0.3)';\n  cans.textAlign = 'left';\n  cans.textBaseline = 'middle';\n  cans.fillText(str || 'vue-admin-box', can.width / 10, can.height / 2);\n  parentNode.style.backgroundImage = 'url(' + can.toDataURL('image/png') + ')';\n}\n\nexport default directive;\n```\n\n***","source":"_posts/实用的Vue自定义指令.md","raw":"---\ntitle: 实用的Vue自定义指令（持续完善...）\ntags:\n  - 前端开发\n  - 知识积累\n  - Vue积累\ncategories: \n  - 前端知识积累\n  - Vue\nabbrlink: a18d\ndate: 2022-08-18 17:22:11\n---\n\n常用的几个Vue自定义指令收集，持续更新...\n\n<!-- more -->\n\n\n### 1. 点击元素外部事件\n```ts\n/**\n * v-clickOutside\n * 点击元素外部事件\n * 接收参数：function类型，点击外面时返回true,点击内部时返回false\n */\nimport type { Directive, DirectiveBinding } from 'vue';\ninterface ElType extends HTMLElement {\n  __handleClick__: any;\n}\nconst directive: Directive = {\n  mounted(el: ElType, binding: DirectiveBinding) {\n    if (typeof binding.value !== 'function') {\n      throw 'callback must be a function';\n    }\n    el.__handleClick__ = function (e) {\n      if (el.contains(e.target)) {\n        binding.value(false);\n      } else {\n        binding.value(true);\n      }\n    };\n    document.addEventListener('click', el.__handleClick__);\n  },\n  beforeUnmount(el: ElType) {\n    document.removeEventListener('click', el.__handleClick__);\n  },\n};\n\nexport default directive;\n```\n\n***\n\n### 2. 复制某个值至剪贴板\n\n```ts\n/**\n * v-copy\n * 复制某个值至剪贴板\n * 接收参数：string类型/Ref<string>类型/Reactive<string>类型\n */\nimport type { Directive, DirectiveBinding } from 'vue';\nimport { ElMessage } from 'element-plus';\ninterface ElType extends HTMLElement {\n  copyData: string | number;\n  __handleClick__: any;\n}\nconst directive: Directive = {\n  mounted(el: ElType, binding: DirectiveBinding) {\n    el.copyData = binding.value;\n    el.addEventListener('click', handleClick);\n  },\n  updated(el: ElType, binding: DirectiveBinding) {\n    el.copyData = binding.value;\n  },\n  beforeUnmount(el: ElType) {\n    el.removeEventListener('click', el.__handleClick__);\n  },\n};\n\nfunction handleClick(this: ElType, ev: MouseEvent) {\n  let input = document.createElement('input');\n  input.value = this.copyData.toLocaleString();\n  document.body.appendChild(input);\n  input.select();\n  document.execCommand('Copy');\n  document.body.removeChild(input);\n  ElMessage({\n    type: 'success',\n    message: '复制成功',\n  });\n}\n\nexport default directive;\n```\n\n***\n\n### 3. 按钮防抖指令,可扩展至input\n\n```ts\n/**\n * v-debounce\n * 按钮防抖指令，可自行扩展至input\n * 接收参数：function类型\n */\nimport type { Directive, DirectiveBinding } from 'vue';\ninterface ElType extends HTMLElement {\n  __handleClick__: any;\n}\nconst directive: Directive = {\n  mounted(el: ElType, binding: DirectiveBinding) {\n    if (typeof binding.value !== 'function') {\n      console.error('callback must be a function');\n      return;\n    }\n    let timer: NodeJS.Timeout | null = null;\n    el.__handleClick__ = function (e: ElType) {\n      if (timer) {\n        clearInterval(timer);\n      }\n      timer = setTimeout(() => {\n        binding.value();\n      }, 200);\n    };\n    el.addEventListener('click', el.__handleClick__);\n  },\n  beforeUnmount(el: ElType) {\n    el.removeEventListener('click', el.__handleClick__);\n  },\n};\n\nexport default directive;\n```\n\n***\n\n### 4. 窗口拖拽\n\n```ts\n/**\n * 可基于窗口各种拖拽使用\n */\nimport type { Directive } from 'vue';\ninterface ElType extends HTMLDivElement {\n  __mouseDown__: any;\n  __mouseUp__: any;\n  __mouseMove__: any;\n  __sizeChange__: any;\n}\ninterface DataDialog {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  marginTop?: string | number;\n  top?: number;\n  bottom?: number;\n  left?: number;\n  right?: number;\n}\nconst drag: Directive = {\n  mounted(el: ElType, binding) {\n    if (binding.value) {\n      handleElShow(el);\n    }\n  },\n  updated(el, binding) {\n    if (binding.value) {\n      handleElShow(el);\n    } else {\n      handleElHide(el);\n    }\n  },\n  beforeUnmount(el: ElType) {\n    handleElHide(el);\n  },\n};\n\nfunction handleElShow(el: ElType) {\n  const dialog = el.querySelector('.el-dialog') as HTMLElement;\n  if (!dialog) {\n    return;\n  }\n  const header = el.querySelector('.el-dialog__header') as HTMLElement;\n  const dialogMask = el.querySelector('.el-overlay') as HTMLElement;\n  dialogMask.style.cssText += 'overflow: hidden;';\n  header.style.cursor = 'move';\n  let dragStatus = false;\n  let data = {\n    // 数据源，不变部分为：window信息、dialog信息、mouse初始值信息，可变部分为：拖拽坐标位移\n    window: {\n      // window信息\n      width: 0,\n      height: 0,\n    },\n    dialog: {\n      x: 0,\n      y: 0,\n      width: 0,\n      height: 0,\n      marginTop: '',\n    } as DataDialog, // dialog信息\n    mouse: {\n      // 鼠标初始信息\n      x: 0,\n      y: 0,\n    },\n    drag: {\n      // 拖拽过程信息\n      x: 0,\n      y: 0,\n    },\n  };\n  // 所有的监听只为了修改data数据\n  header.addEventListener('mousedown', mouseDown);\n  document.addEventListener('mousemove', mouseMove);\n  document.addEventListener('mouseup', mouseUp);\n  window.addEventListener('resize', sizeChange);\n  // 边界处理，防止拖动位置溢出\n  function handlePosition() {\n    if (data.mouse.x - data.drag.x >= data.dialog.x) {\n      data.drag.x = data.mouse.x - data.dialog.x;\n    }\n    if (data.drag.x - data.mouse.x >= data.window.width - (data.dialog.x + data.dialog.width)) {\n      data.drag.x = data.mouse.x + data.window.width - data.dialog.x - data.dialog.width;\n    }\n    if (data.mouse.y - data.drag.y >= data.dialog.y) {\n      data.drag.y = data.mouse.y - data.dialog.y;\n    }\n    if (data.drag.y - data.mouse.y >= data.window.height - (data.dialog.y + data.dialog.height)) {\n      data.drag.y = data.mouse.y + data.window.height - data.dialog.y - data.dialog.height;\n    }\n    setPosition();\n  }\n  // 根据data来设置拖动后的位置\n  function setPosition() {\n    let top = data.drag.y - data.mouse.y + data.dialog.y;\n    let left = data.drag.x - data.mouse.x + data.dialog.x;\n    dialog.style.cssText += `position: absolute; top: calc(${top}px - ${data.dialog.marginTop}); left: ${left}px;`;\n  }\n  function mouseDown(e: any) {\n    // 获取dialog目前的位置，坐标, 以及屏幕当前的宽高\n    // 一切初始数据的获取应该放置于此，避免其他如：宽度修改等一系列的影响\n    if (e.button !== 0) {\n      return;\n    }\n    data.window = {\n      width: document.body.clientWidth,\n      height: document.body.clientHeight,\n    };\n    data.dialog = dialog.getBoundingClientRect();\n    data.dialog.marginTop = window.getComputedStyle(dialog).marginTop;\n    data.mouse = {\n      x: e.clientX,\n      y: e.clientY,\n    };\n    dragStatus = true;\n  }\n  function mouseMove(e: any) {\n    if (dragStatus) {\n      data.drag = {\n        x: e.clientX,\n        y: e.clientY,\n      };\n      dialogMask.style.userSelect = 'none';\n      handlePosition();\n    }\n  }\n  function mouseUp(e: any) {\n    dialogMask.style.userSelect = 'auto';\n    dragStatus = false;\n  }\n  function sizeChange(e: any) {\n    // dialog.style.cssText += 'position: static';\n  }\n  // 方便卸载使用\n  el.__mouseDown__ = mouseDown;\n  el.__mouseUp__ = mouseUp;\n  el.__mouseMove__ = mouseMove;\n  el.__sizeChange__ = sizeChange;\n}\n\nfunction handleElHide(el: ElType) {\n  // 避免重复开销，卸载所有的监听\n  // 解决问题：多次创建新的实例 =》 监听不取消 =》 同时存在多个无用的监听，导致页面卡顿\n  document.removeEventListener('mousedown', el.__mouseDown__);\n  document.removeEventListener('mousemove', el.__mouseMove__);\n  document.removeEventListener('mouseup', el.__mouseUp__);\n  window.removeEventListener('resize', el.__sizeChange__);\n}\n\nexport default drag;\n```\n\n***\n\n### 5. 窗口拖拽2，可自定义父级\n\n```ts\n/**\n * 支持父级，自定义父级，以及window作为父级\n * 使用示例：\n * 1. v-dragable\n * 2. v-dragable=\"'father'\" // 使用父级作为父级\n * 3. v-dragable=\"'body'\" // 使用body对象作为父级\n * 4. v-dragable=\"'#app'\" // 使用id作为父级\n * 5. v-dragable=\"'.list'\" // 使用class名作为父级\n * 3-5代表所有可被document.querySelector()解析的参数值\n **/\nimport type { Directive, DirectiveBinding } from 'vue';\ninterface Position {\n  x: number;\n  y: number;\n}\ninterface Mouse {\n  down: Position;\n  move: Position;\n}\ninterface ElType extends HTMLElement {\n  __mouseDown__: any;\n  __mouseUp__: any;\n  __mouseMove__: any;\n  __parentDom__: HTMLElement;\n  __position__: Position;\n}\nconst directive: Directive = {\n  mounted: (el: ElType, binding: DirectiveBinding) => {\n    setParentDom(el, binding, false);\n    // 子级元素位置处理\n    // 1. 获取父子元素当前位置\n    let parentDomRect: DOMRect;\n    let elDomRect: DOMRect;\n    let mouseData: Mouse = {\n      down: { x: 0, y: 0 },\n      move: { x: 0, y: 0 },\n    };\n    let mouseDown: boolean = false;\n    el.__position__ = {\n      x: 0,\n      y: 0,\n    };\n    let bodyUserSelect: string = 'text';\n\n    function handleMouseDown(e: MouseEvent) {\n      if (e.button !== 0) {\n        return;\n      }\n      mouseData.down = {\n        x: e.clientX,\n        y: e.clientY,\n      };\n      mouseDown = true;\n      parentDomRect = el.__parentDom__.getBoundingClientRect();\n      elDomRect = el.getBoundingClientRect();\n      bodyUserSelect = document.querySelector('body')!.style.userSelect;\n      document.querySelector('body')!.style.userSelect = 'none';\n    }\n    function handleMouseMove(e: MouseEvent) {\n      if (!mouseDown) {\n        return;\n      }\n      mouseData.move = {\n        x: e.clientX,\n        y: e.clientY,\n      };\n      setPosition();\n    }\n    function handleMouseUp(e: MouseEvent) {\n      if (mouseDown) {\n        mouseDown = false;\n        document.querySelector('body')!.style.userSelect = bodyUserSelect;\n      }\n    }\n    // 用于设置el元素的Position位置\n    function setPosition() {\n      // 通过几何图形计算更佳，我就是通过几何画图计算出来的当前数据，使用者可以自行计算，得到这两个值\n      const x = mouseData.move.x + elDomRect.x - parentDomRect.x - mouseData.down.x;\n      const y = mouseData.move.y + elDomRect.y - parentDomRect.y - mouseData.down.y;\n      // 进行x,y坐标边界处理判断\n      if (x < 0) {\n        el.__position__.x = 0;\n      } else if (x > parentDomRect.width - elDomRect.width) {\n        el.__position__.x = parentDomRect.width - elDomRect.width;\n      } else {\n        el.__position__.x = x;\n      }\n      if (y < 0) {\n        el.__position__.y = 0;\n      } else if (y > parentDomRect.height - elDomRect.height) {\n        el.__position__.y = parentDomRect.height - elDomRect.height;\n      } else {\n        el.__position__.y = y;\n      }\n      // 渲染到真实dom属性上\n      el.style.cssText += `\n        position: absolute;\n        z-index: 100;\n        left: ${el.__position__.x}px;\n        top: ${el.__position__.y}px;\n      `;\n    }\n    el.__mouseDown__ = handleMouseDown;\n    el.__mouseMove__ = handleMouseMove;\n    el.__mouseUp__ = handleMouseUp;\n    // 2. 监听拖拽事件\n    el.addEventListener('mousedown', el.__mouseDown__);\n    document.addEventListener('mousemove', el.__mouseMove__);\n    document.addEventListener('mouseup', el.__mouseUp__);\n  },\n  updated(el, binding) {\n    setParentDom(el, binding, true);\n  },\n  beforeUnmount(el: ElType) {\n    // 避免重复开销，卸载所有的监听\n    // 解决问题：多次创建新的实例 =》 监听不取消 =》 同时存在多个无用的监听，导致页面性能变差\n    document.removeEventListener('mousedown', el.__mouseDown__);\n    document.removeEventListener('mousemove', el.__mouseMove__);\n    document.removeEventListener('mouseup', el.__mouseUp__);\n  },\n};\n// 设置parentDom，供mounted和update使用\nfunction setParentDom(el: ElType, binding: DirectiveBinding, updated: boolean) {\n  const array = [{ name: 'father', dom: el.parentElement }];\n\n  // 获取父级元素\n  let parentDom: HTMLElement | HTMLBodyElement;\n  // 以下if操作用于确保一定有一个parentDom\n  if (binding.value) {\n    const findArr = array.find((arr) => {\n      return arr.name === binding.value;\n    });\n    if (findArr && findArr.dom) {\n      parentDom = findArr.dom;\n    } else {\n      parentDom =\n        document.querySelector(binding.value) || (array[0].dom as HTMLElement) || array[1].dom;\n    }\n  } else {\n    parentDom = (array[0].dom as HTMLElement) || array[1].dom;\n  }\n  const parentDomRect = parentDom.getBoundingClientRect();\n  const elDomRect = el.getBoundingClientRect();\n  // 把以前的样式重置一下\n  if (el.__parentDom__) {\n    el.__parentDom__.style.position = 'static';\n  }\n  el.__parentDom__ = parentDom;\n  el.__parentDom__.style.position = 'relative';\n\n  if (updated) {\n    el.__position__ = {\n      x: elDomRect.x - parentDomRect.x,\n      y: elDomRect.y - parentDomRect.y,\n    };\n    // return\n    el.style.cssText += `\n      position: absolute;\n      z-index: 100;\n      left: ${el.__position__.x}px;\n      top: ${el.__position__.y}px;\n    `;\n  }\n}\nexport default directive;\n```\n\n***\n\n### 6. 长按指令，长按时触发事件\n\n```ts\n/**\n * v-longpress\n * 长按指令，长按时触发事件\n */\nimport type { Directive, DirectiveBinding } from 'vue';\n\nconst directive: Directive = {\n  mounted(el: HTMLElement, binding: DirectiveBinding) {\n    if (typeof binding.value !== 'function') {\n      throw 'callback must be a function';\n    }\n    // 定义变量\n    let pressTimer: any = null;\n    // 创建计时器（ 2秒后执行函数 ）\n    let start = (e: MouseEvent | TouchEvent) => {\n      if (e.button) {\n        if (e.type === 'click' && e.button !== 0) {\n          return;\n        }\n      }\n      if (pressTimer === null) {\n        pressTimer = setTimeout(() => {\n          handler(e);\n        }, 1000);\n      }\n    };\n    // 取消计时器\n    let cancel = (e) => {\n      if (pressTimer !== null) {\n        clearTimeout(pressTimer);\n        pressTimer = null;\n      }\n    };\n    // 运行函数\n    const handler = (e: MouseEvent | TouchEvent) => {\n      binding.value(e);\n    };\n    // 添加事件监听器\n    el.addEventListener('mousedown', start);\n    el.addEventListener('touchstart', start);\n    // 取消计时器\n    el.addEventListener('click', cancel);\n    el.addEventListener('mouseout', cancel);\n    el.addEventListener('touchend', cancel);\n    el.addEventListener('touchcancel', cancel);\n  },\n};\n\nexport default directive;\n```\n\n***\n\n### 7. 设置水印效果\n\n```ts\n/**\n * v-waterMarker可接收参数，均为非必填\n * { text: 'vue-admin-box', font: '16px Microsoft JhengHei', textColor: '#000' }\n */\nimport { Color, FontFamilyProperty, FontProperty } from 'csstype';\nimport type { Directive, DirectiveBinding } from 'vue';\n\nconst directive: Directive = {\n  mounted(el: HTMLElement, binding: DirectiveBinding) {\n    binding.value ? binding.value : (binding.value = {});\n    addWaterMarker(binding.value.text, el, binding.value.font, binding.value.textColor);\n  },\n};\n\nfunction addWaterMarker(\n  str: string,\n  parentNode: HTMLElement,\n  font: FontProperty,\n  textColor: Color\n) {\n  // 水印文字，父元素，字体，文字颜色\n  var can = document.createElement('canvas') as HTMLCanvasElement;\n  parentNode.appendChild(can);\n  can.width = 300;\n  can.height = 225;\n  can.style.display = 'none';\n  var cans = can.getContext('2d') as CanvasRenderingContext2D;\n  cans.rotate((-20 * Math.PI) / 180);\n  cans.font = font || '16px Microsoft JhengHei';\n  cans.fillStyle = textColor || 'rgba(180, 180, 180, 0.3)';\n  cans.textAlign = 'left';\n  cans.textBaseline = 'middle';\n  cans.fillText(str || 'vue-admin-box', can.width / 10, can.height / 2);\n  parentNode.style.backgroundImage = 'url(' + can.toDataURL('image/png') + ')';\n}\n\nexport default directive;\n```\n\n***","slug":"实用的Vue自定义指令","published":1,"updated":"2022-08-26T01:42:59.884Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl79tdvvf000h5d9kb49y4lxx","content":"<p>常用的几个Vue自定义指令收集，持续更新…</p>\n<span id=\"more\"></span>\n\n\n<h3 id=\"1-点击元素外部事件\"><a href=\"#1-点击元素外部事件\" class=\"headerlink\" title=\"1. 点击元素外部事件\"></a>1. 点击元素外部事件</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * v-clickOutside</span></span><br><span class=\"line\"><span class=\"comment\"> * 点击元素外部事件</span></span><br><span class=\"line\"><span class=\"comment\"> * 接收参数：function类型，点击外面时返回true,点击内部时返回false</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; <span class=\"title class_\">Directive</span>, <span class=\"title class_\">DirectiveBinding</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">ElType</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">HTMLElement</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">__handleClick__</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">directive</span>: <span class=\"title class_\">Directive</span> = &#123;</span><br><span class=\"line\">  <span class=\"title function_\">mounted</span>(<span class=\"params\">el: ElType, binding: DirectiveBinding</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> binding.<span class=\"property\">value</span> !== <span class=\"string\">&#x27;function&#x27;</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"string\">&#x27;callback must be a function&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    el.<span class=\"property\">__handleClick__</span> = <span class=\"keyword\">function</span> (<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (el.<span class=\"title function_\">contains</span>(e.<span class=\"property\">target</span>)) &#123;</span><br><span class=\"line\">        binding.<span class=\"title function_\">value</span>(<span class=\"literal\">false</span>);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        binding.<span class=\"title function_\">value</span>(<span class=\"literal\">true</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, el.<span class=\"property\">__handleClick__</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title function_\">beforeUnmount</span>(<span class=\"params\">el: ElType</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, el.<span class=\"property\">__handleClick__</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> directive;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2-复制某个值至剪贴板\"><a href=\"#2-复制某个值至剪贴板\" class=\"headerlink\" title=\"2. 复制某个值至剪贴板\"></a>2. 复制某个值至剪贴板</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * v-copy</span></span><br><span class=\"line\"><span class=\"comment\"> * 复制某个值至剪贴板</span></span><br><span class=\"line\"><span class=\"comment\"> * 接收参数：string类型/Ref&lt;string&gt;类型/Reactive&lt;string&gt;类型</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; <span class=\"title class_\">Directive</span>, <span class=\"title class_\">DirectiveBinding</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">ElMessage</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;element-plus&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">ElType</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">HTMLElement</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">copyData</span>: <span class=\"built_in\">string</span> | <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  <span class=\"attr\">__handleClick__</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">directive</span>: <span class=\"title class_\">Directive</span> = &#123;</span><br><span class=\"line\">  <span class=\"title function_\">mounted</span>(<span class=\"params\">el: ElType, binding: DirectiveBinding</span>) &#123;</span><br><span class=\"line\">    el.<span class=\"property\">copyData</span> = binding.<span class=\"property\">value</span>;</span><br><span class=\"line\">    el.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, handleClick);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title function_\">updated</span>(<span class=\"params\">el: ElType, binding: DirectiveBinding</span>) &#123;</span><br><span class=\"line\">    el.<span class=\"property\">copyData</span> = binding.<span class=\"property\">value</span>;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title function_\">beforeUnmount</span>(<span class=\"params\">el: ElType</span>) &#123;</span><br><span class=\"line\">    el.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, el.<span class=\"property\">__handleClick__</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">handleClick</span>(<span class=\"params\"><span class=\"variable language_\">this</span>: ElType, ev: MouseEvent</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> input = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;input&#x27;</span>);</span><br><span class=\"line\">  input.<span class=\"property\">value</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">copyData</span>.<span class=\"title function_\">toLocaleString</span>();</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">appendChild</span>(input);</span><br><span class=\"line\">  input.<span class=\"title function_\">select</span>();</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"title function_\">execCommand</span>(<span class=\"string\">&#x27;Copy&#x27;</span>);</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">removeChild</span>(input);</span><br><span class=\"line\">  <span class=\"title class_\">ElMessage</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"string\">&#x27;success&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">message</span>: <span class=\"string\">&#x27;复制成功&#x27;</span>,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> directive;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"3-按钮防抖指令-可扩展至input\"><a href=\"#3-按钮防抖指令-可扩展至input\" class=\"headerlink\" title=\"3. 按钮防抖指令,可扩展至input\"></a>3. 按钮防抖指令,可扩展至input</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * v-debounce</span></span><br><span class=\"line\"><span class=\"comment\"> * 按钮防抖指令，可自行扩展至input</span></span><br><span class=\"line\"><span class=\"comment\"> * 接收参数：function类型</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; <span class=\"title class_\">Directive</span>, <span class=\"title class_\">DirectiveBinding</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">ElType</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">HTMLElement</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">__handleClick__</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">directive</span>: <span class=\"title class_\">Directive</span> = &#123;</span><br><span class=\"line\">  <span class=\"title function_\">mounted</span>(<span class=\"params\">el: ElType, binding: DirectiveBinding</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> binding.<span class=\"property\">value</span> !== <span class=\"string\">&#x27;function&#x27;</span>) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;callback must be a function&#x27;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"attr\">timer</span>: <span class=\"title class_\">NodeJS</span>.<span class=\"property\">Timeout</span> | <span class=\"literal\">null</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    el.<span class=\"property\">__handleClick__</span> = <span class=\"keyword\">function</span> (<span class=\"params\">e: ElType</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (timer) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">clearInterval</span>(timer);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        binding.<span class=\"title function_\">value</span>();</span><br><span class=\"line\">      &#125;, <span class=\"number\">200</span>);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    el.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, el.<span class=\"property\">__handleClick__</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title function_\">beforeUnmount</span>(<span class=\"params\">el: ElType</span>) &#123;</span><br><span class=\"line\">    el.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, el.<span class=\"property\">__handleClick__</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> directive;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"4-窗口拖拽\"><a href=\"#4-窗口拖拽\" class=\"headerlink\" title=\"4. 窗口拖拽\"></a>4. 窗口拖拽</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 可基于窗口各种拖拽使用</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; <span class=\"title class_\">Directive</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">ElType</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">HTMLDivElement</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">__mouseDown__</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">  <span class=\"attr\">__mouseUp__</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">  <span class=\"attr\">__mouseMove__</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">  <span class=\"attr\">__sizeChange__</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">DataDialog</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">x</span>: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  <span class=\"attr\">y</span>: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  <span class=\"attr\">width</span>: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  <span class=\"attr\">height</span>: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  marginTop?: <span class=\"built_in\">string</span> | <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  top?: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  bottom?: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  left?: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  right?: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">drag</span>: <span class=\"title class_\">Directive</span> = &#123;</span><br><span class=\"line\">  <span class=\"title function_\">mounted</span>(<span class=\"params\">el: ElType, binding</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (binding.<span class=\"property\">value</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">handleElShow</span>(el);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title function_\">updated</span>(<span class=\"params\">el, binding</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (binding.<span class=\"property\">value</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">handleElShow</span>(el);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"title function_\">handleElHide</span>(el);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title function_\">beforeUnmount</span>(<span class=\"params\">el: ElType</span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">handleElHide</span>(el);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">handleElShow</span>(<span class=\"params\">el: ElType</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> dialog = el.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;.el-dialog&#x27;</span>) <span class=\"keyword\">as</span> <span class=\"title class_\">HTMLElement</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!dialog) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> header = el.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;.el-dialog__header&#x27;</span>) <span class=\"keyword\">as</span> <span class=\"title class_\">HTMLElement</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> dialogMask = el.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;.el-overlay&#x27;</span>) <span class=\"keyword\">as</span> <span class=\"title class_\">HTMLElement</span>;</span><br><span class=\"line\">  dialogMask.<span class=\"property\">style</span>.<span class=\"property\">cssText</span> += <span class=\"string\">&#x27;overflow: hidden;&#x27;</span>;</span><br><span class=\"line\">  header.<span class=\"property\">style</span>.<span class=\"property\">cursor</span> = <span class=\"string\">&#x27;move&#x27;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> dragStatus = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> data = &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 数据源，不变部分为：window信息、dialog信息、mouse初始值信息，可变部分为：拖拽坐标位移</span></span><br><span class=\"line\">    <span class=\"attr\">window</span>: &#123;</span><br><span class=\"line\">      <span class=\"comment\">// window信息</span></span><br><span class=\"line\">      <span class=\"attr\">width</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">height</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">dialog</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">x</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">y</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">width</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">height</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">marginTop</span>: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    &#125; <span class=\"keyword\">as</span> <span class=\"title class_\">DataDialog</span>, <span class=\"comment\">// dialog信息</span></span><br><span class=\"line\">    <span class=\"attr\">mouse</span>: &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 鼠标初始信息</span></span><br><span class=\"line\">      <span class=\"attr\">x</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">y</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">drag</span>: &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 拖拽过程信息</span></span><br><span class=\"line\">      <span class=\"attr\">x</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">y</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"comment\">// 所有的监听只为了修改data数据</span></span><br><span class=\"line\">  header.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, mouseDown);</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, mouseMove);</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mouseup&#x27;</span>, mouseUp);</span><br><span class=\"line\">  <span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;resize&#x27;</span>, sizeChange);</span><br><span class=\"line\">  <span class=\"comment\">// 边界处理，防止拖动位置溢出</span></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">handlePosition</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (data.<span class=\"property\">mouse</span>.<span class=\"property\">x</span> - data.<span class=\"property\">drag</span>.<span class=\"property\">x</span> &gt;= data.<span class=\"property\">dialog</span>.<span class=\"property\">x</span>) &#123;</span><br><span class=\"line\">      data.<span class=\"property\">drag</span>.<span class=\"property\">x</span> = data.<span class=\"property\">mouse</span>.<span class=\"property\">x</span> - data.<span class=\"property\">dialog</span>.<span class=\"property\">x</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (data.<span class=\"property\">drag</span>.<span class=\"property\">x</span> - data.<span class=\"property\">mouse</span>.<span class=\"property\">x</span> &gt;= data.<span class=\"property\">window</span>.<span class=\"property\">width</span> - (data.<span class=\"property\">dialog</span>.<span class=\"property\">x</span> + data.<span class=\"property\">dialog</span>.<span class=\"property\">width</span>)) &#123;</span><br><span class=\"line\">      data.<span class=\"property\">drag</span>.<span class=\"property\">x</span> = data.<span class=\"property\">mouse</span>.<span class=\"property\">x</span> + data.<span class=\"property\">window</span>.<span class=\"property\">width</span> - data.<span class=\"property\">dialog</span>.<span class=\"property\">x</span> - data.<span class=\"property\">dialog</span>.<span class=\"property\">width</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (data.<span class=\"property\">mouse</span>.<span class=\"property\">y</span> - data.<span class=\"property\">drag</span>.<span class=\"property\">y</span> &gt;= data.<span class=\"property\">dialog</span>.<span class=\"property\">y</span>) &#123;</span><br><span class=\"line\">      data.<span class=\"property\">drag</span>.<span class=\"property\">y</span> = data.<span class=\"property\">mouse</span>.<span class=\"property\">y</span> - data.<span class=\"property\">dialog</span>.<span class=\"property\">y</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (data.<span class=\"property\">drag</span>.<span class=\"property\">y</span> - data.<span class=\"property\">mouse</span>.<span class=\"property\">y</span> &gt;= data.<span class=\"property\">window</span>.<span class=\"property\">height</span> - (data.<span class=\"property\">dialog</span>.<span class=\"property\">y</span> + data.<span class=\"property\">dialog</span>.<span class=\"property\">height</span>)) &#123;</span><br><span class=\"line\">      data.<span class=\"property\">drag</span>.<span class=\"property\">y</span> = data.<span class=\"property\">mouse</span>.<span class=\"property\">y</span> + data.<span class=\"property\">window</span>.<span class=\"property\">height</span> - data.<span class=\"property\">dialog</span>.<span class=\"property\">y</span> - data.<span class=\"property\">dialog</span>.<span class=\"property\">height</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">setPosition</span>();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 根据data来设置拖动后的位置</span></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">setPosition</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> top = data.<span class=\"property\">drag</span>.<span class=\"property\">y</span> - data.<span class=\"property\">mouse</span>.<span class=\"property\">y</span> + data.<span class=\"property\">dialog</span>.<span class=\"property\">y</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> left = data.<span class=\"property\">drag</span>.<span class=\"property\">x</span> - data.<span class=\"property\">mouse</span>.<span class=\"property\">x</span> + data.<span class=\"property\">dialog</span>.<span class=\"property\">x</span>;</span><br><span class=\"line\">    dialog.<span class=\"property\">style</span>.<span class=\"property\">cssText</span> += <span class=\"string\">`position: absolute; top: calc(<span class=\"subst\">$&#123;top&#125;</span>px - <span class=\"subst\">$&#123;data.dialog.marginTop&#125;</span>); left: <span class=\"subst\">$&#123;left&#125;</span>px;`</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">mouseDown</span>(<span class=\"params\">e: <span class=\"built_in\">any</span></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 获取dialog目前的位置，坐标, 以及屏幕当前的宽高</span></span><br><span class=\"line\">    <span class=\"comment\">// 一切初始数据的获取应该放置于此，避免其他如：宽度修改等一系列的影响</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (e.<span class=\"property\">button</span> !== <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    data.<span class=\"property\">window</span> = &#123;</span><br><span class=\"line\">      <span class=\"attr\">width</span>: <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">clientWidth</span>,</span><br><span class=\"line\">      <span class=\"attr\">height</span>: <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">clientHeight</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    data.<span class=\"property\">dialog</span> = dialog.<span class=\"title function_\">getBoundingClientRect</span>();</span><br><span class=\"line\">    data.<span class=\"property\">dialog</span>.<span class=\"property\">marginTop</span> = <span class=\"variable language_\">window</span>.<span class=\"title function_\">getComputedStyle</span>(dialog).<span class=\"property\">marginTop</span>;</span><br><span class=\"line\">    data.<span class=\"property\">mouse</span> = &#123;</span><br><span class=\"line\">      <span class=\"attr\">x</span>: e.<span class=\"property\">clientX</span>,</span><br><span class=\"line\">      <span class=\"attr\">y</span>: e.<span class=\"property\">clientY</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    dragStatus = <span class=\"literal\">true</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">mouseMove</span>(<span class=\"params\">e: <span class=\"built_in\">any</span></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (dragStatus) &#123;</span><br><span class=\"line\">      data.<span class=\"property\">drag</span> = &#123;</span><br><span class=\"line\">        <span class=\"attr\">x</span>: e.<span class=\"property\">clientX</span>,</span><br><span class=\"line\">        <span class=\"attr\">y</span>: e.<span class=\"property\">clientY</span>,</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">      dialogMask.<span class=\"property\">style</span>.<span class=\"property\">userSelect</span> = <span class=\"string\">&#x27;none&#x27;</span>;</span><br><span class=\"line\">      <span class=\"title function_\">handlePosition</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">mouseUp</span>(<span class=\"params\">e: <span class=\"built_in\">any</span></span>) &#123;</span><br><span class=\"line\">    dialogMask.<span class=\"property\">style</span>.<span class=\"property\">userSelect</span> = <span class=\"string\">&#x27;auto&#x27;</span>;</span><br><span class=\"line\">    dragStatus = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">sizeChange</span>(<span class=\"params\">e: <span class=\"built_in\">any</span></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// dialog.style.cssText += &#x27;position: static&#x27;;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 方便卸载使用</span></span><br><span class=\"line\">  el.<span class=\"property\">__mouseDown__</span> = mouseDown;</span><br><span class=\"line\">  el.<span class=\"property\">__mouseUp__</span> = mouseUp;</span><br><span class=\"line\">  el.<span class=\"property\">__mouseMove__</span> = mouseMove;</span><br><span class=\"line\">  el.<span class=\"property\">__sizeChange__</span> = sizeChange;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">handleElHide</span>(<span class=\"params\">el: ElType</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 避免重复开销，卸载所有的监听</span></span><br><span class=\"line\">  <span class=\"comment\">// 解决问题：多次创建新的实例 =》 监听不取消 =》 同时存在多个无用的监听，导致页面卡顿</span></span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, el.<span class=\"property\">__mouseDown__</span>);</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, el.<span class=\"property\">__mouseMove__</span>);</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mouseup&#x27;</span>, el.<span class=\"property\">__mouseUp__</span>);</span><br><span class=\"line\">  <span class=\"variable language_\">window</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;resize&#x27;</span>, el.<span class=\"property\">__sizeChange__</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> drag;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"5-窗口拖拽2，可自定义父级\"><a href=\"#5-窗口拖拽2，可自定义父级\" class=\"headerlink\" title=\"5. 窗口拖拽2，可自定义父级\"></a>5. 窗口拖拽2，可自定义父级</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 支持父级，自定义父级，以及window作为父级</span></span><br><span class=\"line\"><span class=\"comment\"> * 使用示例：</span></span><br><span class=\"line\"><span class=\"comment\"> * 1. v-dragable</span></span><br><span class=\"line\"><span class=\"comment\"> * 2. v-dragable=&quot;&#x27;father&#x27;&quot; // 使用父级作为父级</span></span><br><span class=\"line\"><span class=\"comment\"> * 3. v-dragable=&quot;&#x27;body&#x27;&quot; // 使用body对象作为父级</span></span><br><span class=\"line\"><span class=\"comment\"> * 4. v-dragable=&quot;&#x27;#app&#x27;&quot; // 使用id作为父级</span></span><br><span class=\"line\"><span class=\"comment\"> * 5. v-dragable=&quot;&#x27;.list&#x27;&quot; // 使用class名作为父级</span></span><br><span class=\"line\"><span class=\"comment\"> * 3-5代表所有可被document.querySelector()解析的参数值</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; <span class=\"title class_\">Directive</span>, <span class=\"title class_\">DirectiveBinding</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Position</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">x</span>: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  <span class=\"attr\">y</span>: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Mouse</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">down</span>: <span class=\"title class_\">Position</span>;</span><br><span class=\"line\">  <span class=\"attr\">move</span>: <span class=\"title class_\">Position</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">ElType</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">HTMLElement</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">__mouseDown__</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">  <span class=\"attr\">__mouseUp__</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">  <span class=\"attr\">__mouseMove__</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">  <span class=\"attr\">__parentDom__</span>: <span class=\"title class_\">HTMLElement</span>;</span><br><span class=\"line\">  <span class=\"attr\">__position__</span>: <span class=\"title class_\">Position</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">directive</span>: <span class=\"title class_\">Directive</span> = &#123;</span><br><span class=\"line\">  <span class=\"attr\">mounted</span>: <span class=\"function\">(<span class=\"params\">el: ElType, binding: DirectiveBinding</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">setParentDom</span>(el, binding, <span class=\"literal\">false</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 子级元素位置处理</span></span><br><span class=\"line\">    <span class=\"comment\">// 1. 获取父子元素当前位置</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"attr\">parentDomRect</span>: <span class=\"title class_\">DOMRect</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"attr\">elDomRect</span>: <span class=\"title class_\">DOMRect</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"attr\">mouseData</span>: <span class=\"title class_\">Mouse</span> = &#123;</span><br><span class=\"line\">      <span class=\"attr\">down</span>: &#123; <span class=\"attr\">x</span>: <span class=\"number\">0</span>, <span class=\"attr\">y</span>: <span class=\"number\">0</span> &#125;,</span><br><span class=\"line\">      <span class=\"attr\">move</span>: &#123; <span class=\"attr\">x</span>: <span class=\"number\">0</span>, <span class=\"attr\">y</span>: <span class=\"number\">0</span> &#125;,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"attr\">mouseDown</span>: <span class=\"built_in\">boolean</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    el.<span class=\"property\">__position__</span> = &#123;</span><br><span class=\"line\">      <span class=\"attr\">x</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">y</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"attr\">bodyUserSelect</span>: <span class=\"built_in\">string</span> = <span class=\"string\">&#x27;text&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">function</span> <span class=\"title function_\">handleMouseDown</span>(<span class=\"params\">e: MouseEvent</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (e.<span class=\"property\">button</span> !== <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      mouseData.<span class=\"property\">down</span> = &#123;</span><br><span class=\"line\">        <span class=\"attr\">x</span>: e.<span class=\"property\">clientX</span>,</span><br><span class=\"line\">        <span class=\"attr\">y</span>: e.<span class=\"property\">clientY</span>,</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">      mouseDown = <span class=\"literal\">true</span>;</span><br><span class=\"line\">      parentDomRect = el.<span class=\"property\">__parentDom__</span>.<span class=\"title function_\">getBoundingClientRect</span>();</span><br><span class=\"line\">      elDomRect = el.<span class=\"title function_\">getBoundingClientRect</span>();</span><br><span class=\"line\">      bodyUserSelect = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;body&#x27;</span>)!.<span class=\"property\">style</span>.<span class=\"property\">userSelect</span>;</span><br><span class=\"line\">      <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;body&#x27;</span>)!.<span class=\"property\">style</span>.<span class=\"property\">userSelect</span> = <span class=\"string\">&#x27;none&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">function</span> <span class=\"title function_\">handleMouseMove</span>(<span class=\"params\">e: MouseEvent</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!mouseDown) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      mouseData.<span class=\"property\">move</span> = &#123;</span><br><span class=\"line\">        <span class=\"attr\">x</span>: e.<span class=\"property\">clientX</span>,</span><br><span class=\"line\">        <span class=\"attr\">y</span>: e.<span class=\"property\">clientY</span>,</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">      <span class=\"title function_\">setPosition</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">function</span> <span class=\"title function_\">handleMouseUp</span>(<span class=\"params\">e: MouseEvent</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (mouseDown) &#123;</span><br><span class=\"line\">        mouseDown = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;body&#x27;</span>)!.<span class=\"property\">style</span>.<span class=\"property\">userSelect</span> = bodyUserSelect;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 用于设置el元素的Position位置</span></span><br><span class=\"line\">    <span class=\"keyword\">function</span> <span class=\"title function_\">setPosition</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 通过几何图形计算更佳，我就是通过几何画图计算出来的当前数据，使用者可以自行计算，得到这两个值</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> x = mouseData.<span class=\"property\">move</span>.<span class=\"property\">x</span> + elDomRect.<span class=\"property\">x</span> - parentDomRect.<span class=\"property\">x</span> - mouseData.<span class=\"property\">down</span>.<span class=\"property\">x</span>;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> y = mouseData.<span class=\"property\">move</span>.<span class=\"property\">y</span> + elDomRect.<span class=\"property\">y</span> - parentDomRect.<span class=\"property\">y</span> - mouseData.<span class=\"property\">down</span>.<span class=\"property\">y</span>;</span><br><span class=\"line\">      <span class=\"comment\">// 进行x,y坐标边界处理判断</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (x &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        el.<span class=\"property\">__position__</span>.<span class=\"property\">x</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (x &gt; parentDomRect.<span class=\"property\">width</span> - elDomRect.<span class=\"property\">width</span>) &#123;</span><br><span class=\"line\">        el.<span class=\"property\">__position__</span>.<span class=\"property\">x</span> = parentDomRect.<span class=\"property\">width</span> - elDomRect.<span class=\"property\">width</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        el.<span class=\"property\">__position__</span>.<span class=\"property\">x</span> = x;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (y &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        el.<span class=\"property\">__position__</span>.<span class=\"property\">y</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (y &gt; parentDomRect.<span class=\"property\">height</span> - elDomRect.<span class=\"property\">height</span>) &#123;</span><br><span class=\"line\">        el.<span class=\"property\">__position__</span>.<span class=\"property\">y</span> = parentDomRect.<span class=\"property\">height</span> - elDomRect.<span class=\"property\">height</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        el.<span class=\"property\">__position__</span>.<span class=\"property\">y</span> = y;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\">// 渲染到真实dom属性上</span></span><br><span class=\"line\">      el.<span class=\"property\">style</span>.<span class=\"property\">cssText</span> += <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">        position: absolute;</span></span><br><span class=\"line\"><span class=\"string\">        z-index: 100;</span></span><br><span class=\"line\"><span class=\"string\">        left: <span class=\"subst\">$&#123;el.__position__.x&#125;</span>px;</span></span><br><span class=\"line\"><span class=\"string\">        top: <span class=\"subst\">$&#123;el.__position__.y&#125;</span>px;</span></span><br><span class=\"line\"><span class=\"string\">      `</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    el.<span class=\"property\">__mouseDown__</span> = handleMouseDown;</span><br><span class=\"line\">    el.<span class=\"property\">__mouseMove__</span> = handleMouseMove;</span><br><span class=\"line\">    el.<span class=\"property\">__mouseUp__</span> = handleMouseUp;</span><br><span class=\"line\">    <span class=\"comment\">// 2. 监听拖拽事件</span></span><br><span class=\"line\">    el.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, el.<span class=\"property\">__mouseDown__</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, el.<span class=\"property\">__mouseMove__</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mouseup&#x27;</span>, el.<span class=\"property\">__mouseUp__</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title function_\">updated</span>(<span class=\"params\">el, binding</span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">setParentDom</span>(el, binding, <span class=\"literal\">true</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title function_\">beforeUnmount</span>(<span class=\"params\">el: ElType</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 避免重复开销，卸载所有的监听</span></span><br><span class=\"line\">    <span class=\"comment\">// 解决问题：多次创建新的实例 =》 监听不取消 =》 同时存在多个无用的监听，导致页面性能变差</span></span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, el.<span class=\"property\">__mouseDown__</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, el.<span class=\"property\">__mouseMove__</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mouseup&#x27;</span>, el.<span class=\"property\">__mouseUp__</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">// 设置parentDom，供mounted和update使用</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setParentDom</span>(<span class=\"params\">el: ElType, binding: DirectiveBinding, updated: <span class=\"built_in\">boolean</span></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> array = [&#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;father&#x27;</span>, <span class=\"attr\">dom</span>: el.<span class=\"property\">parentElement</span> &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 获取父级元素</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"attr\">parentDom</span>: <span class=\"title class_\">HTMLElement</span> | <span class=\"title class_\">HTMLBodyElement</span>;</span><br><span class=\"line\">  <span class=\"comment\">// 以下if操作用于确保一定有一个parentDom</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (binding.<span class=\"property\">value</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> findArr = array.<span class=\"title function_\">find</span>(<span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> arr.<span class=\"property\">name</span> === binding.<span class=\"property\">value</span>;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (findArr &amp;&amp; findArr.<span class=\"property\">dom</span>) &#123;</span><br><span class=\"line\">      parentDom = findArr.<span class=\"property\">dom</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      parentDom =</span><br><span class=\"line\">        <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(binding.<span class=\"property\">value</span>) || (array[<span class=\"number\">0</span>].<span class=\"property\">dom</span> <span class=\"keyword\">as</span> <span class=\"title class_\">HTMLElement</span>) || array[<span class=\"number\">1</span>].<span class=\"property\">dom</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    parentDom = (array[<span class=\"number\">0</span>].<span class=\"property\">dom</span> <span class=\"keyword\">as</span> <span class=\"title class_\">HTMLElement</span>) || array[<span class=\"number\">1</span>].<span class=\"property\">dom</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> parentDomRect = parentDom.<span class=\"title function_\">getBoundingClientRect</span>();</span><br><span class=\"line\">  <span class=\"keyword\">const</span> elDomRect = el.<span class=\"title function_\">getBoundingClientRect</span>();</span><br><span class=\"line\">  <span class=\"comment\">// 把以前的样式重置一下</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (el.<span class=\"property\">__parentDom__</span>) &#123;</span><br><span class=\"line\">    el.<span class=\"property\">__parentDom__</span>.<span class=\"property\">style</span>.<span class=\"property\">position</span> = <span class=\"string\">&#x27;static&#x27;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  el.<span class=\"property\">__parentDom__</span> = parentDom;</span><br><span class=\"line\">  el.<span class=\"property\">__parentDom__</span>.<span class=\"property\">style</span>.<span class=\"property\">position</span> = <span class=\"string\">&#x27;relative&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (updated) &#123;</span><br><span class=\"line\">    el.<span class=\"property\">__position__</span> = &#123;</span><br><span class=\"line\">      <span class=\"attr\">x</span>: elDomRect.<span class=\"property\">x</span> - parentDomRect.<span class=\"property\">x</span>,</span><br><span class=\"line\">      <span class=\"attr\">y</span>: elDomRect.<span class=\"property\">y</span> - parentDomRect.<span class=\"property\">y</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// return</span></span><br><span class=\"line\">    el.<span class=\"property\">style</span>.<span class=\"property\">cssText</span> += <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">      position: absolute;</span></span><br><span class=\"line\"><span class=\"string\">      z-index: 100;</span></span><br><span class=\"line\"><span class=\"string\">      left: <span class=\"subst\">$&#123;el.__position__.x&#125;</span>px;</span></span><br><span class=\"line\"><span class=\"string\">      top: <span class=\"subst\">$&#123;el.__position__.y&#125;</span>px;</span></span><br><span class=\"line\"><span class=\"string\">    `</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> directive;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"6-长按指令，长按时触发事件\"><a href=\"#6-长按指令，长按时触发事件\" class=\"headerlink\" title=\"6. 长按指令，长按时触发事件\"></a>6. 长按指令，长按时触发事件</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * v-longpress</span></span><br><span class=\"line\"><span class=\"comment\"> * 长按指令，长按时触发事件</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; <span class=\"title class_\">Directive</span>, <span class=\"title class_\">DirectiveBinding</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">directive</span>: <span class=\"title class_\">Directive</span> = &#123;</span><br><span class=\"line\">  <span class=\"title function_\">mounted</span>(<span class=\"params\">el: HTMLElement, binding: DirectiveBinding</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> binding.<span class=\"property\">value</span> !== <span class=\"string\">&#x27;function&#x27;</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"string\">&#x27;callback must be a function&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 定义变量</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"attr\">pressTimer</span>: <span class=\"built_in\">any</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 创建计时器（ 2秒后执行函数 ）</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"title function_\">start</span> = (<span class=\"params\">e: MouseEvent | TouchEvent</span>) =&gt; &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (e.<span class=\"property\">button</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (e.<span class=\"property\">type</span> === <span class=\"string\">&#x27;click&#x27;</span> &amp;&amp; e.<span class=\"property\">button</span> !== <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (pressTimer === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        pressTimer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"title function_\">handler</span>(e);</span><br><span class=\"line\">        &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// 取消计时器</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"title function_\">cancel</span> = (<span class=\"params\">e</span>) =&gt; &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (pressTimer !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">clearTimeout</span>(pressTimer);</span><br><span class=\"line\">        pressTimer = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// 运行函数</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"title function_\">handler</span> = (<span class=\"params\">e: MouseEvent | TouchEvent</span>) =&gt; &#123;</span><br><span class=\"line\">      binding.<span class=\"title function_\">value</span>(e);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// 添加事件监听器</span></span><br><span class=\"line\">    el.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, start);</span><br><span class=\"line\">    el.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;touchstart&#x27;</span>, start);</span><br><span class=\"line\">    <span class=\"comment\">// 取消计时器</span></span><br><span class=\"line\">    el.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, cancel);</span><br><span class=\"line\">    el.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mouseout&#x27;</span>, cancel);</span><br><span class=\"line\">    el.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;touchend&#x27;</span>, cancel);</span><br><span class=\"line\">    el.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;touchcancel&#x27;</span>, cancel);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> directive;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"7-设置水印效果\"><a href=\"#7-设置水印效果\" class=\"headerlink\" title=\"7. 设置水印效果\"></a>7. 设置水印效果</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * v-waterMarker可接收参数，均为非必填</span></span><br><span class=\"line\"><span class=\"comment\"> * &#123; text: &#x27;vue-admin-box&#x27;, font: &#x27;16px Microsoft JhengHei&#x27;, textColor: &#x27;#000&#x27; &#125;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Color</span>, <span class=\"title class_\">FontFamilyProperty</span>, <span class=\"title class_\">FontProperty</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;csstype&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; <span class=\"title class_\">Directive</span>, <span class=\"title class_\">DirectiveBinding</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">directive</span>: <span class=\"title class_\">Directive</span> = &#123;</span><br><span class=\"line\">  <span class=\"title function_\">mounted</span>(<span class=\"params\">el: HTMLElement, binding: DirectiveBinding</span>) &#123;</span><br><span class=\"line\">    binding.<span class=\"property\">value</span> ? binding.<span class=\"property\">value</span> : (binding.<span class=\"property\">value</span> = &#123;&#125;);</span><br><span class=\"line\">    <span class=\"title function_\">addWaterMarker</span>(binding.<span class=\"property\">value</span>.<span class=\"property\">text</span>, el, binding.<span class=\"property\">value</span>.<span class=\"property\">font</span>, binding.<span class=\"property\">value</span>.<span class=\"property\">textColor</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">addWaterMarker</span>(<span class=\"params\"></span></span><br><span class=\"line\"><span class=\"params\">  str: <span class=\"built_in\">string</span>,</span></span><br><span class=\"line\"><span class=\"params\">  parentNode: HTMLElement,</span></span><br><span class=\"line\"><span class=\"params\">  font: FontProperty,</span></span><br><span class=\"line\"><span class=\"params\">  textColor: Color</span></span><br><span class=\"line\"><span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 水印文字，父元素，字体，文字颜色</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> can = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;canvas&#x27;</span>) <span class=\"keyword\">as</span> <span class=\"title class_\">HTMLCanvasElement</span>;</span><br><span class=\"line\">  parentNode.<span class=\"title function_\">appendChild</span>(can);</span><br><span class=\"line\">  can.<span class=\"property\">width</span> = <span class=\"number\">300</span>;</span><br><span class=\"line\">  can.<span class=\"property\">height</span> = <span class=\"number\">225</span>;</span><br><span class=\"line\">  can.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&#x27;none&#x27;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> cans = can.<span class=\"title function_\">getContext</span>(<span class=\"string\">&#x27;2d&#x27;</span>) <span class=\"keyword\">as</span> <span class=\"title class_\">CanvasRenderingContext2D</span>;</span><br><span class=\"line\">  cans.<span class=\"title function_\">rotate</span>((-<span class=\"number\">20</span> * <span class=\"title class_\">Math</span>.<span class=\"property\">PI</span>) / <span class=\"number\">180</span>);</span><br><span class=\"line\">  cans.<span class=\"property\">font</span> = font || <span class=\"string\">&#x27;16px Microsoft JhengHei&#x27;</span>;</span><br><span class=\"line\">  cans.<span class=\"property\">fillStyle</span> = textColor || <span class=\"string\">&#x27;rgba(180, 180, 180, 0.3)&#x27;</span>;</span><br><span class=\"line\">  cans.<span class=\"property\">textAlign</span> = <span class=\"string\">&#x27;left&#x27;</span>;</span><br><span class=\"line\">  cans.<span class=\"property\">textBaseline</span> = <span class=\"string\">&#x27;middle&#x27;</span>;</span><br><span class=\"line\">  cans.<span class=\"title function_\">fillText</span>(str || <span class=\"string\">&#x27;vue-admin-box&#x27;</span>, can.<span class=\"property\">width</span> / <span class=\"number\">10</span>, can.<span class=\"property\">height</span> / <span class=\"number\">2</span>);</span><br><span class=\"line\">  parentNode.<span class=\"property\">style</span>.<span class=\"property\">backgroundImage</span> = <span class=\"string\">&#x27;url(&#x27;</span> + can.<span class=\"title function_\">toDataURL</span>(<span class=\"string\">&#x27;image/png&#x27;</span>) + <span class=\"string\">&#x27;)&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> directive;</span><br></pre></td></tr></table></figure>\n\n<hr>\n","site":{"data":{}},"excerpt":"<p>常用的几个Vue自定义指令收集，持续更新…</p>","more":"<h3 id=\"1-点击元素外部事件\"><a href=\"#1-点击元素外部事件\" class=\"headerlink\" title=\"1. 点击元素外部事件\"></a>1. 点击元素外部事件</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * v-clickOutside</span></span><br><span class=\"line\"><span class=\"comment\"> * 点击元素外部事件</span></span><br><span class=\"line\"><span class=\"comment\"> * 接收参数：function类型，点击外面时返回true,点击内部时返回false</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; <span class=\"title class_\">Directive</span>, <span class=\"title class_\">DirectiveBinding</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">ElType</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">HTMLElement</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">__handleClick__</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">directive</span>: <span class=\"title class_\">Directive</span> = &#123;</span><br><span class=\"line\">  <span class=\"title function_\">mounted</span>(<span class=\"params\">el: ElType, binding: DirectiveBinding</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> binding.<span class=\"property\">value</span> !== <span class=\"string\">&#x27;function&#x27;</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"string\">&#x27;callback must be a function&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    el.<span class=\"property\">__handleClick__</span> = <span class=\"keyword\">function</span> (<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (el.<span class=\"title function_\">contains</span>(e.<span class=\"property\">target</span>)) &#123;</span><br><span class=\"line\">        binding.<span class=\"title function_\">value</span>(<span class=\"literal\">false</span>);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        binding.<span class=\"title function_\">value</span>(<span class=\"literal\">true</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, el.<span class=\"property\">__handleClick__</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title function_\">beforeUnmount</span>(<span class=\"params\">el: ElType</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, el.<span class=\"property\">__handleClick__</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> directive;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2-复制某个值至剪贴板\"><a href=\"#2-复制某个值至剪贴板\" class=\"headerlink\" title=\"2. 复制某个值至剪贴板\"></a>2. 复制某个值至剪贴板</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * v-copy</span></span><br><span class=\"line\"><span class=\"comment\"> * 复制某个值至剪贴板</span></span><br><span class=\"line\"><span class=\"comment\"> * 接收参数：string类型/Ref&lt;string&gt;类型/Reactive&lt;string&gt;类型</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; <span class=\"title class_\">Directive</span>, <span class=\"title class_\">DirectiveBinding</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">ElMessage</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;element-plus&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">ElType</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">HTMLElement</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">copyData</span>: <span class=\"built_in\">string</span> | <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  <span class=\"attr\">__handleClick__</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">directive</span>: <span class=\"title class_\">Directive</span> = &#123;</span><br><span class=\"line\">  <span class=\"title function_\">mounted</span>(<span class=\"params\">el: ElType, binding: DirectiveBinding</span>) &#123;</span><br><span class=\"line\">    el.<span class=\"property\">copyData</span> = binding.<span class=\"property\">value</span>;</span><br><span class=\"line\">    el.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, handleClick);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title function_\">updated</span>(<span class=\"params\">el: ElType, binding: DirectiveBinding</span>) &#123;</span><br><span class=\"line\">    el.<span class=\"property\">copyData</span> = binding.<span class=\"property\">value</span>;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title function_\">beforeUnmount</span>(<span class=\"params\">el: ElType</span>) &#123;</span><br><span class=\"line\">    el.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, el.<span class=\"property\">__handleClick__</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">handleClick</span>(<span class=\"params\"><span class=\"variable language_\">this</span>: ElType, ev: MouseEvent</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> input = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;input&#x27;</span>);</span><br><span class=\"line\">  input.<span class=\"property\">value</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">copyData</span>.<span class=\"title function_\">toLocaleString</span>();</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">appendChild</span>(input);</span><br><span class=\"line\">  input.<span class=\"title function_\">select</span>();</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"title function_\">execCommand</span>(<span class=\"string\">&#x27;Copy&#x27;</span>);</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">removeChild</span>(input);</span><br><span class=\"line\">  <span class=\"title class_\">ElMessage</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"string\">&#x27;success&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">message</span>: <span class=\"string\">&#x27;复制成功&#x27;</span>,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> directive;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"3-按钮防抖指令-可扩展至input\"><a href=\"#3-按钮防抖指令-可扩展至input\" class=\"headerlink\" title=\"3. 按钮防抖指令,可扩展至input\"></a>3. 按钮防抖指令,可扩展至input</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * v-debounce</span></span><br><span class=\"line\"><span class=\"comment\"> * 按钮防抖指令，可自行扩展至input</span></span><br><span class=\"line\"><span class=\"comment\"> * 接收参数：function类型</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; <span class=\"title class_\">Directive</span>, <span class=\"title class_\">DirectiveBinding</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">ElType</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">HTMLElement</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">__handleClick__</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">directive</span>: <span class=\"title class_\">Directive</span> = &#123;</span><br><span class=\"line\">  <span class=\"title function_\">mounted</span>(<span class=\"params\">el: ElType, binding: DirectiveBinding</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> binding.<span class=\"property\">value</span> !== <span class=\"string\">&#x27;function&#x27;</span>) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;callback must be a function&#x27;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"attr\">timer</span>: <span class=\"title class_\">NodeJS</span>.<span class=\"property\">Timeout</span> | <span class=\"literal\">null</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    el.<span class=\"property\">__handleClick__</span> = <span class=\"keyword\">function</span> (<span class=\"params\">e: ElType</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (timer) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">clearInterval</span>(timer);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        binding.<span class=\"title function_\">value</span>();</span><br><span class=\"line\">      &#125;, <span class=\"number\">200</span>);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    el.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, el.<span class=\"property\">__handleClick__</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title function_\">beforeUnmount</span>(<span class=\"params\">el: ElType</span>) &#123;</span><br><span class=\"line\">    el.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, el.<span class=\"property\">__handleClick__</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> directive;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"4-窗口拖拽\"><a href=\"#4-窗口拖拽\" class=\"headerlink\" title=\"4. 窗口拖拽\"></a>4. 窗口拖拽</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 可基于窗口各种拖拽使用</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; <span class=\"title class_\">Directive</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">ElType</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">HTMLDivElement</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">__mouseDown__</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">  <span class=\"attr\">__mouseUp__</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">  <span class=\"attr\">__mouseMove__</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">  <span class=\"attr\">__sizeChange__</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">DataDialog</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">x</span>: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  <span class=\"attr\">y</span>: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  <span class=\"attr\">width</span>: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  <span class=\"attr\">height</span>: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  marginTop?: <span class=\"built_in\">string</span> | <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  top?: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  bottom?: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  left?: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  right?: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">drag</span>: <span class=\"title class_\">Directive</span> = &#123;</span><br><span class=\"line\">  <span class=\"title function_\">mounted</span>(<span class=\"params\">el: ElType, binding</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (binding.<span class=\"property\">value</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">handleElShow</span>(el);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title function_\">updated</span>(<span class=\"params\">el, binding</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (binding.<span class=\"property\">value</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">handleElShow</span>(el);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"title function_\">handleElHide</span>(el);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title function_\">beforeUnmount</span>(<span class=\"params\">el: ElType</span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">handleElHide</span>(el);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">handleElShow</span>(<span class=\"params\">el: ElType</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> dialog = el.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;.el-dialog&#x27;</span>) <span class=\"keyword\">as</span> <span class=\"title class_\">HTMLElement</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!dialog) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> header = el.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;.el-dialog__header&#x27;</span>) <span class=\"keyword\">as</span> <span class=\"title class_\">HTMLElement</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> dialogMask = el.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;.el-overlay&#x27;</span>) <span class=\"keyword\">as</span> <span class=\"title class_\">HTMLElement</span>;</span><br><span class=\"line\">  dialogMask.<span class=\"property\">style</span>.<span class=\"property\">cssText</span> += <span class=\"string\">&#x27;overflow: hidden;&#x27;</span>;</span><br><span class=\"line\">  header.<span class=\"property\">style</span>.<span class=\"property\">cursor</span> = <span class=\"string\">&#x27;move&#x27;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> dragStatus = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> data = &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 数据源，不变部分为：window信息、dialog信息、mouse初始值信息，可变部分为：拖拽坐标位移</span></span><br><span class=\"line\">    <span class=\"attr\">window</span>: &#123;</span><br><span class=\"line\">      <span class=\"comment\">// window信息</span></span><br><span class=\"line\">      <span class=\"attr\">width</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">height</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">dialog</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">x</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">y</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">width</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">height</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">marginTop</span>: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    &#125; <span class=\"keyword\">as</span> <span class=\"title class_\">DataDialog</span>, <span class=\"comment\">// dialog信息</span></span><br><span class=\"line\">    <span class=\"attr\">mouse</span>: &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 鼠标初始信息</span></span><br><span class=\"line\">      <span class=\"attr\">x</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">y</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">drag</span>: &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 拖拽过程信息</span></span><br><span class=\"line\">      <span class=\"attr\">x</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">y</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"comment\">// 所有的监听只为了修改data数据</span></span><br><span class=\"line\">  header.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, mouseDown);</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, mouseMove);</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mouseup&#x27;</span>, mouseUp);</span><br><span class=\"line\">  <span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;resize&#x27;</span>, sizeChange);</span><br><span class=\"line\">  <span class=\"comment\">// 边界处理，防止拖动位置溢出</span></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">handlePosition</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (data.<span class=\"property\">mouse</span>.<span class=\"property\">x</span> - data.<span class=\"property\">drag</span>.<span class=\"property\">x</span> &gt;= data.<span class=\"property\">dialog</span>.<span class=\"property\">x</span>) &#123;</span><br><span class=\"line\">      data.<span class=\"property\">drag</span>.<span class=\"property\">x</span> = data.<span class=\"property\">mouse</span>.<span class=\"property\">x</span> - data.<span class=\"property\">dialog</span>.<span class=\"property\">x</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (data.<span class=\"property\">drag</span>.<span class=\"property\">x</span> - data.<span class=\"property\">mouse</span>.<span class=\"property\">x</span> &gt;= data.<span class=\"property\">window</span>.<span class=\"property\">width</span> - (data.<span class=\"property\">dialog</span>.<span class=\"property\">x</span> + data.<span class=\"property\">dialog</span>.<span class=\"property\">width</span>)) &#123;</span><br><span class=\"line\">      data.<span class=\"property\">drag</span>.<span class=\"property\">x</span> = data.<span class=\"property\">mouse</span>.<span class=\"property\">x</span> + data.<span class=\"property\">window</span>.<span class=\"property\">width</span> - data.<span class=\"property\">dialog</span>.<span class=\"property\">x</span> - data.<span class=\"property\">dialog</span>.<span class=\"property\">width</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (data.<span class=\"property\">mouse</span>.<span class=\"property\">y</span> - data.<span class=\"property\">drag</span>.<span class=\"property\">y</span> &gt;= data.<span class=\"property\">dialog</span>.<span class=\"property\">y</span>) &#123;</span><br><span class=\"line\">      data.<span class=\"property\">drag</span>.<span class=\"property\">y</span> = data.<span class=\"property\">mouse</span>.<span class=\"property\">y</span> - data.<span class=\"property\">dialog</span>.<span class=\"property\">y</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (data.<span class=\"property\">drag</span>.<span class=\"property\">y</span> - data.<span class=\"property\">mouse</span>.<span class=\"property\">y</span> &gt;= data.<span class=\"property\">window</span>.<span class=\"property\">height</span> - (data.<span class=\"property\">dialog</span>.<span class=\"property\">y</span> + data.<span class=\"property\">dialog</span>.<span class=\"property\">height</span>)) &#123;</span><br><span class=\"line\">      data.<span class=\"property\">drag</span>.<span class=\"property\">y</span> = data.<span class=\"property\">mouse</span>.<span class=\"property\">y</span> + data.<span class=\"property\">window</span>.<span class=\"property\">height</span> - data.<span class=\"property\">dialog</span>.<span class=\"property\">y</span> - data.<span class=\"property\">dialog</span>.<span class=\"property\">height</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">setPosition</span>();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 根据data来设置拖动后的位置</span></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">setPosition</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> top = data.<span class=\"property\">drag</span>.<span class=\"property\">y</span> - data.<span class=\"property\">mouse</span>.<span class=\"property\">y</span> + data.<span class=\"property\">dialog</span>.<span class=\"property\">y</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> left = data.<span class=\"property\">drag</span>.<span class=\"property\">x</span> - data.<span class=\"property\">mouse</span>.<span class=\"property\">x</span> + data.<span class=\"property\">dialog</span>.<span class=\"property\">x</span>;</span><br><span class=\"line\">    dialog.<span class=\"property\">style</span>.<span class=\"property\">cssText</span> += <span class=\"string\">`position: absolute; top: calc(<span class=\"subst\">$&#123;top&#125;</span>px - <span class=\"subst\">$&#123;data.dialog.marginTop&#125;</span>); left: <span class=\"subst\">$&#123;left&#125;</span>px;`</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">mouseDown</span>(<span class=\"params\">e: <span class=\"built_in\">any</span></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 获取dialog目前的位置，坐标, 以及屏幕当前的宽高</span></span><br><span class=\"line\">    <span class=\"comment\">// 一切初始数据的获取应该放置于此，避免其他如：宽度修改等一系列的影响</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (e.<span class=\"property\">button</span> !== <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    data.<span class=\"property\">window</span> = &#123;</span><br><span class=\"line\">      <span class=\"attr\">width</span>: <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">clientWidth</span>,</span><br><span class=\"line\">      <span class=\"attr\">height</span>: <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">clientHeight</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    data.<span class=\"property\">dialog</span> = dialog.<span class=\"title function_\">getBoundingClientRect</span>();</span><br><span class=\"line\">    data.<span class=\"property\">dialog</span>.<span class=\"property\">marginTop</span> = <span class=\"variable language_\">window</span>.<span class=\"title function_\">getComputedStyle</span>(dialog).<span class=\"property\">marginTop</span>;</span><br><span class=\"line\">    data.<span class=\"property\">mouse</span> = &#123;</span><br><span class=\"line\">      <span class=\"attr\">x</span>: e.<span class=\"property\">clientX</span>,</span><br><span class=\"line\">      <span class=\"attr\">y</span>: e.<span class=\"property\">clientY</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    dragStatus = <span class=\"literal\">true</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">mouseMove</span>(<span class=\"params\">e: <span class=\"built_in\">any</span></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (dragStatus) &#123;</span><br><span class=\"line\">      data.<span class=\"property\">drag</span> = &#123;</span><br><span class=\"line\">        <span class=\"attr\">x</span>: e.<span class=\"property\">clientX</span>,</span><br><span class=\"line\">        <span class=\"attr\">y</span>: e.<span class=\"property\">clientY</span>,</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">      dialogMask.<span class=\"property\">style</span>.<span class=\"property\">userSelect</span> = <span class=\"string\">&#x27;none&#x27;</span>;</span><br><span class=\"line\">      <span class=\"title function_\">handlePosition</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">mouseUp</span>(<span class=\"params\">e: <span class=\"built_in\">any</span></span>) &#123;</span><br><span class=\"line\">    dialogMask.<span class=\"property\">style</span>.<span class=\"property\">userSelect</span> = <span class=\"string\">&#x27;auto&#x27;</span>;</span><br><span class=\"line\">    dragStatus = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">sizeChange</span>(<span class=\"params\">e: <span class=\"built_in\">any</span></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// dialog.style.cssText += &#x27;position: static&#x27;;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 方便卸载使用</span></span><br><span class=\"line\">  el.<span class=\"property\">__mouseDown__</span> = mouseDown;</span><br><span class=\"line\">  el.<span class=\"property\">__mouseUp__</span> = mouseUp;</span><br><span class=\"line\">  el.<span class=\"property\">__mouseMove__</span> = mouseMove;</span><br><span class=\"line\">  el.<span class=\"property\">__sizeChange__</span> = sizeChange;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">handleElHide</span>(<span class=\"params\">el: ElType</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 避免重复开销，卸载所有的监听</span></span><br><span class=\"line\">  <span class=\"comment\">// 解决问题：多次创建新的实例 =》 监听不取消 =》 同时存在多个无用的监听，导致页面卡顿</span></span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, el.<span class=\"property\">__mouseDown__</span>);</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, el.<span class=\"property\">__mouseMove__</span>);</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mouseup&#x27;</span>, el.<span class=\"property\">__mouseUp__</span>);</span><br><span class=\"line\">  <span class=\"variable language_\">window</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;resize&#x27;</span>, el.<span class=\"property\">__sizeChange__</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> drag;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"5-窗口拖拽2，可自定义父级\"><a href=\"#5-窗口拖拽2，可自定义父级\" class=\"headerlink\" title=\"5. 窗口拖拽2，可自定义父级\"></a>5. 窗口拖拽2，可自定义父级</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 支持父级，自定义父级，以及window作为父级</span></span><br><span class=\"line\"><span class=\"comment\"> * 使用示例：</span></span><br><span class=\"line\"><span class=\"comment\"> * 1. v-dragable</span></span><br><span class=\"line\"><span class=\"comment\"> * 2. v-dragable=&quot;&#x27;father&#x27;&quot; // 使用父级作为父级</span></span><br><span class=\"line\"><span class=\"comment\"> * 3. v-dragable=&quot;&#x27;body&#x27;&quot; // 使用body对象作为父级</span></span><br><span class=\"line\"><span class=\"comment\"> * 4. v-dragable=&quot;&#x27;#app&#x27;&quot; // 使用id作为父级</span></span><br><span class=\"line\"><span class=\"comment\"> * 5. v-dragable=&quot;&#x27;.list&#x27;&quot; // 使用class名作为父级</span></span><br><span class=\"line\"><span class=\"comment\"> * 3-5代表所有可被document.querySelector()解析的参数值</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; <span class=\"title class_\">Directive</span>, <span class=\"title class_\">DirectiveBinding</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Position</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">x</span>: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  <span class=\"attr\">y</span>: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Mouse</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">down</span>: <span class=\"title class_\">Position</span>;</span><br><span class=\"line\">  <span class=\"attr\">move</span>: <span class=\"title class_\">Position</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">ElType</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">HTMLElement</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">__mouseDown__</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">  <span class=\"attr\">__mouseUp__</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">  <span class=\"attr\">__mouseMove__</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">  <span class=\"attr\">__parentDom__</span>: <span class=\"title class_\">HTMLElement</span>;</span><br><span class=\"line\">  <span class=\"attr\">__position__</span>: <span class=\"title class_\">Position</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">directive</span>: <span class=\"title class_\">Directive</span> = &#123;</span><br><span class=\"line\">  <span class=\"attr\">mounted</span>: <span class=\"function\">(<span class=\"params\">el: ElType, binding: DirectiveBinding</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">setParentDom</span>(el, binding, <span class=\"literal\">false</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 子级元素位置处理</span></span><br><span class=\"line\">    <span class=\"comment\">// 1. 获取父子元素当前位置</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"attr\">parentDomRect</span>: <span class=\"title class_\">DOMRect</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"attr\">elDomRect</span>: <span class=\"title class_\">DOMRect</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"attr\">mouseData</span>: <span class=\"title class_\">Mouse</span> = &#123;</span><br><span class=\"line\">      <span class=\"attr\">down</span>: &#123; <span class=\"attr\">x</span>: <span class=\"number\">0</span>, <span class=\"attr\">y</span>: <span class=\"number\">0</span> &#125;,</span><br><span class=\"line\">      <span class=\"attr\">move</span>: &#123; <span class=\"attr\">x</span>: <span class=\"number\">0</span>, <span class=\"attr\">y</span>: <span class=\"number\">0</span> &#125;,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"attr\">mouseDown</span>: <span class=\"built_in\">boolean</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    el.<span class=\"property\">__position__</span> = &#123;</span><br><span class=\"line\">      <span class=\"attr\">x</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">y</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"attr\">bodyUserSelect</span>: <span class=\"built_in\">string</span> = <span class=\"string\">&#x27;text&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">function</span> <span class=\"title function_\">handleMouseDown</span>(<span class=\"params\">e: MouseEvent</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (e.<span class=\"property\">button</span> !== <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      mouseData.<span class=\"property\">down</span> = &#123;</span><br><span class=\"line\">        <span class=\"attr\">x</span>: e.<span class=\"property\">clientX</span>,</span><br><span class=\"line\">        <span class=\"attr\">y</span>: e.<span class=\"property\">clientY</span>,</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">      mouseDown = <span class=\"literal\">true</span>;</span><br><span class=\"line\">      parentDomRect = el.<span class=\"property\">__parentDom__</span>.<span class=\"title function_\">getBoundingClientRect</span>();</span><br><span class=\"line\">      elDomRect = el.<span class=\"title function_\">getBoundingClientRect</span>();</span><br><span class=\"line\">      bodyUserSelect = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;body&#x27;</span>)!.<span class=\"property\">style</span>.<span class=\"property\">userSelect</span>;</span><br><span class=\"line\">      <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;body&#x27;</span>)!.<span class=\"property\">style</span>.<span class=\"property\">userSelect</span> = <span class=\"string\">&#x27;none&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">function</span> <span class=\"title function_\">handleMouseMove</span>(<span class=\"params\">e: MouseEvent</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!mouseDown) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      mouseData.<span class=\"property\">move</span> = &#123;</span><br><span class=\"line\">        <span class=\"attr\">x</span>: e.<span class=\"property\">clientX</span>,</span><br><span class=\"line\">        <span class=\"attr\">y</span>: e.<span class=\"property\">clientY</span>,</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">      <span class=\"title function_\">setPosition</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">function</span> <span class=\"title function_\">handleMouseUp</span>(<span class=\"params\">e: MouseEvent</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (mouseDown) &#123;</span><br><span class=\"line\">        mouseDown = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;body&#x27;</span>)!.<span class=\"property\">style</span>.<span class=\"property\">userSelect</span> = bodyUserSelect;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 用于设置el元素的Position位置</span></span><br><span class=\"line\">    <span class=\"keyword\">function</span> <span class=\"title function_\">setPosition</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 通过几何图形计算更佳，我就是通过几何画图计算出来的当前数据，使用者可以自行计算，得到这两个值</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> x = mouseData.<span class=\"property\">move</span>.<span class=\"property\">x</span> + elDomRect.<span class=\"property\">x</span> - parentDomRect.<span class=\"property\">x</span> - mouseData.<span class=\"property\">down</span>.<span class=\"property\">x</span>;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> y = mouseData.<span class=\"property\">move</span>.<span class=\"property\">y</span> + elDomRect.<span class=\"property\">y</span> - parentDomRect.<span class=\"property\">y</span> - mouseData.<span class=\"property\">down</span>.<span class=\"property\">y</span>;</span><br><span class=\"line\">      <span class=\"comment\">// 进行x,y坐标边界处理判断</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (x &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        el.<span class=\"property\">__position__</span>.<span class=\"property\">x</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (x &gt; parentDomRect.<span class=\"property\">width</span> - elDomRect.<span class=\"property\">width</span>) &#123;</span><br><span class=\"line\">        el.<span class=\"property\">__position__</span>.<span class=\"property\">x</span> = parentDomRect.<span class=\"property\">width</span> - elDomRect.<span class=\"property\">width</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        el.<span class=\"property\">__position__</span>.<span class=\"property\">x</span> = x;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (y &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        el.<span class=\"property\">__position__</span>.<span class=\"property\">y</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (y &gt; parentDomRect.<span class=\"property\">height</span> - elDomRect.<span class=\"property\">height</span>) &#123;</span><br><span class=\"line\">        el.<span class=\"property\">__position__</span>.<span class=\"property\">y</span> = parentDomRect.<span class=\"property\">height</span> - elDomRect.<span class=\"property\">height</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        el.<span class=\"property\">__position__</span>.<span class=\"property\">y</span> = y;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\">// 渲染到真实dom属性上</span></span><br><span class=\"line\">      el.<span class=\"property\">style</span>.<span class=\"property\">cssText</span> += <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">        position: absolute;</span></span><br><span class=\"line\"><span class=\"string\">        z-index: 100;</span></span><br><span class=\"line\"><span class=\"string\">        left: <span class=\"subst\">$&#123;el.__position__.x&#125;</span>px;</span></span><br><span class=\"line\"><span class=\"string\">        top: <span class=\"subst\">$&#123;el.__position__.y&#125;</span>px;</span></span><br><span class=\"line\"><span class=\"string\">      `</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    el.<span class=\"property\">__mouseDown__</span> = handleMouseDown;</span><br><span class=\"line\">    el.<span class=\"property\">__mouseMove__</span> = handleMouseMove;</span><br><span class=\"line\">    el.<span class=\"property\">__mouseUp__</span> = handleMouseUp;</span><br><span class=\"line\">    <span class=\"comment\">// 2. 监听拖拽事件</span></span><br><span class=\"line\">    el.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, el.<span class=\"property\">__mouseDown__</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, el.<span class=\"property\">__mouseMove__</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mouseup&#x27;</span>, el.<span class=\"property\">__mouseUp__</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title function_\">updated</span>(<span class=\"params\">el, binding</span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">setParentDom</span>(el, binding, <span class=\"literal\">true</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title function_\">beforeUnmount</span>(<span class=\"params\">el: ElType</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 避免重复开销，卸载所有的监听</span></span><br><span class=\"line\">    <span class=\"comment\">// 解决问题：多次创建新的实例 =》 监听不取消 =》 同时存在多个无用的监听，导致页面性能变差</span></span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, el.<span class=\"property\">__mouseDown__</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, el.<span class=\"property\">__mouseMove__</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mouseup&#x27;</span>, el.<span class=\"property\">__mouseUp__</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">// 设置parentDom，供mounted和update使用</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setParentDom</span>(<span class=\"params\">el: ElType, binding: DirectiveBinding, updated: <span class=\"built_in\">boolean</span></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> array = [&#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;father&#x27;</span>, <span class=\"attr\">dom</span>: el.<span class=\"property\">parentElement</span> &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 获取父级元素</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"attr\">parentDom</span>: <span class=\"title class_\">HTMLElement</span> | <span class=\"title class_\">HTMLBodyElement</span>;</span><br><span class=\"line\">  <span class=\"comment\">// 以下if操作用于确保一定有一个parentDom</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (binding.<span class=\"property\">value</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> findArr = array.<span class=\"title function_\">find</span>(<span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> arr.<span class=\"property\">name</span> === binding.<span class=\"property\">value</span>;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (findArr &amp;&amp; findArr.<span class=\"property\">dom</span>) &#123;</span><br><span class=\"line\">      parentDom = findArr.<span class=\"property\">dom</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      parentDom =</span><br><span class=\"line\">        <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(binding.<span class=\"property\">value</span>) || (array[<span class=\"number\">0</span>].<span class=\"property\">dom</span> <span class=\"keyword\">as</span> <span class=\"title class_\">HTMLElement</span>) || array[<span class=\"number\">1</span>].<span class=\"property\">dom</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    parentDom = (array[<span class=\"number\">0</span>].<span class=\"property\">dom</span> <span class=\"keyword\">as</span> <span class=\"title class_\">HTMLElement</span>) || array[<span class=\"number\">1</span>].<span class=\"property\">dom</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> parentDomRect = parentDom.<span class=\"title function_\">getBoundingClientRect</span>();</span><br><span class=\"line\">  <span class=\"keyword\">const</span> elDomRect = el.<span class=\"title function_\">getBoundingClientRect</span>();</span><br><span class=\"line\">  <span class=\"comment\">// 把以前的样式重置一下</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (el.<span class=\"property\">__parentDom__</span>) &#123;</span><br><span class=\"line\">    el.<span class=\"property\">__parentDom__</span>.<span class=\"property\">style</span>.<span class=\"property\">position</span> = <span class=\"string\">&#x27;static&#x27;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  el.<span class=\"property\">__parentDom__</span> = parentDom;</span><br><span class=\"line\">  el.<span class=\"property\">__parentDom__</span>.<span class=\"property\">style</span>.<span class=\"property\">position</span> = <span class=\"string\">&#x27;relative&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (updated) &#123;</span><br><span class=\"line\">    el.<span class=\"property\">__position__</span> = &#123;</span><br><span class=\"line\">      <span class=\"attr\">x</span>: elDomRect.<span class=\"property\">x</span> - parentDomRect.<span class=\"property\">x</span>,</span><br><span class=\"line\">      <span class=\"attr\">y</span>: elDomRect.<span class=\"property\">y</span> - parentDomRect.<span class=\"property\">y</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// return</span></span><br><span class=\"line\">    el.<span class=\"property\">style</span>.<span class=\"property\">cssText</span> += <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">      position: absolute;</span></span><br><span class=\"line\"><span class=\"string\">      z-index: 100;</span></span><br><span class=\"line\"><span class=\"string\">      left: <span class=\"subst\">$&#123;el.__position__.x&#125;</span>px;</span></span><br><span class=\"line\"><span class=\"string\">      top: <span class=\"subst\">$&#123;el.__position__.y&#125;</span>px;</span></span><br><span class=\"line\"><span class=\"string\">    `</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> directive;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"6-长按指令，长按时触发事件\"><a href=\"#6-长按指令，长按时触发事件\" class=\"headerlink\" title=\"6. 长按指令，长按时触发事件\"></a>6. 长按指令，长按时触发事件</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * v-longpress</span></span><br><span class=\"line\"><span class=\"comment\"> * 长按指令，长按时触发事件</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; <span class=\"title class_\">Directive</span>, <span class=\"title class_\">DirectiveBinding</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">directive</span>: <span class=\"title class_\">Directive</span> = &#123;</span><br><span class=\"line\">  <span class=\"title function_\">mounted</span>(<span class=\"params\">el: HTMLElement, binding: DirectiveBinding</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> binding.<span class=\"property\">value</span> !== <span class=\"string\">&#x27;function&#x27;</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"string\">&#x27;callback must be a function&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 定义变量</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"attr\">pressTimer</span>: <span class=\"built_in\">any</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 创建计时器（ 2秒后执行函数 ）</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"title function_\">start</span> = (<span class=\"params\">e: MouseEvent | TouchEvent</span>) =&gt; &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (e.<span class=\"property\">button</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (e.<span class=\"property\">type</span> === <span class=\"string\">&#x27;click&#x27;</span> &amp;&amp; e.<span class=\"property\">button</span> !== <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (pressTimer === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        pressTimer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"title function_\">handler</span>(e);</span><br><span class=\"line\">        &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// 取消计时器</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"title function_\">cancel</span> = (<span class=\"params\">e</span>) =&gt; &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (pressTimer !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">clearTimeout</span>(pressTimer);</span><br><span class=\"line\">        pressTimer = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// 运行函数</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"title function_\">handler</span> = (<span class=\"params\">e: MouseEvent | TouchEvent</span>) =&gt; &#123;</span><br><span class=\"line\">      binding.<span class=\"title function_\">value</span>(e);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// 添加事件监听器</span></span><br><span class=\"line\">    el.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, start);</span><br><span class=\"line\">    el.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;touchstart&#x27;</span>, start);</span><br><span class=\"line\">    <span class=\"comment\">// 取消计时器</span></span><br><span class=\"line\">    el.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, cancel);</span><br><span class=\"line\">    el.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mouseout&#x27;</span>, cancel);</span><br><span class=\"line\">    el.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;touchend&#x27;</span>, cancel);</span><br><span class=\"line\">    el.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;touchcancel&#x27;</span>, cancel);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> directive;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"7-设置水印效果\"><a href=\"#7-设置水印效果\" class=\"headerlink\" title=\"7. 设置水印效果\"></a>7. 设置水印效果</h3><figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * v-waterMarker可接收参数，均为非必填</span></span><br><span class=\"line\"><span class=\"comment\"> * &#123; text: &#x27;vue-admin-box&#x27;, font: &#x27;16px Microsoft JhengHei&#x27;, textColor: &#x27;#000&#x27; &#125;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Color</span>, <span class=\"title class_\">FontFamilyProperty</span>, <span class=\"title class_\">FontProperty</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;csstype&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; <span class=\"title class_\">Directive</span>, <span class=\"title class_\">DirectiveBinding</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">directive</span>: <span class=\"title class_\">Directive</span> = &#123;</span><br><span class=\"line\">  <span class=\"title function_\">mounted</span>(<span class=\"params\">el: HTMLElement, binding: DirectiveBinding</span>) &#123;</span><br><span class=\"line\">    binding.<span class=\"property\">value</span> ? binding.<span class=\"property\">value</span> : (binding.<span class=\"property\">value</span> = &#123;&#125;);</span><br><span class=\"line\">    <span class=\"title function_\">addWaterMarker</span>(binding.<span class=\"property\">value</span>.<span class=\"property\">text</span>, el, binding.<span class=\"property\">value</span>.<span class=\"property\">font</span>, binding.<span class=\"property\">value</span>.<span class=\"property\">textColor</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">addWaterMarker</span>(<span class=\"params\"></span></span><br><span class=\"line\"><span class=\"params\">  str: <span class=\"built_in\">string</span>,</span></span><br><span class=\"line\"><span class=\"params\">  parentNode: HTMLElement,</span></span><br><span class=\"line\"><span class=\"params\">  font: FontProperty,</span></span><br><span class=\"line\"><span class=\"params\">  textColor: Color</span></span><br><span class=\"line\"><span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 水印文字，父元素，字体，文字颜色</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> can = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;canvas&#x27;</span>) <span class=\"keyword\">as</span> <span class=\"title class_\">HTMLCanvasElement</span>;</span><br><span class=\"line\">  parentNode.<span class=\"title function_\">appendChild</span>(can);</span><br><span class=\"line\">  can.<span class=\"property\">width</span> = <span class=\"number\">300</span>;</span><br><span class=\"line\">  can.<span class=\"property\">height</span> = <span class=\"number\">225</span>;</span><br><span class=\"line\">  can.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&#x27;none&#x27;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> cans = can.<span class=\"title function_\">getContext</span>(<span class=\"string\">&#x27;2d&#x27;</span>) <span class=\"keyword\">as</span> <span class=\"title class_\">CanvasRenderingContext2D</span>;</span><br><span class=\"line\">  cans.<span class=\"title function_\">rotate</span>((-<span class=\"number\">20</span> * <span class=\"title class_\">Math</span>.<span class=\"property\">PI</span>) / <span class=\"number\">180</span>);</span><br><span class=\"line\">  cans.<span class=\"property\">font</span> = font || <span class=\"string\">&#x27;16px Microsoft JhengHei&#x27;</span>;</span><br><span class=\"line\">  cans.<span class=\"property\">fillStyle</span> = textColor || <span class=\"string\">&#x27;rgba(180, 180, 180, 0.3)&#x27;</span>;</span><br><span class=\"line\">  cans.<span class=\"property\">textAlign</span> = <span class=\"string\">&#x27;left&#x27;</span>;</span><br><span class=\"line\">  cans.<span class=\"property\">textBaseline</span> = <span class=\"string\">&#x27;middle&#x27;</span>;</span><br><span class=\"line\">  cans.<span class=\"title function_\">fillText</span>(str || <span class=\"string\">&#x27;vue-admin-box&#x27;</span>, can.<span class=\"property\">width</span> / <span class=\"number\">10</span>, can.<span class=\"property\">height</span> / <span class=\"number\">2</span>);</span><br><span class=\"line\">  parentNode.<span class=\"property\">style</span>.<span class=\"property\">backgroundImage</span> = <span class=\"string\">&#x27;url(&#x27;</span> + can.<span class=\"title function_\">toDataURL</span>(<span class=\"string\">&#x27;image/png&#x27;</span>) + <span class=\"string\">&#x27;)&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> directive;</span><br></pre></td></tr></table></figure>\n\n<hr>"},{"title":"我的prettier.config","abbrlink":"48d3","date":"2022-08-26T01:45:56.000Z","_content":"\n\n```js\nmodule.exports = {\n  printWidth: 100,\n  tabWidth: 2,\n  useTabs: false,\n  semi: true,\n  vueIndentScriptAndStyle: true,\n  singleQuote: true,\n  quoteProps: 'as-needed',\n  bracketSpacing: true,\n  trailingComma: 'es5',\n  jsxBracketSameLine: false,\n  jsxSingleQuote: false,\n  arrowParens: 'always',\n  insertPragma: false,\n  requirePragma: false,\n  proseWrap: 'never',\n  htmlWhitespaceSensitivity: 'strict',\n  endOfLine: 'auto',\n  rangeStart: 0,\n};\n```\n","source":"_posts/我的prettier-config.md","raw":"---\ntitle: 我的prettier.config\ntags:\n  - 备份\ncategories:\n  - 个人备份\nabbrlink: 48d3\ndate: 2022-08-26 09:45:56\n---\n\n\n```js\nmodule.exports = {\n  printWidth: 100,\n  tabWidth: 2,\n  useTabs: false,\n  semi: true,\n  vueIndentScriptAndStyle: true,\n  singleQuote: true,\n  quoteProps: 'as-needed',\n  bracketSpacing: true,\n  trailingComma: 'es5',\n  jsxBracketSameLine: false,\n  jsxSingleQuote: false,\n  arrowParens: 'always',\n  insertPragma: false,\n  requirePragma: false,\n  proseWrap: 'never',\n  htmlWhitespaceSensitivity: 'strict',\n  endOfLine: 'auto',\n  rangeStart: 0,\n};\n```\n","slug":"我的prettier-config","published":1,"updated":"2022-08-26T01:47:54.848Z","_id":"cl79tdvvf000i5d9katsg2a6t","comments":1,"layout":"post","photos":[],"link":"","content":"<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">  <span class=\"attr\">printWidth</span>: <span class=\"number\">100</span>,</span><br><span class=\"line\">  <span class=\"attr\">tabWidth</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">  <span class=\"attr\">useTabs</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"attr\">semi</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"attr\">vueIndentScriptAndStyle</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"attr\">singleQuote</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"attr\">quoteProps</span>: <span class=\"string\">&#x27;as-needed&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">bracketSpacing</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"attr\">trailingComma</span>: <span class=\"string\">&#x27;es5&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">jsxBracketSameLine</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"attr\">jsxSingleQuote</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"attr\">arrowParens</span>: <span class=\"string\">&#x27;always&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">insertPragma</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"attr\">requirePragma</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"attr\">proseWrap</span>: <span class=\"string\">&#x27;never&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">htmlWhitespaceSensitivity</span>: <span class=\"string\">&#x27;strict&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">endOfLine</span>: <span class=\"string\">&#x27;auto&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">rangeStart</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">  <span class=\"attr\">printWidth</span>: <span class=\"number\">100</span>,</span><br><span class=\"line\">  <span class=\"attr\">tabWidth</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">  <span class=\"attr\">useTabs</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"attr\">semi</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"attr\">vueIndentScriptAndStyle</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"attr\">singleQuote</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"attr\">quoteProps</span>: <span class=\"string\">&#x27;as-needed&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">bracketSpacing</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"attr\">trailingComma</span>: <span class=\"string\">&#x27;es5&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">jsxBracketSameLine</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"attr\">jsxSingleQuote</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"attr\">arrowParens</span>: <span class=\"string\">&#x27;always&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">insertPragma</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"attr\">requirePragma</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"attr\">proseWrap</span>: <span class=\"string\">&#x27;never&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">htmlWhitespaceSensitivity</span>: <span class=\"string\">&#x27;strict&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">endOfLine</span>: <span class=\"string\">&#x27;auto&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">rangeStart</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n"},{"title":"持久化vuex","abbrlink":"83d9","date":"2022-08-22T07:22:20.000Z","_content":"\nvue 项目中一般都需要存储用户的信息、用户保存的设置、一些操作的状态等等，大量的信息存储会选择数据库，但是像是用户下单状态、用户音视频通话状态、微信一键登录返回 code 等一些数据存储在数据库无疑是没有意义的。为了防止存储在 vuex 中的数据一经用户刷新页面就丢失导致体验不好的现象，我们可以对 vuex 进行持久化保存，同时可以区分一些数据是存储在 localStorage 中还是 sessionStorage 中。\n\n<!-- more -->\n\n***\n\n> 原理： createStore 也就是创建 vuex 实例时，vuex 向外提供了 plugins 属性，plugins 的值是一个数据，它会向其中所有的元素注入 store 对象，为了方便实时获取到 store，并且会在 store 更新时触发所有 plugins 中的事件，用 subscribe 事件去监听每次 mutation 事件。\n\n```ts\nimport { createStore } from 'vuex';\n\nexport default createStore<RootState>({\n  modules: {},\n  strict: true, // 是否开启严格模式\n  plugins: [], // 元素为函数，并且函数的第一个参数是store对象\n});\n```\n\n##### 如此一来，可以实时获取到 store，并能够在 store 更新时触发回调，就可以直接操作 store 的存与取了\n\n这个是负责存储和取值的实现：\n\n```ts\ninterface Socket {\n  key: string;\n  modules: Modules;\n  modulesKeys: ModulesKeys;\n}\n\ninterface Modules {\n  [propName: string]: any;\n}\n\ninterface ModulesKeys {\n  local: string[];\n  session: string[];\n}\n\ninterface Mutation {\n  type: any;\n  payload: any;\n}\nconst exclude = ['actions', 'getters', 'mutations', 'namespaced'];\nexport default function Persistent({ key, modules, modulesKeys }: Socket) {\n  return (store: any) => {\n    const localOldState = JSON.parse(localStorage.getItem(key) || '{}');\n    const sessionOldState = JSON.parse(sessionStorage.getItem(key) || '{}');\n    let oldState: Modules = {};\n    Object.assign(oldState, localOldState, sessionOldState);\n    if (Object.keys(oldState).length > 0) {\n      for (const oldKey in oldState) {\n        modules[oldKey] = oldState[oldKey];\n      }\n      store.replaceState(modules);\n    }\n    store.subscribe((mutation: Mutation, state: any) => {\n      // 判断是否需要缓存数据至localStorage\n      if (modulesKeys.local.length > 0) {\n        const localData = setData(store.state, modulesKeys.local);\n        localStorage.setItem(key, JSON.stringify(localData));\n      } else {\n        localStorage.removeItem(key);\n      }\n      // 判断是否需要缓存数据至sessionStorage\n      if (modulesKeys.session.length > 0) {\n        const sessionData = setData(store.state, modulesKeys.session);\n        sessionStorage.setItem(key, JSON.stringify(sessionData));\n      } else {\n        sessionStorage.removeItem(key);\n      }\n    });\n  };\n}\n\nfunction setData(state: any, module: string[]) {\n  let data: Modules = {};\n  for (const i of module) {\n    data[i] = state[i];\n  }\n  return data;\n}\n```\n\n#### 同时推荐一个 createLogger 的 plugin，可以实时打印 store 的更改\n\n这里我的文档结构为：\n```\n  | -- store\n    | -- modules\n      | -- app.ts\n      | -- user.ts\n    | -- plugins\n      | -- persistent.ts\n    index.ts\n```\n最终的 store/index.ts 代码如下：\n\n```ts\nimport { createStore, createLogger } from 'vuex';\nimport Persistent from './plugins/persistent';\nimport { userState } from '@/store/modules/user';\nimport { appState } from '@/store/modules/app';\nconst debug = import.meta.env.MODE !== 'production';\nconst files = import.meta.globEager('./modules/*.ts');\n\n// 这里只是举例： user  app 模块\nexport interface RootState {\n  user: userState;\n  app: appState;\n}\n\nlet modules: any = {};\nObject.keys(files).forEach((c: string) => {\n  const module = files[c].default;\n  const moduleName: string = c.replace(/^\\.\\/(.*)\\/(.*)\\.\\w+$/, '$2');\n  modules[moduleName] = module;\n});\n\n// 这是一个vuex本地存储插件，默认把vuex所有数据都做存储了\n// local代表存储在localStorage里面，进行永久存储\n// session代表存储在sessionStorage里面，进行临时存储\n// 都接收Modules的文件名数组，如：['app', 'keepAlive', 'user']\n// 用户相关的数据建议直接存储在local里面，session里面会导致打开新窗口时获取不到token值，因为session只针对当前会话\nconst persistent = Persistent({\n  key: 'vuex',\n  modules,\n  modulesKeys: {\n    local: Object.keys(modules).filter(item => item !== 'call'),\n    session: ['call'],\n  },\n});\n\nexport default createStore<RootState>({\n  modules: {\n    ...modules,\n  },\n  strict: debug,\n  plugins: debug ? [createLogger(), persistent] : [persistent],\n});\n```\n","source":"_posts/持久化vuex.md","raw":"---\ntitle: 持久化vuex\ntags: 知识积累\ncategories:\n  - 前端知识积累\n  - Vue\nabbrlink: 83d9\ndate: 2022-08-22 15:22:20\n---\n\nvue 项目中一般都需要存储用户的信息、用户保存的设置、一些操作的状态等等，大量的信息存储会选择数据库，但是像是用户下单状态、用户音视频通话状态、微信一键登录返回 code 等一些数据存储在数据库无疑是没有意义的。为了防止存储在 vuex 中的数据一经用户刷新页面就丢失导致体验不好的现象，我们可以对 vuex 进行持久化保存，同时可以区分一些数据是存储在 localStorage 中还是 sessionStorage 中。\n\n<!-- more -->\n\n***\n\n> 原理： createStore 也就是创建 vuex 实例时，vuex 向外提供了 plugins 属性，plugins 的值是一个数据，它会向其中所有的元素注入 store 对象，为了方便实时获取到 store，并且会在 store 更新时触发所有 plugins 中的事件，用 subscribe 事件去监听每次 mutation 事件。\n\n```ts\nimport { createStore } from 'vuex';\n\nexport default createStore<RootState>({\n  modules: {},\n  strict: true, // 是否开启严格模式\n  plugins: [], // 元素为函数，并且函数的第一个参数是store对象\n});\n```\n\n##### 如此一来，可以实时获取到 store，并能够在 store 更新时触发回调，就可以直接操作 store 的存与取了\n\n这个是负责存储和取值的实现：\n\n```ts\ninterface Socket {\n  key: string;\n  modules: Modules;\n  modulesKeys: ModulesKeys;\n}\n\ninterface Modules {\n  [propName: string]: any;\n}\n\ninterface ModulesKeys {\n  local: string[];\n  session: string[];\n}\n\ninterface Mutation {\n  type: any;\n  payload: any;\n}\nconst exclude = ['actions', 'getters', 'mutations', 'namespaced'];\nexport default function Persistent({ key, modules, modulesKeys }: Socket) {\n  return (store: any) => {\n    const localOldState = JSON.parse(localStorage.getItem(key) || '{}');\n    const sessionOldState = JSON.parse(sessionStorage.getItem(key) || '{}');\n    let oldState: Modules = {};\n    Object.assign(oldState, localOldState, sessionOldState);\n    if (Object.keys(oldState).length > 0) {\n      for (const oldKey in oldState) {\n        modules[oldKey] = oldState[oldKey];\n      }\n      store.replaceState(modules);\n    }\n    store.subscribe((mutation: Mutation, state: any) => {\n      // 判断是否需要缓存数据至localStorage\n      if (modulesKeys.local.length > 0) {\n        const localData = setData(store.state, modulesKeys.local);\n        localStorage.setItem(key, JSON.stringify(localData));\n      } else {\n        localStorage.removeItem(key);\n      }\n      // 判断是否需要缓存数据至sessionStorage\n      if (modulesKeys.session.length > 0) {\n        const sessionData = setData(store.state, modulesKeys.session);\n        sessionStorage.setItem(key, JSON.stringify(sessionData));\n      } else {\n        sessionStorage.removeItem(key);\n      }\n    });\n  };\n}\n\nfunction setData(state: any, module: string[]) {\n  let data: Modules = {};\n  for (const i of module) {\n    data[i] = state[i];\n  }\n  return data;\n}\n```\n\n#### 同时推荐一个 createLogger 的 plugin，可以实时打印 store 的更改\n\n这里我的文档结构为：\n```\n  | -- store\n    | -- modules\n      | -- app.ts\n      | -- user.ts\n    | -- plugins\n      | -- persistent.ts\n    index.ts\n```\n最终的 store/index.ts 代码如下：\n\n```ts\nimport { createStore, createLogger } from 'vuex';\nimport Persistent from './plugins/persistent';\nimport { userState } from '@/store/modules/user';\nimport { appState } from '@/store/modules/app';\nconst debug = import.meta.env.MODE !== 'production';\nconst files = import.meta.globEager('./modules/*.ts');\n\n// 这里只是举例： user  app 模块\nexport interface RootState {\n  user: userState;\n  app: appState;\n}\n\nlet modules: any = {};\nObject.keys(files).forEach((c: string) => {\n  const module = files[c].default;\n  const moduleName: string = c.replace(/^\\.\\/(.*)\\/(.*)\\.\\w+$/, '$2');\n  modules[moduleName] = module;\n});\n\n// 这是一个vuex本地存储插件，默认把vuex所有数据都做存储了\n// local代表存储在localStorage里面，进行永久存储\n// session代表存储在sessionStorage里面，进行临时存储\n// 都接收Modules的文件名数组，如：['app', 'keepAlive', 'user']\n// 用户相关的数据建议直接存储在local里面，session里面会导致打开新窗口时获取不到token值，因为session只针对当前会话\nconst persistent = Persistent({\n  key: 'vuex',\n  modules,\n  modulesKeys: {\n    local: Object.keys(modules).filter(item => item !== 'call'),\n    session: ['call'],\n  },\n});\n\nexport default createStore<RootState>({\n  modules: {\n    ...modules,\n  },\n  strict: debug,\n  plugins: debug ? [createLogger(), persistent] : [persistent],\n});\n```\n","slug":"持久化vuex","published":1,"updated":"2022-08-26T01:42:59.884Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl79tdvvm001t5d9kh20idq5w","content":"<p>vue 项目中一般都需要存储用户的信息、用户保存的设置、一些操作的状态等等，大量的信息存储会选择数据库，但是像是用户下单状态、用户音视频通话状态、微信一键登录返回 code 等一些数据存储在数据库无疑是没有意义的。为了防止存储在 vuex 中的数据一经用户刷新页面就丢失导致体验不好的现象，我们可以对 vuex 进行持久化保存，同时可以区分一些数据是存储在 localStorage 中还是 sessionStorage 中。</p>\n<span id=\"more\"></span>\n\n<hr>\n<blockquote>\n<p>原理： createStore 也就是创建 vuex 实例时，vuex 向外提供了 plugins 属性，plugins 的值是一个数据，它会向其中所有的元素注入 store 对象，为了方便实时获取到 store，并且会在 store 更新时触发所有 plugins 中的事件，用 subscribe 事件去监听每次 mutation 事件。</p>\n</blockquote>\n<figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; createStore &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vuex&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> createStore&lt;<span class=\"title class_\">RootState</span>&gt;(&#123;</span><br><span class=\"line\">  <span class=\"attr\">modules</span>: &#123;&#125;,</span><br><span class=\"line\">  <span class=\"attr\">strict</span>: <span class=\"literal\">true</span>, <span class=\"comment\">// 是否开启严格模式</span></span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [], <span class=\"comment\">// 元素为函数，并且函数的第一个参数是store对象</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"如此一来，可以实时获取到-store，并能够在-store-更新时触发回调，就可以直接操作-store-的存与取了\"><a href=\"#如此一来，可以实时获取到-store，并能够在-store-更新时触发回调，就可以直接操作-store-的存与取了\" class=\"headerlink\" title=\"如此一来，可以实时获取到 store，并能够在 store 更新时触发回调，就可以直接操作 store 的存与取了\"></a>如此一来，可以实时获取到 store，并能够在 store 更新时触发回调，就可以直接操作 store 的存与取了</h5><p>这个是负责存储和取值的实现：</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Socket</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">key</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">  <span class=\"attr\">modules</span>: <span class=\"title class_\">Modules</span>;</span><br><span class=\"line\">  <span class=\"attr\">modulesKeys</span>: <span class=\"title class_\">ModulesKeys</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Modules</span> &#123;</span><br><span class=\"line\">  [<span class=\"attr\">propName</span>: <span class=\"built_in\">string</span>]: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">ModulesKeys</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">local</span>: <span class=\"built_in\">string</span>[];</span><br><span class=\"line\">  <span class=\"attr\">session</span>: <span class=\"built_in\">string</span>[];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Mutation</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">type</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">  <span class=\"attr\">payload</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> exclude = [<span class=\"string\">&#x27;actions&#x27;</span>, <span class=\"string\">&#x27;getters&#x27;</span>, <span class=\"string\">&#x27;mutations&#x27;</span>, <span class=\"string\">&#x27;namespaced&#x27;</span>];</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">function</span> <span class=\"title function_\">Persistent</span>(<span class=\"params\">&#123; key, modules, modulesKeys &#125;: Socket</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\">(<span class=\"params\">store: <span class=\"built_in\">any</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> localOldState = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(<span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">getItem</span>(key) || <span class=\"string\">&#x27;&#123;&#125;&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> sessionOldState = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(sessionStorage.<span class=\"title function_\">getItem</span>(key) || <span class=\"string\">&#x27;&#123;&#125;&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"attr\">oldState</span>: <span class=\"title class_\">Modules</span> = &#123;&#125;;</span><br><span class=\"line\">    <span class=\"title class_\">Object</span>.<span class=\"title function_\">assign</span>(oldState, localOldState, sessionOldState);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"title class_\">Object</span>.<span class=\"title function_\">keys</span>(oldState).<span class=\"property\">length</span> &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> oldKey <span class=\"keyword\">in</span> oldState) &#123;</span><br><span class=\"line\">        modules[oldKey] = oldState[oldKey];</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      store.<span class=\"title function_\">replaceState</span>(modules);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    store.<span class=\"title function_\">subscribe</span>(<span class=\"function\">(<span class=\"params\">mutation: Mutation, state: <span class=\"built_in\">any</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 判断是否需要缓存数据至localStorage</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (modulesKeys.<span class=\"property\">local</span>.<span class=\"property\">length</span> &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> localData = <span class=\"title function_\">setData</span>(store.<span class=\"property\">state</span>, modulesKeys.<span class=\"property\">local</span>);</span><br><span class=\"line\">        <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(key, <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(localData));</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">removeItem</span>(key);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\">// 判断是否需要缓存数据至sessionStorage</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (modulesKeys.<span class=\"property\">session</span>.<span class=\"property\">length</span> &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> sessionData = <span class=\"title function_\">setData</span>(store.<span class=\"property\">state</span>, modulesKeys.<span class=\"property\">session</span>);</span><br><span class=\"line\">        sessionStorage.<span class=\"title function_\">setItem</span>(key, <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(sessionData));</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        sessionStorage.<span class=\"title function_\">removeItem</span>(key);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setData</span>(<span class=\"params\">state: <span class=\"built_in\">any</span>, <span class=\"variable language_\">module</span>: <span class=\"built_in\">string</span>[]</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"attr\">data</span>: <span class=\"title class_\">Modules</span> = &#123;&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> i <span class=\"keyword\">of</span> <span class=\"variable language_\">module</span>) &#123;</span><br><span class=\"line\">    data[i] = state[i];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> data;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"同时推荐一个-createLogger-的-plugin，可以实时打印-store-的更改\"><a href=\"#同时推荐一个-createLogger-的-plugin，可以实时打印-store-的更改\" class=\"headerlink\" title=\"同时推荐一个 createLogger 的 plugin，可以实时打印 store 的更改\"></a>同时推荐一个 createLogger 的 plugin，可以实时打印 store 的更改</h4><p>这里我的文档结构为：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">| -- store</span><br><span class=\"line\">  | -- modules</span><br><span class=\"line\">    | -- app.ts</span><br><span class=\"line\">    | -- user.ts</span><br><span class=\"line\">  | -- plugins</span><br><span class=\"line\">    | -- persistent.ts</span><br><span class=\"line\">  index.ts</span><br></pre></td></tr></table></figure>\n<p>最终的 store/index.ts 代码如下：</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; createStore, createLogger &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vuex&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Persistent</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./plugins/persistent&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; userState &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@/store/modules/user&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; appState &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@/store/modules/app&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> debug = <span class=\"keyword\">import</span>.<span class=\"property\">meta</span>.<span class=\"property\">env</span>.<span class=\"property\">MODE</span> !== <span class=\"string\">&#x27;production&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> files = <span class=\"keyword\">import</span>.<span class=\"property\">meta</span>.<span class=\"title function_\">globEager</span>(<span class=\"string\">&#x27;./modules/*.ts&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 这里只是举例： user  app 模块</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">RootState</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">user</span>: userState;</span><br><span class=\"line\">  <span class=\"attr\">app</span>: appState;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">modules</span>: <span class=\"built_in\">any</span> = &#123;&#125;;</span><br><span class=\"line\"><span class=\"title class_\">Object</span>.<span class=\"title function_\">keys</span>(files).<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">c: <span class=\"built_in\">string</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> <span class=\"variable language_\">module</span> = files[c].<span class=\"property\">default</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> <span class=\"attr\">moduleName</span>: <span class=\"built_in\">string</span> = c.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/^\\.\\/(.*)\\/(.*)\\.\\w+$/</span>, <span class=\"string\">&#x27;$2&#x27;</span>);</span><br><span class=\"line\">  modules[moduleName] = <span class=\"variable language_\">module</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 这是一个vuex本地存储插件，默认把vuex所有数据都做存储了</span></span><br><span class=\"line\"><span class=\"comment\">// local代表存储在localStorage里面，进行永久存储</span></span><br><span class=\"line\"><span class=\"comment\">// session代表存储在sessionStorage里面，进行临时存储</span></span><br><span class=\"line\"><span class=\"comment\">// 都接收Modules的文件名数组，如：[&#x27;app&#x27;, &#x27;keepAlive&#x27;, &#x27;user&#x27;]</span></span><br><span class=\"line\"><span class=\"comment\">// 用户相关的数据建议直接存储在local里面，session里面会导致打开新窗口时获取不到token值，因为session只针对当前会话</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> persistent = <span class=\"title class_\">Persistent</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">key</span>: <span class=\"string\">&#x27;vuex&#x27;</span>,</span><br><span class=\"line\">  modules,</span><br><span class=\"line\">  <span class=\"attr\">modulesKeys</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">local</span>: <span class=\"title class_\">Object</span>.<span class=\"title function_\">keys</span>(modules).<span class=\"title function_\">filter</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item !== <span class=\"string\">&#x27;call&#x27;</span>),</span><br><span class=\"line\">    <span class=\"attr\">session</span>: [<span class=\"string\">&#x27;call&#x27;</span>],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> createStore&lt;<span class=\"title class_\">RootState</span>&gt;(&#123;</span><br><span class=\"line\">  <span class=\"attr\">modules</span>: &#123;</span><br><span class=\"line\">    ...modules,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">strict</span>: debug,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: debug ? [<span class=\"title function_\">createLogger</span>(), persistent] : [persistent],</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>vue 项目中一般都需要存储用户的信息、用户保存的设置、一些操作的状态等等，大量的信息存储会选择数据库，但是像是用户下单状态、用户音视频通话状态、微信一键登录返回 code 等一些数据存储在数据库无疑是没有意义的。为了防止存储在 vuex 中的数据一经用户刷新页面就丢失导致体验不好的现象，我们可以对 vuex 进行持久化保存，同时可以区分一些数据是存储在 localStorage 中还是 sessionStorage 中。</p>","more":"<hr>\n<blockquote>\n<p>原理： createStore 也就是创建 vuex 实例时，vuex 向外提供了 plugins 属性，plugins 的值是一个数据，它会向其中所有的元素注入 store 对象，为了方便实时获取到 store，并且会在 store 更新时触发所有 plugins 中的事件，用 subscribe 事件去监听每次 mutation 事件。</p>\n</blockquote>\n<figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; createStore &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vuex&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> createStore&lt;<span class=\"title class_\">RootState</span>&gt;(&#123;</span><br><span class=\"line\">  <span class=\"attr\">modules</span>: &#123;&#125;,</span><br><span class=\"line\">  <span class=\"attr\">strict</span>: <span class=\"literal\">true</span>, <span class=\"comment\">// 是否开启严格模式</span></span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [], <span class=\"comment\">// 元素为函数，并且函数的第一个参数是store对象</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"如此一来，可以实时获取到-store，并能够在-store-更新时触发回调，就可以直接操作-store-的存与取了\"><a href=\"#如此一来，可以实时获取到-store，并能够在-store-更新时触发回调，就可以直接操作-store-的存与取了\" class=\"headerlink\" title=\"如此一来，可以实时获取到 store，并能够在 store 更新时触发回调，就可以直接操作 store 的存与取了\"></a>如此一来，可以实时获取到 store，并能够在 store 更新时触发回调，就可以直接操作 store 的存与取了</h5><p>这个是负责存储和取值的实现：</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Socket</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">key</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">  <span class=\"attr\">modules</span>: <span class=\"title class_\">Modules</span>;</span><br><span class=\"line\">  <span class=\"attr\">modulesKeys</span>: <span class=\"title class_\">ModulesKeys</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Modules</span> &#123;</span><br><span class=\"line\">  [<span class=\"attr\">propName</span>: <span class=\"built_in\">string</span>]: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">ModulesKeys</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">local</span>: <span class=\"built_in\">string</span>[];</span><br><span class=\"line\">  <span class=\"attr\">session</span>: <span class=\"built_in\">string</span>[];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Mutation</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">type</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">  <span class=\"attr\">payload</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> exclude = [<span class=\"string\">&#x27;actions&#x27;</span>, <span class=\"string\">&#x27;getters&#x27;</span>, <span class=\"string\">&#x27;mutations&#x27;</span>, <span class=\"string\">&#x27;namespaced&#x27;</span>];</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">function</span> <span class=\"title function_\">Persistent</span>(<span class=\"params\">&#123; key, modules, modulesKeys &#125;: Socket</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\">(<span class=\"params\">store: <span class=\"built_in\">any</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> localOldState = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(<span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">getItem</span>(key) || <span class=\"string\">&#x27;&#123;&#125;&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> sessionOldState = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(sessionStorage.<span class=\"title function_\">getItem</span>(key) || <span class=\"string\">&#x27;&#123;&#125;&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"attr\">oldState</span>: <span class=\"title class_\">Modules</span> = &#123;&#125;;</span><br><span class=\"line\">    <span class=\"title class_\">Object</span>.<span class=\"title function_\">assign</span>(oldState, localOldState, sessionOldState);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"title class_\">Object</span>.<span class=\"title function_\">keys</span>(oldState).<span class=\"property\">length</span> &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> oldKey <span class=\"keyword\">in</span> oldState) &#123;</span><br><span class=\"line\">        modules[oldKey] = oldState[oldKey];</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      store.<span class=\"title function_\">replaceState</span>(modules);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    store.<span class=\"title function_\">subscribe</span>(<span class=\"function\">(<span class=\"params\">mutation: Mutation, state: <span class=\"built_in\">any</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 判断是否需要缓存数据至localStorage</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (modulesKeys.<span class=\"property\">local</span>.<span class=\"property\">length</span> &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> localData = <span class=\"title function_\">setData</span>(store.<span class=\"property\">state</span>, modulesKeys.<span class=\"property\">local</span>);</span><br><span class=\"line\">        <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(key, <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(localData));</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">removeItem</span>(key);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\">// 判断是否需要缓存数据至sessionStorage</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (modulesKeys.<span class=\"property\">session</span>.<span class=\"property\">length</span> &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> sessionData = <span class=\"title function_\">setData</span>(store.<span class=\"property\">state</span>, modulesKeys.<span class=\"property\">session</span>);</span><br><span class=\"line\">        sessionStorage.<span class=\"title function_\">setItem</span>(key, <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(sessionData));</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        sessionStorage.<span class=\"title function_\">removeItem</span>(key);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setData</span>(<span class=\"params\">state: <span class=\"built_in\">any</span>, <span class=\"variable language_\">module</span>: <span class=\"built_in\">string</span>[]</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"attr\">data</span>: <span class=\"title class_\">Modules</span> = &#123;&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> i <span class=\"keyword\">of</span> <span class=\"variable language_\">module</span>) &#123;</span><br><span class=\"line\">    data[i] = state[i];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> data;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"同时推荐一个-createLogger-的-plugin，可以实时打印-store-的更改\"><a href=\"#同时推荐一个-createLogger-的-plugin，可以实时打印-store-的更改\" class=\"headerlink\" title=\"同时推荐一个 createLogger 的 plugin，可以实时打印 store 的更改\"></a>同时推荐一个 createLogger 的 plugin，可以实时打印 store 的更改</h4><p>这里我的文档结构为：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">| -- store</span><br><span class=\"line\">  | -- modules</span><br><span class=\"line\">    | -- app.ts</span><br><span class=\"line\">    | -- user.ts</span><br><span class=\"line\">  | -- plugins</span><br><span class=\"line\">    | -- persistent.ts</span><br><span class=\"line\">  index.ts</span><br></pre></td></tr></table></figure>\n<p>最终的 store/index.ts 代码如下：</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; createStore, createLogger &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vuex&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Persistent</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./plugins/persistent&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; userState &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@/store/modules/user&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; appState &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@/store/modules/app&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> debug = <span class=\"keyword\">import</span>.<span class=\"property\">meta</span>.<span class=\"property\">env</span>.<span class=\"property\">MODE</span> !== <span class=\"string\">&#x27;production&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> files = <span class=\"keyword\">import</span>.<span class=\"property\">meta</span>.<span class=\"title function_\">globEager</span>(<span class=\"string\">&#x27;./modules/*.ts&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 这里只是举例： user  app 模块</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">RootState</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">user</span>: userState;</span><br><span class=\"line\">  <span class=\"attr\">app</span>: appState;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">modules</span>: <span class=\"built_in\">any</span> = &#123;&#125;;</span><br><span class=\"line\"><span class=\"title class_\">Object</span>.<span class=\"title function_\">keys</span>(files).<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">c: <span class=\"built_in\">string</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> <span class=\"variable language_\">module</span> = files[c].<span class=\"property\">default</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> <span class=\"attr\">moduleName</span>: <span class=\"built_in\">string</span> = c.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/^\\.\\/(.*)\\/(.*)\\.\\w+$/</span>, <span class=\"string\">&#x27;$2&#x27;</span>);</span><br><span class=\"line\">  modules[moduleName] = <span class=\"variable language_\">module</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 这是一个vuex本地存储插件，默认把vuex所有数据都做存储了</span></span><br><span class=\"line\"><span class=\"comment\">// local代表存储在localStorage里面，进行永久存储</span></span><br><span class=\"line\"><span class=\"comment\">// session代表存储在sessionStorage里面，进行临时存储</span></span><br><span class=\"line\"><span class=\"comment\">// 都接收Modules的文件名数组，如：[&#x27;app&#x27;, &#x27;keepAlive&#x27;, &#x27;user&#x27;]</span></span><br><span class=\"line\"><span class=\"comment\">// 用户相关的数据建议直接存储在local里面，session里面会导致打开新窗口时获取不到token值，因为session只针对当前会话</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> persistent = <span class=\"title class_\">Persistent</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">key</span>: <span class=\"string\">&#x27;vuex&#x27;</span>,</span><br><span class=\"line\">  modules,</span><br><span class=\"line\">  <span class=\"attr\">modulesKeys</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">local</span>: <span class=\"title class_\">Object</span>.<span class=\"title function_\">keys</span>(modules).<span class=\"title function_\">filter</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item !== <span class=\"string\">&#x27;call&#x27;</span>),</span><br><span class=\"line\">    <span class=\"attr\">session</span>: [<span class=\"string\">&#x27;call&#x27;</span>],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> createStore&lt;<span class=\"title class_\">RootState</span>&gt;(&#123;</span><br><span class=\"line\">  <span class=\"attr\">modules</span>: &#123;</span><br><span class=\"line\">    ...modules,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">strict</span>: debug,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: debug ? [<span class=\"title function_\">createLogger</span>(), persistent] : [persistent],</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>"},{"title":"那些开发中的css技巧","layout":"post","seo_title":"那些开发中的css技巧","keywords":"CSS 开发效率提升","abbrlink":"cc46","date":"2021-07-02T04:11:42.000Z","top":1,"copyright":true,"_content":"\n在开发中合理利用 css，可以大大提高开发效率。积累以便 Ctrl + C\n\n<!-- more -->\n\n### 1. 去除 safari 浏览器输入框的小图标以及密码输入的钥匙图标\n\n```css\n/* 去掉Safari浏览器下密码输入框自带的小钥匙图标 */\ninput::-webkit-credentials-auto-fill-button {\n  display: none !important;\n  visibility: hidden;\n  pointer-events: none;\n  position: absolute;\n  right: 0;\n}\n\n/* 去掉safari浏览器input右边的小图标/小按钮 */\ninput:focus::-webkit-contacts-auto-fill-button {\n  opacity: 0;\n}\n```\n\n---\n\n### 2. 调整浏览器滚动条的样式\n\n```css\n/*定义滚动条高宽及背景 高宽分别对应横竖滚动条的尺寸*/\n::-webkit-scrollbar {\n  /* width: 5px;\n  height: 5px; */\n}\n\n/*定义滚动条轨道 内阴影+圆角*/\n::-webkit-scrollbar-track {\n  border-radius: 999px;\n  border: 0px solid transparent;\n  box-shadow: 1px 1px 5px rgba(100, 100, 100, 0.2) inset;\n}\n\n/*定义滑块 内阴影+圆角*/\n::-webkit-scrollbar-thumb {\n  border-radius: 999px;\n  border: 0px solid transparent;\n  min-height: 20px;\n  background-clip: content-box;\n  box-shadow: 0 0 0 5px rgba(100, 100, 100, 0.5) inset;\n  -webkit-box-shadow: 0 0 0 5px rgba(100, 100, 100, 0.5) inset;\n}\n\n::-webkit-scrollbar-corner {\n  background: transparent;\n}\n```\n\n---\n\n### 3. 毛玻璃效果\n\n```css\ndiv {\n  background: hsla(0, 0%, 100%, 0.75);\n  -webkit-backdrop-filter: blur(5px);\n  backdrop-filter: blur(5px);\n}\n```\n\n---\n\n### 4. 手机端点开多选框出现蓝色块\n\n```css\n* {\n  -webkit-tap-highlight-color: transparent;\n}\n```\n\n---\n\n### 5. 鼠标放上出现一个白色的框(带动画)\n\n```css\n/* 默认样式 -- 不显示 */\n.border:before {\n  content: '';\n  position: absolute;\n  left: 10px;\n  top: 10px;\n  right: 10px;\n  bottom: 10px;\n  box-sizing: border-box;\n  border: 3px solid #ffffff;\n  transform: scale(0);\n  opacity: 0;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) 0s;\n}\n\n/* hover时改变 */\n.border:hover:before {\n  transform: scale(1);\n  opacity: 1;\n}\n```\n\n**效果图**\n![边框效果图](https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E9%82%A3%E4%BA%9B%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84css%E6%8A%80%E5%B7%A7/border-animation.gif)\n\n---\n\n### 6. flex 布局实现简单的瀑布流\n\n**html 部分**\n\n```html\n<!-- 这里需要将文档结构处理成类似的结构 -->\n<div class=\"container\">\n  <div class=\"container-item\">\n    <img src=\"*&^%^%&%*&*\" />\n    <h4>标题1</h4>\n    <p>这是item1的描述信息</p>\n  </div>\n  <div class=\"container-item\">\n    <img src=\"*&^%^%&%*&*\" />\n    <h4>标题2</h4>\n    <p>这是item2的描述信息</p>\n  </div>\n  <div class=\"container-item\">\n    <img src=\"*&^%^%&%*&*\" />\n    <h4>标题3</h4>\n    <p>这是item3的描述信息</p>\n  </div>\n  <div class=\"container-item\">\n    <img src=\"*&^%^%&%*&*\" />\n    <h4>标题4</h4>\n    <p>这是item4的描述信息</p>\n  </div>\n</div>\n```\n\n**css 部分**\n\n```scss\n.container {\n  width: 750rpx;\n  margin: 0 auto;\n  column-count: 4; /* 瀑布流的列数 */\n  column-gap: 0; /* 每列之间的间距 如： 10px;*/\n\n  &-item {\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n  }\n}\n```\n\n### 7. 一个交错动画案例（加载...）\n\n**html 部分**\n\n```htm\n<div class=\"loading\">\n  <div class=\"dot\"></div>\n  <div class=\"dot\"></div>\n  <div class=\"dot\"></div>\n  <div class=\"dot\"></div>\n  <div class=\"dot\"></div>\n</div>\n```\n\n**scss 部分**\n\n```scss\nbody {\n  display: flex;\n  height: 100vh;\n  justify-content: center;\n  align-items: center;\n  background: #222;\n}\n\n.loading {\n  $colors: #7ef9ff, #89cff0, #4682b4, #0f52ba, #000080;\n  display: flex;\n\n  .dot {\n    position: relative;\n    width: 2em;\n    height: 2em;\n    margin: 0.8em;\n    border-radius: 50%;\n\n    &::before {\n      position: absolute;\n      content: '';\n      width: 100%;\n      height: 100%;\n      background: inherit;\n      border-radius: inherit;\n      animation: wave 2s ease-out infinite;\n    }\n\n    @for $i from 1 through 5 {\n      &:nth-child(#{$i}) {\n        background: nth($colors, $i);\n\n        &::before {\n          animation-delay: $i * 0.2s;\n        }\n      }\n    }\n  }\n}\n\n@keyframes wave {\n  50%,\n  75% {\n    transform: scale(2.5);\n  }\n\n  80%,\n  100% {\n    opacity: 0;\n  }\n}\n```\n\n![交错动画演示](https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E9%82%A3%E4%BA%9B%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84css%E6%8A%80%E5%B7%A7/loading_animation.gif)\n\n---\n\n### 8. 利用伪类实现按钮边框特效\n\n**html 部分**\n\n```html\n<button data-text=\"Start\" class=\"btn btn-primary btn-ghost btn-border-stroke  btn-text-float-up\">\n  <div class=\"btn-borders\">\n    <div class=\"border-top\"></div>\n    <div class=\"border-right\"></div>\n    <div class=\"border-bottom\"></div>\n    <div class=\"border-left\"></div>\n  </div>\n  <span class=\"btn-text\">Start</span>\n</button>\n```\n\n**scss 部分**\n\n```scss\n@import url(https://fonts.googleapis.com/css?family=Lato);\n\nbody {\n  display: flex;\n  height: 100vh;\n  justify-content: center;\n  align-items: center;\n  text-align: center;\n  background: #1a1e23;\n}\n\n.btn {\n  --hue: 190;\n  --ease-in-duration: 0.25s;\n  --ease-in-exponential: cubic-bezier(0.95, 0.05, 0.795, 0.035);\n  --ease-out-duration: 0.65s;\n  --ease-out-delay: var(--ease-in-duration);\n  --ease-out-exponential: cubic-bezier(0.19, 1, 0.22, 1);\n  position: relative;\n  padding: 1rem 3rem;\n  font-size: 1rem;\n  line-height: 1.5;\n  color: white;\n  text-decoration: none;\n  background-color: hsl(var(--hue), 100%, 41%);\n  border: 1px solid hsl(var(--hue), 100%, 41%);\n  outline: transparent;\n  overflow: hidden;\n  cursor: pointer;\n  user-select: none;\n  white-space: nowrap;\n  transition: 0.25s;\n\n  &:hover {\n    background: hsl(var(--hue), 100%, 31%);\n  }\n\n  &-primary {\n    --hue: 171;\n  }\n\n  &-ghost {\n    color: hsl(var(--hue), 100%, 41%);\n    background-color: transparent;\n    border-color: hsl(var(--hue), 100%, 41%);\n\n    &:hover {\n      color: white;\n    }\n  }\n\n  &-border-stroke {\n    border-color: hsla(var(--hue), 100%, 41%, 0.35);\n\n    .btn-borders {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n\n      .border-top {\n        position: absolute;\n        top: 0;\n        width: 100%;\n        height: 1px;\n        background: hsl(var(--hue), 100%, 41%);\n        transform: scaleX(0);\n        transform-origin: left;\n      }\n\n      .border-right {\n        position: absolute;\n        right: 0;\n        width: 1px;\n        height: 100%;\n        background: hsl(var(--hue), 100%, 41%);\n        transform: scaleY(0);\n        transform-origin: bottom;\n      }\n\n      .border-bottom {\n        position: absolute;\n        bottom: 0;\n        width: 100%;\n        height: 1px;\n        background: hsl(var(--hue), 100%, 41%);\n        transform: scaleX(0);\n        transform-origin: left;\n      }\n\n      .border-left {\n        position: absolute;\n        left: 0;\n        width: 1px;\n        height: 100%;\n        background: hsl(var(--hue), 100%, 41%);\n        transform: scaleY(0);\n        transform-origin: bottom;\n      }\n\n      // when unhover, ease-out left, bottom; ease-in right, top\n\n      .border-left {\n        transition: var(--ease-out-duration) var(--ease-out-delay) var(--ease-out-exponential);\n      }\n      .border-bottom {\n        transition: var(--ease-out-duration) var(--ease-out-delay) var(--ease-out-exponential);\n      }\n\n      .border-right {\n        transition: var(--ease-in-duration) var(--ease-in-exponential);\n      }\n      .border-top {\n        transition: var(--ease-in-duration) var(--ease-in-exponential);\n      }\n    }\n\n    &:hover {\n      color: hsl(var(--hue), 100%, 41%);\n      background: transparent;\n\n      .border-top,\n      .border-bottom {\n        transform: scaleX(1);\n      }\n      .border-left,\n      .border-right {\n        transform: scaleY(1);\n      }\n\n      // when hover, ease-in left, bottom; ease-out right, top\n\n      .border-left {\n        transition: var(--ease-in-duration) var(--ease-in-exponential);\n      }\n      .border-bottom {\n        transition: var(--ease-in-duration) var(--ease-in-exponential);\n      }\n\n      .border-right {\n        transition: var(--ease-out-duration) var(--ease-out-delay) var(--ease-out-exponential);\n      }\n      .border-top {\n        transition: var(--ease-out-duration) var(--ease-out-delay) var(--ease-out-exponential);\n      }\n    }\n  }\n\n  &-text-float-up {\n    &::after {\n      position: absolute;\n      content: attr(data-text);\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      opacity: 0;\n      transform: translateY(35%);\n      transition: 0.25s ease-out;\n    }\n\n    // when hover, ease-in top-text; ease-out bottom-text\n\n    .btn-text {\n      display: block;\n      transition: 0.75s 0.1s var(--ease-out-exponential);\n    }\n\n    &:hover {\n      // when hover, ease-in bottom-text; ease-out top-text\n\n      .btn-text {\n        opacity: 0;\n        transform: translateY(-25%);\n        transition: 0.25s ease-out;\n      }\n\n      &::after {\n        opacity: 1;\n        transform: translateY(0);\n        transition: 0.75s 0.1s var(--ease-out-exponential);\n      }\n    }\n  }\n}\n```\n\n![按钮动画](https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E9%82%A3%E4%BA%9B%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84css%E6%8A%80%E5%B7%A7/button_animation.gif)\n\n---\n\n### 9. 更换旧的网格系统\n\n```scss\n$minColumnWidth: 10rem; // 最小宽度\n$gridGap: 15px; // 网格之间的上下间距\n.grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax($minColumnWidth, 1fr));\n  grid-gap: 2rem;\n\n  & + .grid {\n    margin-top: $gridGap;\n  }\n}\n```\n\n---\n\n### 10. 媒体查询适配刘海屏\n\n```css\n// iphone x/xs/11 pro\n@media only screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) {\n}\n\n//  iphone xr/11\n@media only screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) {\n}\n\n// iphone x/xs/11pro max\n@media only screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) {\n}\n\n// iphone 12mini\n@media only screen and (device-width: 360px) and (device-height: 780px) and (-webkit-device-pixel-ratio: 3) {\n}\n\n// iphone 12/12pro\n@media only screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) {\n}\n\n// iphone 12pro max\n@media only screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) {\n}\n```\n\n---\n\n### 11. Ios 新特性适配带有小横条的机型\n\n```scss\nbody {\n  padding-bottom: constant(safe-area-inset-bottom) !important;\n  padding-bottom: env(safe-area-inset-bottom) !important;\n}\n```\n","source":"_posts/那些开发中的css技巧.md","raw":"---\ntitle: 那些开发中的css技巧\nlayout: post\nseo_title: 那些开发中的css技巧\nkeywords: CSS 开发效率提升\ncategories: \n  - 前端知识积累\n  - CSS\ntags:\n  - 懒人福音\n  - 前端开发\nabbrlink: cc46\ndate: 2021-07-02 12:11:42\ntop: 1\ncopyright: true\n---\n\n在开发中合理利用 css，可以大大提高开发效率。积累以便 Ctrl + C\n\n<!-- more -->\n\n### 1. 去除 safari 浏览器输入框的小图标以及密码输入的钥匙图标\n\n```css\n/* 去掉Safari浏览器下密码输入框自带的小钥匙图标 */\ninput::-webkit-credentials-auto-fill-button {\n  display: none !important;\n  visibility: hidden;\n  pointer-events: none;\n  position: absolute;\n  right: 0;\n}\n\n/* 去掉safari浏览器input右边的小图标/小按钮 */\ninput:focus::-webkit-contacts-auto-fill-button {\n  opacity: 0;\n}\n```\n\n---\n\n### 2. 调整浏览器滚动条的样式\n\n```css\n/*定义滚动条高宽及背景 高宽分别对应横竖滚动条的尺寸*/\n::-webkit-scrollbar {\n  /* width: 5px;\n  height: 5px; */\n}\n\n/*定义滚动条轨道 内阴影+圆角*/\n::-webkit-scrollbar-track {\n  border-radius: 999px;\n  border: 0px solid transparent;\n  box-shadow: 1px 1px 5px rgba(100, 100, 100, 0.2) inset;\n}\n\n/*定义滑块 内阴影+圆角*/\n::-webkit-scrollbar-thumb {\n  border-radius: 999px;\n  border: 0px solid transparent;\n  min-height: 20px;\n  background-clip: content-box;\n  box-shadow: 0 0 0 5px rgba(100, 100, 100, 0.5) inset;\n  -webkit-box-shadow: 0 0 0 5px rgba(100, 100, 100, 0.5) inset;\n}\n\n::-webkit-scrollbar-corner {\n  background: transparent;\n}\n```\n\n---\n\n### 3. 毛玻璃效果\n\n```css\ndiv {\n  background: hsla(0, 0%, 100%, 0.75);\n  -webkit-backdrop-filter: blur(5px);\n  backdrop-filter: blur(5px);\n}\n```\n\n---\n\n### 4. 手机端点开多选框出现蓝色块\n\n```css\n* {\n  -webkit-tap-highlight-color: transparent;\n}\n```\n\n---\n\n### 5. 鼠标放上出现一个白色的框(带动画)\n\n```css\n/* 默认样式 -- 不显示 */\n.border:before {\n  content: '';\n  position: absolute;\n  left: 10px;\n  top: 10px;\n  right: 10px;\n  bottom: 10px;\n  box-sizing: border-box;\n  border: 3px solid #ffffff;\n  transform: scale(0);\n  opacity: 0;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) 0s;\n}\n\n/* hover时改变 */\n.border:hover:before {\n  transform: scale(1);\n  opacity: 1;\n}\n```\n\n**效果图**\n![边框效果图](https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E9%82%A3%E4%BA%9B%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84css%E6%8A%80%E5%B7%A7/border-animation.gif)\n\n---\n\n### 6. flex 布局实现简单的瀑布流\n\n**html 部分**\n\n```html\n<!-- 这里需要将文档结构处理成类似的结构 -->\n<div class=\"container\">\n  <div class=\"container-item\">\n    <img src=\"*&^%^%&%*&*\" />\n    <h4>标题1</h4>\n    <p>这是item1的描述信息</p>\n  </div>\n  <div class=\"container-item\">\n    <img src=\"*&^%^%&%*&*\" />\n    <h4>标题2</h4>\n    <p>这是item2的描述信息</p>\n  </div>\n  <div class=\"container-item\">\n    <img src=\"*&^%^%&%*&*\" />\n    <h4>标题3</h4>\n    <p>这是item3的描述信息</p>\n  </div>\n  <div class=\"container-item\">\n    <img src=\"*&^%^%&%*&*\" />\n    <h4>标题4</h4>\n    <p>这是item4的描述信息</p>\n  </div>\n</div>\n```\n\n**css 部分**\n\n```scss\n.container {\n  width: 750rpx;\n  margin: 0 auto;\n  column-count: 4; /* 瀑布流的列数 */\n  column-gap: 0; /* 每列之间的间距 如： 10px;*/\n\n  &-item {\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n  }\n}\n```\n\n### 7. 一个交错动画案例（加载...）\n\n**html 部分**\n\n```htm\n<div class=\"loading\">\n  <div class=\"dot\"></div>\n  <div class=\"dot\"></div>\n  <div class=\"dot\"></div>\n  <div class=\"dot\"></div>\n  <div class=\"dot\"></div>\n</div>\n```\n\n**scss 部分**\n\n```scss\nbody {\n  display: flex;\n  height: 100vh;\n  justify-content: center;\n  align-items: center;\n  background: #222;\n}\n\n.loading {\n  $colors: #7ef9ff, #89cff0, #4682b4, #0f52ba, #000080;\n  display: flex;\n\n  .dot {\n    position: relative;\n    width: 2em;\n    height: 2em;\n    margin: 0.8em;\n    border-radius: 50%;\n\n    &::before {\n      position: absolute;\n      content: '';\n      width: 100%;\n      height: 100%;\n      background: inherit;\n      border-radius: inherit;\n      animation: wave 2s ease-out infinite;\n    }\n\n    @for $i from 1 through 5 {\n      &:nth-child(#{$i}) {\n        background: nth($colors, $i);\n\n        &::before {\n          animation-delay: $i * 0.2s;\n        }\n      }\n    }\n  }\n}\n\n@keyframes wave {\n  50%,\n  75% {\n    transform: scale(2.5);\n  }\n\n  80%,\n  100% {\n    opacity: 0;\n  }\n}\n```\n\n![交错动画演示](https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E9%82%A3%E4%BA%9B%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84css%E6%8A%80%E5%B7%A7/loading_animation.gif)\n\n---\n\n### 8. 利用伪类实现按钮边框特效\n\n**html 部分**\n\n```html\n<button data-text=\"Start\" class=\"btn btn-primary btn-ghost btn-border-stroke  btn-text-float-up\">\n  <div class=\"btn-borders\">\n    <div class=\"border-top\"></div>\n    <div class=\"border-right\"></div>\n    <div class=\"border-bottom\"></div>\n    <div class=\"border-left\"></div>\n  </div>\n  <span class=\"btn-text\">Start</span>\n</button>\n```\n\n**scss 部分**\n\n```scss\n@import url(https://fonts.googleapis.com/css?family=Lato);\n\nbody {\n  display: flex;\n  height: 100vh;\n  justify-content: center;\n  align-items: center;\n  text-align: center;\n  background: #1a1e23;\n}\n\n.btn {\n  --hue: 190;\n  --ease-in-duration: 0.25s;\n  --ease-in-exponential: cubic-bezier(0.95, 0.05, 0.795, 0.035);\n  --ease-out-duration: 0.65s;\n  --ease-out-delay: var(--ease-in-duration);\n  --ease-out-exponential: cubic-bezier(0.19, 1, 0.22, 1);\n  position: relative;\n  padding: 1rem 3rem;\n  font-size: 1rem;\n  line-height: 1.5;\n  color: white;\n  text-decoration: none;\n  background-color: hsl(var(--hue), 100%, 41%);\n  border: 1px solid hsl(var(--hue), 100%, 41%);\n  outline: transparent;\n  overflow: hidden;\n  cursor: pointer;\n  user-select: none;\n  white-space: nowrap;\n  transition: 0.25s;\n\n  &:hover {\n    background: hsl(var(--hue), 100%, 31%);\n  }\n\n  &-primary {\n    --hue: 171;\n  }\n\n  &-ghost {\n    color: hsl(var(--hue), 100%, 41%);\n    background-color: transparent;\n    border-color: hsl(var(--hue), 100%, 41%);\n\n    &:hover {\n      color: white;\n    }\n  }\n\n  &-border-stroke {\n    border-color: hsla(var(--hue), 100%, 41%, 0.35);\n\n    .btn-borders {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n\n      .border-top {\n        position: absolute;\n        top: 0;\n        width: 100%;\n        height: 1px;\n        background: hsl(var(--hue), 100%, 41%);\n        transform: scaleX(0);\n        transform-origin: left;\n      }\n\n      .border-right {\n        position: absolute;\n        right: 0;\n        width: 1px;\n        height: 100%;\n        background: hsl(var(--hue), 100%, 41%);\n        transform: scaleY(0);\n        transform-origin: bottom;\n      }\n\n      .border-bottom {\n        position: absolute;\n        bottom: 0;\n        width: 100%;\n        height: 1px;\n        background: hsl(var(--hue), 100%, 41%);\n        transform: scaleX(0);\n        transform-origin: left;\n      }\n\n      .border-left {\n        position: absolute;\n        left: 0;\n        width: 1px;\n        height: 100%;\n        background: hsl(var(--hue), 100%, 41%);\n        transform: scaleY(0);\n        transform-origin: bottom;\n      }\n\n      // when unhover, ease-out left, bottom; ease-in right, top\n\n      .border-left {\n        transition: var(--ease-out-duration) var(--ease-out-delay) var(--ease-out-exponential);\n      }\n      .border-bottom {\n        transition: var(--ease-out-duration) var(--ease-out-delay) var(--ease-out-exponential);\n      }\n\n      .border-right {\n        transition: var(--ease-in-duration) var(--ease-in-exponential);\n      }\n      .border-top {\n        transition: var(--ease-in-duration) var(--ease-in-exponential);\n      }\n    }\n\n    &:hover {\n      color: hsl(var(--hue), 100%, 41%);\n      background: transparent;\n\n      .border-top,\n      .border-bottom {\n        transform: scaleX(1);\n      }\n      .border-left,\n      .border-right {\n        transform: scaleY(1);\n      }\n\n      // when hover, ease-in left, bottom; ease-out right, top\n\n      .border-left {\n        transition: var(--ease-in-duration) var(--ease-in-exponential);\n      }\n      .border-bottom {\n        transition: var(--ease-in-duration) var(--ease-in-exponential);\n      }\n\n      .border-right {\n        transition: var(--ease-out-duration) var(--ease-out-delay) var(--ease-out-exponential);\n      }\n      .border-top {\n        transition: var(--ease-out-duration) var(--ease-out-delay) var(--ease-out-exponential);\n      }\n    }\n  }\n\n  &-text-float-up {\n    &::after {\n      position: absolute;\n      content: attr(data-text);\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      opacity: 0;\n      transform: translateY(35%);\n      transition: 0.25s ease-out;\n    }\n\n    // when hover, ease-in top-text; ease-out bottom-text\n\n    .btn-text {\n      display: block;\n      transition: 0.75s 0.1s var(--ease-out-exponential);\n    }\n\n    &:hover {\n      // when hover, ease-in bottom-text; ease-out top-text\n\n      .btn-text {\n        opacity: 0;\n        transform: translateY(-25%);\n        transition: 0.25s ease-out;\n      }\n\n      &::after {\n        opacity: 1;\n        transform: translateY(0);\n        transition: 0.75s 0.1s var(--ease-out-exponential);\n      }\n    }\n  }\n}\n```\n\n![按钮动画](https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E9%82%A3%E4%BA%9B%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84css%E6%8A%80%E5%B7%A7/button_animation.gif)\n\n---\n\n### 9. 更换旧的网格系统\n\n```scss\n$minColumnWidth: 10rem; // 最小宽度\n$gridGap: 15px; // 网格之间的上下间距\n.grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax($minColumnWidth, 1fr));\n  grid-gap: 2rem;\n\n  & + .grid {\n    margin-top: $gridGap;\n  }\n}\n```\n\n---\n\n### 10. 媒体查询适配刘海屏\n\n```css\n// iphone x/xs/11 pro\n@media only screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) {\n}\n\n//  iphone xr/11\n@media only screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) {\n}\n\n// iphone x/xs/11pro max\n@media only screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) {\n}\n\n// iphone 12mini\n@media only screen and (device-width: 360px) and (device-height: 780px) and (-webkit-device-pixel-ratio: 3) {\n}\n\n// iphone 12/12pro\n@media only screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) {\n}\n\n// iphone 12pro max\n@media only screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) {\n}\n```\n\n---\n\n### 11. Ios 新特性适配带有小横条的机型\n\n```scss\nbody {\n  padding-bottom: constant(safe-area-inset-bottom) !important;\n  padding-bottom: env(safe-area-inset-bottom) !important;\n}\n```\n","slug":"那些开发中的css技巧","published":1,"updated":"2022-08-26T01:42:59.884Z","comments":1,"photos":[],"link":"","_id":"cl79tdvvn001u5d9k782khzoz","content":"<p>在开发中合理利用 css，可以大大提高开发效率。积累以便 Ctrl + C</p>\n<span id=\"more\"></span>\n\n<h3 id=\"1-去除-safari-浏览器输入框的小图标以及密码输入的钥匙图标\"><a href=\"#1-去除-safari-浏览器输入框的小图标以及密码输入的钥匙图标\" class=\"headerlink\" title=\"1. 去除 safari 浏览器输入框的小图标以及密码输入的钥匙图标\"></a>1. 去除 safari 浏览器输入框的小图标以及密码输入的钥匙图标</h3><figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 去掉Safari浏览器下密码输入框自带的小钥匙图标 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">input</span>::-webkit-credentials-auto-fill-button &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: none <span class=\"meta\">!important</span>;</span><br><span class=\"line\">  <span class=\"attribute\">visibility</span>: hidden;</span><br><span class=\"line\">  <span class=\"attribute\">pointer-events</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">  <span class=\"attribute\">right</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 去掉safari浏览器input右边的小图标/小按钮 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">input</span><span class=\"selector-pseudo\">:focus</span>::-webkit-contacts-auto-fill-button &#123;</span><br><span class=\"line\">  <span class=\"attribute\">opacity</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2-调整浏览器滚动条的样式\"><a href=\"#2-调整浏览器滚动条的样式\" class=\"headerlink\" title=\"2. 调整浏览器滚动条的样式\"></a>2. 调整浏览器滚动条的样式</h3><figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*定义滚动条高宽及背景 高宽分别对应横竖滚动条的尺寸*/</span></span><br><span class=\"line\">::-webkit-scrollbar &#123;</span><br><span class=\"line\">  <span class=\"comment\">/* width: 5px;</span></span><br><span class=\"line\"><span class=\"comment\">  height: 5px; */</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*定义滚动条轨道 内阴影+圆角*/</span></span><br><span class=\"line\">::-webkit-scrollbar-track &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border-radius</span>: <span class=\"number\">999px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">0px</span> solid transparent;</span><br><span class=\"line\">  <span class=\"attribute\">box-shadow</span>: <span class=\"number\">1px</span> <span class=\"number\">1px</span> <span class=\"number\">5px</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">0.2</span>) inset;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*定义滑块 内阴影+圆角*/</span></span><br><span class=\"line\">::-webkit-scrollbar-thumb &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border-radius</span>: <span class=\"number\">999px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">0px</span> solid transparent;</span><br><span class=\"line\">  <span class=\"attribute\">min-height</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background-clip</span>: content-box;</span><br><span class=\"line\">  <span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">5px</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">0.5</span>) inset;</span><br><span class=\"line\">  -webkit-<span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">5px</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">0.5</span>) inset;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">::-webkit-scrollbar-corner &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: transparent;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"3-毛玻璃效果\"><a href=\"#3-毛玻璃效果\" class=\"headerlink\" title=\"3. 毛玻璃效果\"></a>3. 毛玻璃效果</h3><figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">div</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"built_in\">hsla</span>(<span class=\"number\">0</span>, <span class=\"number\">0%</span>, <span class=\"number\">100%</span>, <span class=\"number\">0.75</span>);</span><br><span class=\"line\">  -webkit-backdrop-<span class=\"attribute\">filter</span>: <span class=\"built_in\">blur</span>(<span class=\"number\">5px</span>);</span><br><span class=\"line\">  backdrop-<span class=\"attribute\">filter</span>: <span class=\"built_in\">blur</span>(<span class=\"number\">5px</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"4-手机端点开多选框出现蓝色块\"><a href=\"#4-手机端点开多选框出现蓝色块\" class=\"headerlink\" title=\"4. 手机端点开多选框出现蓝色块\"></a>4. 手机端点开多选框出现蓝色块</h3><figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\">* &#123;</span><br><span class=\"line\">  -webkit-tap-highlight-<span class=\"attribute\">color</span>: transparent;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"5-鼠标放上出现一个白色的框-带动画\"><a href=\"#5-鼠标放上出现一个白色的框-带动画\" class=\"headerlink\" title=\"5. 鼠标放上出现一个白色的框(带动画)\"></a>5. 鼠标放上出现一个白色的框(带动画)</h3><figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 默认样式 -- 不显示 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.border</span><span class=\"selector-pseudo\">:before</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">content</span>: <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">  <span class=\"attribute\">left</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">top</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">right</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">bottom</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">box-sizing</span>: border-box;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">3px</span> solid <span class=\"number\">#ffffff</span>;</span><br><span class=\"line\">  <span class=\"attribute\">transform</span>: <span class=\"built_in\">scale</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">  <span class=\"attribute\">opacity</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">transition</span>: all <span class=\"number\">0.3s</span> <span class=\"built_in\">cubic-bezier</span>(<span class=\"number\">0.4</span>, <span class=\"number\">0</span>, <span class=\"number\">0.2</span>, <span class=\"number\">1</span>) <span class=\"number\">0s</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* hover时改变 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.border</span><span class=\"selector-pseudo\">:hover</span><span class=\"selector-pseudo\">:before</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">transform</span>: <span class=\"built_in\">scale</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"attribute\">opacity</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>效果图</strong><br><img src=\"https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E9%82%A3%E4%BA%9B%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84css%E6%8A%80%E5%B7%A7/border-animation.gif\" alt=\"边框效果图\"></p>\n<hr>\n<h3 id=\"6-flex-布局实现简单的瀑布流\"><a href=\"#6-flex-布局实现简单的瀑布流\" class=\"headerlink\" title=\"6. flex 布局实现简单的瀑布流\"></a>6. flex 布局实现简单的瀑布流</h3><p><strong>html 部分</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 这里需要将文档结构处理成类似的结构 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container-item&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;*&amp;^%^%&amp;%*&amp;*&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h4</span>&gt;</span>标题1<span class=\"tag\">&lt;/<span class=\"name\">h4</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>这是item1的描述信息<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container-item&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;*&amp;^%^%&amp;%*&amp;*&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h4</span>&gt;</span>标题2<span class=\"tag\">&lt;/<span class=\"name\">h4</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>这是item2的描述信息<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container-item&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;*&amp;^%^%&amp;%*&amp;*&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h4</span>&gt;</span>标题3<span class=\"tag\">&lt;/<span class=\"name\">h4</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>这是item3的描述信息<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container-item&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;*&amp;^%^%&amp;%*&amp;*&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h4</span>&gt;</span>标题4<span class=\"tag\">&lt;/<span class=\"name\">h4</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>这是item4的描述信息<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>css 部分</strong></p>\n<figure class=\"highlight scss\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">750</span>rpx;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto;</span><br><span class=\"line\">  <span class=\"attribute\">column-count</span>: <span class=\"number\">4</span>; <span class=\"comment\">/* 瀑布流的列数 */</span></span><br><span class=\"line\">  <span class=\"attribute\">column-gap</span>: <span class=\"number\">0</span>; <span class=\"comment\">/* 每列之间的间距 如： 10px;*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;-item &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">    <span class=\"attribute\">flex-direction</span>: column;</span><br><span class=\"line\">    <span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">    <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7-一个交错动画案例（加载…）\"><a href=\"#7-一个交错动画案例（加载…）\" class=\"headerlink\" title=\"7. 一个交错动画案例（加载…）\"></a>7. 一个交错动画案例（加载…）</h3><p><strong>html 部分</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;div class=&quot;loading&quot;&gt;</span><br><span class=\"line\">  &lt;div class=&quot;dot&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">  &lt;div class=&quot;dot&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">  &lt;div class=&quot;dot&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">  &lt;div class=&quot;dot&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">  &lt;div class=&quot;dot&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br></pre></td></tr></table></figure>\n\n<p><strong>scss 部分</strong></p>\n<figure class=\"highlight scss\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100vh</span>;</span><br><span class=\"line\">  <span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">  <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"number\">#222</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.loading</span> &#123;</span><br><span class=\"line\">  <span class=\"variable\">$colors</span>: <span class=\"number\">#7ef9ff</span>, <span class=\"number\">#89cff0</span>, <span class=\"number\">#4682b4</span>, <span class=\"number\">#0f52ba</span>, <span class=\"number\">#000080</span>;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.dot</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">2em</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">2em</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"number\">0.8em</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &amp;<span class=\"selector-pseudo\">::before</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">      <span class=\"attribute\">content</span>: <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">      <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">      <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">      <span class=\"attribute\">background</span>: inherit;</span><br><span class=\"line\">      <span class=\"attribute\">border-radius</span>: inherit;</span><br><span class=\"line\">      <span class=\"attribute\">animation</span>: wave <span class=\"number\">2s</span> ease-out infinite;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">@for</span> <span class=\"variable\">$i</span> from <span class=\"number\">1</span> through <span class=\"number\">5</span> &#123;</span><br><span class=\"line\">      &amp;<span class=\"selector-pseudo\">:nth-child</span>(#&#123;$i&#125;) &#123;</span><br><span class=\"line\">        <span class=\"attribute\">background</span>: <span class=\"built_in\">nth</span>(<span class=\"variable\">$colors</span>, <span class=\"variable\">$i</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        &amp;<span class=\"selector-pseudo\">::before</span> &#123;</span><br><span class=\"line\">          <span class=\"attribute\">animation-delay</span>: <span class=\"variable\">$i</span> * <span class=\"number\">0.2s</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@keyframes</span> wave &#123;</span><br><span class=\"line\">  <span class=\"number\">50%</span>,</span><br><span class=\"line\">  <span class=\"number\">75%</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: <span class=\"built_in\">scale</span>(<span class=\"number\">2.5</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"number\">80%</span>,</span><br><span class=\"line\">  <span class=\"number\">100%</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">opacity</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E9%82%A3%E4%BA%9B%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84css%E6%8A%80%E5%B7%A7/loading_animation.gif\" alt=\"交错动画演示\"></p>\n<hr>\n<h3 id=\"8-利用伪类实现按钮边框特效\"><a href=\"#8-利用伪类实现按钮边框特效\" class=\"headerlink\" title=\"8. 利用伪类实现按钮边框特效\"></a>8. 利用伪类实现按钮边框特效</h3><p><strong>html 部分</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">data-text</span>=<span class=\"string\">&quot;Start&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btn btn-primary btn-ghost btn-border-stroke  btn-text-float-up&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btn-borders&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;border-top&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;border-right&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;border-bottom&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;border-left&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btn-text&quot;</span>&gt;</span>Start<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>scss 部分</strong></p>\n<figure class=\"highlight scss\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@import</span> url(<span class=\"attribute\">https</span>://fonts.googleapis.com/css?family=Lato);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100vh</span>;</span><br><span class=\"line\">  <span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">  <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">  <span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"number\">#1a1e23</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.btn</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">--hue</span>: <span class=\"number\">190</span>;</span><br><span class=\"line\">  <span class=\"attr\">--ease-in-duration</span>: <span class=\"number\">0.25s</span>;</span><br><span class=\"line\">  <span class=\"attr\">--ease-in-exponential</span>: <span class=\"built_in\">cubic-bezier</span>(<span class=\"number\">0.95</span>, <span class=\"number\">0.05</span>, <span class=\"number\">0.795</span>, <span class=\"number\">0.035</span>);</span><br><span class=\"line\">  <span class=\"attr\">--ease-out-duration</span>: <span class=\"number\">0.65s</span>;</span><br><span class=\"line\">  <span class=\"attr\">--ease-out-delay</span>: <span class=\"built_in\">var</span>(--ease-in-duration);</span><br><span class=\"line\">  <span class=\"attr\">--ease-out-exponential</span>: <span class=\"built_in\">cubic-bezier</span>(<span class=\"number\">0.19</span>, <span class=\"number\">1</span>, <span class=\"number\">0.22</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">1rem</span> <span class=\"number\">3rem</span>;</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\">  <span class=\"attribute\">line-height</span>: <span class=\"number\">1.5</span>;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: white;</span><br><span class=\"line\">  <span class=\"attribute\">text-decoration</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: <span class=\"built_in\">hsl</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">41%</span>);</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"built_in\">hsl</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">41%</span>);</span><br><span class=\"line\">  <span class=\"attribute\">outline</span>: transparent;</span><br><span class=\"line\">  <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">  <span class=\"attribute\">cursor</span>: pointer;</span><br><span class=\"line\">  user-select: none;</span><br><span class=\"line\">  <span class=\"attribute\">white-space</span>: nowrap;</span><br><span class=\"line\">  <span class=\"attribute\">transition</span>: <span class=\"number\">0.25s</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;<span class=\"selector-pseudo\">:hover</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"built_in\">hsl</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">31%</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;-primary &#123;</span><br><span class=\"line\">    <span class=\"attr\">--hue</span>: <span class=\"number\">171</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;-ghost &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"built_in\">hsl</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">41%</span>);</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: transparent;</span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: <span class=\"built_in\">hsl</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">41%</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &amp;<span class=\"selector-pseudo\">:hover</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">color</span>: white;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;-<span class=\"attribute\">border</span>-stroke &#123;</span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: <span class=\"built_in\">hsla</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">41%</span>, <span class=\"number\">0.35</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-class\">.btn-borders</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">      <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">      <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.border-top</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">        <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">1px</span>;</span><br><span class=\"line\">        <span class=\"attribute\">background</span>: <span class=\"built_in\">hsl</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">41%</span>);</span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: <span class=\"built_in\">scaleX</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"attribute\">transform-origin</span>: left;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.border-right</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">        <span class=\"attribute\">right</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"attribute\">width</span>: <span class=\"number\">1px</span>;</span><br><span class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">        <span class=\"attribute\">background</span>: <span class=\"built_in\">hsl</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">41%</span>);</span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: <span class=\"built_in\">scaleY</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"attribute\">transform-origin</span>: bottom;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.border-bottom</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">        <span class=\"attribute\">bottom</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">1px</span>;</span><br><span class=\"line\">        <span class=\"attribute\">background</span>: <span class=\"built_in\">hsl</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">41%</span>);</span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: <span class=\"built_in\">scaleX</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"attribute\">transform-origin</span>: left;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.border-left</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">        <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"attribute\">width</span>: <span class=\"number\">1px</span>;</span><br><span class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">        <span class=\"attribute\">background</span>: <span class=\"built_in\">hsl</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">41%</span>);</span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: <span class=\"built_in\">scaleY</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"attribute\">transform-origin</span>: bottom;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// when unhover, ease-out left, bottom; ease-in right, top</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.border-left</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">transition</span>: <span class=\"built_in\">var</span>(--ease-out-duration) <span class=\"built_in\">var</span>(--ease-out-delay) <span class=\"built_in\">var</span>(--ease-out-exponential);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"selector-class\">.border-bottom</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">transition</span>: <span class=\"built_in\">var</span>(--ease-out-duration) <span class=\"built_in\">var</span>(--ease-out-delay) <span class=\"built_in\">var</span>(--ease-out-exponential);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.border-right</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">transition</span>: <span class=\"built_in\">var</span>(--ease-in-duration) <span class=\"built_in\">var</span>(--ease-in-exponential);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"selector-class\">.border-top</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">transition</span>: <span class=\"built_in\">var</span>(--ease-in-duration) <span class=\"built_in\">var</span>(--ease-in-exponential);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &amp;<span class=\"selector-pseudo\">:hover</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"built_in\">hsl</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">41%</span>);</span><br><span class=\"line\">      <span class=\"attribute\">background</span>: transparent;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.border-top</span>,</span><br><span class=\"line\">      <span class=\"selector-class\">.border-bottom</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: <span class=\"built_in\">scaleX</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"selector-class\">.border-left</span>,</span><br><span class=\"line\">      <span class=\"selector-class\">.border-right</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: <span class=\"built_in\">scaleY</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// when hover, ease-in left, bottom; ease-out right, top</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.border-left</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">transition</span>: <span class=\"built_in\">var</span>(--ease-in-duration) <span class=\"built_in\">var</span>(--ease-in-exponential);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"selector-class\">.border-bottom</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">transition</span>: <span class=\"built_in\">var</span>(--ease-in-duration) <span class=\"built_in\">var</span>(--ease-in-exponential);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.border-right</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">transition</span>: <span class=\"built_in\">var</span>(--ease-out-duration) <span class=\"built_in\">var</span>(--ease-out-delay) <span class=\"built_in\">var</span>(--ease-out-exponential);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"selector-class\">.border-top</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">transition</span>: <span class=\"built_in\">var</span>(--ease-out-duration) <span class=\"built_in\">var</span>(--ease-out-delay) <span class=\"built_in\">var</span>(--ease-out-exponential);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;-text-<span class=\"attribute\">float</span>-up &#123;</span><br><span class=\"line\">    &amp;<span class=\"selector-pseudo\">::after</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">      <span class=\"attribute\">content</span>: <span class=\"built_in\">attr</span>(data-text);</span><br><span class=\"line\">      <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">      <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">      <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">      <span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">      <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">      <span class=\"attribute\">opacity</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"attribute\">transform</span>: <span class=\"built_in\">translateY</span>(<span class=\"number\">35%</span>);</span><br><span class=\"line\">      <span class=\"attribute\">transition</span>: <span class=\"number\">0.25s</span> ease-out;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// when hover, ease-in top-text; ease-out bottom-text</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-class\">.btn-text</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">      <span class=\"attribute\">transition</span>: <span class=\"number\">0.75s</span> <span class=\"number\">0.1s</span> <span class=\"built_in\">var</span>(--ease-out-exponential);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &amp;<span class=\"selector-pseudo\">:hover</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// when hover, ease-in bottom-text; ease-out top-text</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.btn-text</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">opacity</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: <span class=\"built_in\">translateY</span>(-<span class=\"number\">25%</span>);</span><br><span class=\"line\">        <span class=\"attribute\">transition</span>: <span class=\"number\">0.25s</span> ease-out;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      &amp;<span class=\"selector-pseudo\">::after</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">opacity</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: <span class=\"built_in\">translateY</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"attribute\">transition</span>: <span class=\"number\">0.75s</span> <span class=\"number\">0.1s</span> <span class=\"built_in\">var</span>(--ease-out-exponential);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E9%82%A3%E4%BA%9B%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84css%E6%8A%80%E5%B7%A7/button_animation.gif\" alt=\"按钮动画\"></p>\n<hr>\n<h3 id=\"9-更换旧的网格系统\"><a href=\"#9-更换旧的网格系统\" class=\"headerlink\" title=\"9. 更换旧的网格系统\"></a>9. 更换旧的网格系统</h3><figure class=\"highlight scss\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$minColumnWidth</span>: <span class=\"number\">10rem</span>; <span class=\"comment\">// 最小宽度</span></span><br><span class=\"line\"><span class=\"variable\">$gridGap</span>: <span class=\"number\">15px</span>; <span class=\"comment\">// 网格之间的上下间距</span></span><br><span class=\"line\"><span class=\"selector-class\">.grid</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: grid;</span><br><span class=\"line\">  <span class=\"attribute\">grid-template-columns</span>: <span class=\"built_in\">repeat</span>(auto-fit, <span class=\"built_in\">minmax</span>(<span class=\"variable\">$minColumnWidth</span>, <span class=\"number\">1</span>fr));</span><br><span class=\"line\">  <span class=\"attribute\">grid-gap</span>: <span class=\"number\">2rem</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp; + <span class=\"selector-class\">.grid</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: <span class=\"variable\">$gridGap</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"10-媒体查询适配刘海屏\"><a href=\"#10-媒体查询适配刘海屏\" class=\"headerlink\" title=\"10. 媒体查询适配刘海屏\"></a>10. 媒体查询适配刘海屏</h3><figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\">// iphone x/xs/<span class=\"number\">11</span> pro</span><br><span class=\"line\"><span class=\"keyword\">@media</span> <span class=\"keyword\">only</span> screen <span class=\"keyword\">and</span> (<span class=\"attribute\">device-width</span>: <span class=\"number\">375px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">device-height</span>: <span class=\"number\">812px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">-webkit-device-pixel-ratio</span>: <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">//  iphone xr/<span class=\"number\">11</span></span><br><span class=\"line\"><span class=\"keyword\">@media</span> <span class=\"keyword\">only</span> screen <span class=\"keyword\">and</span> (<span class=\"attribute\">device-width</span>: <span class=\"number\">414px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">device-height</span>: <span class=\"number\">896px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">-webkit-device-pixel-ratio</span>: <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// iphone x/xs/<span class=\"number\">11</span>pro max</span><br><span class=\"line\"><span class=\"keyword\">@media</span> <span class=\"keyword\">only</span> screen <span class=\"keyword\">and</span> (<span class=\"attribute\">device-width</span>: <span class=\"number\">414px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">device-height</span>: <span class=\"number\">896px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">-webkit-device-pixel-ratio</span>: <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// iphone <span class=\"number\">12</span>mini</span><br><span class=\"line\"><span class=\"keyword\">@media</span> <span class=\"keyword\">only</span> screen <span class=\"keyword\">and</span> (<span class=\"attribute\">device-width</span>: <span class=\"number\">360px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">device-height</span>: <span class=\"number\">780px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">-webkit-device-pixel-ratio</span>: <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// iphone <span class=\"number\">12</span>/<span class=\"number\">12</span>pro</span><br><span class=\"line\"><span class=\"keyword\">@media</span> <span class=\"keyword\">only</span> screen <span class=\"keyword\">and</span> (<span class=\"attribute\">device-width</span>: <span class=\"number\">390px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">device-height</span>: <span class=\"number\">844px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">-webkit-device-pixel-ratio</span>: <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// iphone <span class=\"number\">12</span>pro max</span><br><span class=\"line\"><span class=\"keyword\">@media</span> <span class=\"keyword\">only</span> screen <span class=\"keyword\">and</span> (<span class=\"attribute\">device-width</span>: <span class=\"number\">428px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">device-height</span>: <span class=\"number\">926px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">-webkit-device-pixel-ratio</span>: <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"11-Ios-新特性适配带有小横条的机型\"><a href=\"#11-Ios-新特性适配带有小横条的机型\" class=\"headerlink\" title=\"11. Ios 新特性适配带有小横条的机型\"></a>11. Ios 新特性适配带有小横条的机型</h3><figure class=\"highlight scss\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">padding-bottom</span>: <span class=\"built_in\">constant</span>(safe-area-inset-bottom) <span class=\"meta\">!important</span>;</span><br><span class=\"line\">  <span class=\"attribute\">padding-bottom</span>: <span class=\"built_in\">env</span>(safe-area-inset-bottom) <span class=\"meta\">!important</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>在开发中合理利用 css，可以大大提高开发效率。积累以便 Ctrl + C</p>","more":"<h3 id=\"1-去除-safari-浏览器输入框的小图标以及密码输入的钥匙图标\"><a href=\"#1-去除-safari-浏览器输入框的小图标以及密码输入的钥匙图标\" class=\"headerlink\" title=\"1. 去除 safari 浏览器输入框的小图标以及密码输入的钥匙图标\"></a>1. 去除 safari 浏览器输入框的小图标以及密码输入的钥匙图标</h3><figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 去掉Safari浏览器下密码输入框自带的小钥匙图标 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">input</span>::-webkit-credentials-auto-fill-button &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: none <span class=\"meta\">!important</span>;</span><br><span class=\"line\">  <span class=\"attribute\">visibility</span>: hidden;</span><br><span class=\"line\">  <span class=\"attribute\">pointer-events</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">  <span class=\"attribute\">right</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 去掉safari浏览器input右边的小图标/小按钮 */</span></span><br><span class=\"line\"><span class=\"selector-tag\">input</span><span class=\"selector-pseudo\">:focus</span>::-webkit-contacts-auto-fill-button &#123;</span><br><span class=\"line\">  <span class=\"attribute\">opacity</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2-调整浏览器滚动条的样式\"><a href=\"#2-调整浏览器滚动条的样式\" class=\"headerlink\" title=\"2. 调整浏览器滚动条的样式\"></a>2. 调整浏览器滚动条的样式</h3><figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*定义滚动条高宽及背景 高宽分别对应横竖滚动条的尺寸*/</span></span><br><span class=\"line\">::-webkit-scrollbar &#123;</span><br><span class=\"line\">  <span class=\"comment\">/* width: 5px;</span></span><br><span class=\"line\"><span class=\"comment\">  height: 5px; */</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*定义滚动条轨道 内阴影+圆角*/</span></span><br><span class=\"line\">::-webkit-scrollbar-track &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border-radius</span>: <span class=\"number\">999px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">0px</span> solid transparent;</span><br><span class=\"line\">  <span class=\"attribute\">box-shadow</span>: <span class=\"number\">1px</span> <span class=\"number\">1px</span> <span class=\"number\">5px</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">0.2</span>) inset;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*定义滑块 内阴影+圆角*/</span></span><br><span class=\"line\">::-webkit-scrollbar-thumb &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border-radius</span>: <span class=\"number\">999px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">0px</span> solid transparent;</span><br><span class=\"line\">  <span class=\"attribute\">min-height</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background-clip</span>: content-box;</span><br><span class=\"line\">  <span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">5px</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">0.5</span>) inset;</span><br><span class=\"line\">  -webkit-<span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">5px</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">0.5</span>) inset;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">::-webkit-scrollbar-corner &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: transparent;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"3-毛玻璃效果\"><a href=\"#3-毛玻璃效果\" class=\"headerlink\" title=\"3. 毛玻璃效果\"></a>3. 毛玻璃效果</h3><figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">div</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"built_in\">hsla</span>(<span class=\"number\">0</span>, <span class=\"number\">0%</span>, <span class=\"number\">100%</span>, <span class=\"number\">0.75</span>);</span><br><span class=\"line\">  -webkit-backdrop-<span class=\"attribute\">filter</span>: <span class=\"built_in\">blur</span>(<span class=\"number\">5px</span>);</span><br><span class=\"line\">  backdrop-<span class=\"attribute\">filter</span>: <span class=\"built_in\">blur</span>(<span class=\"number\">5px</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"4-手机端点开多选框出现蓝色块\"><a href=\"#4-手机端点开多选框出现蓝色块\" class=\"headerlink\" title=\"4. 手机端点开多选框出现蓝色块\"></a>4. 手机端点开多选框出现蓝色块</h3><figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\">* &#123;</span><br><span class=\"line\">  -webkit-tap-highlight-<span class=\"attribute\">color</span>: transparent;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"5-鼠标放上出现一个白色的框-带动画\"><a href=\"#5-鼠标放上出现一个白色的框-带动画\" class=\"headerlink\" title=\"5. 鼠标放上出现一个白色的框(带动画)\"></a>5. 鼠标放上出现一个白色的框(带动画)</h3><figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 默认样式 -- 不显示 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.border</span><span class=\"selector-pseudo\">:before</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">content</span>: <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">  <span class=\"attribute\">left</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">top</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">right</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">bottom</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">box-sizing</span>: border-box;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">3px</span> solid <span class=\"number\">#ffffff</span>;</span><br><span class=\"line\">  <span class=\"attribute\">transform</span>: <span class=\"built_in\">scale</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">  <span class=\"attribute\">opacity</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">transition</span>: all <span class=\"number\">0.3s</span> <span class=\"built_in\">cubic-bezier</span>(<span class=\"number\">0.4</span>, <span class=\"number\">0</span>, <span class=\"number\">0.2</span>, <span class=\"number\">1</span>) <span class=\"number\">0s</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* hover时改变 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.border</span><span class=\"selector-pseudo\">:hover</span><span class=\"selector-pseudo\">:before</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">transform</span>: <span class=\"built_in\">scale</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"attribute\">opacity</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>效果图</strong><br><img src=\"https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E9%82%A3%E4%BA%9B%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84css%E6%8A%80%E5%B7%A7/border-animation.gif\" alt=\"边框效果图\"></p>\n<hr>\n<h3 id=\"6-flex-布局实现简单的瀑布流\"><a href=\"#6-flex-布局实现简单的瀑布流\" class=\"headerlink\" title=\"6. flex 布局实现简单的瀑布流\"></a>6. flex 布局实现简单的瀑布流</h3><p><strong>html 部分</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 这里需要将文档结构处理成类似的结构 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container-item&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;*&amp;^%^%&amp;%*&amp;*&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h4</span>&gt;</span>标题1<span class=\"tag\">&lt;/<span class=\"name\">h4</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>这是item1的描述信息<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container-item&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;*&amp;^%^%&amp;%*&amp;*&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h4</span>&gt;</span>标题2<span class=\"tag\">&lt;/<span class=\"name\">h4</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>这是item2的描述信息<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container-item&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;*&amp;^%^%&amp;%*&amp;*&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h4</span>&gt;</span>标题3<span class=\"tag\">&lt;/<span class=\"name\">h4</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>这是item3的描述信息<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container-item&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;*&amp;^%^%&amp;%*&amp;*&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h4</span>&gt;</span>标题4<span class=\"tag\">&lt;/<span class=\"name\">h4</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>这是item4的描述信息<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>css 部分</strong></p>\n<figure class=\"highlight scss\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.container</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">750</span>rpx;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto;</span><br><span class=\"line\">  <span class=\"attribute\">column-count</span>: <span class=\"number\">4</span>; <span class=\"comment\">/* 瀑布流的列数 */</span></span><br><span class=\"line\">  <span class=\"attribute\">column-gap</span>: <span class=\"number\">0</span>; <span class=\"comment\">/* 每列之间的间距 如： 10px;*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;-item &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">    <span class=\"attribute\">flex-direction</span>: column;</span><br><span class=\"line\">    <span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">    <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7-一个交错动画案例（加载…）\"><a href=\"#7-一个交错动画案例（加载…）\" class=\"headerlink\" title=\"7. 一个交错动画案例（加载…）\"></a>7. 一个交错动画案例（加载…）</h3><p><strong>html 部分</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;div class=&quot;loading&quot;&gt;</span><br><span class=\"line\">  &lt;div class=&quot;dot&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">  &lt;div class=&quot;dot&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">  &lt;div class=&quot;dot&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">  &lt;div class=&quot;dot&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">  &lt;div class=&quot;dot&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br></pre></td></tr></table></figure>\n\n<p><strong>scss 部分</strong></p>\n<figure class=\"highlight scss\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100vh</span>;</span><br><span class=\"line\">  <span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">  <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"number\">#222</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.loading</span> &#123;</span><br><span class=\"line\">  <span class=\"variable\">$colors</span>: <span class=\"number\">#7ef9ff</span>, <span class=\"number\">#89cff0</span>, <span class=\"number\">#4682b4</span>, <span class=\"number\">#0f52ba</span>, <span class=\"number\">#000080</span>;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.dot</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">2em</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">2em</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"number\">0.8em</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &amp;<span class=\"selector-pseudo\">::before</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">      <span class=\"attribute\">content</span>: <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">      <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">      <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">      <span class=\"attribute\">background</span>: inherit;</span><br><span class=\"line\">      <span class=\"attribute\">border-radius</span>: inherit;</span><br><span class=\"line\">      <span class=\"attribute\">animation</span>: wave <span class=\"number\">2s</span> ease-out infinite;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">@for</span> <span class=\"variable\">$i</span> from <span class=\"number\">1</span> through <span class=\"number\">5</span> &#123;</span><br><span class=\"line\">      &amp;<span class=\"selector-pseudo\">:nth-child</span>(#&#123;$i&#125;) &#123;</span><br><span class=\"line\">        <span class=\"attribute\">background</span>: <span class=\"built_in\">nth</span>(<span class=\"variable\">$colors</span>, <span class=\"variable\">$i</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        &amp;<span class=\"selector-pseudo\">::before</span> &#123;</span><br><span class=\"line\">          <span class=\"attribute\">animation-delay</span>: <span class=\"variable\">$i</span> * <span class=\"number\">0.2s</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@keyframes</span> wave &#123;</span><br><span class=\"line\">  <span class=\"number\">50%</span>,</span><br><span class=\"line\">  <span class=\"number\">75%</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: <span class=\"built_in\">scale</span>(<span class=\"number\">2.5</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"number\">80%</span>,</span><br><span class=\"line\">  <span class=\"number\">100%</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">opacity</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E9%82%A3%E4%BA%9B%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84css%E6%8A%80%E5%B7%A7/loading_animation.gif\" alt=\"交错动画演示\"></p>\n<hr>\n<h3 id=\"8-利用伪类实现按钮边框特效\"><a href=\"#8-利用伪类实现按钮边框特效\" class=\"headerlink\" title=\"8. 利用伪类实现按钮边框特效\"></a>8. 利用伪类实现按钮边框特效</h3><p><strong>html 部分</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">data-text</span>=<span class=\"string\">&quot;Start&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btn btn-primary btn-ghost btn-border-stroke  btn-text-float-up&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btn-borders&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;border-top&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;border-right&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;border-bottom&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;border-left&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btn-text&quot;</span>&gt;</span>Start<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>scss 部分</strong></p>\n<figure class=\"highlight scss\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@import</span> url(<span class=\"attribute\">https</span>://fonts.googleapis.com/css?family=Lato);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100vh</span>;</span><br><span class=\"line\">  <span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">  <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">  <span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"number\">#1a1e23</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.btn</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">--hue</span>: <span class=\"number\">190</span>;</span><br><span class=\"line\">  <span class=\"attr\">--ease-in-duration</span>: <span class=\"number\">0.25s</span>;</span><br><span class=\"line\">  <span class=\"attr\">--ease-in-exponential</span>: <span class=\"built_in\">cubic-bezier</span>(<span class=\"number\">0.95</span>, <span class=\"number\">0.05</span>, <span class=\"number\">0.795</span>, <span class=\"number\">0.035</span>);</span><br><span class=\"line\">  <span class=\"attr\">--ease-out-duration</span>: <span class=\"number\">0.65s</span>;</span><br><span class=\"line\">  <span class=\"attr\">--ease-out-delay</span>: <span class=\"built_in\">var</span>(--ease-in-duration);</span><br><span class=\"line\">  <span class=\"attr\">--ease-out-exponential</span>: <span class=\"built_in\">cubic-bezier</span>(<span class=\"number\">0.19</span>, <span class=\"number\">1</span>, <span class=\"number\">0.22</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">1rem</span> <span class=\"number\">3rem</span>;</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">1rem</span>;</span><br><span class=\"line\">  <span class=\"attribute\">line-height</span>: <span class=\"number\">1.5</span>;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: white;</span><br><span class=\"line\">  <span class=\"attribute\">text-decoration</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: <span class=\"built_in\">hsl</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">41%</span>);</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"built_in\">hsl</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">41%</span>);</span><br><span class=\"line\">  <span class=\"attribute\">outline</span>: transparent;</span><br><span class=\"line\">  <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">  <span class=\"attribute\">cursor</span>: pointer;</span><br><span class=\"line\">  user-select: none;</span><br><span class=\"line\">  <span class=\"attribute\">white-space</span>: nowrap;</span><br><span class=\"line\">  <span class=\"attribute\">transition</span>: <span class=\"number\">0.25s</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;<span class=\"selector-pseudo\">:hover</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"built_in\">hsl</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">31%</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;-primary &#123;</span><br><span class=\"line\">    <span class=\"attr\">--hue</span>: <span class=\"number\">171</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;-ghost &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"built_in\">hsl</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">41%</span>);</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: transparent;</span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: <span class=\"built_in\">hsl</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">41%</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &amp;<span class=\"selector-pseudo\">:hover</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">color</span>: white;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;-<span class=\"attribute\">border</span>-stroke &#123;</span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: <span class=\"built_in\">hsla</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">41%</span>, <span class=\"number\">0.35</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-class\">.btn-borders</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">      <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">      <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.border-top</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">        <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">1px</span>;</span><br><span class=\"line\">        <span class=\"attribute\">background</span>: <span class=\"built_in\">hsl</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">41%</span>);</span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: <span class=\"built_in\">scaleX</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"attribute\">transform-origin</span>: left;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.border-right</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">        <span class=\"attribute\">right</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"attribute\">width</span>: <span class=\"number\">1px</span>;</span><br><span class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">        <span class=\"attribute\">background</span>: <span class=\"built_in\">hsl</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">41%</span>);</span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: <span class=\"built_in\">scaleY</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"attribute\">transform-origin</span>: bottom;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.border-bottom</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">        <span class=\"attribute\">bottom</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">1px</span>;</span><br><span class=\"line\">        <span class=\"attribute\">background</span>: <span class=\"built_in\">hsl</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">41%</span>);</span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: <span class=\"built_in\">scaleX</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"attribute\">transform-origin</span>: left;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.border-left</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">        <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"attribute\">width</span>: <span class=\"number\">1px</span>;</span><br><span class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">        <span class=\"attribute\">background</span>: <span class=\"built_in\">hsl</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">41%</span>);</span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: <span class=\"built_in\">scaleY</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"attribute\">transform-origin</span>: bottom;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// when unhover, ease-out left, bottom; ease-in right, top</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.border-left</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">transition</span>: <span class=\"built_in\">var</span>(--ease-out-duration) <span class=\"built_in\">var</span>(--ease-out-delay) <span class=\"built_in\">var</span>(--ease-out-exponential);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"selector-class\">.border-bottom</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">transition</span>: <span class=\"built_in\">var</span>(--ease-out-duration) <span class=\"built_in\">var</span>(--ease-out-delay) <span class=\"built_in\">var</span>(--ease-out-exponential);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.border-right</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">transition</span>: <span class=\"built_in\">var</span>(--ease-in-duration) <span class=\"built_in\">var</span>(--ease-in-exponential);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"selector-class\">.border-top</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">transition</span>: <span class=\"built_in\">var</span>(--ease-in-duration) <span class=\"built_in\">var</span>(--ease-in-exponential);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &amp;<span class=\"selector-pseudo\">:hover</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"built_in\">hsl</span>(<span class=\"built_in\">var</span>(--hue), <span class=\"number\">100%</span>, <span class=\"number\">41%</span>);</span><br><span class=\"line\">      <span class=\"attribute\">background</span>: transparent;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.border-top</span>,</span><br><span class=\"line\">      <span class=\"selector-class\">.border-bottom</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: <span class=\"built_in\">scaleX</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"selector-class\">.border-left</span>,</span><br><span class=\"line\">      <span class=\"selector-class\">.border-right</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: <span class=\"built_in\">scaleY</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// when hover, ease-in left, bottom; ease-out right, top</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.border-left</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">transition</span>: <span class=\"built_in\">var</span>(--ease-in-duration) <span class=\"built_in\">var</span>(--ease-in-exponential);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"selector-class\">.border-bottom</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">transition</span>: <span class=\"built_in\">var</span>(--ease-in-duration) <span class=\"built_in\">var</span>(--ease-in-exponential);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.border-right</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">transition</span>: <span class=\"built_in\">var</span>(--ease-out-duration) <span class=\"built_in\">var</span>(--ease-out-delay) <span class=\"built_in\">var</span>(--ease-out-exponential);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"selector-class\">.border-top</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">transition</span>: <span class=\"built_in\">var</span>(--ease-out-duration) <span class=\"built_in\">var</span>(--ease-out-delay) <span class=\"built_in\">var</span>(--ease-out-exponential);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;-text-<span class=\"attribute\">float</span>-up &#123;</span><br><span class=\"line\">    &amp;<span class=\"selector-pseudo\">::after</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">      <span class=\"attribute\">content</span>: <span class=\"built_in\">attr</span>(data-text);</span><br><span class=\"line\">      <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">      <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">      <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">      <span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">      <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">      <span class=\"attribute\">opacity</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"attribute\">transform</span>: <span class=\"built_in\">translateY</span>(<span class=\"number\">35%</span>);</span><br><span class=\"line\">      <span class=\"attribute\">transition</span>: <span class=\"number\">0.25s</span> ease-out;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// when hover, ease-in top-text; ease-out bottom-text</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-class\">.btn-text</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">      <span class=\"attribute\">transition</span>: <span class=\"number\">0.75s</span> <span class=\"number\">0.1s</span> <span class=\"built_in\">var</span>(--ease-out-exponential);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &amp;<span class=\"selector-pseudo\">:hover</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// when hover, ease-in bottom-text; ease-out top-text</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"selector-class\">.btn-text</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">opacity</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: <span class=\"built_in\">translateY</span>(-<span class=\"number\">25%</span>);</span><br><span class=\"line\">        <span class=\"attribute\">transition</span>: <span class=\"number\">0.25s</span> ease-out;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      &amp;<span class=\"selector-pseudo\">::after</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">opacity</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: <span class=\"built_in\">translateY</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"attribute\">transition</span>: <span class=\"number\">0.75s</span> <span class=\"number\">0.1s</span> <span class=\"built_in\">var</span>(--ease-out-exponential);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E9%82%A3%E4%BA%9B%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84css%E6%8A%80%E5%B7%A7/button_animation.gif\" alt=\"按钮动画\"></p>\n<hr>\n<h3 id=\"9-更换旧的网格系统\"><a href=\"#9-更换旧的网格系统\" class=\"headerlink\" title=\"9. 更换旧的网格系统\"></a>9. 更换旧的网格系统</h3><figure class=\"highlight scss\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$minColumnWidth</span>: <span class=\"number\">10rem</span>; <span class=\"comment\">// 最小宽度</span></span><br><span class=\"line\"><span class=\"variable\">$gridGap</span>: <span class=\"number\">15px</span>; <span class=\"comment\">// 网格之间的上下间距</span></span><br><span class=\"line\"><span class=\"selector-class\">.grid</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: grid;</span><br><span class=\"line\">  <span class=\"attribute\">grid-template-columns</span>: <span class=\"built_in\">repeat</span>(auto-fit, <span class=\"built_in\">minmax</span>(<span class=\"variable\">$minColumnWidth</span>, <span class=\"number\">1</span>fr));</span><br><span class=\"line\">  <span class=\"attribute\">grid-gap</span>: <span class=\"number\">2rem</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp; + <span class=\"selector-class\">.grid</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: <span class=\"variable\">$gridGap</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"10-媒体查询适配刘海屏\"><a href=\"#10-媒体查询适配刘海屏\" class=\"headerlink\" title=\"10. 媒体查询适配刘海屏\"></a>10. 媒体查询适配刘海屏</h3><figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\">// iphone x/xs/<span class=\"number\">11</span> pro</span><br><span class=\"line\"><span class=\"keyword\">@media</span> <span class=\"keyword\">only</span> screen <span class=\"keyword\">and</span> (<span class=\"attribute\">device-width</span>: <span class=\"number\">375px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">device-height</span>: <span class=\"number\">812px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">-webkit-device-pixel-ratio</span>: <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">//  iphone xr/<span class=\"number\">11</span></span><br><span class=\"line\"><span class=\"keyword\">@media</span> <span class=\"keyword\">only</span> screen <span class=\"keyword\">and</span> (<span class=\"attribute\">device-width</span>: <span class=\"number\">414px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">device-height</span>: <span class=\"number\">896px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">-webkit-device-pixel-ratio</span>: <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// iphone x/xs/<span class=\"number\">11</span>pro max</span><br><span class=\"line\"><span class=\"keyword\">@media</span> <span class=\"keyword\">only</span> screen <span class=\"keyword\">and</span> (<span class=\"attribute\">device-width</span>: <span class=\"number\">414px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">device-height</span>: <span class=\"number\">896px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">-webkit-device-pixel-ratio</span>: <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// iphone <span class=\"number\">12</span>mini</span><br><span class=\"line\"><span class=\"keyword\">@media</span> <span class=\"keyword\">only</span> screen <span class=\"keyword\">and</span> (<span class=\"attribute\">device-width</span>: <span class=\"number\">360px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">device-height</span>: <span class=\"number\">780px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">-webkit-device-pixel-ratio</span>: <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// iphone <span class=\"number\">12</span>/<span class=\"number\">12</span>pro</span><br><span class=\"line\"><span class=\"keyword\">@media</span> <span class=\"keyword\">only</span> screen <span class=\"keyword\">and</span> (<span class=\"attribute\">device-width</span>: <span class=\"number\">390px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">device-height</span>: <span class=\"number\">844px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">-webkit-device-pixel-ratio</span>: <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// iphone <span class=\"number\">12</span>pro max</span><br><span class=\"line\"><span class=\"keyword\">@media</span> <span class=\"keyword\">only</span> screen <span class=\"keyword\">and</span> (<span class=\"attribute\">device-width</span>: <span class=\"number\">428px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">device-height</span>: <span class=\"number\">926px</span>) <span class=\"keyword\">and</span> (<span class=\"attribute\">-webkit-device-pixel-ratio</span>: <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"11-Ios-新特性适配带有小横条的机型\"><a href=\"#11-Ios-新特性适配带有小横条的机型\" class=\"headerlink\" title=\"11. Ios 新特性适配带有小横条的机型\"></a>11. Ios 新特性适配带有小横条的机型</h3><figure class=\"highlight scss\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">padding-bottom</span>: <span class=\"built_in\">constant</span>(safe-area-inset-bottom) <span class=\"meta\">!important</span>;</span><br><span class=\"line\">  <span class=\"attribute\">padding-bottom</span>: <span class=\"built_in\">env</span>(safe-area-inset-bottom) <span class=\"meta\">!important</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"hexo + volantis 搭建个人博客?","layout":"post","seo_title":"如何搭建个人博客","keywords":"搭建个人博客 hexo","copyright":true,"abbrlink":"9487","date":"2021-06-25T05:36:46.000Z","photos":["https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/headimg.png"],"_content":"\n使用hexo快速搭建个人博客\n\n<!-- more -->\n\n**搭建博客的框架很多，个人比较偏向于hexo框架：**\n- hexo只需要专注于写文档而不需要过分担心别的问题。\n- hexo比较成熟，如果遇到问题也可以得到很好的解决。\n- hexo使用github pages进行部署，不需要购买自己的服务器就可以部署到线上。\n- hexo有很好的主题，如：volantis， yilia....\n\n\n[hexo中文网站](https://hexo.io/zh-cn/)      [volantis主题官方文档](https://volantis.js.org/)\n\n\n\n### 1. 搭建hexo环境\n\n **hexo是基于node开发的，首先需要安装node ，其次如果想要部署到github pages 需要安装git**\n\n\n```powershell <1>安装淘宝镜像\nsudo npm install -g cnpm --registry=https://registry.npm.taobao.org\n```\n\n```powershell <2>安装hexo-cli\nsudo cnpm install -g hexo-cli\n```\n\n```powershell <3>检查是否安装成功\nhexo -v\n```\n\n\n### 2. 创建hexo项目\n\n**首先创建一个空的文件夹用于存放hexo项目代码，并在创建的目录中打开终端**\n```powershell\nmkdir <floder>\ncd <floder>\nhexo init\n\n// 或者直接借助hexo去实现\n\nhexo init <floder> // 这里hexo会自动创建文件夹并初始化项目\n```\n\n**安装依赖**\n```powershell\nnpm install\n```\n\n\n### 3. 启动项目\n\n**启动项目常用的命令**\n```powershell\nhexo clean // 清除项目中的临时文件\nhexo g   // OR  hexo generate 生成临时文件\nhexo s   // OR  hexo start  启动项目\n```\n\n**此时页面可以看到一个默认的博客模板并且有一篇默认的hello world 文章**\n\n\n### 4. 新建一篇文章\n```shell\nhexo new \"如何搭建个人博客\"\n```\n\n### 5. 切换自己喜欢的主题\n**这里以Volantis主题为例，具体的主题需要参照具体的官方文档来做**\n\n- **下载主题插件**\n```shell\nnpm i hexo-theme-volantis \n```\n\n- **修改_config.yml中的 <span style=\"color:rgb(205,0,0)\">theme</span> 字段为volantis**\n```yml\ntheme: volantis\n```\n \n- **安装 Hexo 搜索的依赖包**\n```shell\nnpm i hexo-generator-search hexo-generator-json-content\n```\n\n- **安装 Stylus 渲染器**\n```shell\nnpm i hexo-renderer-stylus\n```\n**这样就可以看到精美的主题啦，之后的细节慢慢去调试成自己喜欢的样子（参考对应的官方文档）**\n\n### 6. 部署到github pages\n\n第一步： 在github上新建一个仓库，仓库的名字为：<用户名>.github.io  （必须）\n\n第二步： 修改项目根目录下的_config.yml中的 <span style=\"color:rgb(205,0,0)\">deploy</span> 字段为：\n```yml\ndeploy:\n  type: git\n  repo: // 这里修改成自己的github仓库地址\n  branch: master\n```\n\n第三步： 将代码部署到github pages \n```shell\nhexo clean\nhexo g // OR hexo generate\nhexo d // OR hexo deploy\n```\n此时控制台会报错：<span style=\"color:rgb(255,0,0)\">ERROR</span> Deployer not found: git\n这是因为项目缺少git部署的插件\n```shell\nnpm install --save hexo-deployer-git\n```\n执行以上的语句即可～～～～～～～然后重复第三步\n此时就可以看到git仓库中已经有了一部分代码,神奇的是：\n此时去访问：<用户名>.github.io 就可以看到线上的博客样式了。\n\n{% link github pages demo, JingTao-Li.github.io, https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/github.png %}\n\n\n### 7. 修改github page 为自定义的域名\n![我的域名](https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/my-yuming.png)\n**点击解析，添加对应的IP地址和CNAME**\n![我的域名解析设置](https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/yuming-parse.png)\n然后在当前项目的 source/ 目录下创建一个名叫 CNAME 的文件，里面的内容就是你的域名地址。接着重新部署一下就可以了。\n\n\n### 8. 如何在项目中引入本地图片\n**第一步：**安装插件：\n```shell\nnpm install hexo-asset-image --save\n```\n\n**第二步：**打开根目录下的 _config.yml 文件，修改 <span style=\"color:rgb(205,0,0)\">post_asset_folder</span> 字段为 **true**\n\n**第三步：**打开 /node_modules/hexo-asset-image/index.js 文件，替换为以下代码：\n```javascript\n'use strict';\nvar cheerio = require('cheerio');\n\n// http://stackoverflow.com/questions/14480345/how-to-get-the-nth-occurrence-in-a-string\nfunction getPosition(str, m, i) {\n  return str.split(m, i).join(m).length;\n}\n\nvar version = String(hexo.version).split('.');\nhexo.extend.filter.register('after_post_render', function(data){\n  var config = hexo.config;\n  if(config.post_asset_folder){\n        var link = data.permalink;\n    if(version.length > 0 && Number(version[0]) == 3)\n       var beginPos = getPosition(link, '/', 1) + 1;\n    else\n       var beginPos = getPosition(link, '/', 3) + 1;\n    // In hexo 3.1.1, the permalink of \"about\" page is like \".../about/index.html\".\n    var endPos = link.lastIndexOf('/') + 1;\n    link = link.substring(beginPos, endPos);\n\n    var toprocess = ['excerpt', 'more', 'content'];\n    for(var i = 0; i < toprocess.length; i++){\n      var key = toprocess[i];\n \n      var $ = cheerio.load(data[key], {\n        ignoreWhitespace: false,\n        xmlMode: false,\n        lowerCaseTags: false,\n        decodeEntities: false\n      });\n\n      $('img').each(function(){\n        if ($(this).attr('src')){\n            // For windows style path, we replace '\\' to '/'.\n            var src = $(this).attr('src').replace('\\\\', '/');\n            if(!/http[s]*.*|\\/\\/.*/.test(src) &&\n               !/^\\s*\\//.test(src)) {\n              // For \"about\" page, the first part of \"src\" can't be removed.\n              // In addition, to support multi-level local directory.\n              var linkArray = link.split('/').filter(function(elem){\n                return elem != '';\n              });\n              var srcArray = src.split('/').filter(function(elem){\n                return elem != '' && elem != '.';\n              });\n              if(srcArray.length > 1)\n                srcArray.shift();\n              src = srcArray.join('/');\n              $(this).attr('src', config.root + link + src);\n              console.info&&console.info(\"update link as:-->\"+config.root + link + src);\n            }\n        }else{\n            console.info&&console.info(\"no src attr, skipped...\");\n            console.info&&console.info($(this));\n        }\n      });\n      data[key] = $.html();\n    }\n  }\n});\n```\n\n**第四步：**之后在新建一个新的文档内容的时候会自动生成一个同名文件夹，里面就可以放本页面需要的图片源文件，在需要的地方引入：\n```markdown\n![这是代替图片的文字，随便写](图片名字)\n```\n\n","source":"_posts/如何搭建个人博客.md","raw":"---\ntitle: hexo + volantis 搭建个人博客?\ntags:\nlayout: post\nseo_title: 如何搭建个人博客\nkeywords: 搭建个人博客 hexo\ncategories: 搭建个人博客\ncopyright: true\nabbrlink: '9487'\ndate: 2021-06-25 13:36:46\nphotos: ['https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/headimg.png']\n---\n\n使用hexo快速搭建个人博客\n\n<!-- more -->\n\n**搭建博客的框架很多，个人比较偏向于hexo框架：**\n- hexo只需要专注于写文档而不需要过分担心别的问题。\n- hexo比较成熟，如果遇到问题也可以得到很好的解决。\n- hexo使用github pages进行部署，不需要购买自己的服务器就可以部署到线上。\n- hexo有很好的主题，如：volantis， yilia....\n\n\n[hexo中文网站](https://hexo.io/zh-cn/)      [volantis主题官方文档](https://volantis.js.org/)\n\n\n\n### 1. 搭建hexo环境\n\n **hexo是基于node开发的，首先需要安装node ，其次如果想要部署到github pages 需要安装git**\n\n\n```powershell <1>安装淘宝镜像\nsudo npm install -g cnpm --registry=https://registry.npm.taobao.org\n```\n\n```powershell <2>安装hexo-cli\nsudo cnpm install -g hexo-cli\n```\n\n```powershell <3>检查是否安装成功\nhexo -v\n```\n\n\n### 2. 创建hexo项目\n\n**首先创建一个空的文件夹用于存放hexo项目代码，并在创建的目录中打开终端**\n```powershell\nmkdir <floder>\ncd <floder>\nhexo init\n\n// 或者直接借助hexo去实现\n\nhexo init <floder> // 这里hexo会自动创建文件夹并初始化项目\n```\n\n**安装依赖**\n```powershell\nnpm install\n```\n\n\n### 3. 启动项目\n\n**启动项目常用的命令**\n```powershell\nhexo clean // 清除项目中的临时文件\nhexo g   // OR  hexo generate 生成临时文件\nhexo s   // OR  hexo start  启动项目\n```\n\n**此时页面可以看到一个默认的博客模板并且有一篇默认的hello world 文章**\n\n\n### 4. 新建一篇文章\n```shell\nhexo new \"如何搭建个人博客\"\n```\n\n### 5. 切换自己喜欢的主题\n**这里以Volantis主题为例，具体的主题需要参照具体的官方文档来做**\n\n- **下载主题插件**\n```shell\nnpm i hexo-theme-volantis \n```\n\n- **修改_config.yml中的 <span style=\"color:rgb(205,0,0)\">theme</span> 字段为volantis**\n```yml\ntheme: volantis\n```\n \n- **安装 Hexo 搜索的依赖包**\n```shell\nnpm i hexo-generator-search hexo-generator-json-content\n```\n\n- **安装 Stylus 渲染器**\n```shell\nnpm i hexo-renderer-stylus\n```\n**这样就可以看到精美的主题啦，之后的细节慢慢去调试成自己喜欢的样子（参考对应的官方文档）**\n\n### 6. 部署到github pages\n\n第一步： 在github上新建一个仓库，仓库的名字为：<用户名>.github.io  （必须）\n\n第二步： 修改项目根目录下的_config.yml中的 <span style=\"color:rgb(205,0,0)\">deploy</span> 字段为：\n```yml\ndeploy:\n  type: git\n  repo: // 这里修改成自己的github仓库地址\n  branch: master\n```\n\n第三步： 将代码部署到github pages \n```shell\nhexo clean\nhexo g // OR hexo generate\nhexo d // OR hexo deploy\n```\n此时控制台会报错：<span style=\"color:rgb(255,0,0)\">ERROR</span> Deployer not found: git\n这是因为项目缺少git部署的插件\n```shell\nnpm install --save hexo-deployer-git\n```\n执行以上的语句即可～～～～～～～然后重复第三步\n此时就可以看到git仓库中已经有了一部分代码,神奇的是：\n此时去访问：<用户名>.github.io 就可以看到线上的博客样式了。\n\n{% link github pages demo, JingTao-Li.github.io, https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/github.png %}\n\n\n### 7. 修改github page 为自定义的域名\n![我的域名](https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/my-yuming.png)\n**点击解析，添加对应的IP地址和CNAME**\n![我的域名解析设置](https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/yuming-parse.png)\n然后在当前项目的 source/ 目录下创建一个名叫 CNAME 的文件，里面的内容就是你的域名地址。接着重新部署一下就可以了。\n\n\n### 8. 如何在项目中引入本地图片\n**第一步：**安装插件：\n```shell\nnpm install hexo-asset-image --save\n```\n\n**第二步：**打开根目录下的 _config.yml 文件，修改 <span style=\"color:rgb(205,0,0)\">post_asset_folder</span> 字段为 **true**\n\n**第三步：**打开 /node_modules/hexo-asset-image/index.js 文件，替换为以下代码：\n```javascript\n'use strict';\nvar cheerio = require('cheerio');\n\n// http://stackoverflow.com/questions/14480345/how-to-get-the-nth-occurrence-in-a-string\nfunction getPosition(str, m, i) {\n  return str.split(m, i).join(m).length;\n}\n\nvar version = String(hexo.version).split('.');\nhexo.extend.filter.register('after_post_render', function(data){\n  var config = hexo.config;\n  if(config.post_asset_folder){\n        var link = data.permalink;\n    if(version.length > 0 && Number(version[0]) == 3)\n       var beginPos = getPosition(link, '/', 1) + 1;\n    else\n       var beginPos = getPosition(link, '/', 3) + 1;\n    // In hexo 3.1.1, the permalink of \"about\" page is like \".../about/index.html\".\n    var endPos = link.lastIndexOf('/') + 1;\n    link = link.substring(beginPos, endPos);\n\n    var toprocess = ['excerpt', 'more', 'content'];\n    for(var i = 0; i < toprocess.length; i++){\n      var key = toprocess[i];\n \n      var $ = cheerio.load(data[key], {\n        ignoreWhitespace: false,\n        xmlMode: false,\n        lowerCaseTags: false,\n        decodeEntities: false\n      });\n\n      $('img').each(function(){\n        if ($(this).attr('src')){\n            // For windows style path, we replace '\\' to '/'.\n            var src = $(this).attr('src').replace('\\\\', '/');\n            if(!/http[s]*.*|\\/\\/.*/.test(src) &&\n               !/^\\s*\\//.test(src)) {\n              // For \"about\" page, the first part of \"src\" can't be removed.\n              // In addition, to support multi-level local directory.\n              var linkArray = link.split('/').filter(function(elem){\n                return elem != '';\n              });\n              var srcArray = src.split('/').filter(function(elem){\n                return elem != '' && elem != '.';\n              });\n              if(srcArray.length > 1)\n                srcArray.shift();\n              src = srcArray.join('/');\n              $(this).attr('src', config.root + link + src);\n              console.info&&console.info(\"update link as:-->\"+config.root + link + src);\n            }\n        }else{\n            console.info&&console.info(\"no src attr, skipped...\");\n            console.info&&console.info($(this));\n        }\n      });\n      data[key] = $.html();\n    }\n  }\n});\n```\n\n**第四步：**之后在新建一个新的文档内容的时候会自动生成一个同名文件夹，里面就可以放本页面需要的图片源文件，在需要的地方引入：\n```markdown\n![这是代替图片的文字，随便写](图片名字)\n```\n\n","slug":"如何搭建个人博客","published":1,"updated":"2022-08-26T01:42:59.883Z","comments":1,"link":"","_id":"cl79tdvvn001w5d9k7dlob7w1","content":"<p>使用hexo快速搭建个人博客</p>\n<span id=\"more\"></span>\n\n<p><strong>搭建博客的框架很多，个人比较偏向于hexo框架：</strong></p>\n<ul>\n<li>hexo只需要专注于写文档而不需要过分担心别的问题。</li>\n<li>hexo比较成熟，如果遇到问题也可以得到很好的解决。</li>\n<li>hexo使用github pages进行部署，不需要购买自己的服务器就可以部署到线上。</li>\n<li>hexo有很好的主题，如：volantis， yilia….</li>\n</ul>\n<p><a href=\"https://hexo.io/zh-cn/\">hexo中文网站</a>      <a href=\"https://volantis.js.org/\">volantis主题官方文档</a></p>\n<h3 id=\"1-搭建hexo环境\"><a href=\"#1-搭建hexo环境\" class=\"headerlink\" title=\"1. 搭建hexo环境\"></a>1. 搭建hexo环境</h3><p> <strong>hexo是基于node开发的，首先需要安装node ，其次如果想要部署到github pages 需要安装git</strong></p>\n<figure class=\"highlight powershell\"><figcaption><span><1>安装淘宝镜像</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">sudo npm install <span class=\"literal\">-g</span> cnpm <span class=\"literal\">--registry</span>=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight powershell\"><figcaption><span><2>安装hexo-cli</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">sudo cnpm install <span class=\"literal\">-g</span> hexo<span class=\"literal\">-cli</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight powershell\"><figcaption><span><3>检查是否安装成功</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">hexo <span class=\"literal\">-v</span></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"2-创建hexo项目\"><a href=\"#2-创建hexo项目\" class=\"headerlink\" title=\"2. 创建hexo项目\"></a>2. 创建hexo项目</h3><p><strong>首先创建一个空的文件夹用于存放hexo项目代码，并在创建的目录中打开终端</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">mkdir &lt;floder&gt;</span><br><span class=\"line\"><span class=\"built_in\">cd</span> &lt;floder&gt;</span><br><span class=\"line\">hexo init</span><br><span class=\"line\"></span><br><span class=\"line\">// 或者直接借助hexo去实现</span><br><span class=\"line\"></span><br><span class=\"line\">hexo init &lt;floder&gt; // 这里hexo会自动创建文件夹并初始化项目</span><br></pre></td></tr></table></figure>\n\n<p><strong>安装依赖</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"3-启动项目\"><a href=\"#3-启动项目\" class=\"headerlink\" title=\"3. 启动项目\"></a>3. 启动项目</h3><p><strong>启动项目常用的命令</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo clean // 清除项目中的临时文件</span><br><span class=\"line\">hexo g   // OR  hexo generate 生成临时文件</span><br><span class=\"line\">hexo s   // OR  hexo <span class=\"built_in\">start</span>  启动项目</span><br></pre></td></tr></table></figure>\n\n<p><strong>此时页面可以看到一个默认的博客模板并且有一篇默认的hello world 文章</strong></p>\n<h3 id=\"4-新建一篇文章\"><a href=\"#4-新建一篇文章\" class=\"headerlink\" title=\"4. 新建一篇文章\"></a>4. 新建一篇文章</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo new &quot;如何搭建个人博客&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-切换自己喜欢的主题\"><a href=\"#5-切换自己喜欢的主题\" class=\"headerlink\" title=\"5. 切换自己喜欢的主题\"></a>5. 切换自己喜欢的主题</h3><p><strong>这里以Volantis主题为例，具体的主题需要参照具体的官方文档来做</strong></p>\n<ul>\n<li><p><strong>下载主题插件</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm i hexo-theme-volantis </span><br></pre></td></tr></table></figure></li>\n<li><p><strong>修改_config.yml中的 <span style=\"color:rgb(205,0,0)\">theme</span> 字段为volantis</strong></p>\n<figure class=\"highlight yml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">theme:</span> <span class=\"string\">volantis</span></span><br></pre></td></tr></table></figure></li>\n<li><p><strong>安装 Hexo 搜索的依赖包</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm i hexo-generator-search hexo-generator-json-content</span><br></pre></td></tr></table></figure></li>\n<li><p><strong>安装 Stylus 渲染器</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm i hexo-renderer-stylus</span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><strong>这样就可以看到精美的主题啦，之后的细节慢慢去调试成自己喜欢的样子（参考对应的官方文档）</strong></p>\n<h3 id=\"6-部署到github-pages\"><a href=\"#6-部署到github-pages\" class=\"headerlink\" title=\"6. 部署到github pages\"></a>6. 部署到github pages</h3><p>第一步： 在github上新建一个仓库，仓库的名字为：&lt;用户名&gt;.github.io  （必须）</p>\n<p>第二步： 修改项目根目录下的_config.yml中的 <span style=\"color:rgb(205,0,0)\">deploy</span> 字段为：</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">deploy:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">git</span></span><br><span class=\"line\">  <span class=\"attr\">repo:</span> <span class=\"string\">//</span> <span class=\"string\">这里修改成自己的github仓库地址</span></span><br><span class=\"line\">  <span class=\"attr\">branch:</span> <span class=\"string\">master</span></span><br></pre></td></tr></table></figure>\n\n<p>第三步： 将代码部署到github pages </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo clean</span><br><span class=\"line\">hexo g // OR hexo generate</span><br><span class=\"line\">hexo d // OR hexo deploy</span><br></pre></td></tr></table></figure>\n<p>此时控制台会报错：<span style=\"color:rgb(255,0,0)\">ERROR</span> Deployer not found: git<br>这是因为项目缺少git部署的插件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install --save hexo-deployer-git</span><br></pre></td></tr></table></figure>\n<p>执行以上的语句即可～～～～～～～然后重复第三步<br>此时就可以看到git仓库中已经有了一部分代码,神奇的是：<br>此时去访问：&lt;用户名&gt;.github.io 就可以看到线上的博客样式了。</p>\n<a href=\"https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/github.png\" title=\"\" target=\"\">github pages demo, JingTao-Li.github.io,</a>\n\n\n<h3 id=\"7-修改github-page-为自定义的域名\"><a href=\"#7-修改github-page-为自定义的域名\" class=\"headerlink\" title=\"7. 修改github page 为自定义的域名\"></a>7. 修改github page 为自定义的域名</h3><p><img src=\"https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/my-yuming.png\" alt=\"我的域名\"><br><strong>点击解析，添加对应的IP地址和CNAME</strong><br><img src=\"https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/yuming-parse.png\" alt=\"我的域名解析设置\"><br>然后在当前项目的 source/ 目录下创建一个名叫 CNAME 的文件，里面的内容就是你的域名地址。接着重新部署一下就可以了。</p>\n<h3 id=\"8-如何在项目中引入本地图片\"><a href=\"#8-如何在项目中引入本地图片\" class=\"headerlink\" title=\"8. 如何在项目中引入本地图片\"></a>8. 如何在项目中引入本地图片</h3><p><strong>第一步：</strong>安装插件：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install hexo-asset-image --save</span><br></pre></td></tr></table></figure>\n\n<p><strong>第二步：</strong>打开根目录下的 _config.yml 文件，修改 <span style=\"color:rgb(205,0,0)\">post_asset_folder</span> 字段为 <strong>true</strong></p>\n<p><strong>第三步：</strong>打开 /node_modules/hexo-asset-image/index.js 文件，替换为以下代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&#x27;use strict&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> cheerio = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;cheerio&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// http://stackoverflow.com/questions/14480345/how-to-get-the-nth-occurrence-in-a-string</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">getPosition</span>(<span class=\"params\">str, m, i</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> str.<span class=\"title function_\">split</span>(m, i).<span class=\"title function_\">join</span>(m).<span class=\"property\">length</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> version = <span class=\"title class_\">String</span>(hexo.<span class=\"property\">version</span>).<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;.&#x27;</span>);</span><br><span class=\"line\">hexo.<span class=\"property\">extend</span>.<span class=\"property\">filter</span>.<span class=\"title function_\">register</span>(<span class=\"string\">&#x27;after_post_render&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">data</span>)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> config = hexo.<span class=\"property\">config</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(config.<span class=\"property\">post_asset_folder</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> link = data.<span class=\"property\">permalink</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(version.<span class=\"property\">length</span> &gt; <span class=\"number\">0</span> &amp;&amp; <span class=\"title class_\">Number</span>(version[<span class=\"number\">0</span>]) == <span class=\"number\">3</span>)</span><br><span class=\"line\">       <span class=\"keyword\">var</span> beginPos = <span class=\"title function_\">getPosition</span>(link, <span class=\"string\">&#x27;/&#x27;</span>, <span class=\"number\">1</span>) + <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">       <span class=\"keyword\">var</span> beginPos = <span class=\"title function_\">getPosition</span>(link, <span class=\"string\">&#x27;/&#x27;</span>, <span class=\"number\">3</span>) + <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"comment\">// In hexo 3.1.1, the permalink of &quot;about&quot; page is like &quot;.../about/index.html&quot;.</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> endPos = link.<span class=\"title function_\">lastIndexOf</span>(<span class=\"string\">&#x27;/&#x27;</span>) + <span class=\"number\">1</span>;</span><br><span class=\"line\">    link = link.<span class=\"title function_\">substring</span>(beginPos, endPos);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> toprocess = [<span class=\"string\">&#x27;excerpt&#x27;</span>, <span class=\"string\">&#x27;more&#x27;</span>, <span class=\"string\">&#x27;content&#x27;</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; toprocess.<span class=\"property\">length</span>; i++)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> key = toprocess[i];</span><br><span class=\"line\"> </span><br><span class=\"line\">      <span class=\"keyword\">var</span> $ = cheerio.<span class=\"title function_\">load</span>(data[key], &#123;</span><br><span class=\"line\">        <span class=\"attr\">ignoreWhitespace</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"attr\">xmlMode</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"attr\">lowerCaseTags</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"attr\">decodeEntities</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">      $(<span class=\"string\">&#x27;img&#x27;</span>).<span class=\"title function_\">each</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($(<span class=\"variable language_\">this</span>).<span class=\"title function_\">attr</span>(<span class=\"string\">&#x27;src&#x27;</span>))&#123;</span><br><span class=\"line\">            <span class=\"comment\">// For windows style path, we replace &#x27;\\&#x27; to &#x27;/&#x27;.</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> src = $(<span class=\"variable language_\">this</span>).<span class=\"title function_\">attr</span>(<span class=\"string\">&#x27;src&#x27;</span>).<span class=\"title function_\">replace</span>(<span class=\"string\">&#x27;\\\\&#x27;</span>, <span class=\"string\">&#x27;/&#x27;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(!<span class=\"regexp\">/http[s]*.*|\\/\\/.*/</span>.<span class=\"title function_\">test</span>(src) &amp;&amp;</span><br><span class=\"line\">               !<span class=\"regexp\">/^\\s*\\//</span>.<span class=\"title function_\">test</span>(src)) &#123;</span><br><span class=\"line\">              <span class=\"comment\">// For &quot;about&quot; page, the first part of &quot;src&quot; can&#x27;t be removed.</span></span><br><span class=\"line\">              <span class=\"comment\">// In addition, to support multi-level local directory.</span></span><br><span class=\"line\">              <span class=\"keyword\">var</span> linkArray = link.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;/&#x27;</span>).<span class=\"title function_\">filter</span>(<span class=\"keyword\">function</span>(<span class=\"params\">elem</span>)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> elem != <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">              &#125;);</span><br><span class=\"line\">              <span class=\"keyword\">var</span> srcArray = src.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;/&#x27;</span>).<span class=\"title function_\">filter</span>(<span class=\"keyword\">function</span>(<span class=\"params\">elem</span>)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> elem != <span class=\"string\">&#x27;&#x27;</span> &amp;&amp; elem != <span class=\"string\">&#x27;.&#x27;</span>;</span><br><span class=\"line\">              &#125;);</span><br><span class=\"line\">              <span class=\"keyword\">if</span>(srcArray.<span class=\"property\">length</span> &gt; <span class=\"number\">1</span>)</span><br><span class=\"line\">                srcArray.<span class=\"title function_\">shift</span>();</span><br><span class=\"line\">              src = srcArray.<span class=\"title function_\">join</span>(<span class=\"string\">&#x27;/&#x27;</span>);</span><br><span class=\"line\">              $(<span class=\"variable language_\">this</span>).<span class=\"title function_\">attr</span>(<span class=\"string\">&#x27;src&#x27;</span>, config.<span class=\"property\">root</span> + link + src);</span><br><span class=\"line\">              <span class=\"variable language_\">console</span>.<span class=\"property\">info</span>&amp;&amp;<span class=\"variable language_\">console</span>.<span class=\"title function_\">info</span>(<span class=\"string\">&quot;update link as:--&gt;&quot;</span>+config.<span class=\"property\">root</span> + link + src);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"property\">info</span>&amp;&amp;<span class=\"variable language_\">console</span>.<span class=\"title function_\">info</span>(<span class=\"string\">&quot;no src attr, skipped...&quot;</span>);</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"property\">info</span>&amp;&amp;<span class=\"variable language_\">console</span>.<span class=\"title function_\">info</span>($(<span class=\"variable language_\">this</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      data[key] = $.<span class=\"title function_\">html</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p><strong>第四步：</strong>之后在新建一个新的文档内容的时候会自动生成一个同名文件夹，里面就可以放本页面需要的图片源文件，在需要的地方引入：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\">![<span class=\"string\">这是代替图片的文字，随便写</span>](<span class=\"link\">图片名字</span>)</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>使用hexo快速搭建个人博客</p>","more":"<p><strong>搭建博客的框架很多，个人比较偏向于hexo框架：</strong></p>\n<ul>\n<li>hexo只需要专注于写文档而不需要过分担心别的问题。</li>\n<li>hexo比较成熟，如果遇到问题也可以得到很好的解决。</li>\n<li>hexo使用github pages进行部署，不需要购买自己的服务器就可以部署到线上。</li>\n<li>hexo有很好的主题，如：volantis， yilia….</li>\n</ul>\n<p><a href=\"https://hexo.io/zh-cn/\">hexo中文网站</a>      <a href=\"https://volantis.js.org/\">volantis主题官方文档</a></p>\n<h3 id=\"1-搭建hexo环境\"><a href=\"#1-搭建hexo环境\" class=\"headerlink\" title=\"1. 搭建hexo环境\"></a>1. 搭建hexo环境</h3><p> <strong>hexo是基于node开发的，首先需要安装node ，其次如果想要部署到github pages 需要安装git</strong></p>\n<figure class=\"highlight powershell\"><figcaption><span><1>安装淘宝镜像</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">sudo npm install <span class=\"literal\">-g</span> cnpm <span class=\"literal\">--registry</span>=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight powershell\"><figcaption><span><2>安装hexo-cli</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">sudo cnpm install <span class=\"literal\">-g</span> hexo<span class=\"literal\">-cli</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight powershell\"><figcaption><span><3>检查是否安装成功</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">hexo <span class=\"literal\">-v</span></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"2-创建hexo项目\"><a href=\"#2-创建hexo项目\" class=\"headerlink\" title=\"2. 创建hexo项目\"></a>2. 创建hexo项目</h3><p><strong>首先创建一个空的文件夹用于存放hexo项目代码，并在创建的目录中打开终端</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">mkdir &lt;floder&gt;</span><br><span class=\"line\"><span class=\"built_in\">cd</span> &lt;floder&gt;</span><br><span class=\"line\">hexo init</span><br><span class=\"line\"></span><br><span class=\"line\">// 或者直接借助hexo去实现</span><br><span class=\"line\"></span><br><span class=\"line\">hexo init &lt;floder&gt; // 这里hexo会自动创建文件夹并初始化项目</span><br></pre></td></tr></table></figure>\n\n<p><strong>安装依赖</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"3-启动项目\"><a href=\"#3-启动项目\" class=\"headerlink\" title=\"3. 启动项目\"></a>3. 启动项目</h3><p><strong>启动项目常用的命令</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo clean // 清除项目中的临时文件</span><br><span class=\"line\">hexo g   // OR  hexo generate 生成临时文件</span><br><span class=\"line\">hexo s   // OR  hexo <span class=\"built_in\">start</span>  启动项目</span><br></pre></td></tr></table></figure>\n\n<p><strong>此时页面可以看到一个默认的博客模板并且有一篇默认的hello world 文章</strong></p>\n<h3 id=\"4-新建一篇文章\"><a href=\"#4-新建一篇文章\" class=\"headerlink\" title=\"4. 新建一篇文章\"></a>4. 新建一篇文章</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo new &quot;如何搭建个人博客&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-切换自己喜欢的主题\"><a href=\"#5-切换自己喜欢的主题\" class=\"headerlink\" title=\"5. 切换自己喜欢的主题\"></a>5. 切换自己喜欢的主题</h3><p><strong>这里以Volantis主题为例，具体的主题需要参照具体的官方文档来做</strong></p>\n<ul>\n<li><p><strong>下载主题插件</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm i hexo-theme-volantis </span><br></pre></td></tr></table></figure></li>\n<li><p><strong>修改_config.yml中的 <span style=\"color:rgb(205,0,0)\">theme</span> 字段为volantis</strong></p>\n<figure class=\"highlight yml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">theme:</span> <span class=\"string\">volantis</span></span><br></pre></td></tr></table></figure></li>\n<li><p><strong>安装 Hexo 搜索的依赖包</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm i hexo-generator-search hexo-generator-json-content</span><br></pre></td></tr></table></figure></li>\n<li><p><strong>安装 Stylus 渲染器</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm i hexo-renderer-stylus</span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><strong>这样就可以看到精美的主题啦，之后的细节慢慢去调试成自己喜欢的样子（参考对应的官方文档）</strong></p>\n<h3 id=\"6-部署到github-pages\"><a href=\"#6-部署到github-pages\" class=\"headerlink\" title=\"6. 部署到github pages\"></a>6. 部署到github pages</h3><p>第一步： 在github上新建一个仓库，仓库的名字为：&lt;用户名&gt;.github.io  （必须）</p>\n<p>第二步： 修改项目根目录下的_config.yml中的 <span style=\"color:rgb(205,0,0)\">deploy</span> 字段为：</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">deploy:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">git</span></span><br><span class=\"line\">  <span class=\"attr\">repo:</span> <span class=\"string\">//</span> <span class=\"string\">这里修改成自己的github仓库地址</span></span><br><span class=\"line\">  <span class=\"attr\">branch:</span> <span class=\"string\">master</span></span><br></pre></td></tr></table></figure>\n\n<p>第三步： 将代码部署到github pages </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo clean</span><br><span class=\"line\">hexo g // OR hexo generate</span><br><span class=\"line\">hexo d // OR hexo deploy</span><br></pre></td></tr></table></figure>\n<p>此时控制台会报错：<span style=\"color:rgb(255,0,0)\">ERROR</span> Deployer not found: git<br>这是因为项目缺少git部署的插件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install --save hexo-deployer-git</span><br></pre></td></tr></table></figure>\n<p>执行以上的语句即可～～～～～～～然后重复第三步<br>此时就可以看到git仓库中已经有了一部分代码,神奇的是：<br>此时去访问：&lt;用户名&gt;.github.io 就可以看到线上的博客样式了。</p>\n<a href=\"https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/github.png\" title=\"\" target=\"\">github pages demo, JingTao-Li.github.io,</a>\n\n\n<h3 id=\"7-修改github-page-为自定义的域名\"><a href=\"#7-修改github-page-为自定义的域名\" class=\"headerlink\" title=\"7. 修改github page 为自定义的域名\"></a>7. 修改github page 为自定义的域名</h3><p><img src=\"https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/my-yuming.png\" alt=\"我的域名\"><br><strong>点击解析，添加对应的IP地址和CNAME</strong><br><img src=\"https://myblogger-1305472061.cos.ap-shanghai.myqcloud.com/%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/yuming-parse.png\" alt=\"我的域名解析设置\"><br>然后在当前项目的 source/ 目录下创建一个名叫 CNAME 的文件，里面的内容就是你的域名地址。接着重新部署一下就可以了。</p>\n<h3 id=\"8-如何在项目中引入本地图片\"><a href=\"#8-如何在项目中引入本地图片\" class=\"headerlink\" title=\"8. 如何在项目中引入本地图片\"></a>8. 如何在项目中引入本地图片</h3><p><strong>第一步：</strong>安装插件：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install hexo-asset-image --save</span><br></pre></td></tr></table></figure>\n\n<p><strong>第二步：</strong>打开根目录下的 _config.yml 文件，修改 <span style=\"color:rgb(205,0,0)\">post_asset_folder</span> 字段为 <strong>true</strong></p>\n<p><strong>第三步：</strong>打开 /node_modules/hexo-asset-image/index.js 文件，替换为以下代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&#x27;use strict&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> cheerio = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;cheerio&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// http://stackoverflow.com/questions/14480345/how-to-get-the-nth-occurrence-in-a-string</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">getPosition</span>(<span class=\"params\">str, m, i</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> str.<span class=\"title function_\">split</span>(m, i).<span class=\"title function_\">join</span>(m).<span class=\"property\">length</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> version = <span class=\"title class_\">String</span>(hexo.<span class=\"property\">version</span>).<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;.&#x27;</span>);</span><br><span class=\"line\">hexo.<span class=\"property\">extend</span>.<span class=\"property\">filter</span>.<span class=\"title function_\">register</span>(<span class=\"string\">&#x27;after_post_render&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">data</span>)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> config = hexo.<span class=\"property\">config</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(config.<span class=\"property\">post_asset_folder</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> link = data.<span class=\"property\">permalink</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(version.<span class=\"property\">length</span> &gt; <span class=\"number\">0</span> &amp;&amp; <span class=\"title class_\">Number</span>(version[<span class=\"number\">0</span>]) == <span class=\"number\">3</span>)</span><br><span class=\"line\">       <span class=\"keyword\">var</span> beginPos = <span class=\"title function_\">getPosition</span>(link, <span class=\"string\">&#x27;/&#x27;</span>, <span class=\"number\">1</span>) + <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">       <span class=\"keyword\">var</span> beginPos = <span class=\"title function_\">getPosition</span>(link, <span class=\"string\">&#x27;/&#x27;</span>, <span class=\"number\">3</span>) + <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"comment\">// In hexo 3.1.1, the permalink of &quot;about&quot; page is like &quot;.../about/index.html&quot;.</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> endPos = link.<span class=\"title function_\">lastIndexOf</span>(<span class=\"string\">&#x27;/&#x27;</span>) + <span class=\"number\">1</span>;</span><br><span class=\"line\">    link = link.<span class=\"title function_\">substring</span>(beginPos, endPos);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> toprocess = [<span class=\"string\">&#x27;excerpt&#x27;</span>, <span class=\"string\">&#x27;more&#x27;</span>, <span class=\"string\">&#x27;content&#x27;</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; toprocess.<span class=\"property\">length</span>; i++)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> key = toprocess[i];</span><br><span class=\"line\"> </span><br><span class=\"line\">      <span class=\"keyword\">var</span> $ = cheerio.<span class=\"title function_\">load</span>(data[key], &#123;</span><br><span class=\"line\">        <span class=\"attr\">ignoreWhitespace</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"attr\">xmlMode</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"attr\">lowerCaseTags</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"attr\">decodeEntities</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">      $(<span class=\"string\">&#x27;img&#x27;</span>).<span class=\"title function_\">each</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($(<span class=\"variable language_\">this</span>).<span class=\"title function_\">attr</span>(<span class=\"string\">&#x27;src&#x27;</span>))&#123;</span><br><span class=\"line\">            <span class=\"comment\">// For windows style path, we replace &#x27;\\&#x27; to &#x27;/&#x27;.</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> src = $(<span class=\"variable language_\">this</span>).<span class=\"title function_\">attr</span>(<span class=\"string\">&#x27;src&#x27;</span>).<span class=\"title function_\">replace</span>(<span class=\"string\">&#x27;\\\\&#x27;</span>, <span class=\"string\">&#x27;/&#x27;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(!<span class=\"regexp\">/http[s]*.*|\\/\\/.*/</span>.<span class=\"title function_\">test</span>(src) &amp;&amp;</span><br><span class=\"line\">               !<span class=\"regexp\">/^\\s*\\//</span>.<span class=\"title function_\">test</span>(src)) &#123;</span><br><span class=\"line\">              <span class=\"comment\">// For &quot;about&quot; page, the first part of &quot;src&quot; can&#x27;t be removed.</span></span><br><span class=\"line\">              <span class=\"comment\">// In addition, to support multi-level local directory.</span></span><br><span class=\"line\">              <span class=\"keyword\">var</span> linkArray = link.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;/&#x27;</span>).<span class=\"title function_\">filter</span>(<span class=\"keyword\">function</span>(<span class=\"params\">elem</span>)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> elem != <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">              &#125;);</span><br><span class=\"line\">              <span class=\"keyword\">var</span> srcArray = src.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;/&#x27;</span>).<span class=\"title function_\">filter</span>(<span class=\"keyword\">function</span>(<span class=\"params\">elem</span>)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> elem != <span class=\"string\">&#x27;&#x27;</span> &amp;&amp; elem != <span class=\"string\">&#x27;.&#x27;</span>;</span><br><span class=\"line\">              &#125;);</span><br><span class=\"line\">              <span class=\"keyword\">if</span>(srcArray.<span class=\"property\">length</span> &gt; <span class=\"number\">1</span>)</span><br><span class=\"line\">                srcArray.<span class=\"title function_\">shift</span>();</span><br><span class=\"line\">              src = srcArray.<span class=\"title function_\">join</span>(<span class=\"string\">&#x27;/&#x27;</span>);</span><br><span class=\"line\">              $(<span class=\"variable language_\">this</span>).<span class=\"title function_\">attr</span>(<span class=\"string\">&#x27;src&#x27;</span>, config.<span class=\"property\">root</span> + link + src);</span><br><span class=\"line\">              <span class=\"variable language_\">console</span>.<span class=\"property\">info</span>&amp;&amp;<span class=\"variable language_\">console</span>.<span class=\"title function_\">info</span>(<span class=\"string\">&quot;update link as:--&gt;&quot;</span>+config.<span class=\"property\">root</span> + link + src);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"property\">info</span>&amp;&amp;<span class=\"variable language_\">console</span>.<span class=\"title function_\">info</span>(<span class=\"string\">&quot;no src attr, skipped...&quot;</span>);</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"property\">info</span>&amp;&amp;<span class=\"variable language_\">console</span>.<span class=\"title function_\">info</span>($(<span class=\"variable language_\">this</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      data[key] = $.<span class=\"title function_\">html</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p><strong>第四步：</strong>之后在新建一个新的文档内容的时候会自动生成一个同名文件夹，里面就可以放本页面需要的图片源文件，在需要的地方引入：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\">![<span class=\"string\">这是代替图片的文字，随便写</span>](<span class=\"link\">图片名字</span>)</span><br></pre></td></tr></table></figure>"}],"PostAsset":[],"PostCategory":[{"post_id":"cl79tdvv900015d9kcng650yc","category_id":"cl79tdvvb00045d9kbbhj1ao3","_id":"cl79tdvvh000q5d9kacufg190"},{"post_id":"cl79tdvv900015d9kcng650yc","category_id":"cl79tdvvg000j5d9k80qa8jje","_id":"cl79tdvvh000t5d9k20mp2tk3"},{"post_id":"cl79tdvvd000a5d9k12881hp6","category_id":"cl79tdvvh000m5d9kc6vnh3dh","_id":"cl79tdvvh000w5d9kfnx5feh7"},{"post_id":"cl79tdvve000d5d9kcfof4x60","category_id":"cl79tdvvh000r5d9kc1urh5jx","_id":"cl79tdvvh00105d9kgatd5zpd"},{"post_id":"cl79tdvva00035d9k30t26s9v","category_id":"cl79tdvvb00045d9kbbhj1ao3","_id":"cl79tdvvi00145d9k8woxgkky"},{"post_id":"cl79tdvva00035d9k30t26s9v","category_id":"cl79tdvvg000j5d9k80qa8jje","_id":"cl79tdvvi00185d9kehls5a4d"},{"post_id":"cl79tdvvf000h5d9kb49y4lxx","category_id":"cl79tdvvb00045d9kbbhj1ao3","_id":"cl79tdvvj001e5d9keqioe3lc"},{"post_id":"cl79tdvvf000h5d9kb49y4lxx","category_id":"cl79tdvvi00165d9k9s9y11bz","_id":"cl79tdvvj001h5d9k0nwpaeo3"},{"post_id":"cl79tdvvc00075d9k4wpygpt5","category_id":"cl79tdvvb00045d9kbbhj1ao3","_id":"cl79tdvvj001k5d9khwweejff"},{"post_id":"cl79tdvvc00075d9k4wpygpt5","category_id":"cl79tdvvi001b5d9khizz3rol","_id":"cl79tdvvj001m5d9k3ts44yh7"},{"post_id":"cl79tdvvf000i5d9katsg2a6t","category_id":"cl79tdvvh000r5d9kc1urh5jx","_id":"cl79tdvvj001o5d9k7caeaacn"},{"post_id":"cl79tdvvf000e5d9kfy8n4pl8","category_id":"cl79tdvvh000z5d9k8qzbhqjm","_id":"cl79tdvvj001r5d9k9pjjbjq1"},{"post_id":"cl79tdvvf000e5d9kfy8n4pl8","category_id":"cl79tdvvj001j5d9k1sfi8lw7","_id":"cl79tdvvj001s5d9k68pp38tr"},{"post_id":"cl79tdvvm001t5d9kh20idq5w","category_id":"cl79tdvvb00045d9kbbhj1ao3","_id":"cl79tdvvo001z5d9k598vg750"},{"post_id":"cl79tdvvm001t5d9kh20idq5w","category_id":"cl79tdvvi00165d9k9s9y11bz","_id":"cl79tdvvo00215d9kfaxe14aa"},{"post_id":"cl79tdvvn001u5d9k782khzoz","category_id":"cl79tdvvb00045d9kbbhj1ao3","_id":"cl79tdvvo00235d9kad1y7k0m"},{"post_id":"cl79tdvvn001u5d9k782khzoz","category_id":"cl79tdvvo001y5d9k7spr5av4","_id":"cl79tdvvo00245d9k42mu3y5c"},{"post_id":"cl79tdvvn001w5d9k7dlob7w1","category_id":"cl79tdvvo00225d9k8ipvarff","_id":"cl79tdvvo00255d9kh5w0cxza"}],"PostTag":[{"post_id":"cl79tdvv900015d9kcng650yc","tag_id":"cl79tdvvc00055d9kc8c098jc","_id":"cl79tdvvh000l5d9k7sied88x"},{"post_id":"cl79tdvv900015d9kcng650yc","tag_id":"cl79tdvvd000c5d9kc5ztbki6","_id":"cl79tdvvh000n5d9kglrl3s20"},{"post_id":"cl79tdvv900015d9kcng650yc","tag_id":"cl79tdvvf000g5d9k8rqh25bw","_id":"cl79tdvvh000p5d9k63zfc4s6"},{"post_id":"cl79tdvva00035d9k30t26s9v","tag_id":"cl79tdvvf000g5d9k8rqh25bw","_id":"cl79tdvvh000u5d9kawmwba4z"},{"post_id":"cl79tdvva00035d9k30t26s9v","tag_id":"cl79tdvvc00055d9kc8c098jc","_id":"cl79tdvvh000v5d9kgajt0nd1"},{"post_id":"cl79tdvvc00075d9k4wpygpt5","tag_id":"cl79tdvvc00055d9kc8c098jc","_id":"cl79tdvvi00125d9kfi727kow"},{"post_id":"cl79tdvvc00075d9k4wpygpt5","tag_id":"cl79tdvvh000x5d9khcsh7off","_id":"cl79tdvvi00135d9k187fhar8"},{"post_id":"cl79tdvvd000a5d9k12881hp6","tag_id":"cl79tdvvc00055d9kc8c098jc","_id":"cl79tdvvi00175d9kg81e3vrh"},{"post_id":"cl79tdvvd000a5d9k12881hp6","tag_id":"cl79tdvvf000g5d9k8rqh25bw","_id":"cl79tdvvi00195d9k9auhfjjh"},{"post_id":"cl79tdvve000d5d9kcfof4x60","tag_id":"cl79tdvvi00155d9k1qkq562v","_id":"cl79tdvvj001c5d9kblyqf40b"},{"post_id":"cl79tdvvf000e5d9kfy8n4pl8","tag_id":"cl79tdvvf000g5d9k8rqh25bw","_id":"cl79tdvvj001g5d9kffvo0iki"},{"post_id":"cl79tdvvf000h5d9kb49y4lxx","tag_id":"cl79tdvvc00055d9kc8c098jc","_id":"cl79tdvvj001l5d9k6julg1jd"},{"post_id":"cl79tdvvf000h5d9kb49y4lxx","tag_id":"cl79tdvvf000g5d9k8rqh25bw","_id":"cl79tdvvj001n5d9k488thyr3"},{"post_id":"cl79tdvvf000h5d9kb49y4lxx","tag_id":"cl79tdvvj001d5d9kfpk78q2q","_id":"cl79tdvvj001p5d9kdoml82by"},{"post_id":"cl79tdvvf000i5d9katsg2a6t","tag_id":"cl79tdvvi00155d9k1qkq562v","_id":"cl79tdvvj001q5d9kco2wa148"},{"post_id":"cl79tdvvm001t5d9kh20idq5w","tag_id":"cl79tdvvf000g5d9k8rqh25bw","_id":"cl79tdvvn001v5d9kbhh1h38i"},{"post_id":"cl79tdvvn001u5d9k782khzoz","tag_id":"cl79tdvvd000c5d9kc5ztbki6","_id":"cl79tdvvo001x5d9kgjfj4vgp"},{"post_id":"cl79tdvvn001u5d9k782khzoz","tag_id":"cl79tdvvc00055d9kc8c098jc","_id":"cl79tdvvo00205d9k0f8dfn8j"}],"Tag":[{"name":"前端开发","_id":"cl79tdvvc00055d9kc8c098jc"},{"name":"懒人福音","_id":"cl79tdvvd000c5d9kc5ztbki6"},{"name":"知识积累","_id":"cl79tdvvf000g5d9k8rqh25bw"},{"name":"面试题","_id":"cl79tdvvh000x5d9khcsh7off"},{"name":"备份","_id":"cl79tdvvi00155d9k1qkq562v"},{"name":"Vue积累","_id":"cl79tdvvj001d5d9kfpk78q2q"}]}}